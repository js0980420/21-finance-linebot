import{r as m,H as j,i as C,u as M,c as g,a as o,x as T,e as w,j as i,d as s,f as _,g as n,I as d,F as A,q as D,v as a,G as f,t as k,n as $,o as b,aZ as E}from"#entry";import{u as I,a as L}from"./DgLT0ASK.js";import{u as B}from"./BtlpaPqX.js";import{u as O}from"./7WFD-W98.js";import{r as z}from"./Bi0YyG7H.js";const F={class:"space-y-6"},H={class:"flex items-center justify-between"},G={class:"bg-white shadow rounded-lg"},P={class:"bg-blue-50 p-4 rounded-lg"},R={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"},Z=["value"],J={class:"bg-green-50 p-4 rounded-lg"},K={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"},Q={class:"bg-yellow-50 p-4 rounded-lg"},W={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},X={class:"md:col-span-2"},Y={class:"bg-purple-50 p-4 rounded-lg"},h={class:"bg-red-50 p-4 rounded-lg"},ee={class:"space-y-4"},oe={class:"flex justify-end space-x-3 pt-6 border-t border-gray-200"},te=["disabled"],re={class:"bg-white rounded-lg p-6 w-full max-w-md"},se={class:"flex items-center mb-4"},pe={__name:"add",setup(le){const y=I(),{error:c}=B(),{getUsers:V}=O(),{post:U}=L(),u=m(!1),p=m(!1),x=m([]),t=j({tracking_person_id:null,contact_time:"",service_stage:"",opportunity_order:"",maintenance_progress:"",opportunity_status:"",contact_method:"",conversation_record:"",contact_duration:null,customer_response:"",notes:"",priority:"中",follow_up_date:""}),S=async()=>{try{const{success:l,users:e}=await V({per_page:250});l&&Array.isArray(e)&&(x.value=e)}catch(l){console.warn("Load users failed:",l)}},q=async()=>{u.value=!0;try{if(!t.tracking_person_id||!t.contact_time||!t.service_stage||!t.opportunity_status||!t.contact_method||!t.maintenance_progress||!t.conversation_record){c("請填寫所有必填欄位");return}const l={tracking_person_id:t.tracking_person_id,contact_time:t.contact_time,service_stage:t.service_stage,opportunity_order:t.opportunity_order||null,maintenance_progress:t.maintenance_progress,opportunity_status:t.opportunity_status,contact_method:t.contact_method,conversation_record:t.conversation_record,contact_duration:t.contact_duration||null,customer_response:t.customer_response||null,notes:t.notes||null,priority:t.priority||"中",follow_up_date:t.follow_up_date||null},{data:e,error:r}=await U("/tracking-records",l);if(r){c(r.message||"儲存失敗，請稍後再試");return}p.value=!0}catch(l){c("系統錯誤，請稍後再試"),console.error("Save tracking record error:",l)}finally{u.value=!1}},v=()=>{p.value=!1,$("/sales/tracking-records")},N=()=>{p.value=!1;const l=t.tracking_person_id;Object.assign(t,{tracking_person_id:l,contact_time:"",service_stage:"",opportunity_order:"",maintenance_progress:"",opportunity_status:"",contact_method:"",conversation_record:"",contact_duration:null,customer_response:"",notes:"",priority:"中",follow_up_date:""})};return C(async()=>{await S();const l=new Date,e=new Date(l.getTime()-l.getTimezoneOffset()*6e4).toISOString().slice(0,16);t.contact_time=e,y.user?.id&&(t.tracking_person_id=y.user.id)}),M({title:"新增追蹤紀錄 - 貸款案件管理系統"}),(l,e)=>(b(),g("div",F,[o("div",H,[e[16]||(e[16]=o("div",null,[o("h1",{class:"text-3xl font-bold text-gray-900"},"新增追蹤紀錄"),o("p",{class:"text-gray-600 mt-2"},"記錄客戶追蹤歷程與業務互動詳情")],-1)),o("button",{onClick:e[0]||(e[0]=r=>l.$router.go(-1)),class:"inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"},[w(s(E),{class:"-ml-1 mr-2 h-5 w-5","aria-hidden":"true"}),e[15]||(e[15]=i(" 返回 ",-1))])]),o("div",G,[e[40]||(e[40]=o("div",{class:"px-6 py-4 border-b border-gray-200"},[o("h3",{class:"text-lg font-medium text-gray-900"},"追蹤紀錄資訊"),o("p",{class:"mt-1 text-sm text-gray-500"},"請填寫完整的客戶追蹤紀錄資料")],-1)),o("form",{onSubmit:_(q,["prevent"]),class:"p-6 space-y-6"},[o("div",P,[e[22]||(e[22]=o("h4",{class:"text-md font-semibold text-gray-800 mb-4"},"基本資訊",-1)),o("div",R,[o("div",null,[e[18]||(e[18]=o("label",{class:"block text-sm font-semibold text-gray-900 mb-1"},[i(" 記錄人員 "),o("span",{class:"text-red-500"},"*")],-1)),n(o("select",{"onUpdate:modelValue":e[1]||(e[1]=r=>s(t).tracking_person_id=r),required:"",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},[e[17]||(e[17]=o("option",{value:""},"請選擇記錄人員",-1)),(b(!0),g(A,null,D(s(x),r=>(b(),g("option",{key:r.id,value:r.id},k(r.name),9,Z))),128))],512),[[d,s(t).tracking_person_id]])]),o("div",null,[e[19]||(e[19]=o("label",{class:"block text-sm font-semibold text-gray-900 mb-1"},[i(" 聯繫時間 "),o("span",{class:"text-red-500"},"*")],-1)),n(o("input",{"onUpdate:modelValue":e[2]||(e[2]=r=>s(t).contact_time=r),type:"datetime-local",required:"",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,512),[[a,s(t).contact_time]])]),o("div",null,[e[21]||(e[21]=o("label",{class:"block text-sm font-semibold text-gray-900 mb-1"},[i(" 聯絡方式 "),o("span",{class:"text-red-500"},"*")],-1)),n(o("select",{"onUpdate:modelValue":e[3]||(e[3]=r=>s(t).contact_method=r),required:"",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},[...e[20]||(e[20]=[f('<option value="">請選擇聯絡方式</option><option value="電話">電話</option><option value="LINE">LINE</option><option value="面談">面談</option><option value="郵件">郵件</option><option value="系統紀錄">系統紀錄</option><option value="其他">其他</option>',7)])],512),[[d,s(t).contact_method]])])])]),o("div",J,[e[28]||(e[28]=o("h4",{class:"text-md font-semibold text-gray-800 mb-4"},"案件資訊",-1)),o("div",K,[o("div",null,[e[24]||(e[24]=o("label",{class:"block text-sm font-semibold text-gray-900 mb-1"},[i(" 服務階段 "),o("span",{class:"text-red-500"},"*")],-1)),n(o("select",{"onUpdate:modelValue":e[4]||(e[4]=r=>s(t).service_stage=r),required:"",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},[...e[23]||(e[23]=[f('<option value="">請選擇服務階段</option><option value="初次接觸">初次接觸</option><option value="需求確認">需求確認</option><option value="資料收集">資料收集</option><option value="方案評估">方案評估</option><option value="申請提交">申請提交</option><option value="審核追蹤">審核追蹤</option><option value="結果確認">結果確認</option><option value="後續服務">後續服務</option>',9)])],512),[[d,s(t).service_stage]])]),o("div",null,[e[25]||(e[25]=o("label",{class:"block text-sm font-semibold text-gray-900 mb-1"}," 商機單 ",-1)),n(o("input",{"onUpdate:modelValue":e[5]||(e[5]=r=>s(t).opportunity_order=r),type:"text",placeholder:"請輸入商機單號",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,512),[[a,s(t).opportunity_order]])]),o("div",null,[e[27]||(e[27]=o("label",{class:"block text-sm font-semibold text-gray-900 mb-1"},[i(" 商機狀態 "),o("span",{class:"text-red-500"},"*")],-1)),n(o("select",{"onUpdate:modelValue":e[6]||(e[6]=r=>s(t).opportunity_status=r),required:"",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},[...e[26]||(e[26]=[f('<option value="">請選擇商機狀態</option><option value="有興趣">有興趣</option><option value="需考慮">需考慮</option><option value="暫無需求">暫無需求</option><option value="拒絕">拒絕</option><option value="轉介">轉介</option>',6)])],512),[[d,s(t).opportunity_status]])])])]),o("div",Q,[e[33]||(e[33]=o("h4",{class:"text-md font-semibold text-gray-800 mb-4"},"追蹤詳情",-1)),o("div",W,[o("div",null,[e[29]||(e[29]=o("label",{class:"block text-sm font-semibold text-gray-900 mb-1"}," 聯繫時長（分鐘） ",-1)),n(o("input",{"onUpdate:modelValue":e[7]||(e[7]=r=>s(t).contact_duration=r),type:"number",min:"0",placeholder:"請輸入聯繫時長",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,512),[[a,s(t).contact_duration,void 0,{number:!0}]])]),o("div",null,[e[31]||(e[31]=o("label",{class:"block text-sm font-semibold text-gray-900 mb-1"}," 優先級別 ",-1)),n(o("select",{"onUpdate:modelValue":e[8]||(e[8]=r=>s(t).priority=r),class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},[...e[30]||(e[30]=[o("option",{value:"中"},"中",-1),o("option",{value:"高"},"高",-1),o("option",{value:"低"},"低",-1)])],512),[[d,s(t).priority]])]),o("div",X,[e[32]||(e[32]=o("label",{class:"block text-sm font-semibold text-gray-900 mb-1"}," 下次追蹤日期 ",-1)),n(o("input",{"onUpdate:modelValue":e[9]||(e[9]=r=>s(t).follow_up_date=r),type:"date",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,512),[[a,s(t).follow_up_date]])])])]),o("div",Y,[e[35]||(e[35]=o("h4",{class:"text-md font-semibold text-gray-800 mb-4"},"維護進度",-1)),o("div",null,[e[34]||(e[34]=o("label",{class:"block text-sm font-semibold text-gray-900 mb-1"},[i(" 維護進度 "),o("span",{class:"text-red-500"},"*")],-1)),n(o("textarea",{"onUpdate:modelValue":e[10]||(e[10]=r=>s(t).maintenance_progress=r),required:"",rows:"3",placeholder:"請詳細描述當前的維護進度和處理情況...",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,512),[[a,s(t).maintenance_progress]])])]),o("div",h,[e[39]||(e[39]=o("h4",{class:"text-md font-semibold text-gray-800 mb-4"},"對話紀錄",-1)),o("div",ee,[o("div",null,[e[36]||(e[36]=o("label",{class:"block text-sm font-semibold text-gray-900 mb-1"},[i(" 對話紀錄 "),o("span",{class:"text-red-500"},"*")],-1)),n(o("textarea",{"onUpdate:modelValue":e[11]||(e[11]=r=>s(t).conversation_record=r),required:"",rows:"4",placeholder:"請記錄與客戶的詳細對話內容...",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,512),[[a,s(t).conversation_record]])]),o("div",null,[e[37]||(e[37]=o("label",{class:"block text-sm font-semibold text-gray-900 mb-1"}," 客戶回應 ",-1)),n(o("textarea",{"onUpdate:modelValue":e[12]||(e[12]=r=>s(t).customer_response=r),rows:"3",placeholder:"請記錄客戶的具體回應和反饋...",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,512),[[a,s(t).customer_response]])]),o("div",null,[e[38]||(e[38]=o("label",{class:"block text-sm font-semibold text-gray-900 mb-1"}," 詳細備註 ",-1)),n(o("textarea",{"onUpdate:modelValue":e[13]||(e[13]=r=>s(t).notes=r),rows:"2",placeholder:"其他需要記錄的重要資訊...",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,512),[[a,s(t).notes]])])])]),o("div",oe,[o("button",{type:"button",onClick:e[14]||(e[14]=r=>l.$router.go(-1)),class:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"}," 取消 "),o("button",{type:"submit",disabled:s(u),class:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed"},k(s(u)?"儲存中...":"儲存追蹤紀錄"),9,te)])],32)]),s(p)?(b(),g("div",{key:0,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",onClick:_(v,["self"])},[o("div",re,[o("div",se,[w(s(z),{class:"h-6 w-6 text-green-600 mr-3"}),e[41]||(e[41]=o("h3",{class:"text-lg font-semibold text-gray-900"},"追蹤紀錄新增成功",-1))]),e[42]||(e[42]=o("p",{class:"text-gray-600 mb-6"},"追蹤紀錄已成功儲存到系統中",-1)),o("div",{class:"flex justify-end space-x-3"},[o("button",{onClick:v,class:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50"}," 返回列表 "),o("button",{onClick:N,class:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700"}," 新增另一筆 ")])])])):T("",!0)]))}};export{pe as default};
