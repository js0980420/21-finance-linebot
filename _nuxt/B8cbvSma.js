import pt from"./-Op9ZE8F.js";import{_ as yt,r as b,b as ie,H as J,y as bt,i as mt,C as gt,u as _t,c as r,a as s,e as O,x as y,k as v,d as o,f as N,g as p,I as E,F as _,q as x,v as g,t as c,j as C,l as Ne,J as xt,o as i,A as ft,K as R,s as K,L as z,n as Ee,h as vt}from"#entry";import{_ as ht,r as kt}from"./CRGlAI26.js";import{u as De}from"./CaSEveCJ.js";import{u as wt}from"./l19cjJOa.js";import{u as Ut,a as _e}from"./DgLT0ASK.js";import{u as Ct}from"./BtlpaPqX.js";import{u as Vt}from"./7WFD-W98.js";import{u as Lt}from"./DzJdZt_Q.js";import{u as It}from"./DQZituR6.js";import{r as St}from"./BKE9UY2T.js";import{r as Nt}from"./DdngC8ig.js";import{r as Et}from"./c8JhvyFk.js";import"./B5My0XuL.js";import"./CKtbBPOe.js";const Dt={class:"space-y-6"},jt=["value"],Tt=["value","onChange"],$t=["value"],At={class:"text-sm font-medium text-gray-900"},Ot=["value","onChange"],qt=["value"],Mt=["value","onChange"],Pt={class:"text-sm text-gray-900"},Ft={class:"text-xs text-gray-500"},Rt={class:"flex items-center space-x-2"},zt={class:"text-sm text-gray-900"},Bt=["onClick"],Wt={class:"text-sm text-gray-900"},Gt={class:"text-xs text-gray-500"},Ht={key:0,class:"flex items-center space-x-2"},Xt=["src","alt"],Jt={key:1,class:"w-6 h-6 rounded-full bg-green-500 flex items-center justify-center text-white text-xs"},Kt={class:"flex-1 min-w-0"},Qt={class:"flex items-center space-x-1"},Yt={class:"text-xs font-medium text-gray-900 truncate"},Zt=["onClick"],es={key:1,class:"flex items-center space-x-2"},ts={class:"text-xs text-gray-900"},ss={key:2,class:"text-xs text-gray-400"},os={class:"text-sm text-gray-900"},ls={class:"text-xs text-gray-500 truncate max-w-[120px]"},as={class:"text-sm text-gray-900"},ns=["value","onChange"],rs={key:0,class:"space-y-1"},is={class:"text-gray-500"},ds={class:"text-gray-900 ml-1"},us={key:0,class:"text-xs text-gray-400"},cs={key:1,class:"text-xs text-gray-400"},ps={class:"flex items-center space-x-2 justify-end"},ys=["onClick"],bs=["onClick"],ms=["onClick"],gs=["onClick"],_s={class:"bg-white h-full w-full overflow-hidden flex flex-col"},xs={class:"flex items-center justify-between p-6 border-b bg-gray-50"},fs={class:"flex-1 overflow-hidden"},vs={class:"flex-1 border-r overflow-y-auto p-6 bg-blue-50"},hs={class:"space-y-4"},ks=["value"],ws=["value"],Us={class:"space-y-2"},Cs=["value"],Vs={class:"space-y-2"},Ls={class:"flex-1 border-r overflow-y-auto p-6 bg-green-50"},Is={class:"text-lg font-semibold text-gray-800 mb-4 sticky top-0 bg-green-50 py-2"},Ss={class:"space-y-4"},Ns={class:"block text-sm font-semibold text-gray-900 mb-1"},Es={key:0,class:"text-red-500"},Ds=["onUpdate:modelValue","type","readonly"],js=["onUpdate:modelValue"],Ts=["onUpdate:modelValue"],$s=["onUpdate:modelValue"],As=["value"],Os={key:4,class:"inline-flex items-center space-x-2 mt-2"},qs=["onUpdate:modelValue"],Ms={key:5,class:"text-sm text-gray-500"},Ps={class:"flex-1 border-r overflow-y-auto p-6 bg-yellow-50"},Fs={class:"text-lg font-semibold text-gray-800 mb-4 sticky top-0 bg-yellow-50 py-2"},Rs={class:"space-y-4"},zs={class:"block text-sm font-semibold text-gray-900 mb-1"},Bs={key:0,class:"text-red-500"},Ws=["onUpdate:modelValue","type","readonly"],Gs=["onUpdate:modelValue"],Hs=["onUpdate:modelValue"],Xs=["onUpdate:modelValue"],Js=["value"],Ks={key:4,class:"inline-flex items-center space-x-2 mt-2"},Qs=["onUpdate:modelValue"],Ys={class:"flex-1 border-r overflow-y-auto p-6 bg-purple-50"},Zs={class:"text-lg font-semibold text-gray-800 mb-4 sticky top-0 bg-purple-50 py-2"},eo={class:"space-y-4"},to={class:"block text-sm font-semibold text-gray-900 mb-1"},so={key:0,class:"text-red-500"},oo=["onUpdate:modelValue","type","readonly"],lo=["onUpdate:modelValue"],ao={key:2,class:"inline-flex items-center space-x-2 mt-2"},no=["onUpdate:modelValue"],ro={class:"flex-1 border-r overflow-y-auto p-6 bg-red-50"},io={class:"text-lg font-semibold text-gray-800 mb-4 sticky top-0 bg-red-50 py-2"},uo={class:"space-y-4"},co={class:"block text-sm font-semibold text-gray-900 mb-1"},po={key:0,class:"text-red-500"},yo=["onUpdate:modelValue","type","readonly"],bo={key:1,class:"inline-flex items-center space-x-2 mt-2"},mo=["onUpdate:modelValue"],go={class:"flex-1 overflow-y-auto p-6 bg-gray-50"},_o={class:"text-lg font-semibold text-gray-800 mb-4 sticky top-0 bg-gray-50 py-2"},xo={class:"space-y-4"},fo={class:"block text-sm font-semibold text-gray-900 mb-1"},vo={key:0,class:"text-red-500"},ho=["onUpdate:modelValue","type","readonly"],ko=["onUpdate:modelValue"],wo={key:0,class:"border-t pt-4"},Uo={class:"space-y-4"},Co={class:"block text-sm font-semibold text-gray-900 mb-1"},Vo={key:0,class:"text-red-500"},Lo=["type","step","required","onUpdate:modelValue"],Io=["required","onUpdate:modelValue"],So=["required","onUpdate:modelValue"],No=["value"],Eo={key:3},Do={class:"flex flex-wrap gap-2"},jo=["value","onUpdate:modelValue"],To={key:4,class:"inline-flex items-center space-x-2 mt-2"},$o=["onUpdate:modelValue"],Ao={class:"border-t pt-4"},Oo={class:"border-t pt-4 flex justify-end space-x-3"},qo=["disabled"],Mo={class:"bg-white rounded-lg p-6 w-full max-w-2xl mx-4 max-h-[90vh] overflow-y-auto"},Po={key:0,class:"space-y-4"},Fo={class:"grid grid-cols-2 gap-4"},Ro={class:"text-gray-900"},zo={class:"text-gray-900"},Bo={class:"text-gray-900"},Wo={class:"text-gray-900"},Go={class:"text-gray-900"},Ho={class:"text-gray-900"},Xo={key:0},Jo={class:"text-gray-900 whitespace-pre-wrap"},Ko={class:"bg-white rounded-lg p-6 w-full max-w-lg"},Qo={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},Yo={class:"md:col-span-2"},Zo={class:"bg-white rounded-lg p-6 w-full max-w-md"},el={key:0,class:"mb-4"},tl={class:"bg-gray-50 p-3 rounded-lg"},sl={class:"text-sm text-gray-900"},ol={class:"text-sm text-gray-900"},ll={class:"text-sm text-gray-900"},al=["value"],nl={class:"flex justify-end space-x-3 pt-4"},rl=["disabled"],il={class:"bg-white rounded-lg p-6 w-full max-w-md"},dl={key:0,class:"mb-4"},ul={class:"bg-gray-50 p-3 rounded-lg flex items-center space-x-3"},cl=["src","alt"],pl={key:1,class:"w-10 h-10 rounded-full bg-green-500 flex items-center justify-center text-white text-sm"},yl={class:"text-sm text-gray-900 font-medium"},bl={class:"text-xs text-gray-500"},ml={class:"flex justify-end space-x-3 pt-4"},gl=["disabled"],_l={__name:"approved-disbursed",setup(xl){const je=[{key:"case_status",title:"進線狀態",sortable:!0,width:"90px"},{key:"datetime",title:"時間",sortable:!0,width:"140px"},{key:"assignee",title:"承辦業務",sortable:!0,width:"80px"},{key:"channel",title:"來源管道",sortable:!0,width:"80px"},{key:"customer_name",title:"姓名",sortable:!0,width:"80px"},{key:"line_info",title:"LINE資訊",sortable:!1,width:"160px"},{key:"purpose",title:"諮詢項目",sortable:!1,width:"100px"},{key:"website",title:"網站",sortable:!1,width:"50px"},{key:"contact_info",title:"聯絡資訊",sortable:!1,width:"160px"},{key:"actions",title:"操作",sortable:!1,width:"160px"}],V={personal:{title:"個人資料",fields:[{key:"birth_date",label:"出生年月日",type:"date"},{key:"id_number",label:"身份證字號",type:"text"},{key:"education",label:"最高學歷",type:"select",options:["國小","國中","高中職","專科","大學","碩士","博士"]}]},contact:{title:"聯絡資訊",fields:[{key:"region",label:"所在地區",type:"text"},{key:"registered_address",label:"戶籍地址",type:"text"},{key:"home_phone",label:"室內電話",type:"text"},{key:"address_same",label:"通訊地址是否同戶籍地",type:"boolean"},{key:"mailing_address",label:"通訊地址",type:"text"},{key:"mobile_phone",label:"通訊電話",type:"text"},{key:"residence_duration",label:"現居地住多久",type:"text"},{key:"residence_owner",label:"居住地持有人",type:"text"},{key:"telecom_provider",label:"電信業者",type:"select",options:["中華電信","台灣大哥大","遠傳電信","台灣之星","亞太電信"]}]},other:{title:"其他資訊",fields:[{key:"case_number",label:"進線編號",type:"text",readonly:!0},{key:"required_amount",label:"需求金額",type:"number"},{key:"custom_fields",label:"自定義欄位",type:"custom"}]},company:{title:"公司資料",fields:[{key:"company_email",label:"電子郵件",type:"email"},{key:"company_name",label:"公司名稱",type:"text"},{key:"company_phone",label:"公司電話",type:"text"},{key:"company_address",label:"公司地址",type:"text"},{key:"job_title",label:"職稱",type:"text"},{key:"monthly_income",label:"月收入",type:"number"},{key:"new_labor_insurance",label:"有無新轉勞保",type:"boolean"},{key:"employment_duration",label:"目前公司在職多久",type:"text"}]},emergency:{title:"緊急聯絡人",fields:[{key:"contact1_name",label:"聯絡人①姓名",type:"text"},{key:"contact1_relationship",label:"聯絡人①關係",type:"text"},{key:"contact1_phone",label:"聯絡人①電話",type:"text"},{key:"contact1_available_time",label:"方便聯絡時間",type:"text"},{key:"contact1_confidential",label:"是否保密",type:"boolean"},{key:"contact2_name",label:"聯絡人②姓名",type:"text"},{key:"contact2_relationship",label:"聯絡人②關係",type:"text"},{key:"contact2_phone",label:"聯絡人②電話",type:"text"},{key:"contact2_confidential",label:"是否保密",type:"boolean"},{key:"contact2_available_time",label:"方便聯絡時間",type:"text"},{key:"referrer",label:"介紹人",type:"text"}]}},Q=Ut(),{success:L,error:m,confirm:de}=Ct(),{list:Te,updateOne:xe,removeOne:$e,convertToCase:Ae}=wt(),{getUsers:Oe}=Vt(),{list:qe}=Lt(),{refreshBadges:Y}=It(),{get:Me}=_e(),q=b(""),D=b("all"),Z=b(!1),ue=b(null),f=b([]),B=b([]),Pe=b({pending:0,today:0,thisWeek:0,processingRate:0}),ce=b([]),Fe=b([]),ee=b(!1),pe=b(!1),te=b(!1),se=b(!1),oe=b(!1),le=b(null),k=b(null),ae=b(null),j=b(null),w=b(null),I=b(!1),W=b(1),ye=b(5);ie(()=>Math.ceil(ve.value.length/ye.value));const G=b([]),h=J({}),fe=[{value:"pending",label:"待處理",category:"leads",route:"/cases"},{value:"valid_customer",label:"有效客",category:"leads_management",route:"/cases/valid-customer"},{value:"invalid_customer",label:"無效客",category:"leads_management",route:"/cases/invalid-customer"},{value:"customer_service",label:"客服",category:"leads_management",route:"/cases/customer-service"},{value:"blacklist",label:"黑名單",category:"leads_management",route:"/cases/blacklist"},{value:"approved_disbursed",label:"核准撥款",category:"submissions",route:"/submissions/approved-disbursed"},{value:"approved_undisbursed",label:"核准未撥",category:"submissions",route:"/submissions/approved-pending"},{value:"conditional_approval",label:"附條件",category:"submissions",route:"/submissions/conditional"},{value:"rejected",label:"婉拒",category:"submissions",route:"/submissions/declined"},{value:"tracking",label:"追蹤中",category:"tracking",route:"/tracking/index"}],Re=Array.from({length:10},(l,t)=>`G${t+1}`),a=J({page_url:"",website_domain:"",channel:"wp_form",status:"pending",created_at:"",assigned_to:null,customer_name:"",email:null,line_id:"",loan_purpose:"",ip_address:null,notes:"",birth_date:"",id_number:"",education:"",region:"",registered_address:"",home_phone:"",address_same:!1,mailing_address:"",mobile_phone:"",residence_duration:"",residence_owner:"",telecom_provider:"",case_number:"",required_amount:null,company_email:"",company_name:"",company_phone:"",company_address:"",job_title:"",monthly_income:null,new_labor_insurance:!1,employment_duration:"",contact1_name:"",contact1_relationship:"",contact1_phone:"",contact1_available_time:"",contact1_confidential:!1,contact2_name:"",contact2_relationship:"",contact2_phone:"",contact2_confidential:!1,contact2_available_time:"",referrer:""}),T=J({loan_amount:null,loan_type:"",notes:""}),$=J({assigned_to:null}),S=J({display_name:""}),ze=ie(()=>je),ve=ie(()=>{let l=f.value;if(q.value&&q.value.length>=2){const t=q.value.toLowerCase();l=l.filter(u=>u.email?.toLowerCase().includes(t)||u.line_id?.toLowerCase().includes(t)||u.payload?.頁面_URL?.toLowerCase().includes(t)||u.source?.toLowerCase().includes(t)||u.assignee?.name?.toLowerCase().includes(t))}return D.value&&D.value!=="all"&&(D.value==="null"?l=l.filter(t=>!t.assigned_to):l=l.filter(t=>t.assigned_to===parseInt(D.value))),l}),ne=ie(()=>G.value.filter(l=>l.is_visible)),A=async()=>{Z.value=!0,ue.value=null;try{if(Ne().public.apiBaseUrl==="/mock-api"){const e=De();f.value=e.leads.filter(n=>n.case_status==="pending"),Z.value=!1,await Y();return}const{items:t,meta:u,success:d}=await Te({case_status:"pending",per_page:1e3});if(d){f.value=t||[];const e=f.value.length,n=new Date,M=f.value.filter(U=>new Date(U.created_at).toDateString()===n.toDateString()).length,H=f.value.filter(U=>{const P=new Date(U.created_at),X=new Date(n);return X.setDate(n.getDate()-n.getDay()),P>=X}).length;Pe.value={pending:e,today:M,thisWeek:H,processingRate:e>0?Math.round(H/e*100):0}}}catch(l){ue.value="載入進線數據失敗",console.error("Load leads error:",l)}finally{Z.value=!1}},Be=async()=>{try{const{success:l,users:t}=await Oe({per_page:250});l&&Array.isArray(t)&&(B.value=t)}catch(l){console.warn("Load users failed:",l)}},he=async()=>{const{success:l,items:t}=await qe("case");l&&(G.value=t)},We=async()=>{try{const{data:l,error:t}=await Me("/websites/options");!t&&Array.isArray(l)?(ce.value=l,Fe.value=l.map(u=>({value:u.domain,label:u.name,website:u}))):console.warn("Failed to load websites from management system:",t)}catch(l){console.warn("Load websites failed:",l)}},Ge=l=>{q.value=l,W.value=1},He=l=>{W.value=l},Xe=l=>{ye.value=l,W.value=1};let be;bt([q,D],()=>{clearTimeout(be),be=setTimeout(()=>{W.value=1},300)});const Je=l=>{k.value=l,pe.value=!0},ke=()=>{pe.value=!1,k.value=null},Ke=async l=>{le.value=l.id;const t=l.payload?.頁面_URL||l.source||"",u=ge(t),d=l.payload||{};Object.assign(a,{page_url:t,website_domain:u.website?u.domain:t?"other":"",channel:l.channel||"wp_form",status:l.status||"pending",created_at:l.created_at?new Date(l.created_at).toISOString().slice(0,16):new Date().toISOString().slice(0,16),assigned_to:l.assigned_to||null,customer_name:l.customer_name||"",email:null,line_id:l.line_id||d.LINE_ID||"",loan_purpose:d.貸款需求||"",ip_address:l.ip_address||null,notes:l.notes||d.備註||"",birth_date:d.出生年月日||"",id_number:d.身份證字號||"",education:d.最高學歷||"",region:d.房屋區域||d.所在地區||"",registered_address:d.戶籍地址||"",home_phone:d.室內電話||"",address_same:d.通訊地址是否同戶籍地||!1,mailing_address:d.通訊地址||d.房屋地址||"",mobile_phone:d.通訊電話||l.phone||"",residence_duration:d.現居地住多久||"",residence_owner:d.居住地持有人||"",telecom_provider:d.電信業者||"",case_number:re(l),required_amount:d.資金需求||null,company_email:d.電子郵件||l.email||"",company_name:d.公司名稱||"",company_phone:d.公司電話||"",company_address:d.公司地址||"",job_title:d.職稱||"",monthly_income:d.月收入||null,new_labor_insurance:d.有無新轉勞保||!1,employment_duration:d.目前公司在職多久||"",contact1_name:d["聯絡人①姓名"]||"",contact1_relationship:d["聯絡人①關係"]||"",contact1_phone:d["聯絡人①電話"]||"",contact1_available_time:d.方便聯絡時間||"",contact1_confidential:d.是否保密||!1,contact2_name:d["聯絡人②姓名"]||"",contact2_relationship:d["聯絡人②關係"]||"",contact2_phone:d["聯絡人②電話"]||"",contact2_confidential:d["聯絡人②是否保密"]||!1,contact2_available_time:d["聯絡人②方便聯絡時間"]||"",referrer:d.介紹人||""}),await he(),rt(l),ee.value=!0},me=()=>{ee.value=!1,le.value=null},Qe=async()=>{if(le.value){I.value=!0;try{let l=a.page_url;if(a.website_domain&&a.website_domain!=="other"){const d=ce.value.find(e=>e.domain===a.website_domain);d&&(l=d.url)}const t={channel:a.channel,status:a.status,email:a.email,line_id:a.line_id,ip_address:a.ip_address,assigned_to:a.assigned_to,notes:a.notes,customer_name:a.customer_name,payload:{頁面_URL:l,LINE_ID:a.line_id,貸款需求:a.loan_purpose,備註:a.notes,出生年月日:a.birth_date,身份證字號:a.id_number,最高學歷:a.education,房屋區域:a.region,戶籍地址:a.registered_address,室內電話:a.home_phone,通訊地址是否同戶籍地:a.address_same,通訊地址:a.mailing_address,通訊電話:a.mobile_phone,現居地住多久:a.residence_duration,居住地持有人:a.residence_owner,電信業者:a.telecom_provider,資金需求:a.required_amount,電子郵件:a.company_email,公司名稱:a.company_name,公司電話:a.company_phone,公司地址:a.company_address,職稱:a.job_title,月收入:a.monthly_income,有無新轉勞保:a.new_labor_insurance,目前公司在職多久:a.employment_duration,"聯絡人①姓名":a.contact1_name,"聯絡人①關係":a.contact1_relationship,"聯絡人①電話":a.contact1_phone,方便聯絡時間:a.contact1_available_time,是否保密:a.contact1_confidential,"聯絡人②姓名":a.contact2_name,"聯絡人②關係":a.contact2_relationship,"聯絡人②電話":a.contact2_phone,"聯絡人②是否保密":a.contact2_confidential,"聯絡人②方便聯絡時間":a.contact2_available_time,介紹人:a.referrer,...h}},{error:u}=await xe(le.value,t);u?m(u?.message||"更新失敗"):(ee.value=!1,await A(),L("進線資料更新成功"))}catch(l){m("系統錯誤，請稍後再試"),console.error("Update lead error:",l)}finally{I.value=!1}}},Ye=async l=>{if(await de(`確定刪除編號 ${l.id} 的進線嗎？`))try{const{error:u}=await $e(l.id);u?m(u?.message||"刪除失敗"):(await A(),L(`編號 ${l.id} 的進線已刪除`))}catch(u){m("系統錯誤，請稍後再試"),console.error("Delete lead error:",u)}},Ze=l=>{if(!l.customer_id){m("此進線尚未綁定客戶，請先建立/綁定客戶後再送件");return}ae.value=l,Object.assign(T,{loan_amount:null,loan_type:"",notes:""}),te.value=!0},we=()=>{te.value=!1,ae.value=null},et=async()=>{if(ae.value)try{const{error:l}=await Ae(ae.value.id,T);l?m(l?.message||"轉換失敗"):(te.value=!1,await A(),L("進線轉換案件成功"))}catch(l){m("系統錯誤，請稍後再試"),console.error("Convert lead error:",l)}},tt=l=>{j.value=l,$.assigned_to=l.assigned_to||null,se.value=!0},Ue=()=>{se.value=!1,j.value=null,$.assigned_to=null},st=async()=>{if(!j.value||!$.assigned_to){m("請選擇承辦業務");return}I.value=!0;try{const{error:l}=await xe(j.value.id,{assigned_to:$.assigned_to});if(l)m(l?.message||"指派失敗");else{se.value=!1,await A();const t=B.value.find(u=>u.id===$.assigned_to);L(`已成功指派給 ${t?.name||"未知業務"}`)}}catch(l){m("系統錯誤，請稍後再試"),console.error("Assign lead error:",l)}},ot=l=>{w.value=l,S.display_name=l.line_user_info?.display_name||"",oe.value=!0},Ce=()=>{oe.value=!1,w.value=null,S.display_name=""},lt=async()=>{if(!w.value||!S.display_name?.trim()){m("名稱不能為空");return}I.value=!0;try{const{$api:l}=vt(),{data:t,error:u}=await l.put(`/leads/${w.value.id}/line-name`,{editable_name:S.display_name.trim()});!u&&t?.success?(w.value.line_user_info&&(w.value.line_user_info.display_name=S.display_name.trim(),w.value.line_user_info.editable_name=S.display_name.trim()),oe.value=!1,await A(),L(`LINE用戶名稱已更新：${t.old_name} → ${t.new_name}`)):m(t?.message||u?.message||"更新失敗")}catch(l){m("更新失敗，請稍後再試"),console.error("Save LINE name error:",l)}},Ve=l=>{const t=fe.find(u=>u.value===l);return t?t.route:"/"},at=async(l,t)=>{try{Ne().public.apiBaseUrl;{console.log("Using mock mode for updateLeadStatus",{itemId:l.id,newStatus:t});const P=De().updateLeadCaseStatus(l.id,t);if(console.log("Mock update result:",P),P){const X=f.value.findIndex(F=>F.id===l.id);X!==-1&&f.value.splice(X,1);const Se=CASE_STATUS_OPTIONS.find(F=>F.value===t)?.label;if(L(`進線狀態已更新為：${Se}`),await Y(),t!=="pending"){const F=Ve(t);F&&setTimeout(async()=>{await de(`進線已移至「${Se}」區塊，是否前往查看？`,"前往查看","留在此頁")&&await Ee(F)},1500)}return}else{console.error("Item not found in mock store:",l.id),m("更新失敗：找不到對應的案件");return}}const{patch:d}=_e(),{data:e,error:n}=await d(`/leads/${l.id}/case-status`,{case_status:t});if(n){m("更新進線狀態失敗");return}const M=f.value.findIndex(U=>U.id===l.id);M!==-1&&f.value.splice(M,1);const H=CASE_STATUS_OPTIONS.find(U=>U.value===t)?.label;if(L(`進線狀態已更新為：${H}`),await Y(),t!=="pending"){const U=Ve(t);U&&setTimeout(async()=>{await de(`進線已移至「${H}」區塊，是否前往查看？`,"前往查看","留在此頁")&&await Ee(U)},1500)}}catch(u){m("更新狀態失敗，請稍後再試"),console.error("Update lead status error:",u)}},nt=async(l,t)=>{try{const{patch:u}=_e(),{error:d}=await u(`/leads/${l.id}`,{payload:{...l.payload,頁面_URL:t}});if(d){m("更新網站失敗");return}l.payload.頁面_URL=t,L(`網站已更新為：${t}`)}catch(u){m("更新網站失敗，請稍後再試"),console.error("Update website error:",u)}},rt=l=>{const t=l?.payload||{};G.value.forEach(u=>{const d=u.key;t&&Object.prototype.hasOwnProperty.call(t,d)?h[d]=t[d]:u.default_value?h[d]=u.default_value:h[d]=u.type==="multiselect"?[]:u.type==="boolean"?!1:""})},it=l=>{try{return new URL(l).hostname}catch{return l||""}},re=l=>{const t=new Date(l.created_at),u=t.getFullYear().toString().slice(-2),d=String(t.getMonth()+1).padStart(2,"0"),e=String(t.getDate()).padStart(2,"0"),n=String(l.id).padStart(3,"0");return`CASE${u}${d}${e}${n}`},ge=l=>{if(!l)return{name:"-",domain:"",website:null};const t=it(l),u=ce.value.find(d=>{if(d.domain===t)return!0;const e=t.replace(/^www\./,""),n=d.domain.replace(/^www\./,"");return!!(e===n||l.includes(d.domain)||t.includes(d.domain)||d.domain.includes(t))});return u?{name:u.name,domain:u.domain,website:u}:{name:t||l,domain:t||l,website:null}},Le=l=>new Date(l).toLocaleDateString("zh-TW",{year:"numeric",month:"2-digit",day:"2-digit"}),Ie=l=>new Date(l).toLocaleTimeString("zh-TW",{hour:"2-digit",minute:"2-digit"}),dt=(l,t)=>t.type==="multiselect"?Array.isArray(l)?l.join(", "):l||"-":t.type==="boolean"?l?"是":"否":l??"-";mt(async()=>{await Promise.all([Be(),A(),he(),We(),Y()])}),gt(()=>{clearTimeout(be)}),_t({title:"網路進線管理"});const ut=async(l,t)=>{try{const u=f.value.findIndex(d=>d.id===l);u!==-1&&(f.value[u].channel=t,L("來源管道更新成功"))}catch(u){console.error("更新來源管道失敗:",u),m("更新來源管道失敗")}},ct=async(l,t)=>{try{const u=f.value.findIndex(d=>d.id===l);u!==-1&&(f.value[u].payload||(f.value[u].payload={}),f.value[u].payload.貸款需求=t,L("諮詢項目更新成功"))}catch(u){console.error("更新諮詢項目失敗:",u),m("更新諮詢項目失敗")}};return(l,t)=>{const u=pt,d=xt("XMarkIcon");return i(),r("div",Dt,[t[77]||(t[77]=s("div",{class:"flex items-center justify-between"},[s("div",null,[s("h1",{class:"text-3xl font-bold text-gray-900"},"核准撥款"),s("p",{class:"text-gray-600 mt-2"},"已核准並完成撥款的案件")])],-1)),O(ht,{title:"網路進線列表",columns:o(ze),data:o(ve),loading:o(Z),error:o(ue),"search-query":o(q),"search-placeholder":"搜尋姓名/手機/Email/LINE/網站... (至少2個字符)","show-search-icon":!1,"current-page":o(W),"items-per-page":o(ye),"loading-text":"載入中...","empty-text":"沒有網路進線案件",onSearch:Ge,onRefresh:A,onRetry:A,onPageChange:He,onPageSizeChange:Xe},{filters:v(()=>[o(Q).hasPermission&&o(Q).hasPermission("customer_management")?p((i(),r("select",{key:0,"onUpdate:modelValue":t[0]||(t[0]=e=>ft(D)?D.value=e:null),class:"px-4 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},[t[20]||(t[20]=s("option",{value:"all"},"全部承辦",-1)),t[21]||(t[21]=s("option",{value:"null"},"未指派",-1)),(i(!0),r(_,null,x(o(B),e=>(i(),r("option",{key:e.id,value:e.id},c(e.name),9,jt))),128))],512)),[[E,o(D)]]):y("",!0)]),actions:v(()=>[...t[22]||(t[22]=[])]),"cell-case_status":v(({item:e})=>[s("select",{value:e.case_status||"pending",onChange:n=>at(e,n.target.value),class:"w-full px-1 py-0.5 text-xs border border-gray-300 rounded bg-white text-gray-900 focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500"},[(i(),r(_,null,x(fe,n=>s("option",{key:n.value,value:n.value},c(n.label),9,$t)),64))],40,Tt)]),"cell-case_number":v(({item:e})=>[s("div",At,c(re(e)),1)]),"cell-website":v(({item:e})=>[s("select",{value:ge(e.payload?.頁面_URL||e.source).name,onChange:n=>nt(e,n.target.value),class:"w-full px-1 py-0.5 text-xs border border-gray-300 rounded bg-white text-gray-900 focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500"},[(i(!0),r(_,null,x(o(Re),n=>(i(),r("option",{key:n,value:n},c(n),9,qt))),128))],40,Ot)]),"cell-channel":v(({item:e})=>[s("select",{value:e.channel,onChange:n=>ut(e.id,n.target.value),class:"w-full px-2 py-1 text-sm border border-gray-300 rounded bg-white text-gray-900 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},[...t[23]||(t[23]=[s("option",{value:"wp_form"},"網站表單",-1),s("option",{value:"lineoa"},"官方LINE",-1),s("option",{value:"email"},"email",-1),s("option",{value:"phone"},"專線",-1)])],40,Mt)]),"cell-datetime":v(({item:e})=>[s("div",null,[s("div",Pt,c(Le(e.created_at)),1),s("div",Ft,c(Ie(e.created_at)),1)])]),"cell-assignee":v(({item:e})=>[s("div",Rt,[s("span",zt,c(e.assignee?.name||"未指派"),1),!e.assignee&&o(Q).hasPermission&&o(Q).hasPermission("customer_management")?(i(),r("button",{key:0,onClick:n=>tt(e),class:"inline-flex items-center justify-center w-6 h-6 text-blue-600 hover:text-white hover:bg-blue-600 rounded transition-colors duration-200 relative group",title:"指派業務"},[O(u,{name:"heroicons:user-plus",class:"w-4 h-4"}),t[24]||(t[24]=s("span",{class:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-2 py-1 text-xs text-white bg-gray-800 rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap"}," 指派業務 ",-1))],8,Bt)):y("",!0)])]),"cell-contact_info":v(({item:e})=>[s("div",null,[s("div",Wt,c(e.email||"未提供"),1),s("div",Gt,c(e.phone||"未提供"),1)])]),"cell-line_info":v(({item:e})=>[e.line_user_info&&e.is_line_user_id?(i(),r("div",Ht,[e.line_user_info.picture_url?(i(),r("img",{key:0,src:e.line_user_info.picture_url,alt:e.line_user_info.display_name||"LINE用戶",class:"w-6 h-6 rounded-full object-cover",onError:t[1]||(t[1]=n=>n.target.style.display="none")},null,40,Xt)):(i(),r("div",Jt," L ")),s("div",Kt,[s("div",Qt,[s("span",Yt,c(e.line_user_info.display_name||"未設定名稱"),1),s("button",{onClick:n=>ot(e),class:"text-blue-500 hover:text-blue-700 text-xs",title:"編輯LINE名稱"}," ✏️ ",8,Zt)])])])):e.line_id&&!e.is_line_user_id?(i(),r("div",es,[t[25]||(t[25]=s("div",{class:"w-6 h-6 rounded-full bg-gray-400 flex items-center justify-center text-white text-xs"}," @ ",-1)),s("span",ts,c(e.line_id),1)])):(i(),r("div",ss," 未綁定 "))]),"cell-location":v(({item:e})=>[s("div",null,[s("div",os,c(e.payload?.房屋區域||e.payload?.所在地區||"未提供"),1),s("div",ls,c(e.payload?.房屋地址||""),1)])]),"cell-amount":v(({item:e})=>[s("span",as,c(e.payload?.資金需求||"未填寫"),1)]),"cell-purpose":v(({item:e})=>[s("select",{value:e.payload?.貸款需求||"",onChange:n=>ct(e.id,n.target.value),class:"w-full px-2 py-1 text-sm border border-gray-300 rounded bg-white text-gray-900 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},[...t[26]||(t[26]=[s("option",{value:""},"請選擇",-1),s("option",{value:"房屋貸款"},"房屋貸款",-1),s("option",{value:"土地貸款"},"土地貸款",-1),s("option",{value:"企業貸款"},"企業貸款",-1),s("option",{value:"個人信貸"},"個人信貸",-1),s("option",{value:"汽車貸款"},"汽車貸款",-1),s("option",{value:"其他"},"其他",-1)])],40,ns)]),"cell-custom_fields":v(({item:e})=>[o(ne).length>0?(i(),r("div",rs,[(i(!0),r(_,null,x(o(ne).slice(0,2),n=>(i(),r("div",{key:n.id,class:"text-xs"},[s("span",is,c(n.label)+":",1),s("span",ds,c(dt(e.payload?.[n.key],n)),1)]))),128)),o(ne).length>2?(i(),r("div",us," +"+c(o(ne).length-2)+" 個欄位 ",1)):y("",!0)])):(i(),r("span",cs,"無自定義欄位"))]),"cell-actions":v(({item:e})=>[s("div",ps,[s("button",{onClick:n=>Je(e),class:"group relative inline-flex items-center justify-center p-2 text-blue-600 hover:text-white hover:bg-blue-600 rounded-lg transition-all duration-200",title:"查看詳情"},[O(o(St),{class:"w-4 h-4"}),t[27]||(t[27]=s("div",{class:"absolute bottom-full mb-2 hidden group-hover:block px-2 py-1 text-xs text-white bg-gray-900 rounded whitespace-nowrap z-10"}," 查看詳情 ",-1))],8,ys),s("button",{onClick:n=>Ke(e),class:"group relative inline-flex items-center justify-center p-2 text-gray-600 hover:text-white hover:bg-gray-600 rounded-lg transition-all duration-200",title:"編輯"},[O(o(kt),{class:"w-4 h-4"}),t[28]||(t[28]=s("div",{class:"absolute bottom-full mb-2 hidden group-hover:block px-2 py-1 text-xs text-white bg-gray-900 rounded whitespace-nowrap z-10"}," 編輯 ",-1))],8,bs),e.customer_id?(i(),r("button",{key:0,onClick:n=>Ze(e),class:"group relative inline-flex items-center justify-center p-2 text-purple-600 hover:text-white hover:bg-purple-600 rounded-lg transition-all duration-200",title:"轉送件"},[O(o(Nt),{class:"w-4 h-4"}),t[29]||(t[29]=s("div",{class:"absolute bottom-full mb-2 hidden group-hover:block px-2 py-1 text-xs text-white bg-gray-900 rounded whitespace-nowrap z-10"}," 轉送件 ",-1))],8,ms)):y("",!0),s("button",{onClick:n=>Ye(e),class:"group relative inline-flex items-center justify-center p-2 text-red-600 hover:text-white hover:bg-red-600 rounded-lg transition-all duration-200",title:"刪除"},[O(o(Et),{class:"w-4 h-4"}),t[30]||(t[30]=s("div",{class:"absolute bottom-full mb-2 hidden group-hover:block px-2 py-1 text-xs text-white bg-gray-900 rounded whitespace-nowrap z-10"}," 刪除 ",-1))],8,gs)])]),_:1},8,["columns","data","loading","error","search-query","current-page","items-per-page"]),o(ee)?(i(),r("div",{key:0,class:"fixed inset-0 bg-black/50 z-50",onClick:N(me,["self"])},[s("div",_s,[s("div",xs,[t[31]||(t[31]=s("h3",{class:"text-xl font-semibold text-gray-900"},"編輯進線",-1)),s("button",{type:"button",onClick:me,class:"text-gray-400 hover:text-gray-600"},[O(d,{class:"w-6 h-6"})])]),s("div",fs,[s("form",{onSubmit:N(Qe,["prevent"]),class:"h-full flex"},[s("div",vs,[t[43]||(t[43]=s("h4",{class:"text-lg font-semibold text-gray-800 mb-4 sticky top-0 bg-blue-50 py-2"},"基本資訊",-1)),s("div",hs,[s("div",null,[t[32]||(t[32]=s("label",{class:"block text-sm font-semibold text-gray-900 mb-1"},"進線狀態",-1)),p(s("select",{"onUpdate:modelValue":t[2]||(t[2]=e=>o(a).case_status=e),class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},[(i(!0),r(_,null,x(l.CASE_STATUS_OPTIONS,e=>(i(),r("option",{key:e.value,value:e.value},c(e.label),9,ks))),128))],512),[[E,o(a).case_status]])]),s("div",null,[t[33]||(t[33]=s("label",{class:"block text-sm font-semibold text-gray-900 mb-1"},"時間",-1)),p(s("input",{"onUpdate:modelValue":t[3]||(t[3]=e=>o(a).created_at=e),type:"datetime-local",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",readonly:""},null,512),[[g,o(a).created_at]])]),s("div",null,[t[35]||(t[35]=s("label",{class:"block text-sm font-semibold text-gray-900 mb-1"},"承辦業務",-1)),p(s("select",{"onUpdate:modelValue":t[4]||(t[4]=e=>o(a).assigned_to=e),class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},[t[34]||(t[34]=s("option",{value:""},"未指派",-1)),(i(!0),r(_,null,x(o(B),e=>(i(),r("option",{key:e.id,value:e.id},c(e.name),9,ws))),128))],512),[[E,o(a).assigned_to]])]),s("div",null,[t[37]||(t[37]=s("label",{class:"block text-sm font-semibold text-gray-900 mb-1"},"來源管道",-1)),p(s("select",{"onUpdate:modelValue":t[5]||(t[5]=e=>o(a).channel=e),class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},[...t[36]||(t[36]=[s("option",{value:"wp_form"},"網站表單",-1),s("option",{value:"lineoa"},"官方LINE",-1),s("option",{value:"email"},"email",-1),s("option",{value:"phone"},"專線",-1)])],512),[[E,o(a).channel]])]),s("div",null,[t[38]||(t[38]=s("label",{class:"block text-sm font-semibold text-gray-900 mb-1"},"姓名",-1)),p(s("input",{"onUpdate:modelValue":t[6]||(t[6]=e=>o(a).customer_name=e),type:"text",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",readonly:""},null,512),[[g,o(a).customer_name]])]),s("div",null,[t[39]||(t[39]=s("label",{class:"block text-sm font-semibold text-gray-900 mb-1"},"LINE資訊",-1)),s("div",Us,[p(s("input",{"onUpdate:modelValue":t[7]||(t[7]=e=>o(a).line_display_name=e),placeholder:"LINE顯示名稱",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",readonly:""},null,512),[[g,o(a).line_display_name]]),p(s("input",{"onUpdate:modelValue":t[8]||(t[8]=e=>o(a).line_id=e),placeholder:"LINE加好友ID",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",readonly:""},null,512),[[g,o(a).line_id]])])]),s("div",null,[t[40]||(t[40]=s("label",{class:"block text-sm font-semibold text-gray-900 mb-1"},"諮詢項目",-1)),p(s("input",{"onUpdate:modelValue":t[9]||(t[9]=e=>o(a).loan_purpose=e),class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",readonly:""},null,512),[[g,o(a).loan_purpose]])]),s("div",null,[t[41]||(t[41]=s("label",{class:"block text-sm font-semibold text-gray-900 mb-1"},"網站",-1)),p(s("select",{"onUpdate:modelValue":t[10]||(t[10]=e=>o(a).website=e),class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},[(i(),r(_,null,x(10,e=>s("option",{key:e,value:`G${e}`},"G"+c(e),9,Cs)),64))],512),[[E,o(a).website]])]),s("div",null,[t[42]||(t[42]=s("label",{class:"block text-sm font-semibold text-gray-900 mb-1"},"聯絡資訊",-1)),s("div",Vs,[p(s("input",{"onUpdate:modelValue":t[11]||(t[11]=e=>o(a).email=e),type:"email",placeholder:"Email",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",readonly:""},null,512),[[g,o(a).email]]),p(s("input",{"onUpdate:modelValue":t[12]||(t[12]=e=>o(a).phone=e),type:"tel",placeholder:"手機號碼",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",readonly:""},null,512),[[g,o(a).phone]])])])])]),s("div",Ls,[s("h4",Is,c(V.personal.title),1),s("div",Ss,[(i(!0),r(_,null,x(V.personal.fields,e=>(i(),r("div",{key:e.key},[s("label",Ns,[C(c(e.label)+" ",1),e.required?(i(),r("span",Es,"*")):y("",!0)]),e.type==="text"||e.type==="email"?p((i(),r("input",{key:0,"onUpdate:modelValue":n=>o(a)[e.key]=n,type:e.type,readonly:e.readonly,class:K(["w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",{"bg-gray-100":e.readonly}])},null,10,Ds)),[[R,o(a)[e.key]]]):e.type==="number"?p((i(),r("input",{key:1,"onUpdate:modelValue":n=>o(a)[e.key]=n,type:"number",min:"0",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,8,js)),[[g,o(a)[e.key],void 0,{number:!0}]]):e.type==="date"?p((i(),r("input",{key:2,"onUpdate:modelValue":n=>o(a)[e.key]=n,type:"date",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,8,Ts)),[[g,o(a)[e.key]]]):e.type==="select"?p((i(),r("select",{key:3,"onUpdate:modelValue":n=>o(a)[e.key]=n,class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},[t[44]||(t[44]=s("option",{value:""},"請選擇",-1)),(i(!0),r(_,null,x(e.options,n=>(i(),r("option",{key:n,value:n},c(n),9,As))),128))],8,$s)),[[E,o(a)[e.key]]]):e.type==="boolean"?(i(),r("label",Os,[p(s("input",{type:"checkbox","onUpdate:modelValue":n=>o(a)[e.key]=n,class:"rounded"},null,8,qs),[[z,o(a)[e.key]]]),t[45]||(t[45]=s("span",{class:"text-sm"},"是",-1))])):e.type==="custom"?(i(),r("div",Ms," 自定義欄位將顯示在下方 ")):y("",!0)]))),128))])]),s("div",Ps,[s("h4",Fs,c(V.contact.title),1),s("div",Rs,[(i(!0),r(_,null,x(V.contact.fields,e=>(i(),r("div",{key:e.key},[s("label",zs,[C(c(e.label)+" ",1),e.required?(i(),r("span",Bs,"*")):y("",!0)]),e.type==="text"||e.type==="email"?p((i(),r("input",{key:0,"onUpdate:modelValue":n=>o(a)[e.key]=n,type:e.type,readonly:e.readonly,class:K(["w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",{"bg-gray-100":e.readonly}])},null,10,Ws)),[[R,o(a)[e.key]]]):e.type==="number"?p((i(),r("input",{key:1,"onUpdate:modelValue":n=>o(a)[e.key]=n,type:"number",min:"0",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,8,Gs)),[[g,o(a)[e.key],void 0,{number:!0}]]):e.type==="date"?p((i(),r("input",{key:2,"onUpdate:modelValue":n=>o(a)[e.key]=n,type:"date",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,8,Hs)),[[g,o(a)[e.key]]]):e.type==="select"?p((i(),r("select",{key:3,"onUpdate:modelValue":n=>o(a)[e.key]=n,class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 focus:ring-2 focus:ring-blue-500 focus:focus:border-blue-500"},[t[46]||(t[46]=s("option",{value:""},"請選擇",-1)),(i(!0),r(_,null,x(e.options,n=>(i(),r("option",{key:n,value:n},c(n),9,Js))),128))],8,Xs)),[[E,o(a)[e.key]]]):e.type==="boolean"?(i(),r("label",Ks,[p(s("input",{type:"checkbox","onUpdate:modelValue":n=>o(a)[e.key]=n,class:"rounded"},null,8,Qs),[[z,o(a)[e.key]]]),t[47]||(t[47]=s("span",{class:"text-sm"},"是",-1))])):y("",!0)]))),128))])]),s("div",Ys,[s("h4",Zs,c(V.company.title),1),s("div",eo,[(i(!0),r(_,null,x(V.company.fields,e=>(i(),r("div",{key:e.key},[s("label",to,[C(c(e.label)+" ",1),e.required?(i(),r("span",so,"*")):y("",!0)]),e.type==="text"||e.type==="email"?p((i(),r("input",{key:0,"onUpdate:modelValue":n=>o(a)[e.key]=n,type:e.type,readonly:e.readonly,class:K(["w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",{"bg-gray-100":e.readonly}])},null,10,oo)),[[R,o(a)[e.key]]]):e.type==="number"?p((i(),r("input",{key:1,"onUpdate:modelValue":n=>o(a)[e.key]=n,type:"number",min:"0",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,8,lo)),[[g,o(a)[e.key],void 0,{number:!0}]]):e.type==="boolean"?(i(),r("label",ao,[p(s("input",{type:"checkbox","onUpdate:modelValue":n=>o(a)[e.key]=n,class:"rounded"},null,8,no),[[z,o(a)[e.key]]]),t[48]||(t[48]=s("span",{class:"text-sm"},"是",-1))])):y("",!0)]))),128))])]),s("div",ro,[s("h4",io,c(V.emergency.title),1),s("div",uo,[(i(!0),r(_,null,x(V.emergency.fields,e=>(i(),r("div",{key:e.key},[s("label",co,[C(c(e.label)+" ",1),e.required?(i(),r("span",po,"*")):y("",!0)]),e.type==="text"?p((i(),r("input",{key:0,"onUpdate:modelValue":n=>o(a)[e.key]=n,type:e.type,readonly:e.readonly,class:K(["w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",{"bg-gray-100":e.readonly}])},null,10,yo)),[[R,o(a)[e.key]]]):e.type==="boolean"?(i(),r("label",bo,[p(s("input",{type:"checkbox","onUpdate:modelValue":n=>o(a)[e.key]=n,class:"rounded"},null,8,mo),[[z,o(a)[e.key]]]),t[49]||(t[49]=s("span",{class:"text-sm"},"是",-1))])):y("",!0)]))),128))])]),s("div",go,[s("h4",_o,c(V.other.title),1),s("div",xo,[(i(!0),r(_,null,x(V.other.fields.filter(e=>e.type!=="custom"),e=>(i(),r("div",{key:e.key},[s("label",fo,[C(c(e.label)+" ",1),e.required?(i(),r("span",vo,"*")):y("",!0)]),e.type==="text"?p((i(),r("input",{key:0,"onUpdate:modelValue":n=>o(a)[e.key]=n,type:e.type,readonly:e.readonly,class:K(["w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",{"bg-gray-100":e.readonly}])},null,10,ho)),[[R,o(a)[e.key]]]):e.type==="number"?p((i(),r("input",{key:1,"onUpdate:modelValue":n=>o(a)[e.key]=n,type:"number",min:"0",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,8,ko)),[[g,o(a)[e.key],void 0,{number:!0}]]):y("",!0)]))),128)),o(G).length?(i(),r("div",wo,[t[52]||(t[52]=s("h5",{class:"text-md font-medium text-gray-800 mb-3"},"自定義欄位",-1)),s("div",Uo,[(i(!0),r(_,null,x(o(G),e=>(i(),r("div",{key:e.id},[s("label",Co,[C(c(e.label)+" ",1),e.is_required?(i(),r("span",Vo,"*")):y("",!0)]),["text","number","decimal","date"].includes(e.type)?p((i(),r("input",{key:0,type:e.type==="decimal"||e.type==="number"?"number":e.type==="date"?"date":"text",step:e.type==="decimal"?"any":void 0,class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:e.is_required,"onUpdate:modelValue":n=>o(h)[e.key]=n},null,8,Lo)),[[R,o(h)[e.key]]]):e.type==="textarea"?p((i(),r("textarea",{key:1,class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:focus:border-blue-500",required:e.is_required,"onUpdate:modelValue":n=>o(h)[e.key]=n,rows:"2"},null,8,Io)),[[g,o(h)[e.key]]]):e.type==="select"?p((i(),r("select",{key:2,class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:e.is_required,"onUpdate:modelValue":n=>o(h)[e.key]=n},[t[50]||(t[50]=s("option",{value:""},"請選擇",-1)),(i(!0),r(_,null,x(e.options||[],n=>(i(),r("option",{key:n,value:n},c(n),9,No))),128))],8,So)),[[E,o(h)[e.key]]]):e.type==="multiselect"?(i(),r("div",Eo,[s("div",Do,[(i(!0),r(_,null,x(e.options||[],n=>(i(),r("label",{key:n,class:"inline-flex items-center text-sm"},[p(s("input",{type:"checkbox",value:n,"onUpdate:modelValue":M=>o(h)[e.key]=M,class:"mr-1"},null,8,jo),[[z,o(h)[e.key]]]),s("span",null,c(n),1)]))),128))])])):e.type==="boolean"?(i(),r("label",To,[p(s("input",{type:"checkbox","onUpdate:modelValue":n=>o(h)[e.key]=n},null,8,$o),[[z,o(h)[e.key]]]),t[51]||(t[51]=s("span",{class:"text-sm"},"是/否",-1))])):y("",!0)]))),128))])])):y("",!0),s("div",Ao,[t[53]||(t[53]=s("label",{class:"block text-sm font-semibold text-gray-900 mb-1"},"備註",-1)),p(s("textarea",{"onUpdate:modelValue":t[13]||(t[13]=e=>o(a).notes=e),rows:"3",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,512),[[g,o(a).notes]])]),s("div",Oo,[s("button",{type:"button",class:"px-4 py-2 border border-gray-300 rounded-lg",onClick:me},"取消"),s("button",{type:"submit",class:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",disabled:o(I)},c(o(I)?"儲存中...":"儲存"),9,qo)])])])],32)])])])):y("",!0),o(pe)?(i(),r("div",{key:1,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 mt-0",onClick:N(ke,["self"])},[s("div",Mo,[s("div",{class:"flex justify-between items-center mb-4"},[t[54]||(t[54]=s("h3",{class:"text-lg font-semibold text-gray-900"},"進線詳情",-1)),s("button",{onClick:ke,class:"text-gray-400 hover:text-gray-600"}," ✕ ")]),o(k)?(i(),r("div",Po,[s("div",Fo,[s("div",null,[t[55]||(t[55]=s("label",{class:"block text-sm font-medium text-gray-700"},"網站",-1)),s("p",Ro,c(ge(o(k).payload?.頁面_URL||o(k).source).name),1)]),s("div",null,[t[56]||(t[56]=s("label",{class:"block text-sm font-medium text-gray-700"},"來源管道",-1)),s("p",zo,c(o(k).channel||"wp_form"),1)]),s("div",null,[t[57]||(t[57]=s("label",{class:"block text-sm font-medium text-gray-700"},"時間",-1)),s("p",Bo,c(Le(o(k).created_at))+" "+c(Ie(o(k).created_at)),1)]),s("div",null,[t[58]||(t[58]=s("label",{class:"block text-sm font-medium text-gray-700"},"承辦業務",-1)),s("p",Wo,c(o(k).assignee?.name||"未指派"),1)]),s("div",null,[t[59]||(t[59]=s("label",{class:"block text-sm font-medium text-gray-700"},"Email",-1)),s("p",Go,c(o(k).email||"未提供"),1)]),s("div",null,[t[60]||(t[60]=s("label",{class:"block text-sm font-medium text-gray-700"},"LINE ID",-1)),s("p",Ho,c(o(k).line_id||"未提供"),1)])]),o(k).notes?(i(),r("div",Xo,[t[61]||(t[61]=s("label",{class:"block text-sm font-medium text-gray-700"},"備註",-1)),s("p",Jo,c(o(k).notes),1)])):y("",!0)])):y("",!0)])])):y("",!0),o(te)?(i(),r("div",{key:2,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 mt-0",onClick:N(we,["self"])},[s("div",Ko,[t[66]||(t[66]=s("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"送件（建立案件）",-1)),s("form",{onSubmit:N(et,["prevent"]),class:"space-y-3"},[s("div",Qo,[s("div",null,[t[62]||(t[62]=s("label",{class:"block text-sm font-semibold text-gray-900 mb-1"},"貸款金額",-1)),p(s("input",{"onUpdate:modelValue":t[14]||(t[14]=e=>o(T).loan_amount=e),required:"",type:"number",min:"0",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,512),[[g,o(T).loan_amount,void 0,{number:!0}]])]),s("div",null,[t[63]||(t[63]=s("label",{class:"block text-sm font-semibold text-gray-900 mb-1"},"貸款類型",-1)),p(s("input",{"onUpdate:modelValue":t[15]||(t[15]=e=>o(T).loan_type=e),class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,512),[[g,o(T).loan_type]])]),s("div",Yo,[t[64]||(t[64]=s("label",{class:"block text-sm font-semibold text-gray-900 mb-1"},"備註",-1)),p(s("textarea",{"onUpdate:modelValue":t[16]||(t[16]=e=>o(T).notes=e),rows:"2",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,512),[[g,o(T).notes]])])]),s("div",{class:"flex justify-end space-x-3 pt-2"},[s("button",{type:"button",class:"px-4 py-2 border border-gray-300 rounded-lg",onClick:we},"取消"),t[65]||(t[65]=s("button",{type:"submit",class:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700"},"送件",-1))])],32)])])):y("",!0),o(se)?(i(),r("div",{key:3,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 mt-0",onClick:N(Ue,["self"])},[s("div",Zo,[t[73]||(t[73]=s("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"指派承辦業務",-1)),s("form",{onSubmit:N(st,["prevent"]),class:"space-y-4"},[o(j)?(i(),r("div",el,[t[70]||(t[70]=s("div",{class:"text-sm text-gray-900 font-semibold mb-2"},"進線資訊：",-1)),s("div",tl,[s("div",sl,[t[67]||(t[67]=s("span",{class:"font-medium"},"進線編號：",-1)),C(c(re(o(j))),1)]),s("div",ol,[t[68]||(t[68]=s("span",{class:"font-medium"},"Email：",-1)),C(c(o(j).email||"未提供"),1)]),s("div",ll,[t[69]||(t[69]=s("span",{class:"font-medium"},"LINE ID：",-1)),C(c(o(j).line_id||"未提供"),1)])])])):y("",!0),s("div",null,[t[72]||(t[72]=s("label",{class:"block text-sm font-semibold text-gray-900 mb-2"},[C("選擇承辦業務 "),s("span",{class:"text-red-500"},"*")],-1)),p(s("select",{"onUpdate:modelValue":t[17]||(t[17]=e=>o($).assigned_to=e),required:"",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},[t[71]||(t[71]=s("option",{value:""},"請選擇業務人員",-1)),(i(!0),r(_,null,x(o(B).filter(e=>e.roles?.[0]?.name==="staff"),e=>(i(),r("option",{key:e.id,value:e.id},c(e.name||e.email)+" (業務) ",9,al))),128))],512),[[E,o($).assigned_to]])]),s("div",nl,[s("button",{type:"button",class:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50",onClick:Ue}," 取消 "),s("button",{type:"submit",class:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",disabled:o(I)||!o($).assigned_to},c(o(I)?"指派中...":"確認指派"),9,rl)])],32)])])):y("",!0),o(oe)?(i(),r("div",{key:4,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 mt-0",onClick:N(Ce,["self"])},[s("div",il,[t[76]||(t[76]=s("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"編輯LINE名稱",-1)),s("form",{onSubmit:N(lt,["prevent"]),class:"space-y-4"},[o(w)?(i(),r("div",dl,[t[74]||(t[74]=s("div",{class:"text-sm text-gray-900 font-semibold mb-2"},"LINE使用者資訊：",-1)),s("div",ul,[o(w).line_user_info?.picture_url?(i(),r("img",{key:0,src:o(w).line_user_info.picture_url,alt:o(w).line_user_info.display_name||"LINE用戶",class:"w-10 h-10 rounded-full object-cover",onError:t[18]||(t[18]=e=>e.target.style.display="none")},null,40,cl)):(i(),r("div",pl," L ")),s("div",null,[s("div",yl,c(o(w).line_user_info?.display_name||"未設定名稱"),1),s("div",bl,"進線編號："+c(re(o(w))),1)])])])):y("",!0),s("div",null,[t[75]||(t[75]=s("label",{class:"block text-sm font-semibold text-gray-900 mb-2"},[C("LINE名稱 "),s("span",{class:"text-red-500"},"*")],-1)),p(s("input",{"onUpdate:modelValue":t[19]||(t[19]=e=>o(S).display_name=e),required:"",maxlength:"100",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"請輸入LINE名稱"},null,512),[[g,o(S).display_name]])]),s("div",ml,[s("button",{type:"button",class:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50",onClick:Ce}," 取消 "),s("button",{type:"submit",class:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",disabled:o(I)||!o(S).display_name?.trim()},c(o(I)?"儲存中...":"儲存"),9,gl)])],32)])])):y("",!0)])}}},$l=yt(_l,[["__scopeId","data-v-bc738d11"]]);export{$l as default};
