import{c as a,o as l,a as e,F as P,q as W,s as w,x as h,t as i,_ as X,b as q,r as p,y as z,i as Y,j as R,e as B,d as r,f as O,g as Z,v as ee,z as J,A as te,p as S,B as ae,C as ie,D as ce,m as de,u as ue,E as ge}from"#entry";import{u as se}from"./CQK2bduw.js";import{r as me}from"./CKFK7sG5.js";import{r as fe}from"./DBrhDGOf.js";import{u as xe}from"./BtlpaPqX.js";import{r as he}from"./B5My0XuL.js";import{r as be}from"./BSBtNZZQ.js";import"./DgLT0ASK.js";function ve(u,C){return l(),a("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m18.375 12.739-7.693 7.693a4.5 4.5 0 0 1-6.364-6.364l10.94-10.94A3 3 0 1 1 19.5 7.372L8.552 18.32m.009-.01-.01.01m5.699-9.941-7.81 7.81a1.5 1.5 0 0 0 2.112 2.13"})])}const ye={class:"space-y-1 p-2"},pe=["onClick"],we={class:"relative flex-shrink-0"},_e=["src","alt"],Ce={key:0,class:"absolute -bottom-1 -right-1 w-4 h-4 bg-green-500 border-2 border-white rounded-full"},ke={key:1,class:"absolute -bottom-1 -right-1 w-4 h-4 bg-green-500 border-2 border-white rounded-full flex items-center justify-center"},Ie={class:"ml-3 flex-1 min-w-0"},$e={class:"flex items-center justify-between mb-1"},Ue={class:"text-sm font-medium text-gray-900 truncate"},Le={class:"text-xs text-gray-500 flex-shrink-0 ml-2"},De={class:"flex items-center justify-between"},Me={class:"text-sm text-gray-600 truncate"},Se={key:0,class:"ml-2 flex-shrink-0 w-5 h-5 bg-blue-500 text-white text-xs rounded-full flex items-center justify-center"},je={class:"mt-1 space-y-1"},Re={class:"flex items-center space-x-2"},Be={key:0,class:"text-xs text-gray-500"},Ee={__name:"ChatUserList",props:{users:{type:Array,required:!0},activeUserId:{type:Number,default:null}},emits:["userSelect"],setup(u){const C=f=>{const m=new Date,s=new Date(f),y=(m-s)/(1e3*60*60);if(y<1){const _=Math.floor((m-s)/6e4);return _<=0?"剛剛":`${_}分鐘前`}else{if(y<24)return`${Math.floor(y)}小時前`;{const _=Math.floor(y/24);return _===1?"昨天":`${_}天前`}}},k=f=>({dealer_executive:"經銷商",admin_manager:"行政主管",sales_staff:"業務人員",line_bot:"LINE BOT",line_customer:"LINE 客戶"})[f]||f,E=f=>({dealer_executive:"bg-purple-100 text-purple-800 ",admin_manager:"bg-green-100 text-green-800 ",sales_staff:"bg-blue-100 text-blue-800 ",line_bot:"bg-yellow-100 text-yellow-800 ",line_customer:"bg-green-100 text-green-800 "})[f]||"bg-gray-100 text-gray-800 ",x=f=>({待處理:"bg-yellow-100 text-yellow-800 ",進行中:"bg-blue-100 text-blue-800 ",已完成:"bg-green-100 text-green-800 ",已結案:"bg-gray-100 text-gray-800 "})[f]||"bg-gray-100 text-gray-800 ";return(f,m)=>(l(),a("div",ye,[(l(!0),a(P,null,W(u.users,s=>(l(),a("div",{key:s.id,onClick:y=>f.$emit("userSelect",s),class:w(["flex items-center p-3 rounded-lg cursor-pointer transition-colors duration-200 hover:bg-gray-50",{"bg-blue-50  border border-blue-200 ":u.activeUserId===s.id}])},[e("div",we,[e("img",{src:s.avatar,alt:s.name,class:"w-12 h-12 rounded-full"},null,8,_e),s.online?(l(),a("div",Ce)):h("",!0),s.isBot?(l(),a("div",ke,[...m[0]||(m[0]=[e("span",{class:"text-white text-xs font-bold"},"B",-1)])])):h("",!0)]),e("div",Ie,[e("div",$e,[e("h4",Ue,i(s.name),1),e("span",Le,i(C(s.timestamp)),1)]),e("div",De,[e("p",Me,i(s.lastMessage),1),s.unreadCount>0?(l(),a("div",Se,i(s.unreadCount>9?"9+":s.unreadCount),1)):h("",!0)]),e("div",je,[e("div",Re,[e("span",{class:w(["inline-flex items-center px-2 py-0.5 rounded text-xs font-medium",E(s.role)])},i(k(s.role)),3),s.role==="line_customer"&&s.customerInfo?(l(),a("span",{key:0,class:w(["inline-flex items-center px-2 py-0.5 rounded text-xs font-medium",x(s.customerInfo.status)])},i(s.customerInfo.status),3)):h("",!0)]),s.role==="line_customer"&&s.customerInfo?(l(),a("div",Be,[e("div",null,i(s.customerInfo.phone)+" · "+i(s.customerInfo.region),1),e("div",null,"來源："+i(s.customerInfo.source),1)])):h("",!0)])])],10,pe))),128))]))}},Te={class:"flex flex-col h-full"},Ne={class:"p-4 border-b border-gray-200 bg-white"},ze={class:"flex items-center justify-between"},Ae={class:"flex items-center"},Fe={class:"relative"},Ve=["src","alt"],Ke={key:0,class:"absolute -bottom-1 -right-1 w-3 h-3 bg-green-500 border-2 border-white rounded-full"},He={class:"ml-3"},Oe={class:"text-lg font-medium text-gray-900"},qe={class:"text-sm text-gray-500"},Pe={key:0,class:"ml-2 text-green-600"},We={class:"flex items-center space-x-2"},Qe={class:"p-2 text-gray-500 hover:bg-gray-100 rounded-lg"},Ge={class:"p-4 space-y-4"},Je={key:0,class:"flex-message-container"},Xe={class:"bg-gradient-to-r from-green-50 to-green-100 border border-green-200 rounded-lg p-4 max-w-sm"},Ye={class:"text-sm text-gray-700 mb-3"},Ze={key:1,class:"text-sm whitespace-pre-wrap break-words"},et={key:0,class:"flex-shrink-0 ml-2 order-1"},tt=["src","alt"],st={key:0,class:"mt-6 p-4 bg-green-50 rounded-lg border border-green-200"},ot={class:"flex items-start space-x-3"},nt={class:"flex-1"},rt={key:0,class:"text-xs text-green-600 space-y-1"},lt={key:0,class:"flex-shrink-0"},at={class:"p-4 bg-white border-t border-gray-200"},it={class:"flex-1"},ct={class:"relative"},dt=["onKeydown"],ut={class:"flex items-center space-x-2"},gt={type:"button",class:"p-2 text-gray-500 hover:bg-gray-100 rounded-lg"},mt=["disabled"],ft={__name:"ChatMessageArea",props:{user:{type:Object,required:!0},messages:{type:Array,default:()=>[]}},emits:["sendMessage"],setup(u,{emit:C}){const k=u,E=C,{getLocalUser:x}=se(),f=q(()=>x()?.id),m=p(""),s=p(null),y=p(null),_=()=>{m.value.trim()&&(E("sendMessage",m.value),m.value="",S(()=>{s.value?.focus(),L()}))},I=()=>{},L=()=>{S(()=>{y.value&&(y.value.scrollTop=y.value.scrollHeight)})};z(()=>k.messages,()=>{L()},{deep:!0}),Y(()=>{L()});const U=d=>d.senderId===f.value||d.isAutoReply||d.isBot&&!d.isCustomer,$=d=>{const n=U(d),g=d.isBot;d.isCustomer;const D=d.isAutoReply;return n?g&&D?"bg-green-500 text-white":"bg-blue-500 text-white":"bg-gray-200 text-gray-900 border border-gray-300"},b=d=>d===k.user.id?k.user.avatar:"https://ui-avatars.com/api/?name=User&background=6366f1&color=fff",T=d=>d===k.user.id?k.user.name:"Unknown User",N=d=>{const n=new Date(d),g=new Date;if(n.toDateString()===g.toDateString())return n.toLocaleTimeString("zh-TW",{hour:"2-digit",minute:"2-digit"});const D=new Date(g);return D.setDate(D.getDate()-1),n.toDateString()===D.toDateString()?`昨天 ${n.toLocaleTimeString("zh-TW",{hour:"2-digit",minute:"2-digit"})}`:n.toLocaleDateString("zh-TW",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})},A=d=>d.type==="flex"||d.metadata&&d.metadata.is_flex_message||d.content&&d.content.includes("請輸入業務推薦碼");return z(()=>m.value,()=>{S(()=>{s.value&&(s.value.style.height="auto",s.value.style.height=Math.min(s.value.scrollHeight,128)+"px")})}),(d,n)=>(l(),a("div",Te,[e("div",Ne,[e("div",ze,[e("div",Ae,[e("div",Fe,[e("img",{src:u.user.avatar,alt:u.user.name,class:"w-10 h-10 rounded-full"},null,8,Ve),u.user.online?(l(),a("div",Ke)):h("",!0)]),e("div",He,[e("h3",Oe,i(u.user.name),1),e("p",qe,[R(i(u.user.online?"線上":"離線")+" ",1),u.user.isBot?(l(),a("span",Pe,"• LINE BOT")):h("",!0)])])]),e("div",We,[e("button",Qe,[B(r(me),{class:"w-5 h-5"})])])])]),e("div",{ref_key:"messagesContainer",ref:y,class:"flex-1 overflow-y-auto bg-gray-50 custom-scrollbar-right relative"},[e("div",Ge,[(l(!0),a(P,null,W(u.messages,g=>(l(),a("div",{key:g.id,class:w(["flex",{"justify-end":U(g)}])},[e("div",{class:w(["max-w-xs lg:max-w-md",{"order-2":U(g)}])},[e("div",{class:w(["px-4 py-2 rounded-2xl",$(g)])},[g.type==="flex"||A(g)?(l(),a("div",Je,[e("div",Xe,[n[1]||(n[1]=e("div",{class:"flex items-center mb-3"},[e("div",{class:"w-6 h-6 bg-green-500 rounded-full flex items-center justify-center mr-3"},[e("span",{class:"text-white text-xs"},"💼")]),e("h4",{class:"font-semibold text-green-800"},"業務推薦碼")],-1)),e("p",Ye,i(g.content),1),n[2]||(n[2]=e("p",{class:"text-xs text-gray-600 mb-4"},"有推薦碼可享更優惠的利率和服務！",-1)),n[3]||(n[3]=e("div",{class:"space-y-2"},[e("button",{class:"w-full bg-green-500 hover:bg-green-600 text-white text-sm py-2 px-4 rounded-lg transition-colors"}," 輸入推薦碼 "),e("button",{class:"w-full bg-gray-300 hover:bg-gray-400 text-gray-700 text-sm py-2 px-4 rounded-lg transition-colors"}," 暫時跳過 ")],-1))])])):(l(),a("p",Ze,i(g.content),1))],2),e("div",{class:w(["mt-1 text-xs text-gray-500",{"text-right":U(g)}])},i(N(g.timestamp)),3)],2),U(g)?h("",!0):(l(),a("div",et,[e("img",{src:b(g.senderId),alt:T(g.senderId),class:"w-8 h-8 rounded-full"},null,8,tt)]))],2))),128)),u.user.isBot&&u.user.role==="line_customer"&&u.messages.length>0?(l(),a("div",st,[e("div",ot,[n[12]||(n[12]=e("div",{class:"flex-shrink-0"},[e("div",{class:"w-8 h-8 bg-green-500 rounded-full flex items-center justify-center"},[e("span",{class:"text-white text-sm font-bold"},"📱")])],-1)),e("div",nt,[n[9]||(n[9]=e("h4",{class:"text-sm font-medium text-green-800 mb-1"}," LINE 官方帳號對話記錄 ",-1)),n[10]||(n[10]=e("p",{class:"text-sm text-green-700 mb-2"}," 此對話來自 LINE 官方帳號，系統已自動整合顯示 ",-1)),u.user.customerInfo?(l(),a("div",rt,[e("div",null,[n[4]||(n[4]=e("span",{class:"font-medium"},"LINE ID:",-1)),R(" "+i(u.user.lineUserId),1)]),e("div",null,[n[5]||(n[5]=e("span",{class:"font-medium"},"聯絡電話:",-1)),R(" "+i(u.user.customerInfo.phone),1)]),e("div",null,[n[6]||(n[6]=e("span",{class:"font-medium"},"地區:",-1)),R(" "+i(u.user.customerInfo.region),1)]),e("div",null,[n[7]||(n[7]=e("span",{class:"font-medium"},"來源網站:",-1)),R(" "+i(u.user.customerInfo.source),1)]),e("div",null,[n[8]||(n[8]=e("span",{class:"font-medium"},"案件狀態:",-1)),R(" "+i(u.user.customerInfo.status),1)])])):h("",!0)]),u.user.customerInfo?(l(),a("div",lt,[...n[11]||(n[11]=[e("button",{class:"px-3 py-1 text-xs bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors"}," 建立案件 ",-1)])])):h("",!0)])])):h("",!0)])],512),e("div",at,[e("form",{onSubmit:O(_,["prevent"]),class:"flex items-end space-x-3"},[e("div",it,[e("div",ct,[Z(e("textarea",{ref_key:"messageInput",ref:s,"onUpdate:modelValue":n[0]||(n[0]=g=>te(m)?m.value=g:null),onKeydown:[J(O(_,["exact","prevent"]),["enter"]),J(O(I,["shift","exact"]),["enter"])],placeholder:"輸入訊息... (Enter 發送，Shift+Enter 換行)",rows:"1",class:"w-full px-4 py-3 border border-gray-300 rounded-2xl bg-white text-gray-900 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none max-h-32",style:{"min-height":"44px"}},null,40,dt),[[ee,r(m)]])])]),e("div",ut,[e("button",gt,[B(r(ve),{class:"w-5 h-5"})]),e("button",{type:"submit",disabled:!r(m).trim(),class:"px-4 py-2 bg-blue-500 hover:bg-blue-600 disabled:bg-gray-300 disabled:cursor-not-allowed text-white rounded-2xl transition-colors duration-200 flex items-center space-x-2"},[B(r(fe),{class:"w-4 h-4"}),n[13]||(n[13]=e("span",{class:"hidden sm:inline"},"發送",-1))],8,mt)])],32)])]))}},xt=X(ft,[["__scopeId","data-v-b84be71a"]]),ht={class:"flex bg-gray-50",style:{height:"calc(100vh - 120px)","max-height":"calc(100vh - 120px)"}},bt={class:"w-80 bg-white border-r border-gray-300 flex flex-col"},vt={class:"p-4 border-b border-gray-200"},yt={class:"flex items-center justify-between mb-4"},pt={class:"flex items-center space-x-3"},wt={class:"flex items-center space-x-1"},_t={class:"text-xs text-gray-500"},Ct={class:"relative"},kt={class:"flex gap-2 mt-3"},It=["onClick"],$t={key:0,class:"fixed top-4 right-4 bg-white border border-gray-300 rounded-lg shadow-lg p-4 max-w-sm z-50"},Ut={class:"space-y-2 text-xs text-gray-800"},Lt={class:"flex items-center justify-between"},Dt={class:"flex items-center justify-between"},Mt={class:"flex items-center justify-between"},St={class:"font-mono font-bold text-gray-900"},jt={class:"flex items-center justify-between"},Rt={class:"font-mono font-bold text-gray-900"},Bt={class:"flex items-center justify-between"},Et={class:"font-mono font-bold text-gray-900"},Tt={class:"flex items-center justify-between"},Nt={key:0,class:"pt-2 border-t border-gray-200"},zt={class:"flex-1 flex flex-col"},At={key:1,class:"flex-1 flex items-center justify-center bg-gray-50"},Ft={class:"text-center"},Vt={key:0,class:"mt-4 p-4 bg-red-100 border border-red-300 rounded-lg"},Kt={class:"text-red-700 text-sm"},Ht={__name:"index",setup(u){const{error:C}=xe(),{canViewAllChats:k,getLocalUser:E}=se(),x=useRealtimeChat(),{conversations:f,messages:m,connectionStatus:s,error:y,getConnectionStatusText:_}=x,I=p(""),L=p("all"),U=p(null),$=p(null),b=p(!1),T=p(!1),N=p(null),A=p(null),c=p({hasUserListContainer:!1,hasUserItemsContainer:!1,renderedUserCount:0,lastCheckResult:null}),d=p([{key:"all",label:"所有訊息"},{key:"unread",label:"未讀"},{key:"favorites",label:"重要"},{key:"archived",label:"封存"}]),n=q(()=>{let t=[...f.value];if(!k()){const o=E();t=t.filter(v=>v.customerInfo?.assignedTo===o?.id)}if(I.value&&I.value.trim()){const o=I.value.toLowerCase();t=t.filter(v=>v.name&&v.name.toLowerCase().includes(o)||v.customerInfo?.phone&&v.customerInfo.phone.includes(I.value)||v.customerInfo?.region&&v.customerInfo.region.toLowerCase().includes(o))}switch(L.value){case"unread":t=t.filter(o=>o.unreadCount>0);break;case"favorites":t=t.filter(o=>o.isFavorite);break;case"archived":t=t.filter(o=>o.isArchived);break}return t}),g=q(()=>$.value?.lineUserId?m.value[$.value.lineUserId]||[]:[]),D=async t=>{if(t?.lineUserId){if(console.log("選擇用戶:",t.name,"LineUserId:",t.lineUserId),$.value=t,U.value=t.id,s.value==="disconnected"||s.value==="error"){console.log("檢測到連接異常，嘗試重新初始化");try{await x.initialize()}catch(o){console.error("重新初始化失敗:",o),await C("聊天室連接異常，請重新整理頁面");return}}await x.loadMessages(t.lineUserId)}},oe=async t=>{if(!(!$.value?.lineUserId||!t.trim()))try{await x.sendMessage($.value.lineUserId,t.trim()),console.log("訊息發送成功")}catch(o){console.error("發送訊息失敗:",o);let v="發送訊息失敗，請重試";o?.error?v=o.error:o?.message&&(v=o.message),await C(v)}},ne=async()=>{console.log("手動重新連接聊天室");try{await x.initialize(),console.log("手動重新連接成功")}catch(t){console.error("手動重新連接失敗:",t),await C("重新連接失敗，請稍後再試或重新整理頁面")}},F=()=>{b.value=!b.value,b.value&&M()},M=()=>{S(()=>{c.value.hasUserListContainer=!!N.value;const t=N.value?.querySelector(".space-y-1.p-2");c.value.hasUserItemsContainer=!!t,c.value.renderedUserCount=t?.children?.length||0,console.log("調試信息更新:",c.value)})},V=()=>{console.log("執行聊天室數據載入完整檢查"),M();const t=[];c.value.hasUserListContainer||t.push("用戶列表容器未找到"),c.value.hasUserItemsContainer||t.push("用戶項目容器(.space-y-1.p-2)未找到"),n.value.length>0&&c.value.renderedUserCount===0&&t.push("有過濾後用戶數據但DOM中沒有渲染項目"),n.value.length!==c.value.renderedUserCount&&t.push(`數據不一致: 過濾用戶${n.value.length}個，DOM渲染${c.value.renderedUserCount}個`),s.value==="error"&&t.push("Firebase連接異常"),s.value==="disconnected"&&t.push("Firebase未連接"),f.value.length===0&&t.push("無原始對話數據"),t.length===0?c.value.lastCheckResult={success:!0,message:"所有檢查項目通過 ✓"}:c.value.lastCheckResult={success:!1,message:`發現 ${t.length} 個問題:
${t.join(`
`)}`},console.log("聊天室檢查結果:",{conversations:f.value.length,filteredUsers:n.value.length,renderedCount:c.value.renderedUserCount,connectionStatus:s.value,hasContainers:{userListContainer:c.value.hasUserListContainer,userItemsContainer:c.value.hasUserItemsContainer},issues:t})},re=t=>{switch(t){case"connected":return"text-green-700";case"connecting":return"text-yellow-700";case"error":return"text-red-700";case"disconnected":default:return"text-gray-700"}},Q=async()=>{console.log("強制重新載入聊天室數據");try{c.value.lastCheckResult={success:!1,message:"正在重新載入數據..."},await x.cleanup(),await S(),await x.initialize(),await S(()=>{M(),V()}),console.log("數據重新載入完成")}catch(t){console.error("強制重新載入失敗:",t),c.value.lastCheckResult={success:!1,message:`重新載入失敗: ${t.message}`}}};z([f,n,s],()=>{b.value&&M()},{deep:!0}),Y(async()=>{console.log("即時聊天室初始化開始...");try{await x.initialize(),console.log("即時聊天室初始化完成"),S(()=>{M()}),document.addEventListener("visibilitychange",K),console.log("頁面可見性監聽器已設置"),document.addEventListener("keydown",H),console.log("鍵盤快捷鍵監聽器已設置 (Ctrl+Shift+D)"),T.value=window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"||localStorage.getItem("chatDebugMode")==="true",(new URLSearchParams(window.location.search).has("debug")||localStorage.getItem("chatDebugMode")==="true")&&(b.value=!0,T.value=!0,console.log("調試模式已啟用"))}catch(t){console.error("即時聊天室初始化失敗:",t),await C("聊天室初始化失敗，請重新整理頁面")}}),ae(()=>{console.log("即時聊天室頁面卸載，清理資源..."),document.removeEventListener("visibilitychange",K),console.log("頁面可見性監聽器已移除"),document.removeEventListener("keydown",H),console.log("鍵盤快捷鍵監聽器已移除"),x.cleanup()}),ie(()=>{document.removeEventListener("visibilitychange",K),document.removeEventListener("keydown",H),x.cleanup()}),ce();const G=de();z(()=>G.path,(t,o)=>{o&&o.includes("/chat")&&!t.includes("/chat")&&(console.log("離開即時聊天室頁面，清理資源"),x.cleanup())});const K=async()=>{if(!document.hidden&&G.path.includes("/chat")&&(console.log("頁面重新可見，檢查聊天室連接狀態"),b.value&&M(),s.value==="disconnected"||s.value==="error")){console.log("重新初始化聊天室連接");try{await x.initialize(),console.log("聊天室重新連接成功")}catch(t){console.error("聊天室重新連接失敗:",t)}}},H=t=>{(t.ctrlKey||t.metaKey)&&t.shiftKey&&t.key==="D"&&(t.preventDefault(),F())};return typeof window<"u"&&(window.toggleChatDebug=()=>{b.value=!b.value;const t=b.value?"enabled":"disabled";localStorage.setItem("chatDebugMode",b.value.toString()),console.log(`聊天室調試模式已${t==="enabled"?"啟用":"禁用"}`),b.value&&M()},window.performChatCheck=V,window.forceReloadChatData=Q),ue({title:"聊天室 - 融資貸款公司 CRM 系統"}),(t,o)=>{const v=Ee,le=xt;return l(),a("div",ht,[e("div",bt,[e("div",vt,[e("div",yt,[e("div",pt,[o[2]||(o[2]=e("h2",{class:"text-lg font-semibold text-gray-900"},"聊天室",-1)),e("div",wt,[e("div",{class:w(["w-2 h-2 rounded-full",{"bg-green-400 animate-pulse":r(s)==="connected","bg-yellow-400 animate-pulse":r(s)==="connecting","bg-red-400":r(s)==="error","bg-gray-400":r(s)==="disconnected"}])},null,2),e("span",_t,i(r(_)()),1),o[1]||(o[1]=e("span",{class:"text-xs bg-blue-100 text-blue-600 px-2 py-1 rounded"}," Firebase ",-1)),r(s)==="error"||r(s)==="disconnected"?(l(),a("button",{key:0,onClick:ne,class:"text-xs bg-red-100 text-red-600 hover:bg-red-200 px-2 py-1 rounded transition-colors",title:"重新連接"}," 重連 ")):h("",!0)])])]),e("div",Ct,[Z(e("input",{"onUpdate:modelValue":o[0]||(o[0]=j=>te(I)?I.value=j:null),type:"text",placeholder:"搜尋用戶...",class:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500"},null,512),[[ee,r(I)]]),B(r(he),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"})]),e("div",kt,[(l(!0),a(P,null,W(r(d),j=>(l(),a("button",{key:j.key,onClick:Ot=>L.value=j.key,class:w(["px-3 py-1 text-sm rounded-full transition-colors duration-200",r(L)===j.key?"bg-blue-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"])},i(j.label),11,It))),128))])]),e("div",{ref_key:"userListContainer",ref:N,class:"flex-1 overflow-y-auto custom-scrollbar-left"},[B(v,{ref_key:"chatUserListComponent",ref:A,users:r(n),activeUserId:r(U),onUserSelect:D},null,8,["users","activeUserId"]),r(b)?(l(),a("div",$t,[e("div",{class:"flex items-center justify-between mb-3"},[o[3]||(o[3]=e("h4",{class:"font-semibold text-gray-900"},"聊天室載入檢查",-1)),e("button",{onClick:F,class:"text-gray-500 hover:text-gray-700 font-bold text-lg"}," ✕ ")]),e("div",Ut,[e("div",Lt,[o[4]||(o[4]=e("span",{class:"font-medium text-gray-700"},"用戶列表容器:",-1)),e("span",{class:w(r(c).hasUserListContainer?"text-green-700 font-bold":"text-red-700 font-bold")},i(r(c).hasUserListContainer?"✓":"✗"),3)]),e("div",Dt,[o[5]||(o[5]=e("span",{class:"font-medium text-gray-700"},"用戶項目容器:",-1)),e("span",{class:w(r(c).hasUserItemsContainer?"text-green-700 font-bold":"text-red-700 font-bold")},i(r(c).hasUserItemsContainer?"✓":"✗"),3)]),e("div",Mt,[o[6]||(o[6]=e("span",{class:"font-medium text-gray-700"},"原始對話數據:",-1)),e("span",St,i(r(f).length),1)]),e("div",jt,[o[7]||(o[7]=e("span",{class:"font-medium text-gray-700"},"過濾後用戶:",-1)),e("span",Rt,i(r(n).length),1)]),e("div",Bt,[o[8]||(o[8]=e("span",{class:"font-medium text-gray-700"},"DOM中用戶項目:",-1)),e("span",Et,i(r(c).renderedUserCount),1)]),e("div",Tt,[o[9]||(o[9]=e("span",{class:"font-medium text-gray-700"},"Firebase狀態:",-1)),e("span",{class:w([re(r(s)),"font-bold"])},i(r(s)),3)]),e("div",{class:"pt-2 border-t border-gray-200 space-y-1"},[e("button",{onClick:V,class:"w-full text-xs bg-blue-500 text-white px-2 py-1 rounded hover:bg-blue-600 font-medium"}," 執行完整檢查 "),e("button",{onClick:Q,class:"w-full text-xs bg-orange-500 text-white px-2 py-1 rounded hover:bg-orange-600 font-medium"}," 強制重新載入數據 ")]),r(c).lastCheckResult?(l(),a("div",Nt,[o[10]||(o[10]=e("div",{class:"text-xs font-bold mb-1 text-gray-700"},"檢查結果:",-1)),e("div",{class:w(["text-xs p-2 rounded whitespace-pre-wrap font-medium",r(c).lastCheckResult.success?"bg-green-50 text-green-800 border border-green-200":"bg-red-50 text-red-800 border border-red-200"])},i(r(c).lastCheckResult.message),3)])):h("",!0)])])):h("",!0),!r(b)&&r(T)?(l(),a("button",{key:1,onClick:F,class:"fixed bottom-4 right-4 bg-blue-500 text-white p-2 rounded-full shadow-lg hover:bg-blue-600 z-40",title:"顯示調試面板"}," 🔍 ")):h("",!0)],512)]),e("div",zt,[r($)?(l(),ge(le,{key:0,user:r($),messages:r(g),onSendMessage:oe},null,8,["user","messages"])):(l(),a("div",At,[e("div",Ft,[B(r(be),{class:"w-16 h-16 text-gray-400 mx-auto mb-4"}),o[11]||(o[11]=e("h3",{class:"text-xl font-medium text-gray-900 mb-2"},"選擇聊天對象",-1)),o[12]||(o[12]=e("p",{class:"text-gray-500"},"從左側列表選擇要聊天的用戶開始對話",-1)),r(y)?(l(),a("div",Vt,[e("p",Kt,i(r(y)),1)])):h("",!0)])]))])])}}},Zt=X(Ht,[["__scopeId","data-v-27ec0795"]]);export{Zt as default};
