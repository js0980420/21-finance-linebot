import{_ as M}from"./0es6LyBp.js";import{h as T,r as w,i as L,c as h,a as e,t as c,f as A,g as _,v as x,d,j as f,e as B,k as C,o as p,l as I,m as b,n as y,p as V}from"#entry";import{u as q}from"./DgLT0ASK.js";const P={class:"min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 via-white to-indigo-50 py-12 px-4 sm:px-6 lg:px-8"},j={class:"max-w-md w-full space-y-8 bg-white rounded-2xl shadow-xl border border-gray-100 p-8"},N={class:"text-center"},U={class:"text-3xl font-bold text-gray-900"},E={class:"mt-2 text-sm text-gray-600"},S={class:"space-y-4"},z={for:"username",class:"block text-sm font-medium text-gray-700 mb-2"},D=["placeholder"],R={for:"password",class:"block text-sm font-medium text-gray-700 mb-2"},F=["placeholder"],H=["disabled"],$={key:0},G={key:1,class:"flex items-center"},J={class:"text-center"},K={class:"text-sm text-gray-600"},Y={__name:"login",setup(O){const{$swal:v}=T(),o=q(),r=n=>({"auth.login_title":"登入帳戶","auth.login_subtitle":"請輸入您的帳戶資訊","auth.username_email":"用戶名或郵箱","auth.username_email_placeholder":"請輸入用戶名或郵箱","auth.password":"密碼","auth.password_placeholder":"請輸入密碼","auth.login":"登入","auth.logging_in":"登入中...","auth.no_account":"還沒有帳戶？","auth.register":"立即註冊"})[n]||n,i=w({username:"",password:""}),g=w(!1),k=async()=>{try{if(g.value=!0,console.log("開始登入流程..."),console.log("表單資料:",i.value),!i.value.username||!i.value.password)throw new Error("請填寫完整的登入資訊");if(I().public.apiBaseUrl==="/mock-api"){console.warn("[Mock Login] 模擬登入成功"),await o.setUser({id:1,name:"Admin User (Mock)",email:"admin@finance-crm.com",roles:[{name:"admin"}],avatar:"https://ui-avatars.com/api/?name=Admin&background=6366f1&color=fff"}),o.setLoggedIn(!0),o.setToken("mock-token-for-admin");const l={success:!0,user:o.user,token:o.token};console.log("Mock Auth store login 結果:",l),await new Promise(m=>setTimeout(m,100));const u=b();let s=u.query.redirect||"/dashboard/analytics";u.query.redirect||l.user.roles?.[0]?.name==="staff"&&(s="/sales/customers"),console.log("準備重定向到 (Mock):",s);try{console.log("使用 window.location.href 進行重定向 (Mock)"),window.location.replace(s)}catch(m){console.warn("重定向失敗，嘗試使用 navigateTo (Mock):",m),await y(s)}return}const a=await o.login(i.value);if(console.log("Auth store login 結果:",a),a&&a.success&&a.user){if(console.log("登入成功，用戶資料:",a.user),console.log("用戶角色:",a.user.role),await V(),console.log("Auth store isLoggedIn:",o.isLoggedIn),console.log("Auth store user:",o.user),!o.isLoggedIn&&(console.log("等待認證狀態更新..."),await new Promise(s=>setTimeout(s,100)),!o.isLoggedIn))throw console.error("認證狀態更新失敗"),new Error("認證狀態更新失敗，請重新嘗試");await new Promise(s=>setTimeout(s,100)),o.isLoggedIn||(console.error("登入狀態確認失敗，等待狀態更新"),await new Promise(s=>setTimeout(s,200)));const l=b();let u=l.query.redirect||"/dashboard/analytics";l.query.redirect||a.user.role==="staff"&&(u="/sales/customers"),console.log("準備重定向到:",u),console.log("當前登入狀態:",o.isLoggedIn),console.log("用戶資料:",o.user);try{console.log("使用 window.location.href 進行重定向"),window.location.replace(u)}catch(s){console.warn("重定向失敗，嘗試使用 navigateTo:",s),await y(u)}}else throw console.error("登入回應異常:",a),new Error("登入失敗，請重試")}catch(n){console.error("登入錯誤:",n);const t=n&&n.message?n.message:"登入過程發生錯誤，請重試";v.fire({icon:"error",title:"系統提示",text:t,confirmButtonText:"確定",confirmButtonColor:"#3B82F6"})}finally{g.value=!1}};return L(()=>{}),(n,t)=>{const a=M;return p(),h("div",P,[e("div",j,[e("div",N,[t[2]||(t[2]=e("div",{class:"mx-auto w-16 h-16 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-2xl flex items-center justify-center mb-6 shadow-lg"},[e("svg",{class:"w-8 h-8 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1)),e("h2",U,c(r("auth.login_title")),1),e("p",E,c(r("auth.login_subtitle")),1)]),e("form",{class:"mt-8 space-y-6",onSubmit:A(k,["prevent"])},[e("div",S,[e("div",null,[e("label",z,c(r("auth.username_email")),1),_(e("input",{id:"username","onUpdate:modelValue":t[0]||(t[0]=l=>d(i).username=l),type:"text",required:"",class:"w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 bg-gray-50 text-gray-900",placeholder:r("auth.username_email_placeholder")},null,8,D),[[x,d(i).username]])]),e("div",null,[e("label",R,c(r("auth.password")),1),_(e("input",{id:"password","onUpdate:modelValue":t[1]||(t[1]=l=>d(i).password=l),type:"password",required:"",class:"w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 bg-gray-50 text-gray-900",placeholder:r("auth.password_placeholder")},null,8,F),[[x,d(i).password]])])]),e("button",{type:"submit",disabled:d(g),class:"w-full flex justify-center py-3 px-4 border border-transparent rounded-lg shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200"},[d(g)?(p(),h("span",G,[t[3]||(t[3]=e("svg",{class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)),f(" "+c(r("auth.logging_in")),1)])):(p(),h("span",$,c(r("auth.login")),1))],8,H),e("div",J,[e("p",K,[f(c(r("auth.no_account"))+" ",1),B(a,{to:"/auth/register",class:"font-medium text-blue-600 hover:text-blue-700 transition-colors duration-200"},{default:C(()=>[f(c(r("auth.register")),1)]),_:1})])])],32)])])}}};export{Y as default};
