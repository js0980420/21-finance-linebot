import{u as J}from"./CaSEveCJ.js";import{a as L}from"./DgLT0ASK.js";import{l as N,r as g,b as $,Y as p}from"#entry";const T=()=>{const{get:m,put:w,post:_,_delete:h}=L(),c=N().public.apiBaseUrl==="/mock-api",u=c&&r?r.cases:g([]),i=g(0),l=g(!1),n=g(null),r=c?J():null,P=async()=>{if(c){r&&(i.value=r.cases.length);return}try{const{data:t,error:e}=await m("/cases",{limit:1});if(e){console.error("Failed to fetch total cases:",e);return}i.value=t.total||0}catch(t){console.error("An error occurred while fetching total cases:",t)}},y=async(t={})=>{if(l.value=!0,n.value=null,c){if(!r)return n.value=new Error("Mock data store not initialized in mock mode."),l.value=!1,{success:!1,error:n.value};try{let e=r.cases;t.case_status&&(e=e.filter(v=>v.case_status===t.case_status));const s=t.per_page||15,a=t.page||1,o=(a-1)*s,f=o+s,d=e.slice(o,f);return i.value=e.length,{success:!0,items:JSON.parse(JSON.stringify(d)),meta:{total:e.length,perPage:s,currentPage:a,lastPage:Math.ceil(e.length/s)}}}catch(e){return n.value=e,u.value=[],{success:!1,error:e}}finally{l.value=!1}}try{const{data:e,error:s}=await m("/cases",t);return s?(n.value=s,u.value=[],{success:!1,error:s}):(u.value=e.data||[],t.page||(i.value=e.total||0),{success:!0,items:e.data||[],meta:{perPage:e.per_page||t.per_page||15,currentPage:e.current_page||t.page||1,lastPage:e.last_page||1}})}catch(e){return n.value=e,u.value=[],{success:!1,error:e}}finally{l.value=!1}},k=async(t={})=>{if(c){if(!r)return{success:!1,error:new Error("Mock data store not initialized in mock mode.")};let a=r.cases;t.case_status&&(a=a.filter(C=>C.case_status===t.case_status)),t.customer_id&&(a=a.filter(C=>C.customer_id===t.customer_id));const o=t.per_page||15,f=t.page||1,d=(f-1)*o,v=d+o,F=a.slice(d,v);return{success:!0,items:JSON.parse(JSON.stringify(F)),meta:{total:a.length,perPage:o,currentPage:f,lastPage:Math.ceil(a.length/o)}}}const{data:e,error:s}=await m("/cases",t);return s?{success:!1,error:s}:{success:!0,items:e.data||[],meta:{total:e.total||0,perPage:e.per_page||t.per_page||15,currentPage:e.current_page||t.page||1,lastPage:e.last_page||1}}},E=async(t,e)=>{if(c){if(!r)return{success:!1,error:new Error("Mock data store not initialized in mock mode.")};const s=r.updateCase(t,e);return s?{success:!0,data:s}:{success:!1,error:new Error("Case not found or update failed in mock store.")}}return await w(`/cases/${t}`,e)},M=async(t,e)=>{if(c){if(!r)return{success:!1,error:new Error("Mock data store not initialized in mock mode.")};const s={customer_id:t,...e,case_status:"tracking"},a=r.addCase(s);return a?{success:!0,data:a}:{success:!1,error:new Error("Failed to create case in mock store.")}}return await _(`/customers/${t}/cases`,e)},S=async t=>{if(c){if(!r)return null;const a=r.cases.filter(o=>o.customer_id===t);return a.length>0?a[a.length-1]:null}const{success:e,items:s}=await k({customer_id:t,per_page:1});return e&&s.length>0?s[0]:null},O=async t=>{if(c){if(!r)return{success:!1,error:new Error("Mock data store not initialized in mock mode.")};const e=r.removeCase(t);return e?{success:!0,data:e}:{success:!1,error:new Error("Case not found or remove failed in mock store.")}}return await h(`/cases/${t}`)},z=async(t,e)=>{if(c){if(!r)return{success:!1,error:new Error("Mock data store not initialized in mock mode.")};const s=r.updateLeadCaseStatus(t,"tracking");return s?(Object.assign(s,e),{success:!0,data:s}):{success:!1,error:new Error("Lead not found or conversion failed in mock store.")}}return await _(`/leads/${t}/convert-to-case`,e)};return{cases:p(u),totalCases:p(i),loading:p(l),error:p(n),fetchTotalCases:P,fetchCases:y,list:k,updateOne:E,createForCustomer:M,getLatestForCustomer:S,removeOne:O,convertToCase:z,countByStatus:c&&r?r.statusCounts:$(()=>{})}};export{T as u};
