import{c as d,o as i,a as t,u as Ve,r as a,b as Q,i as Se,e as m,x as U,t as n,k,f as W,g as c,v as g,I as $,L as Ue,d as f,j as X,F as Y,q as Z,s as ee}from"#entry";import{_ as We,r as $e}from"./CRGlAI26.js";import{a as Fe}from"./DgLT0ASK.js";import{u as r}from"./Csg14XMH.js";import{r as te}from"./c8JhvyFk.js";import{r as G}from"./UqRq4KLf.js";import"./B5My0XuL.js";import"./CKtbBPOe.js";function se(le,F){return i(),d("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M10.5 6h9.75M10.5 6a1.5 1.5 0 1 1-3 0m3 0a1.5 1.5 0 1 0-3 0M3.75 6H7.5m3 12h9.75m-9.75 0a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0m-3.75 0H7.5m9-6h3.75m-3.75 0a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0m-9.75 0h9.75"})])}const je={class:"space-y-6"},Pe={class:"grid grid-cols-1 md:grid-cols-5 gap-4"},qe={class:"bg-white rounded-lg shadow-sm border p-4"},ze={class:"text-2xl font-bold text-gray-900"},Be={class:"bg-white rounded-lg shadow-sm border p-4"},De={class:"text-2xl font-bold text-green-600"},Le={class:"bg-white rounded-lg shadow-sm border p-4"},Ie={class:"text-2xl font-bold text-blue-600"},Ne={class:"bg-white rounded-lg shadow-sm border p-4"},Te={class:"text-2xl font-bold text-purple-600"},Ee={class:"bg-white rounded-lg shadow-sm border p-4"},Ae={class:"text-2xl font-bold text-green-500"},He=["href"],Oe={class:"text-sm text-gray-500"},Re={key:0,class:"text-xs text-green-500 mt-1"},Ge={key:1,class:"text-xs text-red-500 mt-1"},Je={class:"text-sm text-gray-900"},Ke={class:"flex items-center space-x-2 justify-end"},Qe=["onClick"],Xe=["onClick"],Ye=["onClick"],Ze={class:"bg-white rounded-lg p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto"},et={class:"text-lg font-semibold text-gray-900 mb-4"},tt={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},st={class:"md:col-span-2"},lt={class:"md:col-span-2"},ot={class:"flex items-center space-x-2"},rt={key:0,class:"md:col-span-2"},at={key:1,class:"md:col-span-2"},nt={class:"md:col-span-2"},dt={class:"flex justify-end space-x-3 pt-4"},it=["disabled"],ut={class:"bg-white rounded-lg p-6 w-full max-w-4xl max-h-[90vh] overflow-y-auto"},ct={class:"flex items-center justify-between mb-6"},pt={class:"text-lg font-semibold text-gray-900"},bt={key:0,class:"flex items-center justify-center py-12"},gt={key:1},vt={class:"flex items-center justify-between mb-6 p-4 bg-gray-50 rounded-lg"},yt={class:"flex items-center space-x-3"},mt=["disabled"],xt=["disabled"],ft={class:"text-sm text-gray-600"},wt={key:0,class:"text-center py-12"},ht={key:1,class:"space-y-4"},kt={class:"flex items-center justify-between"},_t={class:"overflow-x-auto"},Ct={class:"min-w-full divide-y divide-gray-200"},Mt={class:"bg-gray-50"},Vt={class:"px-4 py-3 text-left text-sm font-medium text-gray-500"},St={class:"bg-white divide-y divide-gray-200"},Ut={class:"px-4 py-3"},Wt=["onUpdate:modelValue"],$t=["value"],Ft={class:"px-4 py-3"},jt=["onUpdate:modelValue","onInput"],Pt={class:"px-4 py-3 text-center"},qt=["onClick"],zt={class:"flex justify-end pt-4 border-t"},Bt={class:"flex space-x-3"},Dt=["disabled"],Lt={class:"bg-white rounded-lg p-6 w-full max-w-2xl"},It={class:"flex justify-end pt-4 border-t space-x-3"},Nt=["disabled"],Kt={__name:"websites",setup(le){Ve({title:"WordPress網站管理 - 金融管理系統"});const F=a({data:[],current_page:1,last_page:1,total:0,from:0,to:0}),_=a({}),D=a(!1),j=a(!1),P=a(!1),x=a(null),C=a(""),V=a(1),L=a(15),w=a({search:"",status:"",type:""}),o=a({name:"",domain:"",url:"",status:"active",type:"wordpress",webhook_enabled:!0,webhook_url:"",webhook_secret:"",notes:""}),I=a(!1),v=a(null),p=a([]),N=a({}),oe=a({}),T=a(!1),M=a(!1),E=a(!1),q=a(!1),u=a({key:"",label:"",description:""}),{get:A,post:S,put:re,del:ae}=Fe(),ne=[{key:"website",title:"網站",sortable:!0,width:"200px"},{key:"status",title:"狀態",sortable:!0,width:"120px"},{key:"statistics",title:"統計",sortable:!1,width:"150px"},{key:"webhook",title:"Webhook",sortable:!0,width:"100px"},{key:"actions",title:"操作",sortable:!1,width:"120px"}],de=Q(()=>F.value.data||[]),J=Q(()=>p.value.length===0?!1:p.value.every(l=>l.system_field&&l.wp_field_name)),y=async(l=V.value)=>{D.value=!0,C.value="";try{const e={page:l.toString(),per_page:L.value.toString(),...w.value},{data:s,error:b}=await A("/websites",e);if(b){console.error("載入網站失敗:",b),C.value=b.message||"無法載入網站列表",r().add({title:"載入失敗",description:C.value,color:"red"});return}F.value=s||{data:[],current_page:1,last_page:1,total:0,from:0,to:0},V.value=F.value.current_page}catch(e){console.error("載入網站失敗:",e),C.value="無法載入網站列表",r().add({title:"載入失敗",description:C.value,color:"red"})}finally{D.value=!1}},H=async()=>{try{const{data:l,error:e}=await A("/websites-statistics");if(e){console.error("載入統計失敗:",e),r().add({title:"載入統計失敗",description:e.message||"無法載入統計資料",color:"red"});return}_.value=l}catch(l){console.error("載入統計失敗:",l),r().add({title:"載入統計失敗",description:"無法載入統計資料",color:"red"})}},ie=()=>{x.value=null,o.value={name:"",domain:"",url:"",status:"active",type:"wordpress",webhook_enabled:!0,webhook_url:"",webhook_secret:"",notes:""},P.value=!0},ue=l=>{x.value=l,o.value={name:l.name,domain:l.domain,url:l.url,status:l.status,type:l.type,webhook_enabled:l.webhook_enabled,webhook_url:l.webhook_url||"",webhook_secret:l.webhook_secret||"",notes:l.notes||""},P.value=!0},ce=async()=>{j.value=!0;try{let l;if(x.value?l=await re(`/websites/${x.value.id}`,o.value):l=await S("/websites",o.value),l.error){console.error("儲存失敗:",l.error),r().add({title:"儲存失敗",description:l.error.message||"網站儲存失敗",color:"red"});return}r().add({title:x.value?"更新成功":"建立成功",description:x.value?"網站資料已更新":"新網站已建立",color:"green"}),O(),await y(),await H()}catch(l){console.error("儲存失敗:",l),r().add({title:"儲存失敗",description:"網站儲存失敗",color:"red"})}finally{j.value=!1}},pe=async l=>{if(confirm(`確定要刪除網站「${l.name}」嗎？`))try{const e=await ae(`/websites/${l.id}`);if(e.error){console.error("刪除失敗:",e.error),r().add({title:"刪除失敗",description:e.error.message||"網站刪除失敗",color:"red"});return}r().add({title:"刪除成功",description:"網站已刪除",color:"green"}),await y(),await H()}catch(e){console.error("刪除失敗:",e),r().add({title:"刪除失敗",description:"網站刪除失敗",color:"red"})}},O=()=>{P.value=!1,x.value=null},be=l=>{w.value.search=l},ge=l=>{V.value=l,y(l)},ve=l=>{L.value=l,V.value=1,y(1)},ye=l=>({active:"bg-green-100 text-green-800",inactive:"bg-red-100 text-red-800",maintenance:"bg-yellow-100 text-yellow-800"})[l]||"bg-gray-100 text-gray-800",me=l=>({active:"運行中",inactive:"已停用",maintenance:"維護中"})[l]||l,xe=async l=>{v.value=l,I.value=!0,await fe(l.id)},z=()=>{I.value=!1,v.value=null,p.value=[]},fe=async l=>{T.value=!0;try{const{data:e,error:s}=await A(`/websites/${l}/field-mappings`);if(s){console.error("載入欄位對應失敗:",s),r().add({title:"載入失敗",description:s.message||"無法載入欄位對應設定",color:"red"});return}p.value=e.data||[],N.value=e.system_fields||{},oe.value=e.field_types||{}}catch(e){console.error("載入欄位對應失敗:",e),r().add({title:"載入失敗",description:"無法載入欄位對應設定",color:"red"})}finally{T.value=!1}},we=async()=>{if(v.value)try{const{data:l,error:e}=await S(`/websites/${v.value.id}/field-mappings/defaults`);if(e){console.error("建立預設對應失敗:",e),r().add({title:"建立失敗",description:e.message||"無法建立預設欄位對應",color:"red"});return}p.value=l.data||[],r().add({title:"建立成功",description:"預設欄位對應已建立",color:"green"})}catch(l){console.error("建立預設對應失敗:",l),r().add({title:"建立失敗",description:"無法建立預設欄位對應",color:"red"})}},K=()=>{p.value.push({system_field:"",wp_field_name:"",display_name:"",sort_order:p.value.length*10})},he=l=>{p.value.splice(l,1)},ke=async()=>{if(!(!v.value||!J.value)){M.value=!0;try{const{data:l,error:e}=await S(`/websites/${v.value.id}/field-mappings`,{mappings:p.value});if(e){console.error("儲存欄位對應失敗:",e),r().add({title:"儲存失敗",description:e.message||"欄位對應設定儲存失敗",color:"red"});return}r().add({title:"儲存成功",description:"欄位對應設定已更新",color:"green"}),z()}catch(l){console.error("儲存欄位對應失敗:",l),r().add({title:"儲存失敗",description:"欄位對應設定儲存失敗",color:"red"})}finally{M.value=!1}}},_e=async()=>{if(!v.value)return;const l={姓名:"測試客戶",手機號碼:"0912345678",Email:"test@example.com",LINE_ID:"test_line_id",方便聯絡時間:"上午9:00-12:00",資金需求:"50萬以下","頁面 URL":"https://example.com/contact/"};try{const{data:e,error:s}=await S(`/websites/${v.value.id}/field-mappings/test`,{test_data:l});if(s){console.error("測試欄位對應失敗:",s),r().add({title:"測試失敗",description:s.message||"欄位對應測試失敗",color:"red"});return}const b=`測試完成！對應了 ${e.mapped_fields_count} 個欄位，${e.unmapped_fields_count} 個欄位未對應`;r().add({title:"測試完成",description:b,color:"green"}),console.log("測試結果:",e)}catch(e){console.error("測試欄位對應失敗:",e),r().add({title:"測試失敗",description:"欄位對應測試失敗",color:"red"})}},Ce=()=>{u.value={key:"",label:"",description:""},E.value=!0},B=()=>{E.value=!1},Me=async()=>{if(!(!u.value.key||!u.value.label)){q.value=!0;try{const{data:l,error:e}=await S("/field-mappings/system-fields",u.value);if(e){console.error("新增系統欄位失敗:",e),r().add({title:"新增失敗",description:e.message||"系統欄位新增失敗",color:"red"});return}N.value[u.value.key]={label:u.value.label,description:u.value.description},r().add({title:"新增成功",description:`系統欄位「${u.value.label}」已新增`,color:"green"}),B()}catch(l){console.error("新增系統欄位失敗:",l),r().add({title:"新增失敗",description:"系統欄位新增失敗",color:"red"})}finally{q.value=!1}}};return Se(()=>{y(),H()}),(l,e)=>(i(),d("div",je,[e[53]||(e[53]=t("div",{class:"flex items-center justify-between"},[t("div",null,[t("h1",{class:"text-3xl font-bold text-gray-900"},"WordPress網站管理"),t("p",{class:"text-gray-600 mt-2"},"管理和編輯WordPress網站設定，統一管理所有進件來源")])],-1)),t("div",Pe,[t("div",qe,[e[14]||(e[14]=t("div",{class:"text-sm text-gray-500"},"總網站數",-1)),t("div",ze,n(_.value.summary?.total_websites||0),1)]),t("div",Be,[e[15]||(e[15]=t("div",{class:"text-sm text-gray-500"},"運行中",-1)),t("div",De,n(_.value.summary?.active_websites||0),1)]),t("div",Le,[e[16]||(e[16]=t("div",{class:"text-sm text-gray-500"},"WordPress",-1)),t("div",Ie,n(_.value.summary?.wordpress_websites||0),1)]),t("div",Ne,[e[17]||(e[17]=t("div",{class:"text-sm text-gray-500"},"Webhook啟用",-1)),t("div",Te,n(_.value.summary?.webhook_enabled||0),1)]),t("div",Ee,[e[18]||(e[18]=t("div",{class:"text-sm text-gray-500"},"健康網站",-1)),t("div",Ae,n(_.value.summary?.healthy_websites||0),1)])]),m(We,{title:"網站列表",columns:ne,data:de.value,loading:D.value,error:C.value,"search-query":w.value.search,"search-placeholder":"搜尋網站名稱...","show-search-icon":!1,"current-page":V.value,"items-per-page":L.value,"loading-text":"載入中...","empty-text":"尚無網站資料",onSearch:be,onRefresh:y,onRetry:y,onPageChange:ge,onPageSizeChange:ve},{filters:k(()=>[c(t("select",{"onUpdate:modelValue":e[0]||(e[0]=s=>w.value.status=s),onChange:y,class:"px-4 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500"},[...e[19]||(e[19]=[t("option",{value:""},"所有狀態",-1),t("option",{value:"active"},"運行中",-1),t("option",{value:"inactive"},"已停用",-1),t("option",{value:"maintenance"},"維護中",-1)])],544),[[$,w.value.status]]),c(t("select",{"onUpdate:modelValue":e[1]||(e[1]=s=>w.value.type=s),onChange:y,class:"px-4 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500"},[...e[20]||(e[20]=[t("option",{value:""},"所有類型",-1),t("option",{value:"wordpress"},"WordPress",-1),t("option",{value:"other"},"其他",-1)])],544),[[$,w.value.type]])]),actions:k(()=>[t("button",{onClick:ie,class:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors duration-200 flex items-center space-x-2"},[m(f(G),{class:"w-5 h-5"}),e[21]||(e[21]=t("span",null,"新增網站",-1))])]),"cell-website":k(({item:s})=>[t("div",null,[t("a",{href:s.url,target:"_blank",class:"text-sm font-medium text-blue-600 hover:text-blue-800"},n(s.name),9,He),t("div",Oe,n(s.type==="wordpress"?"WordPress":"其他"),1)])]),"cell-status":k(({item:s})=>[t("div",null,[t("span",{class:ee([ye(s.status),"px-2 inline-flex text-xs leading-5 font-semibold rounded-full"])},n(me(s.status)),3),s.is_healthy?(i(),d("div",Re,"健康")):(i(),d("div",Ge,"需關注"))])]),"cell-statistics":k(({item:s})=>[t("div",Je,[t("div",null,"進件: "+n(s.statistics?.total_leads||0),1),t("div",null,"客戶: "+n(s.statistics?.total_customers||0),1),t("div",null,"轉換率: "+n(s.conversion_rate)+"%",1)])]),"cell-webhook":k(({item:s})=>[t("span",{class:ee([s.webhook_enabled?"text-green-500":"text-red-500","text-sm"])},n(s.webhook_enabled?"已啟用":"已停用"),3)]),"cell-actions":k(({item:s})=>[t("div",Ke,[t("button",{onClick:b=>xe(s),class:"p-2 text-blue-600 hover:text-blue-800 hover:bg-blue-50 rounded-lg transition-all duration-200 group relative",title:"欄位對應設定"},[m(f(se),{class:"w-4 h-4"}),e[22]||(e[22]=t("span",{class:"absolute -top-8 left-1/2 transform -translate-x-1/2 bg-gray-800 text-white text-xs px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap"}," 欄位對應 ",-1))],8,Qe),t("button",{onClick:b=>ue(s),class:"p-2 text-gray-600 hover:text-gray-800 hover:bg-gray-50 rounded-lg transition-all duration-200 group relative",title:"編輯網站"},[m(f($e),{class:"w-4 h-4"}),e[23]||(e[23]=t("span",{class:"absolute -top-8 left-1/2 transform -translate-x-1/2 bg-gray-800 text-white text-xs px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap"}," 編輯 ",-1))],8,Xe),t("button",{onClick:b=>pe(s),class:"p-2 text-red-600 hover:text-red-800 hover:bg-red-50 rounded-lg transition-all duration-200 group relative",title:"刪除網站"},[m(f(te),{class:"w-4 h-4"}),e[24]||(e[24]=t("span",{class:"absolute -top-8 left-1/2 transform -translate-x-1/2 bg-gray-800 text-white text-xs px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap"}," 刪除 ",-1))],8,Ye)])]),_:1},8,["data","loading","error","search-query","current-page","items-per-page"]),P.value?(i(),d("div",{key:0,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",onClick:W(O,["self"])},[t("div",Ze,[t("h3",et,n(x.value?"編輯網站":"新增網站"),1),t("form",{onSubmit:W(ce,["prevent"]),class:"space-y-4"},[t("div",tt,[t("div",null,[e[25]||(e[25]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"網站名稱 *",-1)),c(t("input",{"onUpdate:modelValue":e[2]||(e[2]=s=>o.value.name=s),required:"",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"例如：熊好貸"},null,512),[[g,o.value.name]])]),t("div",null,[e[26]||(e[26]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"域名 *",-1)),c(t("input",{"onUpdate:modelValue":e[3]||(e[3]=s=>o.value.domain=s),required:"",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"例如：example.com"},null,512),[[g,o.value.domain]])]),t("div",st,[e[27]||(e[27]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"完整網址 *",-1)),c(t("input",{"onUpdate:modelValue":e[4]||(e[4]=s=>o.value.url=s),type:"url",required:"",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"https://example.com"},null,512),[[g,o.value.url]])]),t("div",null,[e[29]||(e[29]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"狀態",-1)),c(t("select",{"onUpdate:modelValue":e[5]||(e[5]=s=>o.value.status=s),class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},[...e[28]||(e[28]=[t("option",{value:"active"},"運行中",-1),t("option",{value:"inactive"},"已停用",-1),t("option",{value:"maintenance"},"維護中",-1)])],512),[[$,o.value.status]])]),t("div",null,[e[31]||(e[31]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"類型",-1)),c(t("select",{"onUpdate:modelValue":e[6]||(e[6]=s=>o.value.type=s),class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},[...e[30]||(e[30]=[t("option",{value:"wordpress"},"WordPress",-1),t("option",{value:"other"},"其他",-1)])],512),[[$,o.value.type]])]),t("div",lt,[t("label",ot,[c(t("input",{type:"checkbox","onUpdate:modelValue":e[7]||(e[7]=s=>o.value.webhook_enabled=s),class:"rounded"},null,512),[[Ue,o.value.webhook_enabled]]),e[32]||(e[32]=t("span",{class:"text-sm font-medium text-gray-700"},"啟用Webhook",-1))])]),o.value.webhook_enabled?(i(),d("div",rt,[e[33]||(e[33]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Webhook網址",-1)),c(t("input",{"onUpdate:modelValue":e[8]||(e[8]=s=>o.value.webhook_url=s),type:"url",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"https://example.com/webhook"},null,512),[[g,o.value.webhook_url]])])):U("",!0),o.value.webhook_enabled?(i(),d("div",at,[e[34]||(e[34]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Webhook密鑰",-1)),c(t("input",{"onUpdate:modelValue":e[9]||(e[9]=s=>o.value.webhook_secret=s),type:"password",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"webhook密鑰"},null,512),[[g,o.value.webhook_secret]])])):U("",!0),t("div",nt,[e[35]||(e[35]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"備註",-1)),c(t("textarea",{"onUpdate:modelValue":e[10]||(e[10]=s=>o.value.notes=s),rows:"3",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"網站相關備註..."},null,512),[[g,o.value.notes]])])]),t("div",dt,[t("button",{type:"button",onClick:O,class:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50"}," 取消 "),t("button",{type:"submit",disabled:j.value,class:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50"},n(j.value?"儲存中...":"儲存"),9,it)])],32)])])):U("",!0),I.value?(i(),d("div",{key:1,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",onClick:W(z,["self"])},[t("div",ut,[t("div",ct,[t("h3",pt,n(v.value?.name)+" - 表單欄位對應設定 ",1),t("button",{onClick:z,class:"text-gray-500 hover:text-gray-700"},[...e[36]||(e[36]=[t("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),T.value?(i(),d("div",bt,[...e[37]||(e[37]=[t("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"},null,-1),t("span",{class:"ml-2 text-gray-600"},"載入欄位對應設定...",-1)])])):(i(),d("div",gt,[t("div",vt,[t("div",yt,[t("button",{onClick:we,disabled:p.value.length>0||M.value,class:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed"}," 建立預設對應 ",8,mt),t("button",{onClick:_e,disabled:p.value.length===0||M.value,class:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed"}," 測試對應 ",8,xt)]),t("div",ft," 已設定 "+n(p.value.length)+" 個欄位對應 ",1)]),p.value.length===0?(i(),d("div",wt,[m(f(se),{class:"w-12 h-12 mx-auto text-gray-400 mb-4"}),e[38]||(e[38]=t("h4",{class:"text-lg font-medium text-gray-900 mb-2"},"尚未設定欄位對應",-1)),e[39]||(e[39]=t("p",{class:"text-gray-600 mb-4"},"請建立預設對應或手動添加欄位對應設定",-1)),t("button",{onClick:K,class:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700"}," 添加欄位對應 ")])):(i(),d("div",ht,[t("div",kt,[e[41]||(e[41]=t("h4",{class:"text-md font-medium text-gray-900"},"欄位對應設定",-1)),t("button",{onClick:K,class:"px-3 py-2 text-sm bg-blue-600 text-white rounded-lg hover:bg-blue-700"},[m(f(G),{class:"w-4 h-4 inline mr-1"}),e[40]||(e[40]=X(" 添加對應 ",-1))])]),t("div",_t,[t("table",Ct,[t("thead",Mt,[t("tr",null,[t("th",Vt,[e[42]||(e[42]=X(" 系統欄位 ",-1)),t("button",{onClick:Ce,class:"ml-2 text-blue-600 hover:text-blue-800",title:"新增系統欄位"},[m(f(G),{class:"w-4 h-4"})])]),e[43]||(e[43]=t("th",{class:"px-4 py-3 text-left text-sm font-medium text-gray-500"},"WordPress欄位名稱",-1)),e[44]||(e[44]=t("th",{class:"px-4 py-3 text-center text-sm font-medium text-gray-500"},"操作",-1))])]),t("tbody",St,[(i(!0),d(Y,null,Z(p.value,(s,b)=>(i(),d("tr",{key:b,class:"hover:bg-gray-50"},[t("td",Ut,[c(t("select",{"onUpdate:modelValue":h=>s.system_field=h,class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},[e[45]||(e[45]=t("option",{value:""},"請選擇系統欄位",-1)),(i(!0),d(Y,null,Z(N.value,(h,R)=>(i(),d("option",{key:R,value:R},n(h.label)+" ("+n(R)+") ",9,$t))),128))],8,Wt),[[$,s.system_field]])]),t("td",Ft,[c(t("input",{"onUpdate:modelValue":h=>s.wp_field_name=h,onInput:h=>s.display_name=s.wp_field_name,placeholder:"例如：姓名",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,40,jt),[[g,s.wp_field_name]])]),t("td",Pt,[t("button",{onClick:h=>he(b),class:"p-1 text-red-600 hover:text-red-800 hover:bg-red-50 rounded"},[m(f(te),{class:"w-4 h-4"})],8,qt)])]))),128))])])]),t("div",zt,[t("div",Bt,[t("button",{onClick:z,type:"button",class:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50"}," 取消 "),t("button",{onClick:ke,disabled:M.value||!J.value,class:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed"},n(M.value?"儲存中...":"儲存設定"),9,Dt)])])]))]))])])):U("",!0),E.value?(i(),d("div",{key:2,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",onClick:W(B,["self"])},[t("div",Lt,[t("div",{class:"flex items-center justify-between mb-6"},[e[47]||(e[47]=t("h3",{class:"text-lg font-semibold text-gray-900"}," 新增系統欄位 ",-1)),t("button",{onClick:B,class:"text-gray-500 hover:text-gray-700"},[...e[46]||(e[46]=[t("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),t("form",{onSubmit:W(Me,["prevent"]),class:"space-y-4"},[t("div",null,[e[48]||(e[48]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"欄位代碼",-1)),c(t("input",{"onUpdate:modelValue":e[11]||(e[11]=s=>u.value.key=s),type:"text",placeholder:"例如：custom_field_1",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:""},null,512),[[g,u.value.key]]),e[49]||(e[49]=t("p",{class:"text-xs text-gray-500 mt-1"},"請使用英文字母、數字和底線，系統內部識別用",-1))]),t("div",null,[e[50]||(e[50]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"欄位名稱",-1)),c(t("input",{"onUpdate:modelValue":e[12]||(e[12]=s=>u.value.label=s),type:"text",placeholder:"例如：客戶職業",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:""},null,512),[[g,u.value.label]]),e[51]||(e[51]=t("p",{class:"text-xs text-gray-500 mt-1"},"在欄位選擇時顯示的名稱",-1))]),t("div",null,[e[52]||(e[52]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"描述（選填）",-1)),c(t("textarea",{"onUpdate:modelValue":e[13]||(e[13]=s=>u.value.description=s),rows:"3",placeholder:"說明此欄位的用途",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,512),[[g,u.value.description]])]),t("div",It,[t("button",{onClick:B,type:"button",class:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50"}," 取消 "),t("button",{type:"submit",disabled:q.value||!u.value.key||!u.value.label,class:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed"},n(q.value?"新增中...":"新增欄位"),9,Nt)])],32)])])):U("",!0)]))}};export{Kt as default};
