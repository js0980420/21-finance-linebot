import bt from"./-Op9ZE8F.js";import{_ as mt,r as p,b as ie,H as K,y as gt,i as _t,C as xt,u as ft,c as r,a as s,e as O,x as y,k as f,d as o,f as S,g as c,I as E,F as m,q as g,v as _,t as u,j as C,l as Ee,o as i,A as vt,K as F,s as Q,L as R,n as De,h as ht}from"#entry";import{_ as kt,r as wt}from"./CRGlAI26.js";import{u as je}from"./CaSEveCJ.js";import{u as Ut}from"./l19cjJOa.js";import{u as Ct,a as xe}from"./DgLT0ASK.js";import{u as Vt}from"./BtlpaPqX.js";import{u as Lt}from"./7WFD-W98.js";import{u as It}from"./DzJdZt_Q.js";import{u as Nt}from"./DQZituR6.js";import{r as St}from"./BKE9UY2T.js";import{r as Et}from"./DdngC8ig.js";import{r as Dt}from"./c8JhvyFk.js";import{r as jt}from"./DWNj0d99.js";import"./B5My0XuL.js";import"./CKtbBPOe.js";const $t={class:"space-y-6"},qt=["value"],At=["value","onChange"],Ot=["value"],Tt={class:"text-sm font-medium text-gray-900"},Mt=["value","onChange"],Pt=["value"],Ft=["value","onChange"],Rt={class:"text-sm text-gray-900"},zt={class:"text-xs text-gray-500"},Bt={class:"flex items-center space-x-2"},Wt={class:"text-sm text-gray-900"},Gt=["onClick"],Ht={class:"text-sm text-gray-900"},Kt={class:"text-xs text-gray-500"},Qt={key:0,class:"flex items-center space-x-2"},Yt=["src","alt"],Jt={key:1,class:"w-6 h-6 rounded-full bg-green-500 flex items-center justify-center text-white text-xs"},Xt={class:"flex-1 min-w-0"},Zt={class:"flex items-center space-x-1"},es={class:"text-xs font-medium text-gray-900 truncate"},ts=["onClick"],ss={key:1,class:"flex items-center space-x-2"},os={class:"text-xs text-gray-900"},ls={key:2,class:"text-xs text-gray-400"},as={class:"text-sm text-gray-900"},ns={class:"text-xs text-gray-500 truncate max-w-[120px]"},rs={class:"text-sm text-gray-900"},is=["value","onChange"],ds={key:0,class:"space-y-1"},us={class:"text-gray-500"},cs={class:"text-gray-900 ml-1"},ys={key:0,class:"text-xs text-gray-400"},ps={key:1,class:"text-xs text-gray-400"},bs={class:"flex items-center space-x-2 justify-end"},ms=["onClick"],gs=["onClick"],_s=["onClick"],xs=["onClick"],fs={class:"bg-white h-full w-full overflow-hidden flex flex-col"},vs={class:"flex items-center justify-between p-6 border-b bg-gray-50"},hs={class:"flex-1 overflow-hidden"},ks={class:"flex-1 border-r overflow-y-auto p-6 bg-blue-50"},ws={class:"space-y-4"},Us=["value"],Cs=["value"],Vs=["value"],Ls={class:"space-y-2"},Is=["value"],Ns={class:"space-y-2"},Ss={class:"flex-1 border-r overflow-y-auto p-6 bg-green-50"},Es={class:"text-lg font-semibold text-gray-800 mb-4 sticky top-0 bg-green-50 py-2"},Ds={class:"space-y-4"},js={class:"block text-sm font-semibold text-gray-900 mb-1"},$s={key:0,class:"text-red-500"},qs=["onUpdate:modelValue","type","readonly"],As=["onUpdate:modelValue"],Os=["onUpdate:modelValue"],Ts=["onUpdate:modelValue"],Ms=["value"],Ps={key:4,class:"inline-flex items-center space-x-2 mt-2"},Fs=["onUpdate:modelValue"],Rs={key:5,class:"text-sm text-gray-500"},zs={class:"flex-1 border-r overflow-y-auto p-6 bg-yellow-50"},Bs={class:"text-lg font-semibold text-gray-800 mb-4 sticky top-0 bg-yellow-50 py-2"},Ws={class:"space-y-4"},Gs={class:"block text-sm font-semibold text-gray-900 mb-1"},Hs={key:0,class:"text-red-500"},Ks=["onUpdate:modelValue","type","readonly"],Qs=["onUpdate:modelValue"],Ys=["onUpdate:modelValue"],Js=["onUpdate:modelValue"],Xs=["value"],Zs={key:4,class:"inline-flex items-center space-x-2 mt-2"},eo=["onUpdate:modelValue"],to={class:"flex-1 border-r overflow-y-auto p-6 bg-purple-50"},so={class:"text-lg font-semibold text-gray-800 mb-4 sticky top-0 bg-purple-50 py-2"},oo={class:"space-y-4"},lo={class:"block text-sm font-semibold text-gray-900 mb-1"},ao={key:0,class:"text-red-500"},no=["onUpdate:modelValue","type","readonly"],ro=["onUpdate:modelValue"],io={key:2,class:"inline-flex items-center space-x-2 mt-2"},uo=["onUpdate:modelValue"],co={class:"flex-1 border-r overflow-y-auto p-6 bg-red-50"},yo={class:"text-lg font-semibold text-gray-800 mb-4 sticky top-0 bg-red-50 py-2"},po={class:"space-y-4"},bo={class:"block text-sm font-semibold text-gray-900 mb-1"},mo={key:0,class:"text-red-500"},go=["onUpdate:modelValue","type","readonly"],_o={key:1,class:"inline-flex items-center space-x-2 mt-2"},xo=["onUpdate:modelValue"],fo={class:"flex-1 overflow-y-auto p-6 bg-gray-50"},vo={class:"text-lg font-semibold text-gray-800 mb-4 sticky top-0 bg-gray-50 py-2"},ho={class:"space-y-4"},ko={class:"block text-sm font-semibold text-gray-900 mb-1"},wo={key:0,class:"text-red-500"},Uo=["onUpdate:modelValue","type","readonly"],Co=["onUpdate:modelValue"],Vo={key:0,class:"border-t pt-4"},Lo={class:"space-y-4"},Io={class:"block text-sm font-semibold text-gray-900 mb-1"},No={key:0,class:"text-red-500"},So=["type","step","required","onUpdate:modelValue"],Eo=["required","onUpdate:modelValue"],Do=["required","onUpdate:modelValue"],jo=["value"],$o={key:3},qo={class:"flex flex-wrap gap-2"},Ao=["value","onUpdate:modelValue"],Oo={key:4,class:"inline-flex items-center space-x-2 mt-2"},To=["onUpdate:modelValue"],Mo={class:"border-t pt-4"},Po={class:"border-t pt-4 flex justify-end space-x-3"},Fo=["disabled"],Ro={class:"bg-white rounded-lg p-6 w-full max-w-2xl mx-4 max-h-[90vh] overflow-y-auto"},zo={key:0,class:"space-y-4"},Bo={class:"grid grid-cols-2 gap-4"},Wo={class:"text-gray-900"},Go={class:"text-gray-900"},Ho={class:"text-gray-900"},Ko={class:"text-gray-900"},Qo={class:"text-gray-900"},Yo={class:"text-gray-900"},Jo={key:0},Xo={class:"text-gray-900 whitespace-pre-wrap"},Zo={class:"bg-white rounded-lg p-6 w-full max-w-lg"},el={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},tl={class:"md:col-span-2"},sl={class:"bg-white rounded-lg p-6 w-full max-w-md"},ol={key:0,class:"mb-4"},ll={class:"bg-gray-50 p-3 rounded-lg"},al={class:"text-sm text-gray-900"},nl={class:"text-sm text-gray-900"},rl={class:"text-sm text-gray-900"},il=["value"],dl={class:"flex justify-end space-x-3 pt-4"},ul=["disabled"],cl={class:"bg-white rounded-lg p-6 w-full max-w-md"},yl={key:0,class:"mb-4"},pl={class:"bg-gray-50 p-3 rounded-lg flex items-center space-x-3"},bl=["src","alt"],ml={key:1,class:"w-10 h-10 rounded-full bg-green-500 flex items-center justify-center text-white text-sm"},gl={class:"text-sm text-gray-900 font-medium"},_l={class:"text-xs text-gray-500"},xl={class:"flex justify-end space-x-3 pt-4"},fl=["disabled"],vl={__name:"blacklist",setup(hl){const de=[{value:"pending",label:"待處理",category:"leads"},{value:"valid_customer",label:"有效客",category:"leads_management"},{value:"invalid_customer",label:"無效客",category:"leads_management"},{value:"customer_service",label:"客服",category:"leads_management"},{value:"blacklist",label:"黑名單",category:"leads_management"},{value:"approved_disbursed",label:"核准撥款",category:"case_management"},{value:"approved_undisbursed",label:"核准未撥",category:"case_management"},{value:"conditional_approval",label:"附條件",category:"case_management"},{value:"declined",label:"婉拒",category:"case_management"},{value:"tracking",label:"追蹤中",category:"sales_tracking"}],$e=[{key:"case_status",title:"進線狀態",sortable:!0,width:"90px"},{key:"datetime",title:"時間",sortable:!0,width:"140px"},{key:"assignee",title:"承辦業務",sortable:!0,width:"80px"},{key:"channel",title:"來源管道",sortable:!0,width:"80px"},{key:"customer_name",title:"姓名",sortable:!0,width:"80px"},{key:"line_info",title:"LINE資訊",sortable:!1,width:"160px"},{key:"purpose",title:"諮詢項目",sortable:!1,width:"100px"},{key:"website",title:"網站",sortable:!1,width:"50px"},{key:"contact_info",title:"聯絡資訊",sortable:!1,width:"160px"},{key:"actions",title:"操作",sortable:!1,width:"160px"}],V={personal:{title:"個人資料",fields:[{key:"birth_date",label:"出生年月日",type:"date"},{key:"id_number",label:"身份證字號",type:"text"},{key:"education",label:"最高學歷",type:"select",options:["國小","國中","高中職","專科","大學","碩士","博士"]}]},contact:{title:"聯絡資訊",fields:[{key:"region",label:"所在地區",type:"text"},{key:"registered_address",label:"戶籍地址",type:"text"},{key:"home_phone",label:"室內電話",type:"text"},{key:"address_same",label:"通訊地址是否同戶籍地",type:"boolean"},{key:"mailing_address",label:"通訊地址",type:"text"},{key:"mobile_phone",label:"通訊電話",type:"text"},{key:"residence_duration",label:"現居地住多久",type:"text"},{key:"residence_owner",label:"居住地持有人",type:"text"},{key:"telecom_provider",label:"電信業者",type:"select",options:["中華電信","台灣大哥大","遠傳電信","台灣之星","亞太電信"]}]},other:{title:"其他資訊",fields:[{key:"case_number",label:"進線編號",type:"text",readonly:!0},{key:"required_amount",label:"需求金額",type:"number"},{key:"custom_fields",label:"自定義欄位",type:"custom"}]},company:{title:"公司資料",fields:[{key:"company_email",label:"電子郵件",type:"email"},{key:"company_name",label:"公司名稱",type:"text"},{key:"company_phone",label:"公司電話",type:"text"},{key:"company_address",label:"公司地址",type:"text"},{key:"job_title",label:"職稱",type:"text"},{key:"monthly_income",label:"月收入",type:"number"},{key:"new_labor_insurance",label:"有無新轉勞保",type:"boolean"},{key:"employment_duration",label:"目前公司在職多久",type:"text"}]},emergency:{title:"緊急聯絡人",fields:[{key:"contact1_name",label:"聯絡人①姓名",type:"text"},{key:"contact1_relationship",label:"聯絡人①關係",type:"text"},{key:"contact1_phone",label:"聯絡人①電話",type:"text"},{key:"contact1_available_time",label:"方便聯絡時間",type:"text"},{key:"contact1_confidential",label:"是否保密",type:"boolean"},{key:"contact2_name",label:"聯絡人②姓名",type:"text"},{key:"contact2_relationship",label:"聯絡人②關係",type:"text"},{key:"contact2_phone",label:"聯絡人②電話",type:"text"},{key:"contact2_confidential",label:"是否保密",type:"boolean"},{key:"contact2_available_time",label:"方便聯絡時間",type:"text"},{key:"referrer",label:"介紹人",type:"text"}]}},Y=Ct(),{success:L,error:b,confirm:ue}=Vt(),{list:qe,updateOne:fe,removeOne:Ae,convertToCase:Oe}=Ut(),{getUsers:Te}=Lt(),{list:Me}=It(),{refreshBadges:J}=Nt(),{get:Pe}=xe(),T=p(""),D=p("all"),X=p(!1),ce=p(null),x=p([]),z=p([]),Fe=p({pending:0,today:0,thisWeek:0,processingRate:0}),ye=p([]),Re=p([]),Z=p(!1),pe=p(!1),ee=p(!1),te=p(!1),se=p(!1),oe=p(null),k=p(null),le=p(null),j=p(null),w=p(null),I=p(!1),B=p(1),be=p(5);ie(()=>Math.ceil(he.value.length/be.value));const W=p([]),v=K({}),ze=[{value:"wp_form",label:"網站表單"},{value:"lineoa",label:"官方賴"},{value:"email",label:"Email"},{value:"phone",label:"電話"}],ve=[{value:"pending",label:"待處理",category:"leads",route:"/cases"},{value:"valid_customer",label:"有效客",category:"leads_management",route:"/cases/valid-customer"},{value:"invalid_customer",label:"無效客",category:"leads_management",route:"/cases/invalid-customer"},{value:"customer_service",label:"客服",category:"leads_management",route:"/cases/customer-service"},{value:"blacklist",label:"黑名單",category:"leads_management",route:"/cases/blacklist"},{value:"approved_disbursed",label:"核准撥款",category:"submissions",route:"/submissions/approved-disbursed"},{value:"approved_undisbursed",label:"核准未撥",category:"submissions",route:"/submissions/approved-pending"},{value:"conditional_approval",label:"附條件",category:"submissions",route:"/submissions/conditional"},{value:"rejected",label:"婉拒",category:"submissions",route:"/submissions/declined"},{value:"tracking",label:"追蹤中",category:"tracking",route:"/tracking/index"}],Be=Array.from({length:10},(l,t)=>`G${t+1}`),a=K({page_url:"",website_domain:"",channel:"wp_form",status:"pending",created_at:"",assigned_to:null,customer_name:"",email:null,line_id:"",loan_purpose:"",ip_address:null,notes:"",birth_date:"",id_number:"",education:"",region:"",registered_address:"",home_phone:"",address_same:!1,mailing_address:"",mobile_phone:"",residence_duration:"",residence_owner:"",telecom_provider:"",case_number:"",required_amount:null,company_email:"",company_name:"",company_phone:"",company_address:"",job_title:"",monthly_income:null,new_labor_insurance:!1,employment_duration:"",contact1_name:"",contact1_relationship:"",contact1_phone:"",contact1_available_time:"",contact1_confidential:!1,contact2_name:"",contact2_relationship:"",contact2_phone:"",contact2_confidential:!1,contact2_available_time:"",referrer:""}),$=K({loan_amount:null,loan_type:"",notes:""}),q=K({assigned_to:null}),N=K({display_name:""}),We=ie(()=>$e),he=ie(()=>{let l=x.value;if(T.value&&T.value.length>=2){const t=T.value.toLowerCase();l=l.filter(d=>d.email?.toLowerCase().includes(t)||d.line_id?.toLowerCase().includes(t)||d.payload?.頁面_URL?.toLowerCase().includes(t)||d.source?.toLowerCase().includes(t)||d.assignee?.name?.toLowerCase().includes(t))}return D.value&&D.value!=="all"&&(D.value==="null"?l=l.filter(t=>!t.assigned_to):l=l.filter(t=>t.assigned_to===parseInt(D.value))),l}),ae=ie(()=>W.value.filter(l=>l.is_visible)),A=async()=>{X.value=!0,ce.value=null;try{if(Ee().public.apiBaseUrl==="/mock-api"){const n=je();x.value=n.leads.filter(h=>h.case_status==="pending"),X.value=!1,await J();return}const{items:t,meta:d,success:e}=await qe({case_status:"pending",per_page:1e3});if(e){x.value=t||[];const n=x.value.length,h=new Date,re=x.value.filter(U=>new Date(U.created_at).toDateString()===h.toDateString()).length,G=x.value.filter(U=>{const M=new Date(U.created_at),H=new Date(h);return H.setDate(h.getDate()-h.getDay()),M>=H}).length;Fe.value={pending:n,today:re,thisWeek:G,processingRate:n>0?Math.round(G/n*100):0}}}catch(l){ce.value="載入進線數據失敗",console.error("Load leads error:",l)}finally{X.value=!1}},Ge=async()=>{try{const{success:l,users:t}=await Te({per_page:250});l&&Array.isArray(t)&&(z.value=t)}catch(l){console.warn("Load users failed:",l)}},ke=async()=>{const{success:l,items:t}=await Me("case");l&&(W.value=t)},He=async()=>{try{const{data:l,error:t}=await Pe("/websites/options");!t&&Array.isArray(l)?(ye.value=l,Re.value=l.map(d=>({value:d.domain,label:d.name,website:d}))):console.warn("Failed to load websites from management system:",t)}catch(l){console.warn("Load websites failed:",l)}},Ke=l=>{T.value=l,B.value=1},Qe=l=>{B.value=l},Ye=l=>{be.value=l,B.value=1};let me;gt([T,D],()=>{clearTimeout(me),me=setTimeout(()=>{B.value=1},300)});const Je=l=>{k.value=l,pe.value=!0},we=()=>{pe.value=!1,k.value=null},Xe=async l=>{oe.value=l.id;const t=l.payload?.頁面_URL||l.source||"",d=_e(t),e=l.payload||{};Object.assign(a,{page_url:t,website_domain:d.website?d.domain:t?"other":"",channel:l.channel||"wp_form",status:l.status||"pending",created_at:l.created_at?new Date(l.created_at).toISOString().slice(0,16):new Date().toISOString().slice(0,16),assigned_to:l.assigned_to||null,customer_name:l.customer_name||"",email:null,line_id:l.line_id||e.LINE_ID||"",loan_purpose:e.貸款需求||"",ip_address:l.ip_address||null,notes:l.notes||e.備註||"",birth_date:e.出生年月日||"",id_number:e.身份證字號||"",education:e.最高學歷||"",region:e.房屋區域||e.所在地區||"",registered_address:e.戶籍地址||"",home_phone:e.室內電話||"",address_same:e.通訊地址是否同戶籍地||!1,mailing_address:e.通訊地址||e.房屋地址||"",mobile_phone:e.通訊電話||l.phone||"",residence_duration:e.現居地住多久||"",residence_owner:e.居住地持有人||"",telecom_provider:e.電信業者||"",case_number:ne(l),required_amount:e.資金需求||null,company_email:e.電子郵件||l.email||"",company_name:e.公司名稱||"",company_phone:e.公司電話||"",company_address:e.公司地址||"",job_title:e.職稱||"",monthly_income:e.月收入||null,new_labor_insurance:e.有無新轉勞保||!1,employment_duration:e.目前公司在職多久||"",contact1_name:e["聯絡人①姓名"]||"",contact1_relationship:e["聯絡人①關係"]||"",contact1_phone:e["聯絡人①電話"]||"",contact1_available_time:e.方便聯絡時間||"",contact1_confidential:e.是否保密||!1,contact2_name:e["聯絡人②姓名"]||"",contact2_relationship:e["聯絡人②關係"]||"",contact2_phone:e["聯絡人②電話"]||"",contact2_confidential:e["聯絡人②是否保密"]||!1,contact2_available_time:e["聯絡人②方便聯絡時間"]||"",referrer:e.介紹人||""}),await ke(),dt(l),Z.value=!0},ge=()=>{Z.value=!1,oe.value=null},Ze=async()=>{if(oe.value){I.value=!0;try{let l=a.page_url;if(a.website_domain&&a.website_domain!=="other"){const e=ye.value.find(n=>n.domain===a.website_domain);e&&(l=e.url)}const t={channel:a.channel,status:a.status,email:a.email,line_id:a.line_id,ip_address:a.ip_address,assigned_to:a.assigned_to,notes:a.notes,customer_name:a.customer_name,payload:{頁面_URL:l,LINE_ID:a.line_id,貸款需求:a.loan_purpose,備註:a.notes,出生年月日:a.birth_date,身份證字號:a.id_number,最高學歷:a.education,房屋區域:a.region,戶籍地址:a.registered_address,室內電話:a.home_phone,通訊地址是否同戶籍地:a.address_same,通訊地址:a.mailing_address,通訊電話:a.mobile_phone,現居地住多久:a.residence_duration,居住地持有人:a.residence_owner,電信業者:a.telecom_provider,資金需求:a.required_amount,電子郵件:a.company_email,公司名稱:a.company_name,公司電話:a.company_phone,公司地址:a.company_address,職稱:a.job_title,月收入:a.monthly_income,有無新轉勞保:a.new_labor_insurance,目前公司在職多久:a.employment_duration,"聯絡人①姓名":a.contact1_name,"聯絡人①關係":a.contact1_relationship,"聯絡人①電話":a.contact1_phone,方便聯絡時間:a.contact1_available_time,是否保密:a.contact1_confidential,"聯絡人②姓名":a.contact2_name,"聯絡人②關係":a.contact2_relationship,"聯絡人②電話":a.contact2_phone,"聯絡人②是否保密":a.contact2_confidential,"聯絡人②方便聯絡時間":a.contact2_available_time,介紹人:a.referrer,...v}},{error:d}=await fe(oe.value,t);d?b(d?.message||"更新失敗"):(Z.value=!1,await A(),L("進線資料更新成功"))}catch(l){b("系統錯誤，請稍後再試"),console.error("Update lead error:",l)}finally{I.value=!1}}},et=async l=>{if(await ue(`確定刪除編號 ${l.id} 的進線嗎？`))try{const{error:d}=await Ae(l.id);d?b(d?.message||"刪除失敗"):(await A(),L(`編號 ${l.id} 的進線已刪除`))}catch(d){b("系統錯誤，請稍後再試"),console.error("Delete lead error:",d)}},tt=l=>{if(!l.customer_id){b("此進線尚未綁定客戶，請先建立/綁定客戶後再送件");return}le.value=l,Object.assign($,{loan_amount:null,loan_type:"",notes:""}),ee.value=!0},Ue=()=>{ee.value=!1,le.value=null},st=async()=>{if(le.value)try{const{error:l}=await Oe(le.value.id,$);l?b(l?.message||"轉換失敗"):(ee.value=!1,await A(),L("進線轉換案件成功"))}catch(l){b("系統錯誤，請稍後再試"),console.error("Convert lead error:",l)}},ot=l=>{j.value=l,q.assigned_to=l.assigned_to||null,te.value=!0},Ce=()=>{te.value=!1,j.value=null,q.assigned_to=null},lt=async()=>{if(!j.value||!q.assigned_to){b("請選擇承辦業務");return}I.value=!0;try{const{error:l}=await fe(j.value.id,{assigned_to:q.assigned_to});if(l)b(l?.message||"指派失敗");else{te.value=!1,await A();const t=z.value.find(d=>d.id===q.assigned_to);L(`已成功指派給 ${t?.name||"未知業務"}`)}}catch(l){b("系統錯誤，請稍後再試"),console.error("Assign lead error:",l)}},at=l=>{w.value=l,N.display_name=l.line_user_info?.display_name||"",se.value=!0},Ve=()=>{se.value=!1,w.value=null,N.display_name=""},nt=async()=>{if(!w.value||!N.display_name?.trim()){b("名稱不能為空");return}I.value=!0;try{const{$api:l}=ht(),{data:t,error:d}=await l.put(`/leads/${w.value.id}/line-name`,{editable_name:N.display_name.trim()});!d&&t?.success?(w.value.line_user_info&&(w.value.line_user_info.display_name=N.display_name.trim(),w.value.line_user_info.editable_name=N.display_name.trim()),se.value=!1,await A(),L(`LINE用戶名稱已更新：${t.old_name} → ${t.new_name}`)):b(t?.message||d?.message||"更新失敗")}catch(l){b("更新失敗，請稍後再試"),console.error("Save LINE name error:",l)}},Le=l=>{const t=ve.find(d=>d.value===l);return t?t.route:"/"},rt=async(l,t)=>{try{Ee().public.apiBaseUrl;{console.log("Using mock mode for updateLeadStatus",{itemId:l.id,newStatus:t});const M=je().updateLeadCaseStatus(l.id,t);if(console.log("Mock update result:",M),M){const H=x.value.findIndex(P=>P.id===l.id);H!==-1&&x.value.splice(H,1);const Se=de.find(P=>P.value===t)?.label;if(L(`進線狀態已更新為：${Se}`),await J(),t!=="pending"){const P=Le(t);P&&setTimeout(async()=>{await ue(`進線已移至「${Se}」區塊，是否前往查看？`,"前往查看","留在此頁")&&await De(P)},1500)}return}else{console.error("Item not found in mock store:",l.id),b("更新失敗：找不到對應的案件");return}}const{patch:e}=xe(),{data:n,error:h}=await e(`/leads/${l.id}/case-status`,{case_status:t});if(h){b("更新進線狀態失敗");return}const re=x.value.findIndex(U=>U.id===l.id);re!==-1&&x.value.splice(re,1);const G=de.find(U=>U.value===t)?.label;if(L(`進線狀態已更新為：${G}`),await J(),t!=="pending"){const U=Le(t);U&&setTimeout(async()=>{await ue(`進線已移至「${G}」區塊，是否前往查看？`,"前往查看","留在此頁")&&await De(U)},1500)}}catch(d){b("更新狀態失敗，請稍後再試"),console.error("Update lead status error:",d)}},it=async(l,t)=>{try{const{patch:d}=xe(),{error:e}=await d(`/leads/${l.id}`,{payload:{...l.payload,頁面_URL:t}});if(e){b("更新網站失敗");return}l.payload.頁面_URL=t,L(`網站已更新為：${t}`)}catch(d){b("更新網站失敗，請稍後再試"),console.error("Update website error:",d)}},dt=l=>{const t=l?.payload||{};W.value.forEach(d=>{const e=d.key;t&&Object.prototype.hasOwnProperty.call(t,e)?v[e]=t[e]:d.default_value?v[e]=d.default_value:v[e]=d.type==="multiselect"?[]:d.type==="boolean"?!1:""})},ut=l=>{try{return new URL(l).hostname}catch{return l||""}},ne=l=>{const t=new Date(l.created_at),d=t.getFullYear().toString().slice(-2),e=String(t.getMonth()+1).padStart(2,"0"),n=String(t.getDate()).padStart(2,"0"),h=String(l.id).padStart(3,"0");return`CASE${d}${e}${n}${h}`},_e=l=>{if(!l)return{name:"-",domain:"",website:null};const t=ut(l),d=ye.value.find(e=>{if(e.domain===t)return!0;const n=t.replace(/^www\./,""),h=e.domain.replace(/^www\./,"");return!!(n===h||l.includes(e.domain)||t.includes(e.domain)||e.domain.includes(t))});return d?{name:d.name,domain:d.domain,website:d}:{name:t||l,domain:t||l,website:null}},Ie=l=>new Date(l).toLocaleDateString("zh-TW",{year:"numeric",month:"2-digit",day:"2-digit"}),Ne=l=>new Date(l).toLocaleTimeString("zh-TW",{hour:"2-digit",minute:"2-digit"}),ct=(l,t)=>t.type==="multiselect"?Array.isArray(l)?l.join(", "):l||"-":t.type==="boolean"?l?"是":"否":l??"-";_t(async()=>{await Promise.all([Ge(),A(),ke(),He(),J()])}),xt(()=>{clearTimeout(me)}),ft({title:"網路進線管理"});const yt=async(l,t)=>{try{const d=x.value.findIndex(e=>e.id===l);d!==-1&&(x.value[d].channel=t,L("來源管道更新成功"))}catch(d){console.error("更新來源管道失敗:",d),b("更新來源管道失敗")}},pt=async(l,t)=>{try{const d=x.value.findIndex(e=>e.id===l);d!==-1&&(x.value[d].payload||(x.value[d].payload={}),x.value[d].payload.貸款需求=t,L("諮詢項目更新成功"))}catch(d){console.error("更新諮詢項目失敗:",d),b("更新諮詢項目失敗")}};return(l,t)=>{const d=bt;return i(),r("div",$t,[t[76]||(t[76]=s("div",{class:"flex items-center justify-between"},[s("div",null,[s("h1",{class:"text-3xl font-bold text-gray-900"},"黑名單"),s("p",{class:"text-gray-600 mt-2"},"管理黑名單客戶清單")])],-1)),O(kt,{title:"網路進線列表",columns:o(We),data:o(he),loading:o(X),error:o(ce),"search-query":o(T),"search-placeholder":"搜尋姓名/手機/Email/LINE/網站... (至少2個字符)","show-search-icon":!1,"current-page":o(B),"items-per-page":o(be),"loading-text":"載入中...","empty-text":"沒有網路進線案件",onSearch:Ke,onRefresh:A,onRetry:A,onPageChange:Qe,onPageSizeChange:Ye},{filters:f(()=>[o(Y).hasPermission&&o(Y).hasPermission("customer_management")?c((i(),r("select",{key:0,"onUpdate:modelValue":t[0]||(t[0]=e=>vt(D)?D.value=e:null),class:"px-4 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},[t[20]||(t[20]=s("option",{value:"all"},"全部承辦",-1)),t[21]||(t[21]=s("option",{value:"null"},"未指派",-1)),(i(!0),r(m,null,g(o(z),e=>(i(),r("option",{key:e.id,value:e.id},u(e.name),9,qt))),128))],512)),[[E,o(D)]]):y("",!0)]),actions:f(()=>[...t[22]||(t[22]=[])]),"cell-case_status":f(({item:e})=>[s("select",{value:e.case_status||"pending",onChange:n=>rt(e,n.target.value),class:"w-full px-1 py-0.5 text-xs border border-gray-300 rounded bg-white text-gray-900 focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500"},[(i(),r(m,null,g(ve,n=>s("option",{key:n.value,value:n.value},u(n.label),9,Ot)),64))],40,At)]),"cell-case_number":f(({item:e})=>[s("div",Tt,u(ne(e)),1)]),"cell-website":f(({item:e})=>[s("select",{value:_e(e.payload?.頁面_URL||e.source).name,onChange:n=>it(e,n.target.value),class:"w-full px-1 py-0.5 text-xs border border-gray-300 rounded bg-white text-gray-900 focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500"},[(i(!0),r(m,null,g(o(Be),n=>(i(),r("option",{key:n,value:n},u(n),9,Pt))),128))],40,Mt)]),"cell-channel":f(({item:e})=>[s("select",{value:e.channel,onChange:n=>yt(e.id,n.target.value),class:"w-full px-2 py-1 text-sm border border-gray-300 rounded bg-white text-gray-900 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},[...t[23]||(t[23]=[s("option",{value:"wp_form"},"網站表單",-1),s("option",{value:"lineoa"},"官方LINE",-1),s("option",{value:"email"},"email",-1),s("option",{value:"phone"},"專線",-1)])],40,Ft)]),"cell-datetime":f(({item:e})=>[s("div",null,[s("div",Rt,u(Ie(e.created_at)),1),s("div",zt,u(Ne(e.created_at)),1)])]),"cell-assignee":f(({item:e})=>[s("div",Bt,[s("span",Wt,u(e.assignee?.name||"未指派"),1),!e.assignee&&o(Y).hasPermission&&o(Y).hasPermission("customer_management")?(i(),r("button",{key:0,onClick:n=>ot(e),class:"inline-flex items-center justify-center w-6 h-6 text-blue-600 hover:text-white hover:bg-blue-600 rounded transition-colors duration-200 relative group",title:"指派業務"},[O(d,{name:"heroicons:user-plus",class:"w-4 h-4"}),t[24]||(t[24]=s("span",{class:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-2 py-1 text-xs text-white bg-gray-800 rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap"}," 指派業務 ",-1))],8,Gt)):y("",!0)])]),"cell-contact_info":f(({item:e})=>[s("div",null,[s("div",Ht,u(e.email||"未提供"),1),s("div",Kt,u(e.phone||"未提供"),1)])]),"cell-line_info":f(({item:e})=>[e.line_user_info&&e.is_line_user_id?(i(),r("div",Qt,[e.line_user_info.picture_url?(i(),r("img",{key:0,src:e.line_user_info.picture_url,alt:e.line_user_info.display_name||"LINE用戶",class:"w-6 h-6 rounded-full object-cover",onError:t[1]||(t[1]=n=>n.target.style.display="none")},null,40,Yt)):(i(),r("div",Jt," L ")),s("div",Xt,[s("div",Zt,[s("span",es,u(e.line_user_info.display_name||"未設定名稱"),1),s("button",{onClick:n=>at(e),class:"text-blue-500 hover:text-blue-700 text-xs",title:"編輯LINE名稱"}," ✏️ ",8,ts)])])])):e.line_id&&!e.is_line_user_id?(i(),r("div",ss,[t[25]||(t[25]=s("div",{class:"w-6 h-6 rounded-full bg-gray-400 flex items-center justify-center text-white text-xs"}," @ ",-1)),s("span",os,u(e.line_id),1)])):(i(),r("div",ls," 未綁定 "))]),"cell-location":f(({item:e})=>[s("div",null,[s("div",as,u(e.payload?.房屋區域||e.payload?.所在地區||"未提供"),1),s("div",ns,u(e.payload?.房屋地址||""),1)])]),"cell-amount":f(({item:e})=>[s("span",rs,u(e.payload?.資金需求||"未填寫"),1)]),"cell-purpose":f(({item:e})=>[s("select",{value:e.payload?.貸款需求||"",onChange:n=>pt(e.id,n.target.value),class:"w-full px-2 py-1 text-sm border border-gray-300 rounded bg-white text-gray-900 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},[...t[26]||(t[26]=[s("option",{value:""},"請選擇",-1),s("option",{value:"房屋貸款"},"房屋貸款",-1),s("option",{value:"土地貸款"},"土地貸款",-1),s("option",{value:"企業貸款"},"企業貸款",-1),s("option",{value:"個人信貸"},"個人信貸",-1),s("option",{value:"汽車貸款"},"汽車貸款",-1),s("option",{value:"其他"},"其他",-1)])],40,is)]),"cell-custom_fields":f(({item:e})=>[o(ae).length>0?(i(),r("div",ds,[(i(!0),r(m,null,g(o(ae).slice(0,2),n=>(i(),r("div",{key:n.id,class:"text-xs"},[s("span",us,u(n.label)+":",1),s("span",cs,u(ct(e.payload?.[n.key],n)),1)]))),128)),o(ae).length>2?(i(),r("div",ys," +"+u(o(ae).length-2)+" 個欄位 ",1)):y("",!0)])):(i(),r("span",ps,"無自定義欄位"))]),"cell-actions":f(({item:e})=>[s("div",bs,[s("button",{onClick:n=>Je(e),class:"group relative inline-flex items-center justify-center p-2 text-blue-600 hover:text-white hover:bg-blue-600 rounded-lg transition-all duration-200",title:"查看詳情"},[O(o(St),{class:"w-4 h-4"}),t[27]||(t[27]=s("div",{class:"absolute bottom-full mb-2 hidden group-hover:block px-2 py-1 text-xs text-white bg-gray-900 rounded whitespace-nowrap z-10"}," 查看詳情 ",-1))],8,ms),s("button",{onClick:n=>Xe(e),class:"group relative inline-flex items-center justify-center p-2 text-gray-600 hover:text-white hover:bg-gray-600 rounded-lg transition-all duration-200",title:"編輯"},[O(o(wt),{class:"w-4 h-4"}),t[28]||(t[28]=s("div",{class:"absolute bottom-full mb-2 hidden group-hover:block px-2 py-1 text-xs text-white bg-gray-900 rounded whitespace-nowrap z-10"}," 編輯 ",-1))],8,gs),e.customer_id?(i(),r("button",{key:0,onClick:n=>tt(e),class:"group relative inline-flex items-center justify-center p-2 text-purple-600 hover:text-white hover:bg-purple-600 rounded-lg transition-all duration-200",title:"轉送件"},[O(o(Et),{class:"w-4 h-4"}),t[29]||(t[29]=s("div",{class:"absolute bottom-full mb-2 hidden group-hover:block px-2 py-1 text-xs text-white bg-gray-900 rounded whitespace-nowrap z-10"}," 轉送件 ",-1))],8,_s)):y("",!0),s("button",{onClick:n=>et(e),class:"group relative inline-flex items-center justify-center p-2 text-red-600 hover:text-white hover:bg-red-600 rounded-lg transition-all duration-200",title:"刪除"},[O(o(Dt),{class:"w-4 h-4"}),t[30]||(t[30]=s("div",{class:"absolute bottom-full mb-2 hidden group-hover:block px-2 py-1 text-xs text-white bg-gray-900 rounded whitespace-nowrap z-10"}," 刪除 ",-1))],8,xs)])]),_:1},8,["columns","data","loading","error","search-query","current-page","items-per-page"]),o(Z)?(i(),r("div",{key:0,class:"fixed inset-0 bg-black/50 z-50",onClick:S(ge,["self"])},[s("div",fs,[s("div",vs,[t[31]||(t[31]=s("h3",{class:"text-xl font-semibold text-gray-900"},"編輯進線",-1)),s("button",{type:"button",onClick:ge,class:"text-gray-400 hover:text-gray-600"},[O(o(jt),{class:"w-6 h-6"})])]),s("div",hs,[s("form",{onSubmit:S(Ze,["prevent"]),class:"h-full flex"},[s("div",ks,[t[42]||(t[42]=s("h4",{class:"text-lg font-semibold text-gray-800 mb-4 sticky top-0 bg-blue-50 py-2"},"基本資訊",-1)),s("div",ws,[s("div",null,[t[32]||(t[32]=s("label",{class:"block text-sm font-semibold text-gray-900 mb-1"},"進線狀態",-1)),c(s("select",{"onUpdate:modelValue":t[2]||(t[2]=e=>o(a).case_status=e),class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},[(i(),r(m,null,g(de,e=>s("option",{key:e.value,value:e.value},u(e.label),9,Us)),64))],512),[[E,o(a).case_status]])]),s("div",null,[t[33]||(t[33]=s("label",{class:"block text-sm font-semibold text-gray-900 mb-1"},"時間",-1)),c(s("input",{"onUpdate:modelValue":t[3]||(t[3]=e=>o(a).created_at=e),type:"datetime-local",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",readonly:""},null,512),[[_,o(a).created_at]])]),s("div",null,[t[35]||(t[35]=s("label",{class:"block text-sm font-semibold text-gray-900 mb-1"},"承辦業務",-1)),c(s("select",{"onUpdate:modelValue":t[4]||(t[4]=e=>o(a).assigned_to=e),class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},[t[34]||(t[34]=s("option",{value:""},"未指派",-1)),(i(!0),r(m,null,g(o(z),e=>(i(),r("option",{key:e.id,value:e.id},u(e.name),9,Cs))),128))],512),[[E,o(a).assigned_to]])]),s("div",null,[t[36]||(t[36]=s("label",{class:"block text-sm font-semibold text-gray-900 mb-1"},"來源管道",-1)),c(s("select",{"onUpdate:modelValue":t[5]||(t[5]=e=>o(a).channel=e),class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},[(i(),r(m,null,g(ze,e=>s("option",{key:e.value,value:e.value},u(e.label),9,Vs)),64))],512),[[E,o(a).channel]])]),s("div",null,[t[37]||(t[37]=s("label",{class:"block text-sm font-semibold text-gray-900 mb-1"},"姓名",-1)),c(s("input",{"onUpdate:modelValue":t[6]||(t[6]=e=>o(a).customer_name=e),type:"text",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",readonly:""},null,512),[[_,o(a).customer_name]])]),s("div",null,[t[38]||(t[38]=s("label",{class:"block text-sm font-semibold text-gray-900 mb-1"},"LINE資訊",-1)),s("div",Ls,[c(s("input",{"onUpdate:modelValue":t[7]||(t[7]=e=>o(a).line_display_name=e),placeholder:"LINE顯示名稱",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",readonly:""},null,512),[[_,o(a).line_display_name]]),c(s("input",{"onUpdate:modelValue":t[8]||(t[8]=e=>o(a).line_id=e),placeholder:"LINE加好友ID",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",readonly:""},null,512),[[_,o(a).line_id]])])]),s("div",null,[t[39]||(t[39]=s("label",{class:"block text-sm font-semibold text-gray-900 mb-1"},"諮詢項目",-1)),c(s("input",{"onUpdate:modelValue":t[9]||(t[9]=e=>o(a).loan_purpose=e),class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",readonly:""},null,512),[[_,o(a).loan_purpose]])]),s("div",null,[t[40]||(t[40]=s("label",{class:"block text-sm font-semibold text-gray-900 mb-1"},"網站",-1)),c(s("select",{"onUpdate:modelValue":t[10]||(t[10]=e=>o(a).website=e),class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},[(i(),r(m,null,g(10,e=>s("option",{key:e,value:`G${e}`},"G"+u(e),9,Is)),64))],512),[[E,o(a).website]])]),s("div",null,[t[41]||(t[41]=s("label",{class:"block text-sm font-semibold text-gray-900 mb-1"},"聯絡資訊",-1)),s("div",Ns,[c(s("input",{"onUpdate:modelValue":t[11]||(t[11]=e=>o(a).email=e),type:"email",placeholder:"Email",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",readonly:""},null,512),[[_,o(a).email]]),c(s("input",{"onUpdate:modelValue":t[12]||(t[12]=e=>o(a).phone=e),type:"tel",placeholder:"手機號碼",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",readonly:""},null,512),[[_,o(a).phone]])])])])]),s("div",Ss,[s("h4",Es,u(V.personal.title),1),s("div",Ds,[(i(!0),r(m,null,g(V.personal.fields,e=>(i(),r("div",{key:e.key},[s("label",js,[C(u(e.label)+" ",1),e.required?(i(),r("span",$s,"*")):y("",!0)]),e.type==="text"||e.type==="email"?c((i(),r("input",{key:0,"onUpdate:modelValue":n=>o(a)[e.key]=n,type:e.type,readonly:e.readonly,class:Q(["w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",{"bg-gray-100":e.readonly}])},null,10,qs)),[[F,o(a)[e.key]]]):e.type==="number"?c((i(),r("input",{key:1,"onUpdate:modelValue":n=>o(a)[e.key]=n,type:"number",min:"0",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,8,As)),[[_,o(a)[e.key],void 0,{number:!0}]]):e.type==="date"?c((i(),r("input",{key:2,"onUpdate:modelValue":n=>o(a)[e.key]=n,type:"date",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,8,Os)),[[_,o(a)[e.key]]]):e.type==="select"?c((i(),r("select",{key:3,"onUpdate:modelValue":n=>o(a)[e.key]=n,class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},[t[43]||(t[43]=s("option",{value:""},"請選擇",-1)),(i(!0),r(m,null,g(e.options,n=>(i(),r("option",{key:n,value:n},u(n),9,Ms))),128))],8,Ts)),[[E,o(a)[e.key]]]):e.type==="boolean"?(i(),r("label",Ps,[c(s("input",{type:"checkbox","onUpdate:modelValue":n=>o(a)[e.key]=n,class:"rounded"},null,8,Fs),[[R,o(a)[e.key]]]),t[44]||(t[44]=s("span",{class:"text-sm"},"是",-1))])):e.type==="custom"?(i(),r("div",Rs," 自定義欄位將顯示在下方 ")):y("",!0)]))),128))])]),s("div",zs,[s("h4",Bs,u(V.contact.title),1),s("div",Ws,[(i(!0),r(m,null,g(V.contact.fields,e=>(i(),r("div",{key:e.key},[s("label",Gs,[C(u(e.label)+" ",1),e.required?(i(),r("span",Hs,"*")):y("",!0)]),e.type==="text"||e.type==="email"?c((i(),r("input",{key:0,"onUpdate:modelValue":n=>o(a)[e.key]=n,type:e.type,readonly:e.readonly,class:Q(["w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",{"bg-gray-100":e.readonly}])},null,10,Ks)),[[F,o(a)[e.key]]]):e.type==="number"?c((i(),r("input",{key:1,"onUpdate:modelValue":n=>o(a)[e.key]=n,type:"number",min:"0",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,8,Qs)),[[_,o(a)[e.key],void 0,{number:!0}]]):e.type==="date"?c((i(),r("input",{key:2,"onUpdate:modelValue":n=>o(a)[e.key]=n,type:"date",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,8,Ys)),[[_,o(a)[e.key]]]):e.type==="select"?c((i(),r("select",{key:3,"onUpdate:modelValue":n=>o(a)[e.key]=n,class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},[t[45]||(t[45]=s("option",{value:""},"請選擇",-1)),(i(!0),r(m,null,g(e.options,n=>(i(),r("option",{key:n,value:n},u(n),9,Xs))),128))],8,Js)),[[E,o(a)[e.key]]]):e.type==="boolean"?(i(),r("label",Zs,[c(s("input",{type:"checkbox","onUpdate:modelValue":n=>o(a)[e.key]=n,class:"rounded"},null,8,eo),[[R,o(a)[e.key]]]),t[46]||(t[46]=s("span",{class:"text-sm"},"是",-1))])):y("",!0)]))),128))])]),s("div",to,[s("h4",so,u(V.company.title),1),s("div",oo,[(i(!0),r(m,null,g(V.company.fields,e=>(i(),r("div",{key:e.key},[s("label",lo,[C(u(e.label)+" ",1),e.required?(i(),r("span",ao,"*")):y("",!0)]),e.type==="text"||e.type==="email"?c((i(),r("input",{key:0,"onUpdate:modelValue":n=>o(a)[e.key]=n,type:e.type,readonly:e.readonly,class:Q(["w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",{"bg-gray-100":e.readonly}])},null,10,no)),[[F,o(a)[e.key]]]):e.type==="number"?c((i(),r("input",{key:1,"onUpdate:modelValue":n=>o(a)[e.key]=n,type:"number",min:"0",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,8,ro)),[[_,o(a)[e.key],void 0,{number:!0}]]):e.type==="boolean"?(i(),r("label",io,[c(s("input",{type:"checkbox","onUpdate:modelValue":n=>o(a)[e.key]=n,class:"rounded"},null,8,uo),[[R,o(a)[e.key]]]),t[47]||(t[47]=s("span",{class:"text-sm"},"是",-1))])):y("",!0)]))),128))])]),s("div",co,[s("h4",yo,u(V.emergency.title),1),s("div",po,[(i(!0),r(m,null,g(V.emergency.fields,e=>(i(),r("div",{key:e.key},[s("label",bo,[C(u(e.label)+" ",1),e.required?(i(),r("span",mo,"*")):y("",!0)]),e.type==="text"?c((i(),r("input",{key:0,"onUpdate:modelValue":n=>o(a)[e.key]=n,type:e.type,readonly:e.readonly,class:Q(["w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",{"bg-gray-100":e.readonly}])},null,10,go)),[[F,o(a)[e.key]]]):e.type==="boolean"?(i(),r("label",_o,[c(s("input",{type:"checkbox","onUpdate:modelValue":n=>o(a)[e.key]=n,class:"rounded"},null,8,xo),[[R,o(a)[e.key]]]),t[48]||(t[48]=s("span",{class:"text-sm"},"是",-1))])):y("",!0)]))),128))])]),s("div",fo,[s("h4",vo,u(V.other.title),1),s("div",ho,[(i(!0),r(m,null,g(V.other.fields.filter(e=>e.type!=="custom"),e=>(i(),r("div",{key:e.key},[s("label",ko,[C(u(e.label)+" ",1),e.required?(i(),r("span",wo,"*")):y("",!0)]),e.type==="text"?c((i(),r("input",{key:0,"onUpdate:modelValue":n=>o(a)[e.key]=n,type:e.type,readonly:e.readonly,class:Q(["w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",{"bg-gray-100":e.readonly}])},null,10,Uo)),[[F,o(a)[e.key]]]):e.type==="number"?c((i(),r("input",{key:1,"onUpdate:modelValue":n=>o(a)[e.key]=n,type:"number",min:"0",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,8,Co)),[[_,o(a)[e.key],void 0,{number:!0}]]):y("",!0)]))),128)),o(W).length?(i(),r("div",Vo,[t[51]||(t[51]=s("h5",{class:"text-md font-medium text-gray-800 mb-3"},"自定義欄位",-1)),s("div",Lo,[(i(!0),r(m,null,g(o(W),e=>(i(),r("div",{key:e.id},[s("label",Io,[C(u(e.label)+" ",1),e.is_required?(i(),r("span",No,"*")):y("",!0)]),["text","number","decimal","date"].includes(e.type)?c((i(),r("input",{key:0,type:e.type==="decimal"||e.type==="number"?"number":e.type==="date"?"date":"text",step:e.type==="decimal"?"any":void 0,class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:e.is_required,"onUpdate:modelValue":n=>o(v)[e.key]=n},null,8,So)),[[F,o(v)[e.key]]]):e.type==="textarea"?c((i(),r("textarea",{key:1,class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:focus:border-blue-500",required:e.is_required,"onUpdate:modelValue":n=>o(v)[e.key]=n,rows:"2"},null,8,Eo)),[[_,o(v)[e.key]]]):e.type==="select"?c((i(),r("select",{key:2,class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:e.is_required,"onUpdate:modelValue":n=>o(v)[e.key]=n},[t[49]||(t[49]=s("option",{value:""},"請選擇",-1)),(i(!0),r(m,null,g(e.options||[],n=>(i(),r("option",{key:n,value:n},u(n),9,jo))),128))],8,Do)),[[E,o(v)[e.key]]]):e.type==="multiselect"?(i(),r("div",$o,[s("div",qo,[(i(!0),r(m,null,g(e.options||[],n=>(i(),r("label",{key:n,class:"inline-flex items-center text-sm"},[c(s("input",{type:"checkbox",value:n,"onUpdate:modelValue":h=>o(v)[e.key]=h,class:"mr-1"},null,8,Ao),[[R,o(v)[e.key]]]),s("span",null,u(n),1)]))),128))])])):e.type==="boolean"?(i(),r("label",Oo,[c(s("input",{type:"checkbox","onUpdate:modelValue":n=>o(v)[e.key]=n},null,8,To),[[R,o(v)[e.key]]]),t[50]||(t[50]=s("span",{class:"text-sm"},"是/否",-1))])):y("",!0)]))),128))])])):y("",!0),s("div",Mo,[t[52]||(t[52]=s("label",{class:"block text-sm font-semibold text-gray-900 mb-1"},"備註",-1)),c(s("textarea",{"onUpdate:modelValue":t[13]||(t[13]=e=>o(a).notes=e),rows:"3",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,512),[[_,o(a).notes]])]),s("div",Po,[s("button",{type:"button",class:"px-4 py-2 border border-gray-300 rounded-lg",onClick:ge},"取消"),s("button",{type:"submit",class:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",disabled:o(I)},u(o(I)?"儲存中...":"儲存"),9,Fo)])])])],32)])])])):y("",!0),o(pe)?(i(),r("div",{key:1,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 mt-0",onClick:S(we,["self"])},[s("div",Ro,[s("div",{class:"flex justify-between items-center mb-4"},[t[53]||(t[53]=s("h3",{class:"text-lg font-semibold text-gray-900"},"進線詳情",-1)),s("button",{onClick:we,class:"text-gray-400 hover:text-gray-600"}," ✕ ")]),o(k)?(i(),r("div",zo,[s("div",Bo,[s("div",null,[t[54]||(t[54]=s("label",{class:"block text-sm font-medium text-gray-700"},"網站",-1)),s("p",Wo,u(_e(o(k).payload?.頁面_URL||o(k).source).name),1)]),s("div",null,[t[55]||(t[55]=s("label",{class:"block text-sm font-medium text-gray-700"},"來源管道",-1)),s("p",Go,u(o(k).channel||"wp_form"),1)]),s("div",null,[t[56]||(t[56]=s("label",{class:"block text-sm font-medium text-gray-700"},"時間",-1)),s("p",Ho,u(Ie(o(k).created_at))+" "+u(Ne(o(k).created_at)),1)]),s("div",null,[t[57]||(t[57]=s("label",{class:"block text-sm font-medium text-gray-700"},"承辦業務",-1)),s("p",Ko,u(o(k).assignee?.name||"未指派"),1)]),s("div",null,[t[58]||(t[58]=s("label",{class:"block text-sm font-medium text-gray-700"},"Email",-1)),s("p",Qo,u(o(k).email||"未提供"),1)]),s("div",null,[t[59]||(t[59]=s("label",{class:"block text-sm font-medium text-gray-700"},"LINE ID",-1)),s("p",Yo,u(o(k).line_id||"未提供"),1)])]),o(k).notes?(i(),r("div",Jo,[t[60]||(t[60]=s("label",{class:"block text-sm font-medium text-gray-700"},"備註",-1)),s("p",Xo,u(o(k).notes),1)])):y("",!0)])):y("",!0)])])):y("",!0),o(ee)?(i(),r("div",{key:2,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 mt-0",onClick:S(Ue,["self"])},[s("div",Zo,[t[65]||(t[65]=s("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"送件（建立案件）",-1)),s("form",{onSubmit:S(st,["prevent"]),class:"space-y-3"},[s("div",el,[s("div",null,[t[61]||(t[61]=s("label",{class:"block text-sm font-semibold text-gray-900 mb-1"},"貸款金額",-1)),c(s("input",{"onUpdate:modelValue":t[14]||(t[14]=e=>o($).loan_amount=e),required:"",type:"number",min:"0",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,512),[[_,o($).loan_amount,void 0,{number:!0}]])]),s("div",null,[t[62]||(t[62]=s("label",{class:"block text-sm font-semibold text-gray-900 mb-1"},"貸款類型",-1)),c(s("input",{"onUpdate:modelValue":t[15]||(t[15]=e=>o($).loan_type=e),class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,512),[[_,o($).loan_type]])]),s("div",tl,[t[63]||(t[63]=s("label",{class:"block text-sm font-semibold text-gray-900 mb-1"},"備註",-1)),c(s("textarea",{"onUpdate:modelValue":t[16]||(t[16]=e=>o($).notes=e),rows:"2",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,512),[[_,o($).notes]])])]),s("div",{class:"flex justify-end space-x-3 pt-2"},[s("button",{type:"button",class:"px-4 py-2 border border-gray-300 rounded-lg",onClick:Ue},"取消"),t[64]||(t[64]=s("button",{type:"submit",class:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700"},"送件",-1))])],32)])])):y("",!0),o(te)?(i(),r("div",{key:3,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 mt-0",onClick:S(Ce,["self"])},[s("div",sl,[t[72]||(t[72]=s("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"指派承辦業務",-1)),s("form",{onSubmit:S(lt,["prevent"]),class:"space-y-4"},[o(j)?(i(),r("div",ol,[t[69]||(t[69]=s("div",{class:"text-sm text-gray-900 font-semibold mb-2"},"進線資訊：",-1)),s("div",ll,[s("div",al,[t[66]||(t[66]=s("span",{class:"font-medium"},"進線編號：",-1)),C(u(ne(o(j))),1)]),s("div",nl,[t[67]||(t[67]=s("span",{class:"font-medium"},"Email：",-1)),C(u(o(j).email||"未提供"),1)]),s("div",rl,[t[68]||(t[68]=s("span",{class:"font-medium"},"LINE ID：",-1)),C(u(o(j).line_id||"未提供"),1)])])])):y("",!0),s("div",null,[t[71]||(t[71]=s("label",{class:"block text-sm font-semibold text-gray-900 mb-2"},[C("選擇承辦業務 "),s("span",{class:"text-red-500"},"*")],-1)),c(s("select",{"onUpdate:modelValue":t[17]||(t[17]=e=>o(q).assigned_to=e),required:"",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},[t[70]||(t[70]=s("option",{value:""},"請選擇業務人員",-1)),(i(!0),r(m,null,g(o(z).filter(e=>e.roles?.[0]?.name==="staff"),e=>(i(),r("option",{key:e.id,value:e.id},u(e.name||e.email)+" (業務) ",9,il))),128))],512),[[E,o(q).assigned_to]])]),s("div",dl,[s("button",{type:"button",class:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50",onClick:Ce}," 取消 "),s("button",{type:"submit",class:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",disabled:o(I)||!o(q).assigned_to},u(o(I)?"指派中...":"確認指派"),9,ul)])],32)])])):y("",!0),o(se)?(i(),r("div",{key:4,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 mt-0",onClick:S(Ve,["self"])},[s("div",cl,[t[75]||(t[75]=s("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"編輯LINE名稱",-1)),s("form",{onSubmit:S(nt,["prevent"]),class:"space-y-4"},[o(w)?(i(),r("div",yl,[t[73]||(t[73]=s("div",{class:"text-sm text-gray-900 font-semibold mb-2"},"LINE使用者資訊：",-1)),s("div",pl,[o(w).line_user_info?.picture_url?(i(),r("img",{key:0,src:o(w).line_user_info.picture_url,alt:o(w).line_user_info.display_name||"LINE用戶",class:"w-10 h-10 rounded-full object-cover",onError:t[18]||(t[18]=e=>e.target.style.display="none")},null,40,bl)):(i(),r("div",ml," L ")),s("div",null,[s("div",gl,u(o(w).line_user_info?.display_name||"未設定名稱"),1),s("div",_l,"進線編號："+u(ne(o(w))),1)])])])):y("",!0),s("div",null,[t[74]||(t[74]=s("label",{class:"block text-sm font-semibold text-gray-900 mb-2"},[C("LINE名稱 "),s("span",{class:"text-red-500"},"*")],-1)),c(s("input",{"onUpdate:modelValue":t[19]||(t[19]=e=>o(N).display_name=e),required:"",maxlength:"100",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"請輸入LINE名稱"},null,512),[[_,o(N).display_name]])]),s("div",xl,[s("button",{type:"button",class:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50",onClick:Ve}," 取消 "),s("button",{type:"submit",class:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",disabled:o(I)||!o(N).display_name?.trim()},u(o(I)?"儲存中...":"儲存"),9,fl)])],32)])])):y("",!0)])}}},Ml=mt(vl,[["__scopeId","data-v-b9505c4c"]]);export{Ml as default};
