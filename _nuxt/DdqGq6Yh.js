import{u as U}from"./CaSEveCJ.js";import{u as A}from"./BtlpaPqX.js";import{u as B}from"./DQZituR6.js";import{m as _,l as E,n as M}from"#entry";import{a as p}from"./DgLT0ASK.js";const j=()=>{const l=E(),{success:u,error:o}=A(),{refreshBadges:i}=B(),m=U(),f={pending:"/cases",valid_customer:"/cases/valid-customer",invalid_customer:"/cases/invalid-customer",customer_service:"/cases/customer-service",blacklist:"/cases/blacklist",approved_disbursed:"/cases/approved-disbursed",approved_undisbursed:"/cases/approved-undisbursed",conditional_approval:"/cases/conditional-approval",declined:"/cases/rejected",tracking:"/cases/tracking/index.vue"},h=[{value:"pending",label:"待處理"},{value:"valid_customer",label:"有效客戶"},{value:"invalid_customer",label:"無效客戶"},{value:"customer_service",label:"客服處理"},{value:"blacklist",label:"黑名單"},{value:"approved_disbursed",label:"已核准已撥款"},{value:"approved_undisbursed",label:"已核准未撥款"},{value:"conditional_approval",label:"條件核准"},{value:"declined",label:"婉拒"},{value:"tracking",label:"追蹤中"}],$=async s=>{if(l.public.apiBaseUrl==="/mock-api")return m.leads.filter(t=>(t.case_status||t.status||"pending")===s);const{get:e}=p(),{data:a,error:r}=await e("/cases",{case_status:s,per_page:1e3});return r?(console.error("載入案件失敗:",r),[]):a.items||[]},b=async s=>{if(l.public.apiBaseUrl==="/mock-api"){const t=m.addCase(s);return await i(),{success:!0,data:t}}const{post:e}=p(),{data:a,error:r}=await e("/cases",s);return r?{success:!1,error:r}:(await i(),{success:!0,data:a})},k=async(s,e,a=!0)=>{try{if(l.public.apiBaseUrl==="/mock-api"){const n=m.updateCaseStatus(s,e);if(n){const w=h.find(d=>d.value===e)?.label;if(u(`案件狀態已更新為：${w}`),await i(),a){const d=f[e];d&&d!==_().path&&await M(d)}return{success:!0,data:n}}else return o("更新案件狀態失敗"),{success:!1,error:"案件不存在"}}const{patch:r}=p(),{data:t,error:c}=await r(`/cases/${s}/status`,{case_status:e});if(c)return o("更新案件狀態失敗"),{success:!1,error:c};const C=h.find(n=>n.value===e)?.label;if(u(`案件狀態已更新為：${C}`),await i(),a){const n=f[e];n&&n!==_().path&&await M(n)}return{success:!0,data:t}}catch(r){return o("更新狀態失敗，請稍後再試"),console.error("Update case status error:",r),{success:!1,error:r}}},S=async(s,e)=>{try{if(l.public.apiBaseUrl==="/mock-api"){const c=m.updateCaseBusinessLevel(s,e);return c?(u(`業務等級已更新為：${e}級`),{success:!0,data:c}):(o("更新業務等級失敗"),{success:!1,error:"案件不存在"})}const{patch:a}=p(),{data:r,error:t}=await a(`/cases/${s}/business-level`,{business_level:e});return t?(o("更新業務等級失敗"),{success:!1,error:t}):(u(`業務等級已更新為：${e}級`),{success:!0,data:r})}catch(a){return o("更新業務等級失敗，請稍後再試"),console.error("Update business level error:",a),{success:!1,error:a}}},y=async s=>{if(l.public.apiBaseUrl==="/mock-api")return o("Mock 模式不支持刪除案件"),{success:!1,error:"Mock 模式不支持刪除"};const{delete:e}=p(),{data:a,error:r}=await e(`/cases/${s}`);return r?(o("刪除案件失敗"),{success:!1,error:r}):(u("案件已刪除"),await i(),{success:!0,data:a})},v={"/cases":"pending","/cases/valid-customer":"valid_customer","/cases/invalid-customer":"invalid_customer","/cases/customer-service":"customer_service","/cases/blacklist":"blacklist","/cases/approved-disbursed":"approved_disbursed","/cases/approved-undisbursed":"approved_undisbursed","/cases/conditional-approval":"conditional_approval","/cases/rejected":"declined","/cases/tracking/index.vue":"tracking"},g=(s,e={})=>{const a=Date.now(),r={customer_name:e.customer_name||`客戶${a}`,created_at:new Date().toISOString(),assigned_to:null,channel:s,...e};switch(s){case"wp_form":return{...r,email:e.email||`mock${a}@example.com`,phone:e.phone||`09${String(Math.floor(Math.random()*1e8)).padStart(8,"0")}`,line_id:null,source:e.source||`https://g${Math.floor(Math.random()*10)+1}.example.com`,payload:{頁面_URL:e.source||`https://g${Math.floor(Math.random()*10)+1}.example.com`,需求金額:Math.floor(Math.random()*1e6)+1e5,房屋地址:`假地址${Math.floor(Math.random()*999)}號`,...e.payload}};case"lineoa":return{...r,line_id:e.line_id||`U${a}abcdef`,line_user_info:{display_name:e.customer_name||`LINE用戶${a}`,picture_url:"/images/line-avatar-default.png",editable_name:e.customer_name||`LINE用戶${a}`,...e.line_user_info},email:null,phone:null,source:"line",payload:{聯絡方式:"LINE",所在地區:`地區${Math.floor(Math.random()*999)}`,資金需求:Math.floor(Math.random()*1e6)+1e5,貸款需求:"房屋貸款",...e.payload}};case"email":return{...r,email:e.email||`customer${a}@example.com`,phone:e.phone||`09${String(Math.floor(Math.random()*1e8)).padStart(8,"0")}`,line_id:null,source:"email",payload:{聯絡方式:"Email",所在地區:`地區${Math.floor(Math.random()*999)}`,資金需求:Math.floor(Math.random()*1e6)+1e5,貸款需求:"信用貸款",...e.payload}};case"phone":return{...r,phone:e.phone||`09${String(Math.floor(Math.random()*1e8)).padStart(8,"0")}`,email:null,line_id:null,source:"phone",payload:{聯絡方式:"電話",所在地區:`地區${Math.floor(Math.random()*999)}`,資金需求:Math.floor(Math.random()*1e6)+1e5,貸款需求:"個人信貸",...e.payload}};default:return{...r,email:`mock${a}@example.com`,phone:`09${String(Math.floor(Math.random()*1e8)).padStart(8,"0")}`,source:"unknown",payload:{}}}};return{STATUS_ROUTE_MAP:f,CASE_STATUS_OPTIONS:h,PAGE_CASE_STATUS_MAP:v,loadCasesByStatus:$,addCase:b,updateCaseStatus:k,updateBusinessLevel:S,deleteCase:y,generateMockCase:(s="pending",e={})=>{const a=Date.now();return{customer_name:`假客戶${a}`,email:`mock${a}@example.com`,phone:`09${String(Math.floor(Math.random()*1e8)).padStart(8,"0")}`,line_id:`mocklineid${a}`,channel:"wp_form",source:`http://mock-website-${a}.com`,case_status:s,assigned_to:null,business_level:"A",payload:{頁面_URL:`http://mock-website-${a}.com`,需求金額:Math.floor(Math.random()*1e6)+1e5,房屋地址:`假地址${Math.floor(Math.random()*999)}號`},...e}},generateCaseByChannel:g,generateCaseForCurrentPage:(s="wp_form",e={})=>{const a=_().path,r=v[a]||"pending",t=g(s,e);return t.case_status=r,a==="/cases/tracking/index.vue"&&(t.business_level=e.business_level||"A"),t},getDisplaySource:s=>{if(!s)return"-";switch(s.channel){case"wp_form":const e=s.payload?.頁面_URL||s.source;if(e)try{return new URL(e).hostname}catch{return e}return"網站表單";case"lineoa":return"官方LINE";case"email":return"Email";case"phone":return"電話";default:return s.channel||"-"}}}};export{j as u};
