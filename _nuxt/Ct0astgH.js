import Ze from"./-Op9ZE8F.js";import{_ as et,r as c,b as Y,H as P,y as tt,i as st,C as lt,u as ot,c as a,a as t,x as g,e as j,k as m,d as o,f as U,g as b,I as $,F as w,q as h,v as x,t as u,j as q,o as n,A as at,K as nt,L as _e,h as rt}from"#entry";import{_ as it,r as dt}from"./CRGlAI26.js";import{u as ut}from"./l19cjJOa.js";import{u as ct,a as we}from"./DgLT0ASK.js";import{u as bt}from"./BtlpaPqX.js";import{u as gt}from"./7WFD-W98.js";import{u as pt}from"./DzJdZt_Q.js";import{u as mt}from"./DQZituR6.js";import{r as yt}from"./BKE9UY2T.js";import{r as xt}from"./DdngC8ig.js";import{r as ft}from"./c8JhvyFk.js";import"./B5My0XuL.js";import"./CKtbBPOe.js";import"./CaSEveCJ.js";const vt={class:"space-y-6"},_t=["value"],wt=["value","onChange"],ht=["value"],kt={class:"text-sm font-medium text-gray-900"},Ct={class:"text-sm font-medium text-gray-900"},Lt={class:"text-sm text-gray-900"},Ut={class:"text-sm text-gray-900"},St={class:"text-xs text-gray-500"},Vt={class:"flex items-center space-x-2"},Et={class:"text-sm text-gray-900"},Nt=["onClick"],Dt={class:"text-sm text-gray-900"},It={class:"text-xs text-gray-500"},jt={key:0,class:"flex items-center space-x-2"},$t=["src","alt"],qt={key:1,class:"w-6 h-6 rounded-full bg-green-500 flex items-center justify-center text-white text-xs"},At={class:"flex-1 min-w-0"},Ot={class:"flex items-center space-x-1"},Tt={class:"text-xs font-medium text-gray-900 truncate"},Pt=["onClick"],Ft={key:1,class:"flex items-center space-x-2"},Mt={class:"text-xs text-gray-900"},zt={key:2,class:"text-xs text-gray-400"},Rt={class:"text-sm text-gray-900"},Wt={class:"text-xs text-gray-500 truncate max-w-[120px]"},Bt={class:"text-sm text-gray-900"},Ht={class:"text-sm text-gray-900"},Gt={key:0,class:"space-y-1"},Kt={class:"text-gray-500"},Qt={class:"text-gray-900 ml-1"},Yt={key:0,class:"text-xs text-gray-400"},Jt={key:1,class:"text-xs text-gray-400"},Xt={class:"flex items-center space-x-2 justify-end"},Zt=["onClick"],es=["onClick"],ts=["onClick"],ss=["onClick"],ls={class:"bg-white rounded-lg p-6 w-full max-w-xl max-h-[80vh] overflow-y-auto"},os={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},as=["value"],ns=["value"],rs=["value"],is={class:"md:col-span-2"},ds={key:0,class:"md:col-span-2 pt-2"},us={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},cs={class:"block text-sm font-semibold text-gray-900 mb-1"},bs={key:0,class:"text-red-500"},gs=["type","step","required","onUpdate:modelValue"],ps=["required","onUpdate:modelValue"],ms=["required","onUpdate:modelValue"],ys=["value"],xs={key:3},fs={class:"flex flex-wrap gap-3"},vs=["value","onUpdate:modelValue"],_s={key:4,class:"inline-flex items-center space-x-2"},ws=["onUpdate:modelValue"],hs={class:"flex justify-end space-x-3 pt-2"},ks=["disabled"],Cs={class:"bg-white rounded-lg p-6 w-full max-w-2xl mx-4 max-h-[90vh] overflow-y-auto"},Ls={key:0,class:"space-y-4"},Us={class:"grid grid-cols-2 gap-4"},Ss={class:"text-gray-900"},Vs={class:"text-gray-900"},Es={class:"text-gray-900"},Ns={class:"text-gray-900"},Ds={class:"text-gray-900"},Is={class:"text-gray-900"},js={key:0},$s={class:"text-gray-900 whitespace-pre-wrap"},qs={class:"bg-white rounded-lg p-6 w-full max-w-lg"},As={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},Os={class:"md:col-span-2"},Ts={class:"bg-white rounded-lg p-6 w-full max-w-md"},Ps={key:0,class:"mb-4"},Fs={class:"bg-gray-50 p-3 rounded-lg"},Ms={class:"text-sm text-gray-900"},zs={class:"text-sm text-gray-900"},Rs={class:"text-sm text-gray-900"},Ws=["value"],Bs={class:"flex justify-end space-x-3 pt-4"},Hs=["disabled"],Gs={class:"bg-white rounded-lg p-6 w-full max-w-md"},Ks={key:0,class:"mb-4"},Qs={class:"bg-gray-50 p-3 rounded-lg flex items-center space-x-3"},Ys=["src","alt"],Js={key:1,class:"w-10 h-10 rounded-full bg-green-500 flex items-center justify-center text-white text-sm"},Xs={class:"text-sm text-gray-900 font-medium"},Zs={class:"text-xs text-gray-500"},el={class:"flex justify-end space-x-3 pt-4"},tl=["disabled"],sl={__name:"declined",setup(ll){const F=ct(),{success:D,error:p,confirm:he}=bt(),{list:ke,updateOne:ne,removeOne:Ce,convertToCase:Le}=ut(),{getUsers:Ue}=gt(),{list:Se}=pt(),{refreshBadges:Ve}=mt(),{get:Ee}=we(),I=c(""),S=c("all"),J=c(!1),X=c(null),A=c([]),M=c([]),Ne=c({pending:0,today:0,thisWeek:0,processingRate:0}),Z=c([]),re=c([]),z=c(!1),ee=c(!1),R=c(!1),W=c(!1),B=c(!1),H=c(null),f=c(null),G=c(null),V=c(null),v=c(null),_=c(!1),O=c(1),te=c(5);Y(()=>Math.ceil(de.value.length/te.value));const T=c([]),y=P({}),De=[{value:"wp_form",label:"網站表單"},{value:"lineoa",label:"官方賴"},{value:"email",label:"Email"},{value:"phone",label:"電話"}],Ie=[{value:"pending",label:"待處理"},{value:"intake",label:"已進件"},{value:"approved",label:"已核准"},{value:"disbursed",label:"已撥款"},{value:"tracking",label:"追蹤中"},{value:"blacklist",label:"黑名單"}],ie=[{value:"unassigned",label:"未指派"},{value:"valid_customer",label:"有效客"},{value:"invalid_customer",label:"無效客"},{value:"customer_service",label:"客服"},{value:"blacklist",label:"黑名單"},{value:"approved_disbursed",label:"核准撥款"},{value:"conditional",label:"附條件"},{value:"declined",label:"婉拒"},{value:"tracking",label:"追蹤管理"}],d=P({page_url:"",website_domain:"",channel:"wp_form",status:"pending",created_at:"",assigned_to:null,email:null,line_id:"",region:"",address:"",required_amount:null,loan_purpose:"",contact_time:"",ip_address:null,notes:""}),E=P({loan_amount:null,loan_type:"",notes:""}),N=P({assigned_to:null}),k=P({display_name:""}),je=Y(()=>[{key:"case_status",title:"案件狀態",sortable:!0,width:"150px"},{key:"case_number",title:"案件編號",sortable:!0,width:"140px"},{key:"datetime",title:"時間",sortable:!0,width:"140px"},{key:"assignee",title:"承辦業務",sortable:!0,width:"100px"},{key:"channel",title:"來源管道",sortable:!0,width:"100px"},{key:"line_info",title:"LINE資訊",sortable:!1,width:"160px"},{key:"purpose",title:"諮詢項目",sortable:!1,width:"120px"},{key:"website",title:"網站",sortable:!1,width:"140px"},{key:"contact_info",title:"聯絡資訊",sortable:!1,width:"160px"},{key:"location",title:"地區/地址",sortable:!1,width:"160px"},{key:"amount",title:"需求金額",sortable:!1,width:"120px"},{key:"custom_fields",title:"自定義欄位",sortable:!1,width:"140px"},{key:"actions",title:"操作",sortable:!1,width:"160px"}]),de=Y(()=>{let l=A.value;if(I.value&&I.value.length>=2){const e=I.value.toLowerCase();l=l.filter(i=>i.email?.toLowerCase().includes(e)||i.line_id?.toLowerCase().includes(e)||i.payload?.頁面_URL?.toLowerCase().includes(e)||i.source?.toLowerCase().includes(e)||i.assignee?.name?.toLowerCase().includes(e))}return S.value&&S.value!=="all"&&(S.value==="null"?l=l.filter(e=>!e.assigned_to):l=l.filter(e=>e.assigned_to===parseInt(S.value))),l}),K=Y(()=>T.value.filter(l=>l.is_visible)),C=async()=>{J.value=!0,X.value=null;try{const{items:l,meta:e,success:i}=await ke({case_status:"declined",per_page:1e3});if(i){A.value=l||[];const s=A.value.length,r=new Date,L=A.value.filter(ae=>new Date(ae.created_at).toDateString()===r.toDateString()).length,Q=A.value.filter(ae=>{const fe=new Date(ae.created_at),ve=new Date(r);return ve.setDate(r.getDate()-r.getDay()),fe>=ve}).length;Ne.value={pending:s,today:L,thisWeek:Q,processingRate:s>0?Math.round(Q/s*100):0}}}catch(l){X.value="載入案件數據失敗",console.error("Load cases error:",l)}finally{J.value=!1}},$e=async()=>{try{const{success:l,users:e}=await Ue({per_page:250});l&&Array.isArray(e)&&(M.value=e)}catch(l){console.warn("Load users failed:",l)}},ue=async()=>{const{success:l,items:e}=await Se("case");l&&(T.value=e)},qe=async()=>{try{const{data:l,error:e}=await Ee("/websites/options");!e&&Array.isArray(l)?(Z.value=l,re.value=l.map(i=>({value:i.domain,label:i.name,website:i}))):console.warn("Failed to load websites from management system:",e)}catch(l){console.warn("Load websites failed:",l)}},Ae=l=>{I.value=l,O.value=1},Oe=l=>{O.value=l},Te=l=>{te.value=l,O.value=1};let se;tt([I,S],()=>{clearTimeout(se),se=setTimeout(()=>{O.value=1},300)});const Pe=l=>{f.value=l,ee.value=!0},ce=()=>{ee.value=!1,f.value=null},Fe=async l=>{H.value=l.id;const e=l.payload?.頁面_URL||l.source||"",i=oe(e);Object.assign(d,{page_url:e,website_domain:i.website?i.domain:e?"other":"",channel:l.channel||"wp_form",status:l.status||"pending",created_at:l.created_at?new Date(l.created_at).toISOString().slice(0,16):new Date().toISOString().slice(0,16),assigned_to:l.assigned_to||null,email:l.email||null,line_id:l.line_id||l.payload?.LINE_ID||"",region:l.payload?.房屋區域||l.payload?.所在地區||"",address:l.payload?.房屋地址||"",required_amount:l.payload?.資金需求||"",loan_purpose:l.payload?.貸款需求||"",contact_time:l.payload?.方便聯絡時間||"",ip_address:l.ip_address||null,notes:l.notes||l.payload?.備註||""}),await ue(),Ye(l),z.value=!0},be=()=>{z.value=!1,H.value=null},Me=async()=>{if(H.value){_.value=!0;try{let l=d.page_url;if(d.website_domain&&d.website_domain!=="other"){const s=Z.value.find(r=>r.domain===d.website_domain);s&&(l=s.url)}const e={channel:d.channel,status:d.status,email:d.email,line_id:d.line_id,ip_address:d.ip_address,assigned_to:d.assigned_to,notes:d.notes,payload:{頁面_URL:l,LINE_ID:d.line_id,房屋區域:d.region,房屋地址:d.address,資金需求:d.required_amount,貸款需求:d.loan_purpose,方便聯絡時間:d.contact_time,...y}},{error:i}=await ne(H.value,e);i?p(i?.message||"更新失敗"):(z.value=!1,await C(),D("進件資料更新成功"))}catch(l){p("系統錯誤，請稍後再試"),console.error("Update case error:",l)}finally{_.value=!1}}},ze=async l=>{if(await he(`確定刪除編號 ${l.id} 的進件嗎？`))try{const{error:i}=await Ce(l.id);i?p(i?.message||"刪除失敗"):(await C(),D(`編號 ${l.id} 的進件已刪除`))}catch(i){p("系統錯誤，請稍後再試"),console.error("Delete case error:",i)}},Re=l=>{if(!l.customer_id){p("此進件尚未綁定客戶，請先建立/綁定客戶後再送件");return}G.value=l,Object.assign(E,{loan_amount:null,loan_type:"",notes:""}),R.value=!0},ge=()=>{R.value=!1,G.value=null},We=async()=>{if(G.value)try{const{error:l}=await Le(G.value.id,E);l?p(l?.message||"轉換失敗"):(R.value=!1,await C(),D("案件轉換成功"))}catch(l){p("系統錯誤，請稍後再試"),console.error("Convert case error:",l)}},Be=l=>{V.value=l,N.assigned_to=l.assigned_to||null,W.value=!0},pe=()=>{W.value=!1,V.value=null,N.assigned_to=null},He=async()=>{if(!V.value||!N.assigned_to){p("請選擇承辦業務");return}_.value=!0;try{const{error:l}=await ne(V.value.id,{assigned_to:N.assigned_to});if(l)p(l?.message||"指派失敗");else{W.value=!1,await C();const e=M.value.find(i=>i.id===N.assigned_to);D(`已成功指派給 ${e?.name||"未知業務"}`)}}catch(l){p("系統錯誤，請稍後再試"),console.error("Assign case error:",l)}finally{_.value=!1}},Ge=l=>{v.value=l,k.display_name=l.line_user_info?.display_name||"",B.value=!0},me=()=>{B.value=!1,v.value=null,k.display_name=""},Ke=async()=>{if(!v.value||!k.display_name?.trim()){p("名稱不能為空");return}_.value=!0;try{const{$api:l}=rt(),{data:e,error:i}=await l.put(`/leads/${v.value.id}/line-name`,{editable_name:k.display_name.trim()});!i&&e?.success?(v.value.line_user_info&&(v.value.line_user_info.display_name=k.display_name.trim(),v.value.line_user_info.editable_name=k.display_name.trim()),B.value=!1,await C(),D(`LINE用戶名稱已更新：${e.old_name} → ${e.new_name}`)):p(e?.message||i?.message||"更新失敗")}catch(l){p("更新失敗，請稍後再試"),console.error("Save LINE name error:",l)}finally{_.value=!1}},Qe=async(l,e)=>{try{const{patch:i}=we(),{data:s,error:r}=await i(`/leads/${l.id}/case-status`,{case_status:e});if(r){p("更新案件狀態失敗");return}l.case_status=e;const L=ie.find(Q=>Q.value===e)?.label;D(`案件狀態已更新為：${L}`),await C(),await Ve()}catch(i){p("更新狀態失敗，請稍後再試"),console.error("Update case status error:",i)}},Ye=l=>{const e=l?.payload||{};T.value.forEach(i=>{const s=i.key;e&&Object.prototype.hasOwnProperty.call(e,s)?y[s]=e[s]:i.default_value?y[s]=i.default_value:y[s]=i.type==="multiselect"?[]:i.type==="boolean"?!1:""})},Je=l=>{try{return new URL(l).hostname}catch{return l||""}},le=l=>{const e=new Date(l.created_at),i=e.getFullYear().toString().slice(-2),s=String(e.getMonth()+1).padStart(2,"0"),r=String(e.getDate()).padStart(2,"0"),L=String(l.id).padStart(3,"0");return`CASE${i}${s}${r}${L}`},oe=l=>{if(!l)return{name:"-",domain:"",website:null};const e=Je(l),i=Z.value.find(s=>{if(s.domain===e)return!0;const r=e.replace(/^www\./,""),L=s.domain.replace(/^www\./,"");return!!(r===L||l.includes(s.domain)||e.includes(s.domain)||s.domain.includes(e))});return i?{name:i.name,domain:i.domain,website:i}:{name:e||l,domain:e||l,website:null}},ye=l=>new Date(l).toLocaleDateString("zh-TW",{year:"numeric",month:"2-digit",day:"2-digit"}),xe=l=>new Date(l).toLocaleTimeString("zh-TW",{hour:"2-digit",minute:"2-digit"}),Xe=(l,e)=>e.type==="multiselect"?Array.isArray(l)?l.join(", "):l||"-":e.type==="boolean"?l?"是":"否":l??"-";return st(async()=>{await Promise.all([$e(),C(),ue(),qe()])}),lt(()=>{clearTimeout(se)}),ot({title:"婉拒 - 貸款案件管理系統"}),(l,e)=>{const i=Ze;return n(),a("div",vt,[e[69]||(e[69]=t("div",{class:"flex items-center justify-between"},[t("div",null,[t("h1",{class:"text-3xl font-bold text-gray-900"},"婉拒"),t("p",{class:"text-gray-600 mt-2"},"顯示被婉拒的案件")])],-1)),g("",!0),j(it,{title:"婉拒列表",columns:o(je),data:o(de),loading:o(J),error:o(X),"search-query":o(I),"search-placeholder":"搜尋姓名/手機/Email/LINE/網站... (至少2個字符)","show-search-icon":!1,"current-page":o(O),"items-per-page":o(te),"loading-text":"載入中...","empty-text":"沒有待處理案件",onSearch:Ae,onRefresh:C,onRetry:C,onPageChange:Oe,onPageSizeChange:Te},{filters:m(()=>[o(F).hasPermission&&o(F).hasPermission("customer_management")?b((n(),a("select",{key:0,"onUpdate:modelValue":e[0]||(e[0]=s=>at(S)?S.value=s:null),class:"px-4 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500"},[e[20]||(e[20]=t("option",{value:"all"},"全部承辦",-1)),e[21]||(e[21]=t("option",{value:"null"},"未指派",-1)),(n(!0),a(w,null,h(o(M),s=>(n(),a("option",{key:s.id,value:s.id},u(s.name),9,_t))),128))],512)),[[$,o(S)]]):g("",!0)]),actions:m(()=>[...e[22]||(e[22]=[])]),"cell-case_status":m(({item:s})=>[t("select",{value:s.case_status||"unassigned",onChange:r=>Qe(s,r.target.value),class:"w-full px-1 py-0.5 text-xs border border-gray-300 rounded bg-white text-gray-900 focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500"},[(n(),a(w,null,h(ie,r=>t("option",{key:r.value,value:r.value},u(r.label),9,ht)),64))],40,wt)]),"cell-case_number":m(({item:s})=>[t("div",kt,u(le(s)),1)]),"cell-website":m(({item:s})=>[t("div",Ct,u(oe(s.payload?.頁面_URL||s.source).name),1)]),"cell-channel":m(({item:s})=>[t("span",Lt,u(s.channel==="wp_form"?"網站表單":s.channel==="lineoa"?"官方賴":s.channel==="email"?"Email":s.channel==="phone"?"電話":s.channel||"-"),1)]),"cell-datetime":m(({item:s})=>[t("div",null,[t("div",Ut,u(ye(s.created_at)),1),t("div",St,u(xe(s.created_at)),1)])]),"cell-assignee":m(({item:s})=>[t("div",Vt,[t("span",Et,u(s.assignee?.name||"未指派"),1),!s.assignee&&o(F).hasPermission&&o(F).hasPermission("customer_management")?(n(),a("button",{key:0,onClick:r=>Be(s),class:"inline-flex items-center justify-center w-6 h-6 text-blue-600 hover:text-white hover:bg-blue-600 rounded transition-colors duration-200 relative group",title:"指派業務"},[j(i,{name:"heroicons:user-plus",class:"w-4 h-4"}),e[23]||(e[23]=t("span",{class:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-2 py-1 text-xs text-white bg-gray-800 rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap"}," 指派業務 ",-1))],8,Nt)):g("",!0)])]),"cell-contact_info":m(({item:s})=>[t("div",null,[t("div",Dt,u(s.email||"未提供"),1),t("div",It,u(s.phone||"未提供"),1)])]),"cell-line_info":m(({item:s})=>[s.line_user_info&&s.is_line_user_id?(n(),a("div",jt,[s.line_user_info.picture_url?(n(),a("img",{key:0,src:s.line_user_info.picture_url,alt:s.line_user_info.display_name||"LINE用戶",class:"w-6 h-6 rounded-full object-cover",onError:e[1]||(e[1]=r=>r.target.style.display="none")},null,40,$t)):(n(),a("div",qt," L ")),t("div",At,[t("div",Ot,[t("span",Tt,u(s.line_user_info.display_name||"未設定名稱"),1),t("button",{onClick:r=>Ge(s),class:"text-blue-500 hover:text-blue-700 text-xs",title:"編輯LINE名稱"}," ✏️ ",8,Pt)])])])):s.line_id&&!s.is_line_user_id?(n(),a("div",Ft,[e[24]||(e[24]=t("div",{class:"w-6 h-6 rounded-full bg-gray-400 flex items-center justify-center text-white text-xs"}," @ ",-1)),t("span",Mt,u(s.line_id),1)])):(n(),a("div",zt," 未綁定 "))]),"cell-location":m(({item:s})=>[t("div",null,[t("div",Rt,u(s.payload?.房屋區域||s.payload?.所在地區||"未提供"),1),t("div",Wt,u(s.payload?.房屋地址||""),1)])]),"cell-amount":m(({item:s})=>[t("span",Bt,u(s.payload?.資金需求||"未填寫"),1)]),"cell-purpose":m(({item:s})=>[t("span",Ht,u(s.payload?.貸款需求||"未填寫"),1)]),"cell-custom_fields":m(({item:s})=>[o(K).length>0?(n(),a("div",Gt,[(n(!0),a(w,null,h(o(K).slice(0,2),r=>(n(),a("div",{key:r.id,class:"text-xs"},[t("span",Kt,u(r.label)+":",1),t("span",Qt,u(Xe(s.payload?.[r.key],r)),1)]))),128)),o(K).length>2?(n(),a("div",Yt," +"+u(o(K).length-2)+" 個欄位 ",1)):g("",!0)])):(n(),a("span",Jt,"無自定義欄位"))]),"cell-actions":m(({item:s})=>[t("div",Xt,[t("button",{onClick:r=>Pe(s),class:"group relative inline-flex items-center justify-center p-2 text-blue-600 hover:text-white hover:bg-blue-600 rounded-lg transition-all duration-200",title:"查看詳情"},[j(o(yt),{class:"w-4 h-4"}),e[25]||(e[25]=t("div",{class:"absolute bottom-full mb-2 hidden group-hover:block px-2 py-1 text-xs text-white bg-gray-900 rounded whitespace-nowrap z-10"}," 查看詳情 ",-1))],8,Zt),t("button",{onClick:r=>Fe(s),class:"group relative inline-flex items-center justify-center p-2 text-gray-600 hover:text-white hover:bg-gray-600 rounded-lg transition-all duration-200",title:"編輯"},[j(o(dt),{class:"w-4 h-4"}),e[26]||(e[26]=t("div",{class:"absolute bottom-full mb-2 hidden group-hover:block px-2 py-1 text-xs text-white bg-gray-900 rounded whitespace-nowrap z-10"}," 編輯 ",-1))],8,es),s.customer_id?(n(),a("button",{key:0,onClick:r=>Re(s),class:"group relative inline-flex items-center justify-center p-2 text-purple-600 hover:text-white hover:bg-purple-600 rounded-lg transition-all duration-200",title:"轉送件"},[j(o(xt),{class:"w-4 h-4"}),e[27]||(e[27]=t("div",{class:"absolute bottom-full mb-2 hidden group-hover:block px-2 py-1 text-xs text-white bg-gray-900 rounded whitespace-nowrap z-10"}," 轉送件 ",-1))],8,ts)):g("",!0),t("button",{onClick:r=>ze(s),class:"group relative inline-flex items-center justify-center p-2 text-red-600 hover:text-white hover:bg-red-600 rounded-lg transition-all duration-200",title:"刪除"},[j(o(ft),{class:"w-4 h-4"}),e[28]||(e[28]=t("div",{class:"absolute bottom-full mb-2 hidden group-hover:block px-2 py-1 text-xs text-white bg-gray-900 rounded whitespace-nowrap z-10"}," 刪除 ",-1))],8,ss)])]),_:1},8,["columns","data","loading","error","search-query","current-page","items-per-page"]),o(z)?(n(),a("div",{key:1,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 mt-0",onClick:U(be,["self"])},[t("div",ls,[e[45]||(e[45]=t("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"編輯進件",-1)),t("form",{onSubmit:U(Me,["prevent"]),class:"space-y-3"},[t("div",os,[t("div",null,[e[31]||(e[31]=t("label",{class:"block text-sm font-semibold text-gray-900 mb-1"},"網站",-1)),b(t("select",{"onUpdate:modelValue":e[2]||(e[2]=s=>o(d).website_domain=s),class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},[e[29]||(e[29]=t("option",{value:""},"請選擇網站",-1)),(n(!0),a(w,null,h(o(re),s=>(n(),a("option",{key:s.value,value:s.value},u(s.label),9,as))),128)),e[30]||(e[30]=t("option",{value:"other"},"其他（手動輸入）",-1))],512),[[$,o(d).website_domain]]),o(d).website_domain==="other"?b((n(),a("input",{key:0,"onUpdate:modelValue":e[3]||(e[3]=s=>o(d).page_url=s),placeholder:"請輸入完整的網址",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 mt-2"},null,512)),[[x,o(d).page_url]]):g("",!0)]),t("div",null,[e[32]||(e[32]=t("label",{class:"block text-sm font-semibold text-gray-900 mb-1"},"來源管道",-1)),b(t("select",{"onUpdate:modelValue":e[4]||(e[4]=s=>o(d).channel=s),class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},[(n(),a(w,null,h(De,s=>t("option",{key:s.value,value:s.value},u(s.label),9,ns)),64))],512),[[$,o(d).channel]])]),t("div",null,[e[33]||(e[33]=t("label",{class:"block text-sm font-semibold text-gray-900 mb-1"},"案件狀態",-1)),b(t("select",{"onUpdate:modelValue":e[5]||(e[5]=s=>o(d).status=s),class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},[(n(),a(w,null,h(Ie,s=>t("option",{key:s.value,value:s.value},u(s.label),9,rs)),64))],512),[[$,o(d).status]])]),t("div",null,[e[34]||(e[34]=t("label",{class:"block text-sm font-semibold text-gray-900 mb-1"},"時間",-1)),b(t("input",{"onUpdate:modelValue":e[6]||(e[6]=s=>o(d).created_at=s),type:"datetime-local",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,512),[[x,o(d).created_at]])]),t("div",null,[e[35]||(e[35]=t("label",{class:"block text-sm font-semibold text-gray-900 mb-1"},"Email",-1)),b(t("input",{"onUpdate:modelValue":e[7]||(e[7]=s=>o(d).email=s),type:"email",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,512),[[x,o(d).email]])]),t("div",null,[e[36]||(e[36]=t("label",{class:"block text-sm font-semibold text-gray-900 mb-1"},"LINE ID",-1)),b(t("input",{"onUpdate:modelValue":e[8]||(e[8]=s=>o(d).line_id=s),class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,512),[[x,o(d).line_id]])]),t("div",null,[e[37]||(e[37]=t("label",{class:"block text-sm font-semibold text-gray-900 mb-1"},"地區",-1)),b(t("input",{"onUpdate:modelValue":e[9]||(e[9]=s=>o(d).region=s),class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,512),[[x,o(d).region]])]),t("div",null,[e[38]||(e[38]=t("label",{class:"block text-sm font-semibold text-gray-900 mb-1"},"地址",-1)),b(t("input",{"onUpdate:modelValue":e[10]||(e[10]=s=>o(d).address=s),class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,512),[[x,o(d).address]])]),t("div",null,[e[39]||(e[39]=t("label",{class:"block text-sm font-semibold text-gray-900 mb-1"},"需求金額",-1)),b(t("input",{"onUpdate:modelValue":e[11]||(e[11]=s=>o(d).required_amount=s),type:"number",min:"0",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,512),[[x,o(d).required_amount,void 0,{number:!0}]])]),t("div",null,[e[40]||(e[40]=t("label",{class:"block text-sm font-semibold text-gray-900 mb-1"},"諮詢項目",-1)),b(t("input",{"onUpdate:modelValue":e[12]||(e[12]=s=>o(d).loan_purpose=s),class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,512),[[x,o(d).loan_purpose]])]),t("div",is,[e[41]||(e[41]=t("label",{class:"block text-sm font-semibold text-gray-900 mb-1"},"備註",-1)),b(t("textarea",{"onUpdate:modelValue":e[13]||(e[13]=s=>o(d).notes=s),rows:"2",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,512),[[x,o(d).notes]])]),o(T).length?(n(),a("div",ds,[e[44]||(e[44]=t("div",{class:"text-sm font-semibold mb-2"},"自定義欄位（案件）",-1)),t("div",us,[(n(!0),a(w,null,h(o(T),s=>(n(),a("div",{key:s.id},[t("label",cs,[q(u(s.label)+" ",1),s.is_required?(n(),a("span",bs,"*")):g("",!0)]),["text","number","decimal","date"].includes(s.type)?b((n(),a("input",{key:0,type:s.type==="decimal"||s.type==="number"?"number":s.type==="date"?"date":"text",step:s.type==="decimal"?"any":void 0,class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:s.is_required,"onUpdate:modelValue":r=>o(y)[s.key]=r},null,8,gs)),[[nt,o(y)[s.key]]]):s.type==="textarea"?b((n(),a("textarea",{key:1,class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:s.is_required,"onUpdate:modelValue":r=>o(y)[s.key]=r},null,8,ps)),[[x,o(y)[s.key]]]):s.type==="select"?b((n(),a("select",{key:2,class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:s.is_required,"onUpdate:modelValue":r=>o(y)[s.key]=r},[e[42]||(e[42]=t("option",{value:""},"請選擇",-1)),(n(!0),a(w,null,h(s.options||[],r=>(n(),a("option",{key:r,value:r},u(r),9,ys))),128))],8,ms)),[[$,o(y)[s.key]]]):s.type==="multiselect"?(n(),a("div",xs,[t("div",fs,[(n(!0),a(w,null,h(s.options||[],r=>(n(),a("label",{key:r,class:"inline-flex items-center"},[b(t("input",{type:"checkbox",value:r,"onUpdate:modelValue":L=>o(y)[s.key]=L,class:"mr-2"},null,8,vs),[[_e,o(y)[s.key]]]),t("span",null,u(r),1)]))),128))])])):s.type==="boolean"?(n(),a("label",_s,[b(t("input",{type:"checkbox","onUpdate:modelValue":r=>o(y)[s.key]=r},null,8,ws),[[_e,o(y)[s.key]]]),e[43]||(e[43]=t("span",null,"是/否",-1))])):g("",!0)]))),128))])])):g("",!0)]),t("div",hs,[t("button",{type:"button",class:"px-4 py-2 border border-gray-300 rounded-lg",onClick:be},"取消"),t("button",{type:"submit",class:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",disabled:o(_)},u(o(_)?"儲存中...":"儲存"),9,ks)])],32)])])):g("",!0),o(ee)?(n(),a("div",{key:2,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 mt-0",onClick:U(ce,["self"])},[t("div",Cs,[t("div",{class:"flex justify-between items-center mb-4"},[e[46]||(e[46]=t("h3",{class:"text-lg font-semibold text-gray-900"},"案件詳情",-1)),t("button",{onClick:ce,class:"text-gray-400 hover:text-gray-600"}," ✕ ")]),o(f)?(n(),a("div",Ls,[t("div",Us,[t("div",null,[e[47]||(e[47]=t("label",{class:"block text-sm font-medium text-gray-700"},"網站",-1)),t("p",Ss,u(oe(o(f).payload?.頁面_URL||o(f).source).name),1)]),t("div",null,[e[48]||(e[48]=t("label",{class:"block text-sm font-medium text-gray-700"},"來源管道",-1)),t("p",Vs,u(o(f).channel||"wp_form"),1)]),t("div",null,[e[49]||(e[49]=t("label",{class:"block text-sm font-medium text-gray-700"},"時間",-1)),t("p",Es,u(ye(o(f).created_at))+" "+u(xe(o(f).created_at)),1)]),t("div",null,[e[50]||(e[50]=t("label",{class:"block text-sm font-medium text-gray-700"},"承辦業務",-1)),t("p",Ns,u(o(f).assignee?.name||"未指派"),1)]),t("div",null,[e[51]||(e[51]=t("label",{class:"block text-sm font-medium text-gray-700"},"Email",-1)),t("p",Ds,u(o(f).email||"未提供"),1)]),t("div",null,[e[52]||(e[52]=t("label",{class:"block text-sm font-medium text-gray-700"},"LINE ID",-1)),t("p",Is,u(o(f).line_id||"未提供"),1)])]),o(f).notes?(n(),a("div",js,[e[53]||(e[53]=t("label",{class:"block text-sm font-medium text-gray-700"},"備註",-1)),t("p",$s,u(o(f).notes),1)])):g("",!0)])):g("",!0)])])):g("",!0),o(R)?(n(),a("div",{key:3,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 mt-0",onClick:U(ge,["self"])},[t("div",qs,[e[58]||(e[58]=t("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"送件（建立案件）",-1)),t("form",{onSubmit:U(We,["prevent"]),class:"space-y-3"},[t("div",As,[t("div",null,[e[54]||(e[54]=t("label",{class:"block text-sm font-semibold text-gray-900 mb-1"},"貸款金額",-1)),b(t("input",{"onUpdate:modelValue":e[14]||(e[14]=s=>o(E).loan_amount=s),required:"",type:"number",min:"0",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,512),[[x,o(E).loan_amount,void 0,{number:!0}]])]),t("div",null,[e[55]||(e[55]=t("label",{class:"block text-sm font-semibold text-gray-900 mb-1"},"貸款類型",-1)),b(t("input",{"onUpdate:modelValue":e[15]||(e[15]=s=>o(E).loan_type=s),class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,512),[[x,o(E).loan_type]])]),t("div",Os,[e[56]||(e[56]=t("label",{class:"block text-sm font-semibold text-gray-900 mb-1"},"備註",-1)),b(t("textarea",{"onUpdate:modelValue":e[16]||(e[16]=s=>o(E).notes=s),rows:"2",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,512),[[x,o(E).notes]])])]),t("div",{class:"flex justify-end space-x-3 pt-2"},[t("button",{type:"button",class:"px-4 py-2 border border-gray-300 rounded-lg",onClick:ge},"取消"),e[57]||(e[57]=t("button",{type:"submit",class:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700"},"送件",-1))])],32)])])):g("",!0),o(W)?(n(),a("div",{key:4,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 mt-0",onClick:U(pe,["self"])},[t("div",Ts,[e[65]||(e[65]=t("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"指派承辦業務",-1)),t("form",{onSubmit:U(He,["prevent"]),class:"space-y-4"},[o(V)?(n(),a("div",Ps,[e[62]||(e[62]=t("div",{class:"text-sm text-gray-900 font-semibold mb-2"},"案件資訊：",-1)),t("div",Fs,[t("div",Ms,[e[59]||(e[59]=t("span",{class:"font-medium"},"案件編號：",-1)),q(u(le(o(V))),1)]),t("div",zs,[e[60]||(e[60]=t("span",{class:"font-medium"},"Email：",-1)),q(u(o(V).email||"未提供"),1)]),t("div",Rs,[e[61]||(e[61]=t("span",{class:"font-medium"},"LINE ID：",-1)),q(u(o(V).line_id||"未提供"),1)])])])):g("",!0),t("div",null,[e[64]||(e[64]=t("label",{class:"block text-sm font-semibold text-gray-900 mb-2"},[q("選擇承辦業務 "),t("span",{class:"text-red-500"},"*")],-1)),b(t("select",{"onUpdate:modelValue":e[17]||(e[17]=s=>o(N).assigned_to=s),required:"",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},[e[63]||(e[63]=t("option",{value:""},"請選擇業務人員",-1)),(n(!0),a(w,null,h(o(M).filter(s=>s.roles?.[0]?.name==="staff"),s=>(n(),a("option",{key:s.id,value:s.id},u(s.name||s.email)+" (業務) ",9,Ws))),128))],512),[[$,o(N).assigned_to]])]),t("div",Bs,[t("button",{type:"button",class:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50",onClick:pe}," 取消 "),t("button",{type:"submit",class:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",disabled:o(_)||!o(N).assigned_to},u(o(_)?"指派中...":"確認指派"),9,Hs)])],32)])])):g("",!0),o(B)?(n(),a("div",{key:5,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 mt-0",onClick:U(me,["self"])},[t("div",Gs,[e[68]||(e[68]=t("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"編輯LINE名稱",-1)),t("form",{onSubmit:U(Ke,["prevent"]),class:"space-y-4"},[o(v)?(n(),a("div",Ks,[e[66]||(e[66]=t("div",{class:"text-sm text-gray-900 font-semibold mb-2"},"LINE使用者資訊：",-1)),t("div",Qs,[o(v).line_user_info?.picture_url?(n(),a("img",{key:0,src:o(v).line_user_info.picture_url,alt:o(v).line_user_info.display_name||"LINE用戶",class:"w-10 h-10 rounded-full object-cover",onError:e[18]||(e[18]=s=>s.target.style.display="none")},null,40,Ys)):(n(),a("div",Js," L ")),t("div",null,[t("div",Xs,u(o(v).line_user_info?.display_name||"未設定名稱"),1),t("div",Zs,"案件編號："+u(le(o(v))),1)])])])):g("",!0),t("div",null,[e[67]||(e[67]=t("label",{class:"block text-sm font-semibold text-gray-900 mb-2"},[q("LINE名稱 "),t("span",{class:"text-red-500"},"*")],-1)),b(t("input",{"onUpdate:modelValue":e[19]||(e[19]=s=>o(k).display_name=s),required:"",maxlength:"100",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"請輸入LINE名稱"},null,512),[[x,o(k).display_name]])]),t("div",el,[t("button",{type:"button",class:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50",onClick:me}," 取消 "),t("button",{type:"submit",class:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",disabled:o(_)||!o(k).display_name?.trim()},u(o(_)?"儲存中...":"儲存"),9,tl)])],32)])])):g("",!0)])}}},vl=et(sl,[["__scopeId","data-v-e30d6b09"]]);export{vl as default};
