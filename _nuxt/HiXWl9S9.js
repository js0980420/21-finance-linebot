import et from"./-Op9ZE8F.js";import{_ as tt,r as c,b as Y,H as F,y as st,i as lt,C as ot,u as at,c as n,a as t,x as b,e as q,k as p,d as o,f as U,g,I as A,F as h,q as k,v as f,t as u,j as O,l as nt,o as r,A as rt,K as it,L as we,h as ut}from"#entry";import{_ as dt,r as ct}from"./CRGlAI26.js";import{u as gt}from"./CaSEveCJ.js";import{u as bt}from"./l19cjJOa.js";import{u as pt}from"./CuXVLCuF.js";import{u as yt,a as he}from"./DgLT0ASK.js";import{u as mt}from"./BtlpaPqX.js";import{u as ft}from"./7WFD-W98.js";import{u as xt}from"./DzJdZt_Q.js";import{u as vt}from"./DQZituR6.js";import{r as _t}from"./BKE9UY2T.js";import{r as wt}from"./DdngC8ig.js";import{r as ht}from"./c8JhvyFk.js";import"./B5My0XuL.js";import"./CKtbBPOe.js";const kt={class:"space-y-6"},Ct=["value"],Lt=["value","onChange"],Ut=["value"],St=["value","onChange"],Nt={class:"text-sm font-medium text-gray-900"},Vt={class:"text-sm font-medium text-gray-900"},Et={class:"text-sm text-gray-900"},Dt={class:"text-sm text-gray-900"},jt={class:"text-xs text-gray-500"},$t={class:"flex items-center space-x-2"},qt={class:"text-sm text-gray-900"},At=["onClick"],Ot={class:"text-sm text-gray-900"},Tt={class:"text-xs text-gray-500"},Pt={key:0,class:"flex items-center space-x-2"},Ft=["src","alt"],Mt={key:1,class:"w-6 h-6 rounded-full bg-green-500 flex items-center justify-center text-white text-xs"},zt={class:"flex-1 min-w-0"},Wt={class:"flex items-center space-x-1"},Bt={class:"text-xs font-medium text-gray-900 truncate"},Rt=["onClick"],It={key:1,class:"flex items-center space-x-2"},Ht={class:"text-xs text-gray-900"},Gt={key:2,class:"text-xs text-gray-400"},Kt={class:"text-sm text-gray-900"},Qt={class:"text-xs text-gray-500 truncate max-w-[120px]"},Yt={class:"text-sm text-gray-900"},Jt={class:"text-sm text-gray-900"},Xt={key:0,class:"space-y-1"},Zt={class:"text-gray-500"},es={class:"text-gray-900 ml-1"},ts={key:0,class:"text-xs text-gray-400"},ss={key:1,class:"text-xs text-gray-400"},ls={class:"flex items-center space-x-2 justify-end"},os=["onClick"],as=["onClick"],ns=["onClick"],rs=["onClick"],is={class:"bg-white rounded-lg p-6 w-full max-w-xl max-h-[80vh] overflow-y-auto"},us={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},ds=["value"],cs=["value"],gs=["value"],bs={class:"md:col-span-2"},ps={key:0,class:"md:col-span-2 pt-2"},ys={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},ms={class:"block text-sm font-semibold text-gray-900 mb-1"},fs={key:0,class:"text-red-500"},xs=["type","step","required","onUpdate:modelValue"],vs=["required","onUpdate:modelValue"],_s=["required","onUpdate:modelValue"],ws=["value"],hs={key:3},ks={class:"flex flex-wrap gap-3"},Cs=["value","onUpdate:modelValue"],Ls={key:4,class:"inline-flex items-center space-x-2"},Us=["onUpdate:modelValue"],Ss={class:"flex justify-end space-x-3 pt-2"},Ns=["disabled"],Vs={class:"bg-white rounded-lg p-6 w-full max-w-2xl mx-4 max-h-[90vh] overflow-y-auto"},Es={key:0,class:"space-y-4"},Ds={class:"grid grid-cols-2 gap-4"},js={class:"text-gray-900"},$s={class:"text-gray-900"},qs={class:"text-gray-900"},As={class:"text-gray-900"},Os={class:"text-gray-900"},Ts={class:"text-gray-900"},Ps={key:0},Fs={class:"text-gray-900 whitespace-pre-wrap"},Ms={class:"bg-white rounded-lg p-6 w-full max-w-lg"},zs={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},Ws={class:"md:col-span-2"},Bs={class:"bg-white rounded-lg p-6 w-full max-w-md"},Rs={key:0,class:"mb-4"},Is={class:"bg-gray-50 p-3 rounded-lg"},Hs={class:"text-sm text-gray-900"},Gs={class:"text-sm text-gray-900"},Ks={class:"text-sm text-gray-900"},Qs=["value"],Ys={class:"flex justify-end space-x-3 pt-4"},Js=["disabled"],Xs={class:"bg-white rounded-lg p-6 w-full max-w-md"},Zs={key:0,class:"mb-4"},el={class:"bg-gray-50 p-3 rounded-lg flex items-center space-x-3"},tl=["src","alt"],sl={key:1,class:"w-10 h-10 rounded-full bg-green-500 flex items-center justify-center text-white text-sm"},ll={class:"text-sm text-gray-900 font-medium"},ol={class:"text-xs text-gray-500"},al={class:"flex justify-end space-x-3 pt-4"},nl=["disabled"],rl={__name:"cases",setup(il){const M=yt(),{success:D,error:y,confirm:ke}=mt(),{list:Ce,updateOne:ae,removeOne:Le,convertToCase:Ue}=bt(),{getUsers:Se}=ft(),{list:Ne}=xt(),{refreshBadges:Ve}=vt(),{get:Ee}=he(),j=c(""),S=c("all"),z=c(!1),J=c(null),$=c([]),W=c([]),De=c({pending:0,today:0,thisWeek:0,processingRate:0}),X=c([]),ne=c([]),{getWebsiteInfo:je,getWebsiteName:re}=pt(X),B=c(!1),Z=c(!1),R=c(!1),I=c(!1),H=c(!1),G=c(null),_=c(null),K=c(null),N=c(null),x=c(null),v=c(!1),T=c(1),ee=c(5);Y(()=>Math.ceil(ue.value.length/ee.value));const P=c([]),m=F({}),$e=[{value:"wp_form",label:"網站表單"},{value:"lineoa",label:"官方賴"},{value:"email",label:"Email"},{value:"phone",label:"電話"}],qe=[{value:"pending",label:"待處理"},{value:"intake",label:"已進件"},{value:"approved",label:"已核准"},{value:"disbursed",label:"已撥款"},{value:"tracking",label:"追蹤中"},{value:"blacklist",label:"黑名單"}],ie=[{value:"unassigned",label:"未指派"},{value:"valid_customer",label:"有效客"},{value:"invalid_customer",label:"無效客"},{value:"customer_service",label:"客服"},{value:"blacklist",label:"黑名單"},{value:"approved_disbursed",label:"核准撥款"},{value:"conditional",label:"附條件"},{value:"declined",label:"婉拒"},{value:"follow_up",label:"追蹤管理"}],i=F({business_level:"",page_url:"",website_domain:"",channel:"wp_form",status:"pending",created_at:"",assigned_to:null,email:null,line_id:"",region:"",address:"",required_amount:null,loan_purpose:"",contact_time:"",ip_address:null,notes:""}),V=F({loan_amount:null,loan_type:"",notes:""}),E=F({assigned_to:null}),C=F({display_name:""}),Ae=Y(()=>[{key:"case_status",title:"案件狀態",sortable:!0,width:"80px"},{key:"business_level",title:"業務等級",sortable:!0,width:"90px"},{key:"datetime",title:"時間",sortable:!0,width:"140px"},{key:"assignee",title:"承辦業務",sortable:!0,width:"100px"},{key:"channel",title:"來源管道",sortable:!0,width:"100px"},{key:"line_info",title:"LINE資訊",sortable:!1,width:"160px"},{key:"purpose",title:"諮詢項目",sortable:!1,width:"120px"},{key:"website",title:"網站",sortable:!1,width:"30px"},{key:"contact_info",title:"聯絡資訊",sortable:!1,width:"160px"},{key:"location",title:"地區/地址",sortable:!1,width:"160px"},{key:"amount",title:"需求金額",sortable:!1,width:"120px"},{key:"custom_fields",title:"自定義欄位",sortable:!1,width:"140px"},{key:"actions",title:"操作",sortable:!1,width:"160px"}]),ue=Y(()=>{let l=$.value;if(j.value&&j.value.length>=2){const e=j.value.toLowerCase();l=l.filter(d=>d.email?.toLowerCase().includes(e)||d.line_id?.toLowerCase().includes(e)||d.payload?.頁面_URL?.toLowerCase().includes(e)||d.source?.toLowerCase().includes(e)||d.assignee?.name?.toLowerCase().includes(e))}return S.value&&S.value!=="all"&&(S.value==="null"?l=l.filter(e=>!e.assigned_to):l=l.filter(e=>e.assigned_to===parseInt(S.value))),l}),Q=Y(()=>P.value.filter(l=>l.is_visible)),L=async()=>{z.value=!0,J.value=null;try{if(nt().public.apiBaseUrl==="/mock-api"){const a=gt();$.value=a.cases.filter(w=>w.case_status==="tracking"),z.value=!1;return}const{items:e,meta:d,success:s}=await Ce({case_status:"tracking",per_page:1e3});if(s){$.value=e||[];const a=$.value.length,w=new Date,le=$.value.filter(oe=>new Date(oe.created_at).toDateString()===w.toDateString()).length,xe=$.value.filter(oe=>{const ve=new Date(oe.created_at),_e=new Date(w);return _e.setDate(w.getDate()-w.getDay()),ve>=_e}).length;De.value={pending:a,today:le,thisWeek:xe,processingRate:a>0?Math.round(xe/a*100):0}}}catch(l){J.value="載入案件數據失敗",console.error("Load cases error:",l)}finally{z.value=!1}},Oe=async()=>{try{const{success:l,users:e}=await Se({per_page:250});l&&Array.isArray(e)&&(W.value=e)}catch(l){console.warn("Load users failed:",l)}},de=async()=>{const{success:l,items:e}=await Ne("case");l&&(P.value=e)},Te=async()=>{try{const{data:l,error:e}=await Ee("/websites/options");!e&&Array.isArray(l)?(X.value=l,ne.value=l.map(d=>({value:d.domain,label:d.name,website:d}))):console.warn("Failed to load websites from management system:",e)}catch(l){console.warn("Load websites failed:",l)}},Pe=l=>{j.value=l,T.value=1},Fe=l=>{T.value=l},Me=l=>{ee.value=l,T.value=1};let te;st([j,S],()=>{clearTimeout(te),te=setTimeout(()=>{T.value=1},300)});const ze=l=>{_.value=l,Z.value=!0},ce=()=>{Z.value=!1,_.value=null},We=async l=>{G.value=l.id;const e=l.payload?.頁面_URL||l.source||"",d=je(e);Object.assign(i,{page_url:e,website_domain:d.website?d.domain:e?"other":"",channel:l.channel||"wp_form",status:l.status||"pending",created_at:l.created_at?new Date(l.created_at).toISOString().slice(0,16):new Date().toISOString().slice(0,16),assigned_to:l.assigned_to||null,email:l.email||null,line_id:l.line_id||l.payload?.LINE_ID||"",region:l.payload?.房屋區域||l.payload?.所在地區||"",address:l.payload?.房屋地址||"",required_amount:l.payload?.資金需求||"",loan_purpose:l.payload?.貸款需求||"",contact_time:l.payload?.方便聯絡時間||"",ip_address:l.ip_address||null,notes:l.notes||l.payload?.備註||""}),await de(),Xe(l),B.value=!0},ge=()=>{B.value=!1,G.value=null},Be=async()=>{if(G.value){v.value=!0;try{let l=i.page_url;if(i.website_domain&&i.website_domain!=="other"){const s=X.value.find(a=>a.domain===i.website_domain);s&&(l=s.url)}const e={channel:i.channel,status:i.status,email:i.email,line_id:i.line_id,ip_address:i.ip_address,assigned_to:i.assigned_to,notes:i.notes,payload:{頁面_URL:l,LINE_ID:i.line_id,房屋區域:i.region,房屋地址:i.address,資金需求:i.required_amount,貸款需求:i.loan_purpose,方便聯絡時間:i.contact_time,...m}},{error:d}=await ae(G.value,e);d?y(d?.message||"更新失敗"):(B.value=!1,await L(),D("進件資料更新成功"))}catch(l){y("系統錯誤，請稍後再試"),console.error("Update case error:",l)}finally{v.value=!1}}},Re=async l=>{if(await ke(`確定刪除編號 ${l.id} 的進件嗎？`))try{const{error:d}=await Le(l.id);d?y(d?.message||"刪除失敗"):(await L(),D(`編號 ${l.id} 的進件已刪除`))}catch(d){y("系統錯誤，請稍後再試"),console.error("Delete case error:",d)}},Ie=l=>{if(!l.customer_id){y("此進件尚未綁定客戶，請先建立/綁定客戶後再送件");return}K.value=l,Object.assign(V,{loan_amount:null,loan_type:"",notes:""}),R.value=!0},be=()=>{R.value=!1,K.value=null},He=async()=>{if(K.value)try{const{error:l}=await Ue(K.value.id,V);l?y(l?.message||"轉換失敗"):(R.value=!1,await L(),D("案件轉換成功"))}catch(l){y("系統錯誤，請稍後再試"),console.error("Convert case error:",l)}finally{v.value=!1}},Ge=l=>{N.value=l,E.assigned_to=l.assigned_to||null,I.value=!0},pe=()=>{I.value=!1,N.value=null,E.assigned_to=null},Ke=async()=>{if(!N.value||!E.assigned_to){y("請選擇承辦業務");return}v.value=!0;try{const{error:l}=await ae(N.value.id,{assigned_to:E.assigned_to});if(l)y(l?.message||"指派失敗");else{I.value=!1,await L();const e=W.value.find(d=>d.id===E.assigned_to);D(`已成功指派給 ${e?.name||"未知業務"}`)}}catch(l){y("系統錯誤，請稍後再試"),console.error("Assign case error:",l)}finally{v.value=!1}},Qe=l=>{x.value=l,C.display_name=l.line_user_info?.display_name||"",H.value=!0},ye=()=>{H.value=!1,x.value=null,C.display_name=""},Ye=async()=>{if(!x.value||!C.display_name?.trim()){y("名稱不能為空");return}v.value=!0;try{const{$api:l}=ut(),{data:e,error:d}=await l.put(`/cases/${x.value.id}/line-name`,{editable_name:C.display_name.trim()});!d&&e?.success?(x.value.line_user_info&&(x.value.line_user_info.display_name=C.display_name.trim(),x.value.line_user_info.editable_name=C.display_name.trim()),H.value=!1,await L(),D(`LINE用戶名稱已更新：${e.old_name} → ${e.new_name}`)):y(e?.message||d?.message||"更新失敗")}catch(l){y("更新失敗，請稍後再試"),console.error("Save LINE name error:",l)}finally{v.value=!1}},Je=async(l,e)=>{try{const{patch:d}=he(),{data:s,error:a}=await d(`/cases/${l.id}/case-status`,{case_status:e});if(a){y("更新案件狀態失敗");return}l.case_status=e;const w=ie.find(le=>le.value===e)?.label;D(`案件狀態已更新為：${w}`),await L(),await Ve()}catch(d){y("更新狀態失敗，請稍後再試"),console.error("Update case status error:",d)}},Xe=l=>{const e=l?.payload||{};P.value.forEach(d=>{const s=d.key;e&&Object.prototype.hasOwnProperty.call(e,s)?m[s]=e[s]:d.default_value?m[s]=d.default_value:m[s]=d.type==="multiselect"?[]:d.type==="boolean"?!1:""})},se=l=>{const e=new Date(l.created_at),d=e.getFullYear().toString().slice(-2),s=String(e.getMonth()+1).padStart(2,"0"),a=String(e.getDate()).padStart(2,"0"),w=String(l.id).padStart(3,"0");return`CASE${d}${s}${a}${w}`},me=l=>new Date(l).toLocaleDateString("zh-TW",{year:"numeric",month:"2-digit",day:"2-digit"}),fe=l=>new Date(l).toLocaleTimeString("zh-TW",{hour:"2-digit",minute:"2-digit"}),Ze=(l,e)=>e.type==="multiselect"?Array.isArray(l)?l.join(", "):l||"-":e.type==="boolean"?l?"是":"否":l??"-";return lt(async()=>{await Promise.all([Oe(),L(),de(),Te()])}),ot(()=>{clearTimeout(te)}),at({title:"有效客 - 貸款案件管理系統"}),(l,e)=>{const d=et;return r(),n("div",kt,[e[70]||(e[70]=t("div",{class:"flex items-center justify-between"},[t("div",null,[t("h1",{class:"text-3xl font-bold text-gray-900"},"追蹤管理"),t("p",{class:"text-gray-600 mt-2"},"顯示追蹤中的案件")])],-1)),b("",!0),q(dt,{title:"追蹤管理列表",columns:o(Ae),data:o(ue),loading:o(z),error:o(J),"search-query":o(j),"search-placeholder":"搜尋姓名/手機/Email/LINE/網站... (至少2個字符)","show-search-icon":!1,"current-page":o(T),"items-per-page":o(ee),"loading-text":"載入中...","empty-text":"沒有追蹤中案件",onSearch:Pe,onRefresh:L,onRetry:L,onPageChange:Fe,onPageSizeChange:Me},{filters:p(()=>[o(M).hasPermission&&o(M).hasPermission("customer_management")?g((r(),n("select",{key:0,"onUpdate:modelValue":e[0]||(e[0]=s=>rt(S)?S.value=s:null),class:"px-4 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500"},[e[20]||(e[20]=t("option",{value:"all"},"全部承辦",-1)),e[21]||(e[21]=t("option",{value:"null"},"未指派",-1)),(r(!0),n(h,null,k(o(W),s=>(r(),n("option",{key:s.id,value:s.id},u(s.name),9,Ct))),128))],512)),[[A,o(S)]]):b("",!0)]),actions:p(()=>[...e[22]||(e[22]=[])]),"cell-case_status":p(({item:s})=>[t("select",{value:s.case_status||"unassigned",onChange:a=>Je(s,a.target.value),class:"w-full px-1 py-0.5 text-xs border border-gray-300 rounded bg-white text-gray-900 focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500"},[(r(),n(h,null,k(ie,a=>t("option",{key:a.value,value:a.value},u(a.label),9,Ut)),64))],40,Lt)]),"cell-business_level":p(({item:s})=>[t("select",{value:s.business_level||"",onChange:a=>l.updateBusinessLevel(s,a.target.value),class:"w-full px-1 py-0.5 text-xs border border-gray-300 rounded bg-white text-gray-900 focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500"},[...e[23]||(e[23]=[t("option",{value:""},"請選擇",-1),t("option",{value:"A"},"A",-1),t("option",{value:"B"},"B",-1),t("option",{value:"C"},"C",-1)])],40,St)]),"cell-case_number":p(({item:s})=>[t("div",Nt,u(se(s)),1)]),"cell-website":p(({item:s})=>[t("div",Vt,u(o(re)(s)),1)]),"cell-channel":p(({item:s})=>[t("span",Et,u(s.channel==="wp_form"?"網站表單":s.channel==="lineoa"?"官方賴":s.channel==="email"?"Email":s.channel==="phone"?"電話":s.channel||"-"),1)]),"cell-datetime":p(({item:s})=>[t("div",null,[t("div",Dt,u(me(s.created_at)),1),t("div",jt,u(fe(s.created_at)),1)])]),"cell-assignee":p(({item:s})=>[t("div",$t,[t("span",qt,u(s.assignee?.name||"未指派"),1),!s.assignee&&o(M).hasPermission&&o(M).hasPermission("customer_management")?(r(),n("button",{key:0,onClick:a=>Ge(s),class:"inline-flex items-center justify-center w-6 h-6 text-blue-600 hover:text-white hover:bg-blue-600 rounded transition-colors duration-200 relative group",title:"指派業務"},[q(d,{name:"heroicons:user-plus",class:"w-4 h-4"}),e[24]||(e[24]=t("span",{class:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-2 py-1 text-xs text-white bg-gray-800 rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap"}," 指派業務 ",-1))],8,At)):b("",!0)])]),"cell-contact_info":p(({item:s})=>[t("div",null,[t("div",Ot,u(s.email||"未提供"),1),t("div",Tt,u(s.phone||"未提供"),1)])]),"cell-line_info":p(({item:s})=>[s.line_user_info&&s.is_line_user_id?(r(),n("div",Pt,[s.line_user_info.picture_url?(r(),n("img",{key:0,src:s.line_user_info.picture_url,alt:s.line_user_info.display_name||"LINE用戶",class:"w-6 h-6 rounded-full object-cover",onError:e[1]||(e[1]=a=>a.target.style.display="none")},null,40,Ft)):(r(),n("div",Mt," L ")),t("div",zt,[t("div",Wt,[t("span",Bt,u(s.line_user_info.display_name||"未設定名稱"),1),t("button",{onClick:a=>Qe(s),class:"text-blue-500 hover:text-blue-700 text-xs",title:"編輯LINE名稱"}," ✏️ ",8,Rt)])])])):s.line_id&&!s.is_line_user_id?(r(),n("div",It,[e[25]||(e[25]=t("div",{class:"w-6 h-6 rounded-full bg-gray-400 flex items-center justify-center text-white text-xs"}," @ ",-1)),t("span",Ht,u(s.line_id),1)])):(r(),n("div",Gt," 未綁定 "))]),"cell-location":p(({item:s})=>[t("div",null,[t("div",Kt,u(s.payload?.房屋區域||s.payload?.所在地區||"未提供"),1),t("div",Qt,u(s.payload?.房屋地址||""),1)])]),"cell-amount":p(({item:s})=>[t("span",Yt,u(s.payload?.資金需求||"未填寫"),1)]),"cell-purpose":p(({item:s})=>[t("span",Jt,u(s.payload?.貸款需求||"未填寫"),1)]),"cell-custom_fields":p(({item:s})=>[o(Q).length>0?(r(),n("div",Xt,[(r(!0),n(h,null,k(o(Q).slice(0,2),a=>(r(),n("div",{key:a.id,class:"text-xs"},[t("span",Zt,u(a.label)+":",1),t("span",es,u(Ze(s.payload?.[a.key],a)),1)]))),128)),o(Q).length>2?(r(),n("div",ts," +"+u(o(Q).length-2)+" 個欄位 ",1)):b("",!0)])):(r(),n("span",ss,"無自定義欄位"))]),"cell-actions":p(({item:s})=>[t("div",ls,[t("button",{onClick:a=>ze(s),class:"group relative inline-flex items-center justify-center p-2 text-blue-600 hover:text-white hover:bg-blue-600 rounded-lg transition-all duration-200",title:"查看詳情"},[q(o(_t),{class:"w-4 h-4"}),e[26]||(e[26]=t("div",{class:"absolute bottom-full mb-2 hidden group-hover:block px-2 py-1 text-xs text-white bg-gray-900 rounded whitespace-nowrap z-10"}," 查看詳情 ",-1))],8,os),t("button",{onClick:a=>We(s),class:"group relative inline-flex items-center justify-center p-2 text-gray-600 hover:text-white hover:bg-gray-600 rounded-lg transition-all duration-200",title:"編輯"},[q(o(ct),{class:"w-4 h-4"}),e[27]||(e[27]=t("div",{class:"absolute bottom-full mb-2 hidden group-hover:block px-2 py-1 text-xs text-white bg-gray-900 rounded whitespace-nowrap z-10"}," 編輯 ",-1))],8,as),s.customer_id?(r(),n("button",{key:0,onClick:a=>Ie(s),class:"group relative inline-flex items-center justify-center p-2 text-purple-600 hover:text-white hover:bg-purple-600 rounded-lg transition-all duration-200",title:"轉送件"},[q(o(wt),{class:"w-4 h-4"}),e[28]||(e[28]=t("div",{class:"absolute bottom-full mb-2 hidden group-hover:block px-2 py-1 text-xs text-white bg-gray-900 rounded whitespace-nowrap z-10"}," 轉送件 ",-1))],8,ns)):b("",!0),t("button",{onClick:a=>Re(s),class:"group relative inline-flex items-center justify-center p-2 text-red-600 hover:text-white hover:bg-red-600 rounded-lg transition-all duration-200",title:"刪除"},[q(o(ht),{class:"w-4 h-4"}),e[29]||(e[29]=t("div",{class:"absolute bottom-full mb-2 hidden group-hover:block px-2 py-1 text-xs text-white bg-gray-900 rounded whitespace-nowrap z-10"}," 刪除 ",-1))],8,rs)])]),_:1},8,["columns","data","loading","error","search-query","current-page","items-per-page"]),o(B)?(r(),n("div",{key:1,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 mt-0",onClick:U(ge,["self"])},[t("div",is,[e[46]||(e[46]=t("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"編輯進件",-1)),t("form",{onSubmit:U(Be,["prevent"]),class:"space-y-3"},[t("div",us,[t("div",null,[e[32]||(e[32]=t("label",{class:"block text-sm font-semibold text-gray-900 mb-1"},"網站",-1)),g(t("select",{"onUpdate:modelValue":e[2]||(e[2]=s=>o(i).website_domain=s),class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},[e[30]||(e[30]=t("option",{value:""},"請選擇網站",-1)),(r(!0),n(h,null,k(o(ne),s=>(r(),n("option",{key:s.value,value:s.value},u(s.label),9,ds))),128)),e[31]||(e[31]=t("option",{value:"other"},"其他（手動輸入）",-1))],512),[[A,o(i).website_domain]]),o(i).website_domain==="other"?g((r(),n("input",{key:0,"onUpdate:modelValue":e[3]||(e[3]=s=>o(i).page_url=s),placeholder:"請輸入完整的網址",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 mt-2"},null,512)),[[f,o(i).page_url]]):b("",!0)]),t("div",null,[e[33]||(e[33]=t("label",{class:"block text-sm font-semibold text-gray-900 mb-1"},"來源管道",-1)),g(t("select",{"onUpdate:modelValue":e[4]||(e[4]=s=>o(i).channel=s),class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},[(r(),n(h,null,k($e,s=>t("option",{key:s.value,value:s.value},u(s.label),9,cs)),64))],512),[[A,o(i).channel]])]),t("div",null,[e[34]||(e[34]=t("label",{class:"block text-sm font-semibold text-gray-900 mb-1"},"案件狀態",-1)),g(t("select",{"onUpdate:modelValue":e[5]||(e[5]=s=>o(i).status=s),class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},[(r(),n(h,null,k(qe,s=>t("option",{key:s.value,value:s.value},u(s.label),9,gs)),64))],512),[[A,o(i).status]])]),t("div",null,[e[35]||(e[35]=t("label",{class:"block text-sm font-semibold text-gray-900 mb-1"},"時間",-1)),g(t("input",{"onUpdate:modelValue":e[6]||(e[6]=s=>o(i).created_at=s),type:"datetime-local",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,512),[[f,o(i).created_at]])]),t("div",null,[e[36]||(e[36]=t("label",{class:"block text-sm font-semibold text-gray-900 mb-1"},"Email",-1)),g(t("input",{"onUpdate:modelValue":e[7]||(e[7]=s=>o(i).email=s),type:"email",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,512),[[f,o(i).email]])]),t("div",null,[e[37]||(e[37]=t("label",{class:"block text-sm font-semibold text-gray-900 mb-1"},"LINE ID",-1)),g(t("input",{"onUpdate:modelValue":e[8]||(e[8]=s=>o(i).line_id=s),class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,512),[[f,o(i).line_id]])]),t("div",null,[e[38]||(e[38]=t("label",{class:"block text-sm font-semibold text-gray-900 mb-1"},"地區",-1)),g(t("input",{"onUpdate:modelValue":e[9]||(e[9]=s=>o(i).region=s),class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,512),[[f,o(i).region]])]),t("div",null,[e[39]||(e[39]=t("label",{class:"block text-sm font-semibold text-gray-900 mb-1"},"地址",-1)),g(t("input",{"onUpdate:modelValue":e[10]||(e[10]=s=>o(i).address=s),class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,512),[[f,o(i).address]])]),t("div",null,[e[40]||(e[40]=t("label",{class:"block text-sm font-semibold text-gray-900 mb-1"},"需求金額",-1)),g(t("input",{"onUpdate:modelValue":e[11]||(e[11]=s=>o(i).required_amount=s),type:"number",min:"0",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,512),[[f,o(i).required_amount,void 0,{number:!0}]])]),t("div",null,[e[41]||(e[41]=t("label",{class:"block text-sm font-semibold text-gray-900 mb-1"},"諮詢項目",-1)),g(t("input",{"onUpdate:modelValue":e[12]||(e[12]=s=>o(i).loan_purpose=s),class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,512),[[f,o(i).loan_purpose]])]),t("div",bs,[e[42]||(e[42]=t("label",{class:"block text-sm font-semibold text-gray-900 mb-1"},"備註",-1)),g(t("textarea",{"onUpdate:modelValue":e[13]||(e[13]=s=>o(i).notes=s),rows:"2",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,512),[[f,o(i).notes]])]),o(P).length?(r(),n("div",ps,[e[45]||(e[45]=t("div",{class:"text-sm font-semibold mb-2"},"自定義欄位（案件）",-1)),t("div",ys,[(r(!0),n(h,null,k(o(P),s=>(r(),n("div",{key:s.id},[t("label",ms,[O(u(s.label)+" ",1),s.is_required?(r(),n("span",fs,"*")):b("",!0)]),["text","number","decimal","date"].includes(s.type)?g((r(),n("input",{key:0,type:s.type==="decimal"||s.type==="number"?"number":s.type==="date"?"date":"text",step:s.type==="decimal"?"any":void 0,class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:s.is_required,"onUpdate:modelValue":a=>o(m)[s.key]=a},null,8,xs)),[[it,o(m)[s.key]]]):s.type==="textarea"?g((r(),n("textarea",{key:1,class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:s.is_required,"onUpdate:modelValue":a=>o(m)[s.key]=a},null,8,vs)),[[f,o(m)[s.key]]]):s.type==="select"?g((r(),n("select",{key:2,class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:s.is_required,"onUpdate:modelValue":a=>o(m)[s.key]=a},[e[43]||(e[43]=t("option",{value:""},"請選擇",-1)),(r(!0),n(h,null,k(s.options||[],a=>(r(),n("option",{key:a,value:a},u(a),9,ws))),128))],8,_s)),[[A,o(m)[s.key]]]):s.type==="multiselect"?(r(),n("div",hs,[t("div",ks,[(r(!0),n(h,null,k(s.options||[],a=>(r(),n("label",{key:a,class:"inline-flex items-center"},[g(t("input",{type:"checkbox",value:a,"onUpdate:modelValue":w=>o(m)[s.key]=w,class:"mr-2"},null,8,Cs),[[we,o(m)[s.key]]]),t("span",null,u(a),1)]))),128))])])):s.type==="boolean"?(r(),n("label",Ls,[g(t("input",{type:"checkbox","onUpdate:modelValue":a=>o(m)[s.key]=a},null,8,Us),[[we,o(m)[s.key]]]),e[44]||(e[44]=t("span",null,"是/否",-1))])):b("",!0)]))),128))])])):b("",!0)]),t("div",Ss,[t("button",{type:"button",class:"px-4 py-2 border border-gray-300 rounded-lg",onClick:ge},"取消"),t("button",{type:"submit",class:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",disabled:o(v)},u(o(v)?"儲存中...":"儲存"),9,Ns)])],32)])])):b("",!0),o(Z)?(r(),n("div",{key:2,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 mt-0",onClick:U(ce,["self"])},[t("div",Vs,[t("div",{class:"flex justify-between items-center mb-4"},[e[47]||(e[47]=t("h3",{class:"text-lg font-semibold text-gray-900"},"案件詳情",-1)),t("button",{onClick:ce,class:"text-gray-400 hover:text-gray-600"}," ✕ ")]),o(_)?(r(),n("div",Es,[t("div",Ds,[t("div",null,[e[48]||(e[48]=t("label",{class:"block text-sm font-medium text-gray-700"},"網站",-1)),t("p",js,u(o(re)(o(_))),1)]),t("div",null,[e[49]||(e[49]=t("label",{class:"block text-sm font-medium text-gray-700"},"來源管道",-1)),t("p",$s,u(o(_).channel||"wp_form"),1)]),t("div",null,[e[50]||(e[50]=t("label",{class:"block text-sm font-medium text-gray-700"},"時間",-1)),t("p",qs,u(me(o(_).created_at))+" "+u(fe(o(_).created_at)),1)]),t("div",null,[e[51]||(e[51]=t("label",{class:"block text-sm font-medium text-gray-700"},"承辦業務",-1)),t("p",As,u(o(_).assignee?.name||"未指派"),1)]),t("div",null,[e[52]||(e[52]=t("label",{class:"block text-sm font-medium text-gray-700"},"Email",-1)),t("p",Os,u(o(_).email||"未提供"),1)]),t("div",null,[e[53]||(e[53]=t("label",{class:"block text-sm font-medium text-gray-700"},"LINE ID",-1)),t("p",Ts,u(o(_).line_id||"未提供"),1)])]),o(_).notes?(r(),n("div",Ps,[e[54]||(e[54]=t("label",{class:"block text-sm font-medium text-gray-700"},"備註",-1)),t("p",Fs,u(o(_).notes),1)])):b("",!0)])):b("",!0)])])):b("",!0),o(R)?(r(),n("div",{key:3,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 mt-0",onClick:U(be,["self"])},[t("div",Ms,[e[59]||(e[59]=t("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"送件（建立案件）",-1)),t("form",{onSubmit:U(He,["prevent"]),class:"space-y-3"},[t("div",zs,[t("div",null,[e[55]||(e[55]=t("label",{class:"block text-sm font-semibold text-gray-900 mb-1"},"貸款金額",-1)),g(t("input",{"onUpdate:modelValue":e[14]||(e[14]=s=>o(V).loan_amount=s),required:"",type:"number",min:"0",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,512),[[f,o(V).loan_amount,void 0,{number:!0}]])]),t("div",null,[e[56]||(e[56]=t("label",{class:"block text-sm font-semibold text-gray-900 mb-1"},"貸款類型",-1)),g(t("input",{"onUpdate:modelValue":e[15]||(e[15]=s=>o(V).loan_type=s),class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,512),[[f,o(V).loan_type]])]),t("div",Ws,[e[57]||(e[57]=t("label",{class:"block text-sm font-semibold text-gray-900 mb-1"},"備註",-1)),g(t("textarea",{"onUpdate:modelValue":e[16]||(e[16]=s=>o(V).notes=s),rows:"2",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,512),[[f,o(V).notes]])])]),t("div",{class:"flex justify-end space-x-3 pt-2"},[t("button",{type:"button",class:"px-4 py-2 border border-gray-300 rounded-lg",onClick:be},"取消"),e[58]||(e[58]=t("button",{type:"submit",class:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700"},"送件",-1))])],32)])])):b("",!0),o(I)?(r(),n("div",{key:4,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 mt-0",onClick:U(pe,["self"])},[t("div",Bs,[e[66]||(e[66]=t("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"指派承辦業務",-1)),t("form",{onSubmit:U(Ke,["prevent"]),class:"space-y-4"},[o(N)?(r(),n("div",Rs,[e[63]||(e[63]=t("div",{class:"text-sm text-gray-900 font-semibold mb-2"},"案件資訊：",-1)),t("div",Is,[t("div",Hs,[e[60]||(e[60]=t("span",{class:"font-medium"},"案件編號：",-1)),O(u(se(o(N))),1)]),t("div",Gs,[e[61]||(e[61]=t("span",{class:"font-medium"},"Email：",-1)),O(u(o(N).email||"未提供"),1)]),t("div",Ks,[e[62]||(e[62]=t("span",{class:"font-medium"},"LINE ID：",-1)),O(u(o(N).line_id||"未提供"),1)])])])):b("",!0),t("div",null,[e[65]||(e[65]=t("label",{class:"block text-sm font-semibold text-gray-900 mb-2"},[O("選擇承辦業務 "),t("span",{class:"text-red-500"},"*")],-1)),g(t("select",{"onUpdate:modelValue":e[17]||(e[17]=s=>o(E).assigned_to=s),required:"",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},[e[64]||(e[64]=t("option",{value:""},"請選擇業務人員",-1)),(r(!0),n(h,null,k(o(W).filter(s=>s.roles?.[0]?.name==="staff"),s=>(r(),n("option",{key:s.id,value:s.id},u(s.name||s.email)+" (業務) ",9,Qs))),128))],512),[[A,o(E).assigned_to]])]),t("div",Ys,[t("button",{type:"button",class:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50",onClick:pe}," 取消 "),t("button",{type:"submit",class:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",disabled:o(v)||!o(E).assigned_to},u(o(v)?"指派中...":"確認指派"),9,Js)])],32)])])):b("",!0),o(H)?(r(),n("div",{key:5,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 mt-0",onClick:U(ye,["self"])},[t("div",Xs,[e[69]||(e[69]=t("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"編輯LINE名稱",-1)),t("form",{onSubmit:U(Ye,["prevent"]),class:"space-y-4"},[o(x)?(r(),n("div",Zs,[e[67]||(e[67]=t("div",{class:"text-sm text-gray-900 font-semibold mb-2"},"LINE使用者資訊：",-1)),t("div",el,[o(x).line_user_info?.picture_url?(r(),n("img",{key:0,src:o(x).line_user_info.picture_url,alt:o(x).line_user_info.display_name||"LINE用戶",class:"w-10 h-10 rounded-full object-cover",onError:e[18]||(e[18]=s=>s.target.style.display="none")},null,40,tl)):(r(),n("div",sl," L ")),t("div",null,[t("div",ll,u(o(x).line_user_info?.display_name||"未設定名稱"),1),t("div",ol,"案件編號："+u(se(o(x))),1)])])])):b("",!0),t("div",null,[e[68]||(e[68]=t("label",{class:"block text-sm font-semibold text-gray-900 mb-2"},[O("LINE名稱 "),t("span",{class:"text-red-500"},"*")],-1)),g(t("input",{"onUpdate:modelValue":e[19]||(e[19]=s=>o(C).display_name=s),required:"",maxlength:"100",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"請輸入LINE名稱"},null,512),[[f,o(C).display_name]])]),t("div",al,[t("button",{type:"button",class:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50",onClick:ye}," 取消 "),t("button",{type:"submit",class:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",disabled:o(v)||!o(C).display_name?.trim()},u(o(v)?"儲存中...":"儲存"),9,nl)])],32)])])):b("",!0)])}}},Ll=tt(rl,[["__scopeId","data-v-d83146d0"]]);export{Ll as default};
