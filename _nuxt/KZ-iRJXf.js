import Ae from"./BNIY59VZ.js";import{r as m,H as Fe,y as be,i as fe,c as a,o as n,a as e,g,v as f,d as s,I as $,G as Oe,x as y,F as I,q as N,t as i,A as ie,f as E,b as Q,u as ze,e as w,k as C,E as De,s as ae,j as Re}from"#entry";import{_ as J}from"./wdgW8CHO.js";import{a as Be,u as We}from"./DgLT0ASK.js";import{_ as He,r as Ge}from"./CRGlAI26.js";import{u as Qe,f as Je}from"./CdwAlNvG.js";import{u as Ke}from"./BtlpaPqX.js";import{u as Xe}from"./7WFD-W98.js";import{r as Ye}from"./BKE9UY2T.js";import{r as Ze}from"./D4TV4JXr.js";import{r as et}from"./c8JhvyFk.js";import{r as tt}from"./UqRq4KLf.js";import"./91ekCI0b.js";import"./wUKDeqpb.js";import"./CGjWf7d3.js";import"./nS2KoPbh.js";import"./Ca9-rUq1.js";import"./DLM5oWup.js";import"./Bm92f-5u.js";import"./CxIZtCgj.js";import"./mGL09qS9.js";import"./mD2okE1y.js";import"./0es6LyBp.js";import"./EQ4Iz6fV.js";import"./DdngC8ig.js";import"./DW5NWq0j.js";import"./DBrhDGOf.js";import"./BSBtNZZQ.js";import"./Bi0YyG7H.js";import"./CQZt9cKZ.js";import"./B5My0XuL.js";import"./CKtbBPOe.js";const st={class:"p-4"},lt={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ot={class:"md:col-span-2"},rt=["value"],nt={class:"md:col-span-2"},at={class:"flex justify-end space-x-3"},it={__name:"CustomerForm",props:{modelValue:{type:Object,default:()=>({})}},emits:["save","cancel"],setup(ue,{emit:h}){const M=ue,k=h,F=m([]),_=m(""),c=Fe({id:null,name:"",phone:"",email:"",region:"",address:"",channel:"wp_form",website_source:"",notes:""});be(()=>M.modelValue,p=>{Object.assign(c,{id:p?.id??null,name:p?.name??"",phone:p?.phone??"",email:p?.email??"",region:p?.region??"",address:p?.address??"",channel:p?.channel??"wp_form",website_source:p?.website_source??"",notes:p?.notes??""})},{immediate:!0});const{get:K}=Be(),X=async()=>{try{const{data:p,error:r}=await K("/websites/options");if(r){console.error("載入網站選項失敗:",r);return}F.value=p||[]}catch(p){console.error("載入網站選項失敗:",p)}},Y=()=>{_.value.trim()&&(c.website_source=_.value.trim(),_.value="")},Z=()=>{k("save",{...c})};return fe(()=>{X()}),(p,r)=>(n(),a("div",st,[e("form",{onSubmit:E(Z,["prevent"]),class:"space-y-4"},[e("div",lt,[e("div",null,[r[10]||(r[10]=e("label",{class:"block text-sm font-medium mb-1"},"姓名",-1)),g(e("input",{"onUpdate:modelValue":r[0]||(r[0]=u=>s(c).name=u),type:"text",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:""},null,512),[[f,s(c).name]])]),e("div",null,[r[11]||(r[11]=e("label",{class:"block text-sm font-medium mb-1"},"手機號碼",-1)),g(e("input",{"onUpdate:modelValue":r[1]||(r[1]=u=>s(c).phone=u),type:"text",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:""},null,512),[[f,s(c).phone]])]),e("div",null,[r[12]||(r[12]=e("label",{class:"block text-sm font-medium mb-1"},"Email",-1)),g(e("input",{"onUpdate:modelValue":r[2]||(r[2]=u=>s(c).email=u),type:"email",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,512),[[f,s(c).email]])]),e("div",null,[r[13]||(r[13]=e("label",{class:"block text-sm font-medium mb-1"},"所在地區",-1)),g(e("input",{"onUpdate:modelValue":r[3]||(r[3]=u=>s(c).region=u),type:"text",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,512),[[f,s(c).region]])]),e("div",ot,[r[14]||(r[14]=e("label",{class:"block text-sm font-medium mb-1"},"地址",-1)),g(e("input",{"onUpdate:modelValue":r[4]||(r[4]=u=>s(c).address=u),type:"text",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,512),[[f,s(c).address]])]),e("div",null,[r[16]||(r[16]=e("label",{class:"block text-sm font-medium mb-1"},"來源管道",-1)),g(e("select",{"onUpdate:modelValue":r[5]||(r[5]=u=>s(c).channel=u),class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},[...r[15]||(r[15]=[Oe('<option value="">未指定</option><option value="wp_form">網站表單</option><option value="line">官方賴</option><option value="email">Email</option><option value="phone_call">電話</option>',5)])],512),[[$,s(c).channel]])]),e("div",null,[r[19]||(r[19]=e("label",{class:"block text-sm font-medium mb-1"},"網站來源 (domain)",-1)),g(e("select",{"onUpdate:modelValue":r[6]||(r[6]=u=>s(c).website_source=u),class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},[r[17]||(r[17]=e("option",{value:""},"請選擇網站",-1)),(n(!0),a(I,null,N(s(F),u=>(n(),a("option",{key:u.id,value:u.domain},i(u.name)+" ("+i(u.domain)+") ",9,rt))),128)),r[18]||(r[18]=e("option",{value:"_custom"},"手動輸入...",-1))],512),[[$,s(c).website_source]]),s(c).website_source==="_custom"?g((n(),a("input",{key:0,"onUpdate:modelValue":r[7]||(r[7]=u=>ie(_)?_.value=u:null),type:"text",placeholder:"請輸入域名...",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 mt-2",onBlur:Y},null,544)),[[f,s(_)]]):y("",!0)]),e("div",nt,[r[20]||(r[20]=e("label",{class:"block text-sm font-medium mb-1"},"備註",-1)),g(e("textarea",{"onUpdate:modelValue":r[8]||(r[8]=u=>s(c).notes=u),rows:"3",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,512),[[f,s(c).notes]])])]),e("div",at,[e("button",{type:"button",class:"px-4 py-2 rounded border",onClick:r[9]||(r[9]=u=>p.$emit("cancel"))},"取消"),r[21]||(r[21]=e("button",{type:"submit",class:"px-4 py-2 rounded bg-blue-600 text-white"},"儲存",-1))])],32)]))}},ut={class:"space-y-6"},dt={class:"flex items-center justify-between"},ct={class:"text-gray-600 mt-2"},mt={key:0},gt={key:1},pt={class:"grid grid-cols-1 md:grid-cols-4 gap-6"},bt=["value"],ft={class:"flex items-center"},xt={class:"flex-shrink-0 w-10 h-10"},yt=["src","alt"],vt={class:"ml-4"},wt={class:"text-sm font-medium text-gray-900"},ht={class:"text-sm text-gray-500"},kt={class:"text-sm text-gray-900"},Ct={class:"text-sm text-gray-500"},_t={key:1,class:"text-xs text-gray-400"},Vt={class:"flex items-center space-x-2"},Ut={key:0,class:"flex items-center space-x-1"},St={key:1,class:"flex items-center space-x-1"},Et=["onClick"],$t={class:"flex items-center space-x-2 justify-end"},Mt=["onClick"],jt=["onClick"],It=["onClick"],Nt=["onClick"],Pt={class:"bg-white rounded-lg p-6 w-full max-w-md mx-4"},Lt=["value"],Tt={class:"flex justify-end space-x-3 pt-4"},qt=["disabled"],At={class:"bg-white rounded-lg p-6 w-full max-w-md mx-4"},Ft=["value"],Ot=["value"],zt={class:"flex justify-end space-x-3 pt-4"},Dt=["disabled"],Rt={class:"bg-white rounded-lg p-6 w-full max-w-2xl mx-4 max-h-[90vh] overflow-y-auto"},Bt={key:0,class:"space-y-4"},Wt={class:"grid grid-cols-2 gap-4"},Ht={class:"text-gray-900"},Gt={class:"text-gray-900"},Qt={class:"text-gray-900"},Jt={class:"text-gray-900"},Kt={class:"text-gray-900"},Xt={class:"text-gray-900"},Yt={key:0,class:"text-xs text-gray-500"},Zt={class:"text-gray-900"},es={key:0},ts={class:"text-gray-900 whitespace-pre-wrap"},ss={class:"bg-white rounded-lg p-6 w-full max-w-md mx-4"},ls={key:0,class:"space-y-4"},os={class:"block text-sm font-medium text-gray-700 mb-1"},rs={class:"block text-sm font-medium text-gray-700 mb-1"},ns={class:"block text-sm font-medium text-gray-700 mb-1"},as=["value"],is={key:0,class:"text-sm text-red-500 mt-1"},us={class:"flex justify-end space-x-3 pt-4"},ds=["disabled"],Rs={__name:"index",setup(ue){const h=We(),{success:M,error:k}=Ke(),{getCustomers:F,checkLineFriendStatus:_,getStatusOptions:c,createCustomer:K,updateCustomer:X,deleteCustomer:Y,assignCustomer:Z}=Qe(),{getUsers:p}=Xe(),r=m(""),u=m(""),ee=m(!1),O=m(null),j=m([]),P=m({total:0,active:0,new:0,conversionRate:0}),te=m(!1),se=m(!1),le=m(!1),oe=m(!1),z=m(null),x=m(null),S=m(null),D=m(!1),R=m(!1),B=m(!1),de=m(!1),L=m([]),V=m(""),xe=o=>{switch(o){case"submitted":return"已送件";case"approved":return"已核准";case"rejected":return"已婉拒";case"disbursed":return"已撥款";default:return o}},ye=o=>{switch(o){case"submitted":return"bg-blue-100 text-blue-800";case"approved":return"bg-green-100 text-green-800";case"rejected":return"bg-red-100 text-red-800";case"disbursed":return"bg-purple-100 text-purple-800";default:return"bg-gray-100 text-gray-800"}},d=m({name:"",phone:"",email:"",region:"",website_source:"",channel:"",notes:"",assigned_to:null,status:"new"}),ce=[{value:"wp_form",label:"網站表單"},{value:"lineoa",label:"官方LINE"},{value:"email",label:"Email"},{value:"phone",label:"專線"}],U=async()=>{ee.value=!0,O.value=null;try{const o={};r.value.trim()&&(o.search=r.value.trim()),u.value&&(o.status=u.value);const{data:t,error:b}=await F(o);if(b){O.value=b.message;return}j.value=t.data||[];const l=j.value.length,v=j.value.filter(A=>["new","contacted","interested"].includes(A.status)).length,Te=j.value.filter(A=>A.status==="new").length,qe=j.value.filter(A=>A.status==="converted").length;P.value={total:l,active:v,new:Te,conversionRate:l>0?Math.round(qe/l*100):0}}catch(o){O.value="載入客戶數據失敗",console.error("Load customers error:",o)}finally{ee.value=!1}},re=Q(()=>j.value),W=m(1),T=m(5);Q(()=>Math.ceil(re.value.length/T.value)),Q(()=>{const o=(W.value-1)*T.value,t=o+T.value;return re.value.slice(o,t)});const ve=Q(()=>{const o=[{key:"customer_info",title:"客戶資訊",sortable:!1,width:"250px"},{key:"contact_info",title:"聯絡方式",sortable:!1,width:"200px"},{key:"status",title:"狀態",sortable:!0,width:"120px"},{key:"case_status",title:"案件狀態",sortable:!0,width:"120px"},{key:"line_status",title:"LINE 狀態",sortable:!1,width:"120px"},{key:"updated_at",title:"最後聯絡",sortable:!0,width:"140px",formatter:Je.date}];return h.isSales||o.push({key:"assigned_user",title:"負責業務",sortable:!0,width:"120px"}),o.push({key:"actions",title:"操作",sortable:!1,width:"200px"}),o}),we=o=>{r.value=o},he=o=>{W.value=o},ke=o=>{T.value=o,W.value=1},Ce=async o=>{try{const{data:t,error:b}=await _(o.id);if(b){console.error("檢查LINE好友狀態失敗:",b.message);return}console.log("LINE好友狀態檢查結果:",t)}catch(t){console.error("檢查LINE好友狀態錯誤:",t)}};let ne=null;be([r,u],()=>{ne&&clearTimeout(ne),ne=setTimeout(()=>{U()},300)});const _e=()=>{d.value={name:"",phone:"",email:"",region:"",website_source:"",channel:"wp_form",notes:"",assigned_to:null,status:"new"},te.value=!0},q=()=>{te.value=!1},Ve=o=>{z.value=o,d.value={name:o.name||"",phone:o.phone||"",email:o.email||"",region:o.region||"",website_source:o.website_source||"",channel:o.channel||"wp_form",notes:o.notes||"",assigned_to:o.assigned_to,status:o.status||"new"},se.value=!0},H=()=>{se.value=!1,z.value=null},Ue=o=>{x.value=o,le.value=!0},Se=o=>{Ve(o)},me=()=>{le.value=!1,x.value=null},Ee=async o=>{S.value=o,V.value="",await $e(),oe.value=!0},G=()=>{oe.value=!1,S.value=null,V.value=""},$e=async()=>{try{console.log("開始載入業務人員列表...");const{success:o,users:t,error:b}=await p({role:"staff"});if(console.log("API 回應:",{success:o,users:t,error:b}),!o||b){console.error("載入業務人員失敗:",b?.message||"未知錯誤");return}L.value=t||[],console.log("載入的業務人員:",L.value)}catch(o){console.error("載入業務人員錯誤:",o)}},Me=async()=>{if(S.value){B.value=!0;try{const o=V.value==="null"?null:V.value,{data:t,error:b}=await Z(S.value.id,o);if(b){await k("指派業務失敗："+b.message);return}await M("指派業務成功"),G(),U()}catch(o){console.error("指派業務錯誤:",o),await k("指派業務時發生錯誤")}finally{B.value=!1}}},je=o=>{confirm(`確定要刪除客戶「${o.name}」嗎？此操作無法復原。`)&&Ie(o)},Ie=async o=>{de.value=!0;try{const{data:t,error:b}=await Y(o.id);if(b){await k("刪除客戶失敗："+b.message);return}await M("客戶刪除成功"),U()}catch(t){console.error("刪除客戶錯誤:",t),await k("刪除客戶時發生錯誤")}finally{de.value=!1}},Ne=async()=>{D.value=!0;try{const{data:o,error:t}=await K(d.value);if(t){await k("創建客戶失敗："+t.message);return}await M("客戶創建成功"),q(),U()}catch(o){console.error("Create customer error:",o),await k("創建客戶時發生錯誤")}finally{D.value=!1}},Pe=async()=>{if(z.value){R.value=!0;try{const{data:o,error:t}=await X(z.value.id,d.value);if(t){await k("更新客戶失敗："+t.message);return}await M("客戶更新成功"),H(),U()}catch(o){console.error("Update customer error:",o),await k("更新客戶時發生錯誤")}finally{R.value=!1}}},ge=o=>{const t={new:"bg-blue-100 text-blue-800",contacted:"bg-yellow-100 text-yellow-800",interested:"bg-green-100 text-green-800",not_interested:"bg-red-100 text-red-800",invalid:"bg-gray-100 text-gray-800",converted:"bg-purple-100 text-purple-800"};return t[o]||t.new},pe=o=>c()[o]||"未知",Le=o=>new Date(o).toLocaleDateString("zh-TW",{year:"numeric",month:"short",day:"numeric"});return fe(()=>{U()}),ze({title:"客戶管理 - 貸款案件管理系統"}),(o,t)=>{const b=Ae;return n(),a("div",ut,[e("div",dt,[e("div",null,[t[16]||(t[16]=e("h1",{class:"text-3xl font-bold text-gray-900"},"客戶資料管理",-1)),e("p",ct,[s(h).isSales?(n(),a("span",mt,"您的客戶清單")):(n(),a("span",gt,"所有客戶資料總覽"))])]),w(b,{modelValue:o.createModalOpen,"onUpdate:modelValue":t[0]||(t[0]=l=>o.createModalOpen=l)},{default:C(()=>[w(it,{"model-value":o.editing||{},onSave:o.handleSave,onCancel:q},null,8,["model-value","onSave"])]),_:1},8,["modelValue"])]),e("div",pt,[w(J,{title:"總客戶數",value:s(P).total,description:"系統中的客戶總數",icon:"UserGroupIcon",iconColor:"blue",trend:5.2},null,8,["value"]),w(J,{title:"活躍客戶",value:s(P).active,description:"近30天有互動",icon:"CheckCircleIcon",iconColor:"green",trend:12.3,progress:78},null,8,["value"]),w(J,{title:"新增客戶",value:s(P).new,description:"本月新增",icon:"PlusIcon",iconColor:"yellow",trend:8.1},null,8,["value"]),s(h).isSales?y("",!0):(n(),De(J,{key:0,title:"轉換率",value:s(P).conversionRate,format:"percentage",description:"潛在客戶轉換率",icon:"ChartBarIcon",iconColor:"purple",trend:-2.4,progress:65},null,8,["value"]))]),w(He,{title:"客戶清單",columns:s(ve),data:s(re),loading:s(ee),error:s(O),"search-query":s(r),"search-placeholder":"搜尋客戶...","current-page":s(W),"items-per-page":s(T),"loading-text":"載入中...","empty-text":"沒有客戶資料",onSearch:we,onRefresh:U,onRetry:U,onPageChange:he,onPageSizeChange:ke},{filters:C(()=>[g(e("select",{"onUpdate:modelValue":t[1]||(t[1]=l=>ie(u)?u.value=l:null),class:"px-4 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500"},[t[17]||(t[17]=e("option",{value:""},"所有狀態",-1)),(n(!0),a(I,null,N(s(c)(),(l,v)=>(n(),a("option",{key:v,value:v},i(l),9,bt))),128))],512),[[$,s(u)]])]),actions:C(()=>[s(h).hasPermission("customer_management")?(n(),a("button",{key:0,onClick:_e,class:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors duration-200 flex items-center space-x-2"},[w(s(tt),{class:"w-5 h-5"}),t[18]||(t[18]=e("span",null,"新增客戶",-1))])):y("",!0)]),"cell-customer_info":C(({item:l})=>[e("div",ft,[e("div",xt,[e("img",{src:`https://ui-avatars.com/api/?name=${l.name}&background=6366f1&color=fff`,alt:l.name,class:"w-10 h-10 rounded-full"},null,8,yt)]),e("div",vt,[e("div",wt,i(l.name),1),e("div",ht,i(l.region||"未填寫地區"),1)])])]),"cell-contact_info":C(({item:l})=>[e("div",null,[e("div",kt,i(l.email||"未提供"),1),e("div",Ct,i(l.phone),1)])]),"cell-status":C(({item:l})=>[e("span",{class:ae(["inline-flex px-2 py-1 text-xs font-semibold rounded-full",ge(l.status)])},i(pe(l.status)),3)]),"cell-case_status":C(({item:l})=>[l.case_status?(n(),a("span",{key:0,class:ae(["inline-flex px-2 py-1 text-xs font-semibold rounded-full",ye(l.case_status)])},i(xe(l.case_status)),3)):(n(),a("span",_t,"無案件"))]),"cell-line_status":C(({item:l})=>[e("div",Vt,[l.line_user_id?(n(),a("div",Ut,[...t[19]||(t[19]=[e("div",{class:"w-2 h-2 bg-green-400 rounded-full"},null,-1),e("span",{class:"text-xs text-green-600"},"已綁定",-1)])])):(n(),a("div",St,[...t[20]||(t[20]=[e("div",{class:"w-2 h-2 bg-gray-300 rounded-full"},null,-1),e("span",{class:"text-xs text-gray-500"},"未綁定",-1)])])),l.line_user_id?(n(),a("button",{key:2,onClick:v=>Ce(l),class:"text-xs text-blue-600 hover:text-blue-800",title:"檢查好友狀態"}," 檢查 ",8,Et)):y("",!0)])]),"cell-assigned_user":C(({item:l})=>[e("span",null,i(l.assigned_user?.name||"未分配"),1)]),"cell-actions":C(({item:l})=>[e("div",$t,[e("button",{onClick:v=>Ue(l),class:"p-2 text-blue-600 hover:text-blue-800 hover:bg-blue-50 rounded-lg transition-all duration-200 group relative",title:"查看客戶詳情"},[w(s(Ye),{class:"w-4 h-4"}),t[21]||(t[21]=e("span",{class:"absolute -top-8 left-1/2 transform -translate-x-1/2 bg-gray-800 text-white text-xs px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap"}," 查看 ",-1))],8,Mt),s(h).hasPermission("customer_management")||l.assigned_to===s(h).user?.id?(n(),a("button",{key:0,onClick:v=>Se(l),class:"p-2 text-gray-600 hover:text-gray-800 hover:bg-gray-50 rounded-lg transition-all duration-200 group relative",title:"編輯客戶資料"},[w(s(Ge),{class:"w-4 h-4"}),t[22]||(t[22]=e("span",{class:"absolute -top-8 left-1/2 transform -translate-x-1/2 bg-gray-800 text-white text-xs px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap"}," 編輯 ",-1))],8,jt)):y("",!0),s(h).hasPermission("customer_management")?(n(),a("button",{key:1,onClick:v=>Ee(l),class:"p-2 text-green-600 hover:text-green-800 hover:bg-green-50 rounded-lg transition-all duration-200 group relative",title:"指派負責業務"},[w(s(Ze),{class:"w-4 h-4"}),t[23]||(t[23]=e("span",{class:"absolute -top-8 left-1/2 transform -translate-x-1/2 bg-gray-800 text-white text-xs px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap"}," 指派 ",-1))],8,It)):y("",!0),s(h).hasPermission("customer_management")?(n(),a("button",{key:2,onClick:v=>je(l),class:"p-2 text-red-600 hover:text-red-800 hover:bg-red-50 rounded-lg transition-all duration-200 group relative",title:"刪除客戶"},[w(s(et),{class:"w-4 h-4"}),t[24]||(t[24]=e("span",{class:"absolute -top-8 left-1/2 transform -translate-x-1/2 bg-gray-800 text-white text-xs px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap"}," 刪除 ",-1))],8,Nt)):y("",!0)])]),_:1},8,["columns","data","loading","error","search-query","current-page","items-per-page"]),s(te)?(n(),a("div",{key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:E(q,["self"])},[e("div",Pt,[e("div",{class:"flex justify-between items-center mb-4"},[t[25]||(t[25]=e("h3",{class:"text-lg font-semibold text-gray-900"},"新增客戶",-1)),e("button",{onClick:q,class:"text-gray-400 hover:text-gray-600"}," ✕ ")]),e("form",{onSubmit:E(Ne,["prevent"]),class:"space-y-4"},[e("div",null,[t[26]||(t[26]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"}," 客戶姓名 * ",-1)),g(e("input",{"onUpdate:modelValue":t[2]||(t[2]=l=>s(d).name=l),type:"text",required:"",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500"},null,512),[[f,s(d).name]])]),e("div",null,[t[27]||(t[27]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"}," 電話 * ",-1)),g(e("input",{"onUpdate:modelValue":t[3]||(t[3]=l=>s(d).phone=l),type:"tel",required:"",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500"},null,512),[[f,s(d).phone]])]),e("div",null,[t[28]||(t[28]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"}," 電子郵件 ",-1)),g(e("input",{"onUpdate:modelValue":t[4]||(t[4]=l=>s(d).email=l),type:"email",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500"},null,512),[[f,s(d).email]])]),e("div",null,[t[29]||(t[29]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"}," 地區 ",-1)),g(e("input",{"onUpdate:modelValue":t[5]||(t[5]=l=>s(d).region=l),type:"text",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500"},null,512),[[f,s(d).region]])]),e("div",null,[t[30]||(t[30]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"}," 來源管道 ",-1)),g(e("select",{"onUpdate:modelValue":t[6]||(t[6]=l=>s(d).channel=l),class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500"},[(n(),a(I,null,N(ce,l=>e("option",{key:l.value,value:l.value},i(l.label),9,Lt)),64))],512),[[$,s(d).channel]])]),e("div",null,[t[31]||(t[31]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"}," 備註 ",-1)),g(e("textarea",{"onUpdate:modelValue":t[7]||(t[7]=l=>s(d).notes=l),rows:"3",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500"},null,512),[[f,s(d).notes]])]),e("div",Tt,[e("button",{type:"button",onClick:q,class:"px-4 py-2 text-gray-600 hover:text-gray-800"}," 取消 "),e("button",{type:"submit",disabled:s(D),class:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50"},i(s(D)?"創建中...":"創建客戶"),9,qt)])],32)])])):y("",!0),s(se)?(n(),a("div",{key:1,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:E(H,["self"])},[e("div",At,[e("div",{class:"flex justify-between items-center mb-4"},[t[32]||(t[32]=e("h3",{class:"text-lg font-semibold text-gray-900"},"編輯客戶",-1)),e("button",{onClick:H,class:"text-gray-400 hover:text-gray-600"}," ✕ ")]),e("form",{onSubmit:E(Pe,["prevent"]),class:"space-y-4"},[e("div",null,[t[33]||(t[33]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"}," 客戶姓名 * ",-1)),g(e("input",{"onUpdate:modelValue":t[8]||(t[8]=l=>s(d).name=l),type:"text",required:"",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500"},null,512),[[f,s(d).name]])]),e("div",null,[t[34]||(t[34]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"}," 電話 * ",-1)),g(e("input",{"onUpdate:modelValue":t[9]||(t[9]=l=>s(d).phone=l),type:"tel",required:"",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500"},null,512),[[f,s(d).phone]])]),e("div",null,[t[35]||(t[35]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"}," 電子郵件 ",-1)),g(e("input",{"onUpdate:modelValue":t[10]||(t[10]=l=>s(d).email=l),type:"email",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500"},null,512),[[f,s(d).email]])]),e("div",null,[t[36]||(t[36]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"}," 地區 ",-1)),g(e("input",{"onUpdate:modelValue":t[11]||(t[11]=l=>s(d).region=l),type:"text",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500"},null,512),[[f,s(d).region]])]),e("div",null,[t[37]||(t[37]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"}," 來源管道 ",-1)),g(e("select",{"onUpdate:modelValue":t[12]||(t[12]=l=>s(d).channel=l),class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500"},[(n(),a(I,null,N(ce,l=>e("option",{key:l.value,value:l.value},i(l.label),9,Ft)),64))],512),[[$,s(d).channel]])]),e("div",null,[t[38]||(t[38]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"}," 狀態 ",-1)),g(e("select",{"onUpdate:modelValue":t[13]||(t[13]=l=>s(d).status=l),class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500"},[(n(!0),a(I,null,N(s(c)(),(l,v)=>(n(),a("option",{key:v,value:v},i(l),9,Ot))),128))],512),[[$,s(d).status]])]),e("div",null,[t[39]||(t[39]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"}," 備註 ",-1)),g(e("textarea",{"onUpdate:modelValue":t[14]||(t[14]=l=>s(d).notes=l),rows:"3",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500"},null,512),[[f,s(d).notes]])]),e("div",zt,[e("button",{type:"button",onClick:H,class:"px-4 py-2 text-gray-600 hover:text-gray-800"}," 取消 "),e("button",{type:"submit",disabled:s(R),class:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50"},i(s(R)?"更新中...":"更新客戶"),9,Dt)])],32)])])):y("",!0),s(le)?(n(),a("div",{key:2,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:E(me,["self"])},[e("div",Rt,[e("div",{class:"flex justify-between items-center mb-4"},[t[40]||(t[40]=e("h3",{class:"text-lg font-semibold text-gray-900"},"客戶詳情",-1)),e("button",{onClick:me,class:"text-gray-400 hover:text-gray-600"}," ✕ ")]),s(x)?(n(),a("div",Bt,[e("div",Wt,[e("div",null,[t[41]||(t[41]=e("label",{class:"block text-sm font-medium text-gray-700"},"客戶姓名",-1)),e("p",Ht,i(s(x).name),1)]),e("div",null,[t[42]||(t[42]=e("label",{class:"block text-sm font-medium text-gray-700"},"電話",-1)),e("p",Gt,i(s(x).phone),1)]),e("div",null,[t[43]||(t[43]=e("label",{class:"block text-sm font-medium text-gray-700"},"電子郵件",-1)),e("p",Qt,i(s(x).email||"未提供"),1)]),e("div",null,[t[44]||(t[44]=e("label",{class:"block text-sm font-medium text-gray-700"},"地區",-1)),e("p",Jt,i(s(x).region||"未填寫"),1)]),e("div",null,[t[45]||(t[45]=e("label",{class:"block text-sm font-medium text-gray-700"},"狀態",-1)),e("span",{class:ae(["inline-flex px-2 py-1 text-sm font-semibold rounded-full",ge(s(x).status)])},i(pe(s(x).status)),3)]),e("div",null,[t[46]||(t[46]=e("label",{class:"block text-sm font-medium text-gray-700"},"負責業務",-1)),e("p",Kt,i(s(x).assigned_user?.name||"未分配"),1)]),e("div",null,[t[47]||(t[47]=e("label",{class:"block text-sm font-medium text-gray-700"},"LINE 用戶",-1)),e("p",Xt,[Re(i(s(x).line_display_name||"未綁定")+" ",1),s(x).line_user_id?(n(),a("span",Yt," ("+i(s(x).line_user_id)+") ",1)):y("",!0)])]),e("div",null,[t[48]||(t[48]=e("label",{class:"block text-sm font-medium text-gray-700"},"建立時間",-1)),e("p",Zt,i(Le(s(x).created_at)),1)])]),s(x).notes?(n(),a("div",es,[t[49]||(t[49]=e("label",{class:"block text-sm font-medium text-gray-700"},"備註",-1)),e("p",ts,i(s(x).notes),1)])):y("",!0)])):y("",!0)])])):y("",!0),s(oe)?(n(),a("div",{key:3,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:E(G,["self"])},[e("div",ss,[e("div",{class:"flex justify-between items-center mb-4"},[t[50]||(t[50]=e("h3",{class:"text-lg font-semibold text-gray-900"},"指派業務",-1)),e("button",{onClick:G,class:"text-gray-400 hover:text-gray-600"}," ✕ ")]),s(S)?(n(),a("div",ls,[e("div",null,[e("label",os," 客戶："+i(s(S).name),1),e("label",rs," 目前負責業務："+i(s(S).assigned_user?.name||"未分配"),1)]),e("div",null,[e("label",ns," 選擇新的負責業務 * ("+i(s(L).length)+" 位業務人員) ",1),g(e("select",{"onUpdate:modelValue":t[15]||(t[15]=l=>ie(V)?V.value=l:null),class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500",required:""},[t[51]||(t[51]=e("option",{value:""},"請選擇業務人員",-1)),t[52]||(t[52]=e("option",{value:"null"},"取消分配",-1)),(n(!0),a(I,null,N(s(L),l=>(n(),a("option",{key:l.id,value:l.id},i(l.name)+" (ID: "+i(l.id)+") ",9,as))),128))],512),[[$,s(V)]]),s(L).length===0?(n(),a("div",is," 未載入任何業務人員資料 ")):y("",!0)]),e("div",us,[e("button",{type:"button",onClick:G,class:"px-4 py-2 text-gray-600 hover:text-gray-800"}," 取消 "),e("button",{onClick:Me,disabled:s(B)||!s(V),class:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50"},i(s(B)?"指派中...":"確認指派"),9,ds)])])):y("",!0)])])):y("",!0)])}}};export{Rs as default};
