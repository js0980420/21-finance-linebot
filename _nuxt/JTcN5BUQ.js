import Ge from"./-Op9ZE8F.js";import{_ as Ke,r as c,b as G,H as O,y as Qe,i as Ye,C as Je,u as Xe,c as a,a as t,x as g,e as j,k as m,d as o,f as L,g as b,I as $,F as w,q as h,v as x,t as u,j as q,o as n,A as Ze,K as et,L as be,h as tt}from"#entry";import{_ as st,r as lt}from"./CRGlAI26.js";import{u as ot}from"./l19cjJOa.js";import{u as at,a as ge}from"./DgLT0ASK.js";import{u as nt}from"./BtlpaPqX.js";import{u as rt}from"./7WFD-W98.js";import{u as it}from"./DzJdZt_Q.js";import{u as dt}from"./DQZituR6.js";import{r as ut}from"./BKE9UY2T.js";import{r as ct}from"./DdngC8ig.js";import{r as bt}from"./c8JhvyFk.js";import"./B5My0XuL.js";import"./CKtbBPOe.js";import"./CaSEveCJ.js";const gt={class:"space-y-6"},pt=["value"],mt=["value","onChange"],yt=["value"],xt={class:"text-sm font-medium text-gray-900"},ft={class:"text-sm font-medium text-gray-900"},vt={class:"text-sm text-gray-900"},_t={class:"text-sm text-gray-900"},wt={class:"text-xs text-gray-500"},ht={class:"flex items-center space-x-2"},kt={class:"text-sm text-gray-900"},Lt=["onClick"],Ct={class:"text-sm text-gray-900"},Ut={class:"text-xs text-gray-500"},St={key:0,class:"flex items-center space-x-2"},Vt=["src","alt"],Et={key:1,class:"w-6 h-6 rounded-full bg-green-500 flex items-center justify-center text-white text-xs"},Nt={class:"flex-1 min-w-0"},It={class:"flex items-center space-x-1"},jt={class:"text-xs font-medium text-gray-900 truncate"},$t=["onClick"],qt={key:1,class:"flex items-center space-x-2"},Dt={class:"text-xs text-gray-900"},At={key:2,class:"text-xs text-gray-400"},Ot={class:"text-sm text-gray-900"},Tt={class:"text-xs text-gray-500 truncate max-w-[120px]"},Pt={class:"text-sm text-gray-900"},Ft={class:"text-sm text-gray-900"},zt={key:0,class:"space-y-1"},Mt={class:"text-gray-500"},Rt={class:"text-gray-900 ml-1"},Wt={key:0,class:"text-xs text-gray-400"},Bt={key:1,class:"text-xs text-gray-400"},Ht={class:"flex items-center space-x-2 justify-end"},Gt=["onClick"],Kt=["onClick"],Qt=["onClick"],Yt=["onClick"],Jt={class:"bg-white rounded-lg p-6 w-full max-w-xl max-h-[80vh] overflow-y-auto"},Xt={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},Zt=["value"],es=["value"],ts=["value"],ss={class:"md:col-span-2"},ls={key:0,class:"md:col-span-2 pt-2"},os={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},as={class:"block text-sm font-semibold text-gray-900 mb-1"},ns={key:0,class:"text-red-500"},rs=["type","step","required","onUpdate:modelValue"],is=["required","onUpdate:modelValue"],ds=["required","onUpdate:modelValue"],us=["value"],cs={key:3},bs={class:"flex flex-wrap gap-3"},gs=["value","onUpdate:modelValue"],ps={key:4,class:"inline-flex items-center space-x-2"},ms=["onUpdate:modelValue"],ys={class:"flex justify-end space-x-3 pt-2"},xs=["disabled"],fs={class:"bg-white rounded-lg p-6 w-full max-w-2xl mx-4 max-h-[90vh] overflow-y-auto"},vs={key:0,class:"space-y-4"},_s={class:"grid grid-cols-2 gap-4"},ws={class:"text-gray-900"},hs={class:"text-gray-900"},ks={class:"text-gray-900"},Ls={class:"text-gray-900"},Cs={class:"text-gray-900"},Us={class:"text-gray-900"},Ss={key:0},Vs={class:"text-gray-900 whitespace-pre-wrap"},Es={class:"bg-white rounded-lg p-6 w-full max-w-lg"},Ns={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},Is={class:"md:col-span-2"},js={class:"bg-white rounded-lg p-6 w-full max-w-md"},$s={key:0,class:"mb-4"},qs={class:"bg-gray-50 p-3 rounded-lg"},Ds={class:"text-sm text-gray-900"},As={class:"text-sm text-gray-900"},Os={class:"text-sm text-gray-900"},Ts=["value"],Ps={class:"flex justify-end space-x-3 pt-4"},Fs=["disabled"],zs={class:"bg-white rounded-lg p-6 w-full max-w-md"},Ms={key:0,class:"mb-4"},Rs={class:"bg-gray-50 p-3 rounded-lg flex items-center space-x-3"},Ws=["src","alt"],Bs={key:1,class:"w-10 h-10 rounded-full bg-green-500 flex items-center justify-center text-white text-sm"},Hs={class:"text-sm text-gray-900 font-medium"},Gs={class:"text-xs text-gray-500"},Ks={class:"flex justify-end space-x-3 pt-4"},Qs=["disabled"],Ys={__name:"conditional",setup(Js){const T=at(),{success:N,error:p,confirm:pe}=nt(),{updateOne:ee,removeOne:me,convertToCase:ye}=ot(),{getUsers:xe}=rt(),{list:fe}=it(),{refreshBadges:ve}=dt(),{get:_e}=ge(),I=c(""),C=c("all"),we=c(!1),he=c(null),ke=c([]),P=c([]);c({pending:0,today:0,thisWeek:0,processingRate:0});const K=c([]),te=c([]),F=c(!1),Q=c(!1),z=c(!1),M=c(!1),R=c(!1),W=c(null),f=c(null),B=c(null),U=c(null),v=c(null),_=c(!1),D=c(1),Y=c(5);G(()=>Math.ceil(le.value.length/Y.value));const A=c([]),y=O({}),Le=[{value:"wp_form",label:"網站表單"},{value:"lineoa",label:"官方賴"},{value:"email",label:"Email"},{value:"phone",label:"電話"}],Ce=[{value:"pending",label:"待處理"},{value:"intake",label:"已進件"},{value:"approved",label:"已核准"},{value:"disbursed",label:"已撥款"},{value:"tracking",label:"追蹤中"},{value:"blacklist",label:"黑名單"}],se=[{value:"unassigned",label:"未指派"},{value:"valid_customer",label:"有效客"},{value:"invalid_customer",label:"無效客"},{value:"customer_service",label:"客服"},{value:"blacklist",label:"黑名單"},{value:"approved_disbursed",label:"核准撥款"},{value:"conditional",label:"附條件"},{value:"declined",label:"婉拒"},{value:"tracking",label:"追蹤管理"}],i=O({page_url:"",website_domain:"",channel:"wp_form",status:"pending",created_at:"",assigned_to:null,email:null,line_id:"",region:"",address:"",required_amount:null,loan_purpose:"",contact_time:"",ip_address:null,notes:""}),S=O({loan_amount:null,loan_type:"",notes:""}),V=O({assigned_to:null}),k=O({display_name:""}),Ue=G(()=>[{key:"case_status",title:"案件狀態",sortable:!0,width:"150px"},{key:"case_number",title:"案件編號",sortable:!0,width:"140px"},{key:"datetime",title:"時間",sortable:!0,width:"140px"},{key:"assignee",title:"承辦業務",sortable:!0,width:"100px"},{key:"channel",title:"來源管道",sortable:!0,width:"100px"},{key:"line_info",title:"LINE資訊",sortable:!1,width:"160px"},{key:"purpose",title:"諮詢項目",sortable:!1,width:"120px"},{key:"website",title:"網站",sortable:!1,width:"140px"},{key:"contact_info",title:"聯絡資訊",sortable:!1,width:"160px"},{key:"location",title:"地區/地址",sortable:!1,width:"160px"},{key:"amount",title:"需求金額",sortable:!1,width:"120px"},{key:"custom_fields",title:"自定義欄位",sortable:!1,width:"140px"},{key:"actions",title:"操作",sortable:!1,width:"160px"}]),le=G(()=>{let l=ke.value;if(I.value&&I.value.length>=2){const e=I.value.toLowerCase();l=l.filter(r=>r.email?.toLowerCase().includes(e)||r.line_id?.toLowerCase().includes(e)||r.payload?.頁面_URL?.toLowerCase().includes(e)||r.source?.toLowerCase().includes(e)||r.assignee?.name?.toLowerCase().includes(e))}return C.value&&C.value!=="all"&&(C.value==="null"?l=l.filter(e=>!e.assigned_to):l=l.filter(e=>e.assigned_to===parseInt(C.value))),l}),H=G(()=>A.value.filter(l=>l.is_visible)),Se=async()=>{try{const{success:l,users:e}=await xe({per_page:250});l&&Array.isArray(e)&&(P.value=e)}catch(l){console.warn("Load users failed:",l)}},oe=async()=>{const{success:l,items:e}=await fe("lead");l&&(A.value=e)},Ve=async()=>{try{const{data:l,error:e}=await _e("/websites/options");!e&&Array.isArray(l)?(K.value=l,te.value=l.map(r=>({value:r.domain,label:r.name,website:r}))):console.warn("Failed to load websites from management system:",e)}catch(l){console.warn("Load websites failed:",l)}},Ee=l=>{I.value=l,D.value=1},Ne=l=>{D.value=l},Ie=l=>{Y.value=l,D.value=1};let J;Qe([I,C],()=>{clearTimeout(J),J=setTimeout(()=>{D.value=1},300)});const je=l=>{f.value=l,Q.value=!0},ae=()=>{Q.value=!1,f.value=null},$e=async l=>{W.value=l.id;const e=l.payload?.頁面_URL||l.source||"",r=Z(e);Object.assign(i,{page_url:e,website_domain:r.website?r.domain:e?"other":"",channel:l.channel||"wp_form",status:l.status||"pending",created_at:l.created_at?new Date(l.created_at).toISOString().slice(0,16):new Date().toISOString().slice(0,16),assigned_to:l.assigned_to||null,email:l.email||null,line_id:l.line_id||l.payload?.LINE_ID||"",region:l.payload?.房屋區域||l.payload?.所在地區||"",address:l.payload?.房屋地址||"",required_amount:null,loan_purpose:"",contact_time:"",ip_address:null,notes:""}),await oe(),Re(l),F.value=!0},ne=()=>{F.value=!1,W.value=null},qe=async()=>{if(W.value){_.value=!0;try{let l=i.page_url;if(i.website_domain&&i.website_domain!=="other"){const s=K.value.find(d=>d.domain===i.website_domain);s&&(l=s.url)}const e={channel:i.channel,status:i.status,email:i.email,line_id:i.line_id,ip_address:i.ip_address,assigned_to:i.assigned_to,notes:i.notes,payload:{頁面_URL:l,LINE_ID:i.line_id,房屋區域:i.region,房屋地址:i.address,資金需求:i.required_amount,貸款需求:i.loan_purpose,方便聯絡時間:i.contact_time,...y}},{error:r}=await ee(W.value,e);r?p(r?.message||"更新失敗"):(F.value=!1,await loadLeads(),N("進件資料更新成功"))}catch(l){p("系統錯誤，請稍後再試"),console.error("Update case error:",l)}finally{_.value=!1}}},De=async l=>{if(await pe(`確定刪除編號 ${l.id} 的進件嗎？`))try{const{error:r}=await me(l.id);r?p(r?.message||"刪除失敗"):(await loadLeads(),N(`編號 ${l.id} 的進件已刪除`))}catch(r){p("系統錯誤，請稍後再試"),console.error("Delete case error:",r)}},Ae=l=>{if(!l.customer_id){p("此進件尚未綁定客戶，請先建立/綁定客戶後再送件");return}B.value=l,Object.assign(S,{loan_amount:null,loan_type:"",notes:""}),z.value=!0},re=()=>{z.value=!1,B.value=null},Oe=async()=>{if(B.value)try{const{error:l}=await ye(B.value.id,S);l?p(l?.message||"轉換失敗"):(z.value=!1,await loadLeads(),N("案件轉換成功"))}catch(l){p("系統錯誤，請稍後再試"),console.error("Convert case error:",l)}},Te=l=>{U.value=l,V.assigned_to=l.assigned_to||null,M.value=!0},ie=()=>{M.value=!1,U.value=null,V.assigned_to=null},Pe=async()=>{if(!U.value||!V.assigned_to){p("請選擇承辦業務");return}_.value=!0;try{const{error:l}=await ee(U.value.id,{assigned_to:V.assigned_to});if(l)p(l?.message||"指派失敗");else{M.value=!1,await loadLeads();const e=P.value.find(r=>r.id===V.assigned_to);N(`已成功指派給 ${e?.name||"未知業務"}`)}}catch(l){p("系統錯誤，請稍後再試"),console.error("Assign case error:",l)}},Fe=l=>{v.value=l,k.display_name=l.line_user_info?.display_name||"",R.value=!0},de=()=>{R.value=!1,v.value=null,k.display_name=""},ze=async()=>{if(!v.value||!k.display_name?.trim()){p("名稱不能為空");return}_.value=!0;try{const{$api:l}=tt(),{data:e,error:r}=await l.put(`/leads/${v.value.id}/line-name`,{editable_name:k.display_name.trim()});!r&&e?.success?(v.value.line_user_info&&(v.value.line_user_info.display_name=k.display_name.trim(),v.value.line_user_info.editable_name=k.display_name.trim()),R.value=!1,await loadLeads(),N(`LINE用戶名稱已更新：${e.old_name} → ${e.new_name}`)):p(e?.message||r?.message||"更新失敗")}catch(l){p("更新失敗，請稍後再試"),console.error("Save LINE name error:",l)}finally{_.value=!1}},Me=async(l,e)=>{try{const{patch:r}=ge(),{data:s,error:d}=await r(`/leads/${l.id}/case-status`,{case_status:e});if(d){p("更新案件狀態失敗");return}l.case_status=e;const E=se.find(He=>He.value===e)?.label;N(`案件狀態已更新為：${E}`),await loadLeads(),await ve()}catch(r){p("更新狀態失敗，請稍後再試"),console.error("Update case error:",r)}},Re=l=>{const e=l?.payload||{};A.value.forEach(r=>{const s=r.key;e&&Object.prototype.hasOwnProperty.call(e,s)?y[s]=e[s]:r.default_value?y[s]=r.default_value:y[s]=r.type==="multiselect"?[]:r.type==="boolean"?!1:""})},We=l=>{try{return new URL(l).hostname}catch{return l||""}},X=l=>{const e=new Date(l.created_at),r=e.getFullYear().toString().slice(-2),s=String(e.getMonth()+1).padStart(2,"0"),d=String(e.getDate()).padStart(2,"0"),E=String(l.id).padStart(3,"0");return`CASE${r}${s}${d}${E}`},Z=l=>{if(!l)return{name:"-",domain:"",website:null};const e=We(l),r=K.value.find(s=>{if(s.domain===e)return!0;const d=e.replace(/^www\./,""),E=s.domain.replace(/^www\./,"");return!!(d===E||l.includes(s.domain)||e.includes(s.domain)||s.domain.includes(e))});return r?{name:r.name,domain:r.domain,website:r}:{name:e||l,domain:e||l,website:null}},ue=l=>new Date(l).toLocaleDateString("zh-TW",{year:"numeric",month:"2-digit",day:"2-digit"}),ce=l=>new Date(l).toLocaleTimeString("zh-TW",{hour:"2-digit",minute:"2-digit"}),Be=(l,e)=>e.type==="multiselect"?Array.isArray(l)?l.join(", "):l||"-":e.type==="boolean"?l?"是":"否":l??"-";return Ye(async()=>{await Promise.all([Se(),loadLeads(),oe(),Ve()])}),Je(()=>{clearTimeout(J)}),Xe({title:"附條件 - 貸款案件管理系統"}),(l,e)=>{const r=Ge;return n(),a("div",gt,[e[69]||(e[69]=t("div",{class:"flex items-center justify-between"},[t("div",null,[t("h1",{class:"text-3xl font-bold text-gray-900"},"附條件"),t("p",{class:"text-gray-600 mt-2"},"顯示附條件核准的案件")])],-1)),g("",!0),j(st,{title:"附條件列表",columns:o(Ue),data:o(le),loading:o(we),error:o(he),"search-query":o(I),"search-placeholder":"搜尋姓名/手機/Email/LINE/網站... (至少2個字符)","show-search-icon":!1,"current-page":o(D),"items-per-page":o(Y),"loading-text":"載入中...","empty-text":"沒有待處理案件",onSearch:Ee,onRefresh:l.loadLeads,onRetry:l.loadLeads,onPageChange:Ne,onPageSizeChange:Ie},{filters:m(()=>[o(T).hasPermission&&o(T).hasPermission("customer_management")?b((n(),a("select",{key:0,"onUpdate:modelValue":e[0]||(e[0]=s=>Ze(C)?C.value=s:null),class:"px-4 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500"},[e[20]||(e[20]=t("option",{value:"all"},"全部承辦",-1)),e[21]||(e[21]=t("option",{value:"null"},"未指派",-1)),(n(!0),a(w,null,h(o(P),s=>(n(),a("option",{key:s.id,value:s.id},u(s.name),9,pt))),128))],512)),[[$,o(C)]]):g("",!0)]),actions:m(()=>[...e[22]||(e[22]=[])]),"cell-case_status":m(({item:s})=>[t("select",{value:s.case_status||"unassigned",onChange:d=>Me(s,d.target.value),class:"w-full px-1 py-0.5 text-xs border border-gray-300 rounded bg-white text-gray-900 focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500"},[(n(),a(w,null,h(se,d=>t("option",{key:d.value,value:d.value},u(d.label),9,yt)),64))],40,mt)]),"cell-case_number":m(({item:s})=>[t("div",xt,u(X(s)),1)]),"cell-website":m(({item:s})=>[t("div",ft,u(Z(s.payload?.頁面_URL||s.source).name),1)]),"cell-channel":m(({item:s})=>[t("span",vt,u(s.channel==="wp_form"?"網站表單":s.channel==="lineoa"?"官方賴":s.channel==="email"?"Email":s.channel==="phone"?"電話":s.channel||"-"),1)]),"cell-datetime":m(({item:s})=>[t("div",null,[t("div",_t,u(ue(s.created_at)),1),t("div",wt,u(ce(s.created_at)),1)])]),"cell-assignee":m(({item:s})=>[t("div",ht,[t("span",kt,u(s.assignee?.name||"未指派"),1),!s.assignee&&o(T).hasPermission&&o(T).hasPermission("customer_management")?(n(),a("button",{key:0,onClick:d=>Te(s),class:"inline-flex items-center justify-center w-6 h-6 text-blue-600 hover:text-white hover:bg-blue-600 rounded transition-colors duration-200 relative group",title:"指派業務"},[j(r,{name:"heroicons:user-plus",class:"w-4 h-4"}),e[23]||(e[23]=t("span",{class:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-2 py-1 text-xs text-white bg-gray-800 rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap"}," 指派業務 ",-1))],8,Lt)):g("",!0)])]),"cell-contact_info":m(({item:s})=>[t("div",null,[t("div",Ct,u(s.email||"未提供"),1),t("div",Ut,u(s.phone||"未提供"),1)])]),"cell-line_info":m(({item:s})=>[s.line_user_info&&s.is_line_user_id?(n(),a("div",St,[s.line_user_info.picture_url?(n(),a("img",{key:0,src:s.line_user_info.picture_url,alt:s.line_user_info.display_name||"LINE用戶",class:"w-6 h-6 rounded-full object-cover",onError:e[1]||(e[1]=d=>d.target.style.display="none")},null,40,Vt)):(n(),a("div",Et," L ")),t("div",Nt,[t("div",It,[t("span",jt,u(s.line_user_info.display_name||"未設定名稱"),1),t("button",{onClick:d=>Fe(s),class:"text-blue-500 hover:text-blue-700 text-xs",title:"編輯LINE名稱"}," ✏️ ",8,$t)])])])):s.line_id&&!s.is_line_user_id?(n(),a("div",qt,[e[24]||(e[24]=t("div",{class:"w-6 h-6 rounded-full bg-gray-400 flex items-center justify-center text-white text-xs"}," @ ",-1)),t("span",Dt,u(s.line_id),1)])):(n(),a("div",At," 未綁定 "))]),"cell-location":m(({item:s})=>[t("div",null,[t("div",Ot,u(s.payload?.房屋區域||s.payload?.所在地區||"未提供"),1),t("div",Tt,u(s.payload?.房屋地址||""),1)])]),"cell-amount":m(({item:s})=>[t("span",Pt,u(s.payload?.資金需求||"未填寫"),1)]),"cell-purpose":m(({item:s})=>[t("span",Ft,u(s.payload?.貸款需求||"未填寫"),1)]),"cell-custom_fields":m(({item:s})=>[o(H).length>0?(n(),a("div",zt,[(n(!0),a(w,null,h(o(H).slice(0,2),d=>(n(),a("div",{key:d.id,class:"text-xs"},[t("span",Mt,u(d.label)+":",1),t("span",Rt,u(Be(s.payload?.[d.key],d)),1)]))),128)),o(H).length>2?(n(),a("div",Wt," +"+u(o(H).length-2)+" 個欄位 ",1)):g("",!0)])):(n(),a("span",Bt,"無自定義欄位"))]),"cell-actions":m(({item:s})=>[t("div",Ht,[t("button",{onClick:d=>je(s),class:"group relative inline-flex items-center justify-center p-2 text-blue-600 hover:text-white hover:bg-blue-600 rounded-lg transition-all duration-200",title:"查看詳情"},[j(o(ut),{class:"w-4 h-4"}),e[25]||(e[25]=t("div",{class:"absolute bottom-full mb-2 hidden group-hover:block px-2 py-1 text-xs text-white bg-gray-900 rounded whitespace-nowrap z-10"}," 查看詳情 ",-1))],8,Gt),t("button",{onClick:d=>$e(s),class:"group relative inline-flex items-center justify-center p-2 text-gray-600 hover:text-white hover:bg-gray-600 rounded-lg transition-all duration-200",title:"編輯"},[j(o(lt),{class:"w-4 h-4"}),e[26]||(e[26]=t("div",{class:"absolute bottom-full mb-2 hidden group-hover:block px-2 py-1 text-xs text-white bg-gray-900 rounded whitespace-nowrap z-10"}," 編輯 ",-1))],8,Kt),s.customer_id?(n(),a("button",{key:0,onClick:d=>Ae(s),class:"group relative inline-flex items-center justify-center p-2 text-purple-600 hover:text-white hover:bg-purple-600 rounded-lg transition-all duration-200",title:"轉送件"},[j(o(ct),{class:"w-4 h-4"}),e[27]||(e[27]=t("div",{class:"absolute bottom-full mb-2 hidden group-hover:block px-2 py-1 text-xs text-white bg-gray-900 rounded whitespace-nowrap z-10"}," 轉送件 ",-1))],8,Qt)):g("",!0),t("button",{onClick:d=>De(s),class:"group relative inline-flex items-center justify-center p-2 text-red-600 hover:text-white hover:bg-red-600 rounded-lg transition-all duration-200",title:"刪除"},[j(o(bt),{class:"w-4 h-4"}),e[28]||(e[28]=t("div",{class:"absolute bottom-full mb-2 hidden group-hover:block px-2 py-1 text-xs text-white bg-gray-900 rounded whitespace-nowrap z-10"}," 刪除 ",-1))],8,Yt)])]),_:1},8,["columns","data","loading","error","search-query","current-page","items-per-page","onRefresh","onRetry"]),o(F)?(n(),a("div",{key:1,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 mt-0",onClick:L(ne,["self"])},[t("div",Jt,[e[45]||(e[45]=t("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"編輯進件",-1)),t("form",{onSubmit:L(qe,["prevent"]),class:"space-y-3"},[t("div",Xt,[t("div",null,[e[31]||(e[31]=t("label",{class:"block text-sm font-semibold text-gray-900 mb-1"},"網站",-1)),b(t("select",{"onUpdate:modelValue":e[2]||(e[2]=s=>o(i).website_domain=s),class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},[e[29]||(e[29]=t("option",{value:""},"請選擇網站",-1)),(n(!0),a(w,null,h(o(te),s=>(n(),a("option",{key:s.value,value:s.value},u(s.label),9,Zt))),128)),e[30]||(e[30]=t("option",{value:"other"},"其他（手動輸入）",-1))],512),[[$,o(i).website_domain]]),o(i).website_domain==="other"?b((n(),a("input",{key:0,"onUpdate:modelValue":e[3]||(e[3]=s=>o(i).page_url=s),placeholder:"請輸入完整的網址",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 mt-2"},null,512)),[[x,o(i).page_url]]):g("",!0)]),t("div",null,[e[32]||(e[32]=t("label",{class:"block text-sm font-semibold text-gray-900 mb-1"},"來源管道",-1)),b(t("select",{"onUpdate:modelValue":e[4]||(e[4]=s=>o(i).channel=s),class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},[(n(),a(w,null,h(Le,s=>t("option",{key:s.value,value:s.value},u(s.label),9,es)),64))],512),[[$,o(i).channel]])]),t("div",null,[e[33]||(e[33]=t("label",{class:"block text-sm font-semibold text-gray-900 mb-1"},"案件狀態",-1)),b(t("select",{"onUpdate:modelValue":e[5]||(e[5]=s=>o(i).status=s),class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},[(n(),a(w,null,h(Ce,s=>t("option",{key:s.value,value:s.value},u(s.label),9,ts)),64))],512),[[$,o(i).status]])]),t("div",null,[e[34]||(e[34]=t("label",{class:"block text-sm font-semibold text-gray-900 mb-1"},"時間",-1)),b(t("input",{"onUpdate:modelValue":e[6]||(e[6]=s=>o(i).created_at=s),type:"datetime-local",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,512),[[x,o(i).created_at]])]),t("div",null,[e[35]||(e[35]=t("label",{class:"block text-sm font-semibold text-gray-900 mb-1"},"Email",-1)),b(t("input",{"onUpdate:modelValue":e[7]||(e[7]=s=>o(i).email=s),type:"email",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,512),[[x,o(i).email]])]),t("div",null,[e[36]||(e[36]=t("label",{class:"block text-sm font-semibold text-gray-900 mb-1"},"LINE ID",-1)),b(t("input",{"onUpdate:modelValue":e[8]||(e[8]=s=>o(i).line_id=s),class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,512),[[x,o(i).line_id]])]),t("div",null,[e[37]||(e[37]=t("label",{class:"block text-sm font-semibold text-gray-900 mb-1"},"地區",-1)),b(t("input",{"onUpdate:modelValue":e[9]||(e[9]=s=>o(i).region=s),class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,512),[[x,o(i).region]])]),t("div",null,[e[38]||(e[38]=t("label",{class:"block text-sm font-semibold text-gray-900 mb-1"},"地址",-1)),b(t("input",{"onUpdate:modelValue":e[10]||(e[10]=s=>o(i).address=s),class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,512),[[x,o(i).address]])]),t("div",null,[e[39]||(e[39]=t("label",{class:"block text-sm font-semibold text-gray-900 mb-1"},"需求金額",-1)),b(t("input",{"onUpdate:modelValue":e[11]||(e[11]=s=>o(i).required_amount=s),type:"number",min:"0",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,512),[[x,o(i).required_amount,void 0,{number:!0}]])]),t("div",null,[e[40]||(e[40]=t("label",{class:"block text-sm font-semibold text-gray-900 mb-1"},"諮詢項目",-1)),b(t("input",{"onUpdate:modelValue":e[12]||(e[12]=s=>o(i).loan_purpose=s),class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,512),[[x,o(i).loan_purpose]])]),t("div",ss,[e[41]||(e[41]=t("label",{class:"block text-sm font-semibold text-gray-900 mb-1"},"備註",-1)),b(t("textarea",{"onUpdate:modelValue":e[13]||(e[13]=s=>o(i).notes=s),rows:"2",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,512),[[x,o(i).notes]])]),o(A).length?(n(),a("div",ls,[e[44]||(e[44]=t("div",{class:"text-sm font-semibold mb-2"},"自定義欄位（案件）",-1)),t("div",os,[(n(!0),a(w,null,h(o(A),s=>(n(),a("div",{key:s.id},[t("label",as,[q(u(s.label)+" ",1),s.is_required?(n(),a("span",ns,"*")):g("",!0)]),["text","number","decimal","date"].includes(s.type)?b((n(),a("input",{key:0,type:s.type==="decimal"||s.type==="number"?"number":s.type==="date"?"date":"text",step:s.type==="decimal"?"any":void 0,class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:s.is_required,"onUpdate:modelValue":d=>o(y)[s.key]=d},null,8,rs)),[[et,o(y)[s.key]]]):s.type==="textarea"?b((n(),a("textarea",{key:1,class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:s.is_required,"onUpdate:modelValue":d=>o(y)[s.key]=d},null,8,is)),[[x,o(y)[s.key]]]):s.type==="select"?b((n(),a("select",{key:2,class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:s.is_required,"onUpdate:modelValue":d=>o(y)[s.key]=d},[e[42]||(e[42]=t("option",{value:""},"請選擇",-1)),(n(!0),a(w,null,h(s.options||[],d=>(n(),a("option",{key:d,value:d},u(d),9,us))),128))],8,ds)),[[$,o(y)[s.key]]]):s.type==="multiselect"?(n(),a("div",cs,[t("div",bs,[(n(!0),a(w,null,h(s.options||[],d=>(n(),a("label",{key:d,class:"inline-flex items-center"},[b(t("input",{type:"checkbox",value:d,"onUpdate:modelValue":E=>o(y)[s.key]=E,class:"mr-2"},null,8,gs),[[be,o(y)[s.key]]]),t("span",null,u(d),1)]))),128))])])):s.type==="boolean"?(n(),a("label",ps,[b(t("input",{type:"checkbox","onUpdate:modelValue":d=>o(y)[s.key]=d},null,8,ms),[[be,o(y)[s.key]]]),e[43]||(e[43]=t("span",null,"是/否",-1))])):g("",!0)]))),128))])])):g("",!0)]),t("div",ys,[t("button",{type:"button",class:"px-4 py-2 border border-gray-300 rounded-lg",onClick:ne},"取消"),t("button",{type:"submit",class:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",disabled:o(_)},u(o(_)?"儲存中...":"儲存"),9,xs)])],32)])])):g("",!0),o(Q)?(n(),a("div",{key:2,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 mt-0",onClick:L(ae,["self"])},[t("div",fs,[t("div",{class:"flex justify-between items-center mb-4"},[e[46]||(e[46]=t("h3",{class:"text-lg font-semibold text-gray-900"},"案件詳情",-1)),t("button",{onClick:ae,class:"text-gray-400 hover:text-gray-600"}," ✕ ")]),o(f)?(n(),a("div",vs,[t("div",_s,[t("div",null,[e[47]||(e[47]=t("label",{class:"block text-sm font-medium text-gray-700"},"網站",-1)),t("p",ws,u(Z(o(f).payload?.頁面_URL||o(f).source).name),1)]),t("div",null,[e[48]||(e[48]=t("label",{class:"block text-sm font-medium text-gray-700"},"來源管道",-1)),t("p",hs,u(o(f).channel||"wp_form"),1)]),t("div",null,[e[49]||(e[49]=t("label",{class:"block text-sm font-medium text-gray-700"},"時間",-1)),t("p",ks,u(ue(o(f).created_at))+" "+u(ce(o(f).created_at)),1)]),t("div",null,[e[50]||(e[50]=t("label",{class:"block text-sm font-medium text-gray-700"},"承辦業務",-1)),t("p",Ls,u(o(f).assignee?.name||"未指派"),1)]),t("div",null,[e[51]||(e[51]=t("label",{class:"block text-sm font-medium text-gray-700"},"Email",-1)),t("p",Cs,u(o(f).email||"未提供"),1)]),t("div",null,[e[52]||(e[52]=t("label",{class:"block text-sm font-medium text-gray-700"},"LINE ID",-1)),t("p",Us,u(o(f).line_id||"未提供"),1)])]),o(f).notes?(n(),a("div",Ss,[e[53]||(e[53]=t("label",{class:"block text-sm font-medium text-gray-700"},"備註",-1)),t("p",Vs,u(o(f).notes),1)])):g("",!0)])):g("",!0)])])):g("",!0),o(z)?(n(),a("div",{key:3,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 mt-0",onClick:L(re,["self"])},[t("div",Es,[e[58]||(e[58]=t("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"送件（建立案件）",-1)),t("form",{onSubmit:L(Oe,["prevent"]),class:"space-y-3"},[t("div",Ns,[t("div",null,[e[54]||(e[54]=t("label",{class:"block text-sm font-semibold text-gray-900 mb-1"},"貸款金額",-1)),b(t("input",{"onUpdate:modelValue":e[14]||(e[14]=s=>o(S).loan_amount=s),required:"",type:"number",min:"0",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,512),[[x,o(S).loan_amount,void 0,{number:!0}]])]),t("div",null,[e[55]||(e[55]=t("label",{class:"block text-sm font-semibold text-gray-900 mb-1"},"貸款類型",-1)),b(t("input",{"onUpdate:modelValue":e[15]||(e[15]=s=>o(S).loan_type=s),class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,512),[[x,o(S).loan_type]])]),t("div",Is,[e[56]||(e[56]=t("label",{class:"block text-sm font-semibold text-gray-900 mb-1"},"備註",-1)),b(t("textarea",{"onUpdate:modelValue":e[16]||(e[16]=s=>o(S).notes=s),rows:"2",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,512),[[x,o(S).notes]])])]),t("div",{class:"flex justify-end space-x-3 pt-2"},[t("button",{type:"button",class:"px-4 py-2 border border-gray-300 rounded-lg",onClick:re},"取消"),e[57]||(e[57]=t("button",{type:"submit",class:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700"},"送件",-1))])],32)])])):g("",!0),o(M)?(n(),a("div",{key:4,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 mt-0",onClick:L(ie,["self"])},[t("div",js,[e[65]||(e[65]=t("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"指派承辦業務",-1)),t("form",{onSubmit:L(Pe,["prevent"]),class:"space-y-4"},[o(U)?(n(),a("div",$s,[e[62]||(e[62]=t("div",{class:"text-sm text-gray-900 font-semibold mb-2"},"案件資訊：",-1)),t("div",qs,[t("div",Ds,[e[59]||(e[59]=t("span",{class:"font-medium"},"案件編號：",-1)),q(u(X(o(U))),1)]),t("div",As,[e[60]||(e[60]=t("span",{class:"font-medium"},"Email：",-1)),q(u(o(U).email||"未提供"),1)]),t("div",Os,[e[61]||(e[61]=t("span",{class:"font-medium"},"LINE ID：",-1)),q(u(o(U).line_id||"未提供"),1)])])])):g("",!0),t("div",null,[e[64]||(e[64]=t("label",{class:"block text-sm font-semibold text-gray-900 mb-2"},[q("選擇承辦業務 "),t("span",{class:"text-red-500"},"*")],-1)),b(t("select",{"onUpdate:modelValue":e[17]||(e[17]=s=>o(V).assigned_to=s),required:"",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},[e[63]||(e[63]=t("option",{value:""},"請選擇業務人員",-1)),(n(!0),a(w,null,h(o(P).filter(s=>s.roles?.[0]?.name==="staff"),s=>(n(),a("option",{key:s.id,value:s.id},u(s.name||s.email)+" (業務) ",9,Ts))),128))],512),[[$,o(V).assigned_to]])]),t("div",Ps,[t("button",{type:"button",class:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50",onClick:ie}," 取消 "),t("button",{type:"submit",class:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",disabled:o(_)||!o(V).assigned_to},u(o(_)?"指派中...":"確認指派"),9,Fs)])],32)])])):g("",!0),o(R)?(n(),a("div",{key:5,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 mt-0",onClick:L(de,["self"])},[t("div",zs,[e[68]||(e[68]=t("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"編輯LINE名稱",-1)),t("form",{onSubmit:L(ze,["prevent"]),class:"space-y-4"},[o(v)?(n(),a("div",Ms,[e[66]||(e[66]=t("div",{class:"text-sm text-gray-900 font-semibold mb-2"},"LINE使用者資訊：",-1)),t("div",Rs,[o(v).line_user_info?.picture_url?(n(),a("img",{key:0,src:o(v).line_user_info.picture_url,alt:o(v).line_user_info.display_name||"LINE用戶",class:"w-10 h-10 rounded-full object-cover",onError:e[18]||(e[18]=s=>s.target.style.display="none")},null,40,Ws)):(n(),a("div",Bs," L ")),t("div",null,[t("div",Hs,u(o(v).line_user_info?.display_name||"未設定名稱"),1),t("div",Gs,"案件編號："+u(X(o(v))),1)])])])):g("",!0),t("div",null,[e[67]||(e[67]=t("label",{class:"block text-sm font-semibold text-gray-900 mb-2"},[q("LINE名稱 "),t("span",{class:"text-red-500"},"*")],-1)),b(t("input",{"onUpdate:modelValue":e[19]||(e[19]=s=>o(k).display_name=s),required:"",maxlength:"100",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"請輸入LINE名稱"},null,512),[[x,o(k).display_name]])]),t("div",Ks,[t("button",{type:"button",class:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50",onClick:de}," 取消 "),t("button",{type:"submit",class:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",disabled:o(_)||!o(k).display_name?.trim()},u(o(_)?"儲存中...":"儲存"),9,Qs)])],32)])])):g("",!0)])}}},gl=Ke(Ys,[["__scopeId","data-v-a9b0ad4d"]]);export{gl as default};
