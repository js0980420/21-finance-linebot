import bt from"./-Op9ZE8F.js";import{_ as mt,r as b,b as ie,H as K,y as gt,i as Ee,C as _t,u as xt,c as r,a as o,e as T,x as y,j as L,d as s,k as v,f as D,g as p,I as N,F as x,q as f,v as _,t as c,l as _e,J as ft,o as i,A as vt,K as F,s as Q,L as z,n as je,h as ht}from"#entry";import{_ as kt,r as wt}from"./CRGlAI26.js";import{u as xe}from"./CaSEveCJ.js";import{u as Ut,a as fe}from"./DgLT0ASK.js";import{u as Lt}from"./BtlpaPqX.js";import{u as Ct}from"./7WFD-W98.js";import{u as Vt}from"./DzJdZt_Q.js";import{u as St}from"./DQZituR6.js";import{r as It}from"./UqRq4KLf.js";import{r as Dt}from"./BKE9UY2T.js";import{r as Nt}from"./DdngC8ig.js";import{r as $t}from"./c8JhvyFk.js";import"./B5My0XuL.js";import"./CKtbBPOe.js";const Et={class:"space-y-6"},jt={class:"flex items-center justify-between"},At=["value"],Mt=["value","onChange"],Tt=["value"],Ot={class:"text-sm font-medium text-gray-900"},qt=["value","onChange"],Pt=["value"],Rt=["value","onChange"],Ft={class:"text-sm text-gray-900"},zt={class:"text-xs text-gray-500"},Bt={class:"flex items-center space-x-2"},Wt={class:"text-sm text-gray-900"},Gt=["onClick"],Ht={class:"text-sm text-gray-900"},Xt={class:"text-xs text-gray-500"},Jt={key:0,class:"flex items-center space-x-2"},Kt=["src","alt"],Qt={key:1,class:"w-6 h-6 rounded-full bg-green-500 flex items-center justify-center text-white text-xs"},Yt={class:"flex-1 min-w-0"},Zt={class:"flex items-center space-x-1"},eo={class:"text-xs font-medium text-gray-900 truncate"},to=["onClick"],oo={key:1,class:"flex items-center space-x-2"},so={class:"text-xs text-gray-900"},lo={key:2,class:"text-xs text-gray-400"},ao={class:"text-sm text-gray-900"},no={class:"text-xs text-gray-500 truncate max-w-[120px]"},ro={class:"text-sm text-gray-900"},io=["value","onChange"],uo={key:0,class:"space-y-1"},co={class:"text-gray-500"},po={class:"text-gray-900 ml-1"},yo={key:0,class:"text-xs text-gray-400"},bo={key:1,class:"text-xs text-gray-400"},mo={class:"flex items-center space-x-2 justify-end"},go=["onClick"],_o=["onClick"],xo=["onClick"],fo=["onClick"],vo={class:"bg-white h-full w-full overflow-hidden flex flex-col"},ho={class:"flex items-center justify-between p-6 border-b bg-gray-50"},ko={class:"flex-1 overflow-hidden"},wo={class:"flex-1 border-r overflow-y-auto p-6 bg-blue-50"},Uo={class:"space-y-4"},Lo=["value"],Co=["value"],Vo={class:"space-y-2"},So=["value"],Io={class:"space-y-2"},Do={class:"flex-1 border-r overflow-y-auto p-6 bg-green-50"},No={class:"text-lg font-semibold text-gray-800 mb-4 sticky top-0 bg-green-50 py-2"},$o={class:"space-y-4"},Eo={class:"block text-sm font-semibold text-gray-900 mb-1"},jo={key:0,class:"text-red-500"},Ao=["onUpdate:modelValue","type","readonly"],Mo=["onUpdate:modelValue"],To=["onUpdate:modelValue"],Oo=["onUpdate:modelValue"],qo=["value"],Po={key:4,class:"inline-flex items-center space-x-2 mt-2"},Ro=["onUpdate:modelValue"],Fo={key:5,class:"text-sm text-gray-500"},zo={class:"flex-1 border-r overflow-y-auto p-6 bg-yellow-50"},Bo={class:"text-lg font-semibold text-gray-800 mb-4 sticky top-0 bg-yellow-50 py-2"},Wo={class:"space-y-4"},Go={class:"block text-sm font-semibold text-gray-900 mb-1"},Ho={key:0,class:"text-red-500"},Xo=["onUpdate:modelValue","type","readonly"],Jo=["onUpdate:modelValue"],Ko=["onUpdate:modelValue"],Qo=["onUpdate:modelValue"],Yo=["value"],Zo={key:4,class:"inline-flex items-center space-x-2 mt-2"},es=["onUpdate:modelValue"],ts={class:"flex-1 border-r overflow-y-auto p-6 bg-purple-50"},os={class:"text-lg font-semibold text-gray-800 mb-4 sticky top-0 bg-purple-50 py-2"},ss={class:"space-y-4"},ls={class:"block text-sm font-semibold text-gray-900 mb-1"},as={key:0,class:"text-red-500"},ns=["onUpdate:modelValue","type","readonly"],rs=["onUpdate:modelValue"],is={key:2,class:"inline-flex items-center space-x-2 mt-2"},ds=["onUpdate:modelValue"],us={class:"flex-1 border-r overflow-y-auto p-6 bg-red-50"},cs={class:"text-lg font-semibold text-gray-800 mb-4 sticky top-0 bg-red-50 py-2"},ps={class:"space-y-4"},ys={class:"block text-sm font-semibold text-gray-900 mb-1"},bs={key:0,class:"text-red-500"},ms=["onUpdate:modelValue","type","readonly"],gs={key:1,class:"inline-flex items-center space-x-2 mt-2"},_s=["onUpdate:modelValue"],xs={class:"flex-1 overflow-y-auto p-6 bg-gray-50"},fs={class:"text-lg font-semibold text-gray-800 mb-4 sticky top-0 bg-gray-50 py-2"},vs={class:"space-y-4"},hs={class:"block text-sm font-semibold text-gray-900 mb-1"},ks={key:0,class:"text-red-500"},ws=["onUpdate:modelValue","type","readonly"],Us=["onUpdate:modelValue"],Ls={key:0,class:"border-t pt-4"},Cs={class:"space-y-4"},Vs={class:"block text-sm font-semibold text-gray-900 mb-1"},Ss={key:0,class:"text-red-500"},Is=["type","step","required","onUpdate:modelValue"],Ds=["required","onUpdate:modelValue"],Ns=["required","onUpdate:modelValue"],$s=["value"],Es={key:3},js={class:"flex flex-wrap gap-2"},As=["value","onUpdate:modelValue"],Ms={key:4,class:"inline-flex items-center space-x-2 mt-2"},Ts=["onUpdate:modelValue"],Os={class:"border-t pt-4"},qs={class:"border-t pt-4 flex justify-end space-x-3"},Ps=["disabled"],Rs={class:"bg-white rounded-lg p-6 w-full max-w-2xl mx-4 max-h-[90vh] overflow-y-auto"},Fs={key:0,class:"space-y-4"},zs={class:"grid grid-cols-2 gap-4"},Bs={class:"text-gray-900"},Ws={class:"text-gray-900"},Gs={class:"text-gray-900"},Hs={class:"text-gray-900"},Xs={class:"text-gray-900"},Js={class:"text-gray-900"},Ks={key:0},Qs={class:"text-gray-900 whitespace-pre-wrap"},Ys={class:"bg-white rounded-lg p-6 w-full max-w-lg"},Zs={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},el={class:"md:col-span-2"},tl={class:"bg-white rounded-lg p-6 w-full max-w-md"},ol={key:0,class:"mb-4"},sl={class:"bg-gray-50 p-3 rounded-lg"},ll={class:"text-sm text-gray-900"},al={class:"text-sm text-gray-900"},nl={class:"text-sm text-gray-900"},rl=["value"],il={class:"flex justify-end space-x-3 pt-4"},dl=["disabled"],ul={class:"bg-white rounded-lg p-6 w-full max-w-md"},cl={key:0,class:"mb-4"},pl={class:"bg-gray-50 p-3 rounded-lg flex items-center space-x-3"},yl=["src","alt"],bl={key:1,class:"w-10 h-10 rounded-full bg-green-500 flex items-center justify-center text-white text-sm"},ml={class:"text-sm text-gray-900 font-medium"},gl={class:"text-xs text-gray-500"},_l={class:"flex justify-end space-x-3 pt-4"},xl=["disabled"],fl={__name:"conditional-approval",setup(vl){const Ae=[{key:"case_status",title:"進線狀態",sortable:!0,width:"90px"},{key:"datetime",title:"時間",sortable:!0,width:"140px"},{key:"assignee",title:"承辦業務",sortable:!0,width:"80px"},{key:"channel",title:"來源管道",sortable:!0,width:"80px"},{key:"customer_name",title:"姓名",sortable:!0,width:"80px"},{key:"line_info",title:"LINE資訊",sortable:!1,width:"160px"},{key:"purpose",title:"諮詢項目",sortable:!1,width:"100px"},{key:"website",title:"網站",sortable:!1,width:"50px"},{key:"contact_info",title:"聯絡資訊",sortable:!1,width:"160px"},{key:"actions",title:"操作",sortable:!1,width:"160px"}],V={personal:{title:"個人資料",fields:[{key:"birth_date",label:"出生年月日",type:"date"},{key:"id_number",label:"身份證字號",type:"text"},{key:"education",label:"最高學歷",type:"select",options:["國小","國中","高中職","專科","大學","碩士","博士"]}]},contact:{title:"聯絡資訊",fields:[{key:"region",label:"所在地區",type:"text"},{key:"registered_address",label:"戶籍地址",type:"text"},{key:"home_phone",label:"室內電話",type:"text"},{key:"address_same",label:"通訊地址是否同戶籍地",type:"boolean"},{key:"mailing_address",label:"通訊地址",type:"text"},{key:"mobile_phone",label:"通訊電話",type:"text"},{key:"residence_duration",label:"現居地住多久",type:"text"},{key:"residence_owner",label:"居住地持有人",type:"text"},{key:"telecom_provider",label:"電信業者",type:"select",options:["中華電信","台灣大哥大","遠傳電信","台灣之星","亞太電信"]}]},other:{title:"其他資訊",fields:[{key:"case_number",label:"進線編號",type:"text",readonly:!0},{key:"required_amount",label:"需求金額",type:"number"},{key:"custom_fields",label:"自定義欄位",type:"custom"}]},company:{title:"公司資料",fields:[{key:"company_email",label:"電子郵件",type:"email"},{key:"company_name",label:"公司名稱",type:"text"},{key:"company_phone",label:"公司電話",type:"text"},{key:"company_address",label:"公司地址",type:"text"},{key:"job_title",label:"職稱",type:"text"},{key:"monthly_income",label:"月收入",type:"number"},{key:"new_labor_insurance",label:"有無新轉勞保",type:"boolean"},{key:"employment_duration",label:"目前公司在職多久",type:"text"}]},emergency:{title:"緊急聯絡人",fields:[{key:"contact1_name",label:"聯絡人①姓名",type:"text"},{key:"contact1_relationship",label:"聯絡人①關係",type:"text"},{key:"contact1_phone",label:"聯絡人①電話",type:"text"},{key:"contact1_available_time",label:"方便聯絡時間",type:"text"},{key:"contact1_confidential",label:"是否保密",type:"boolean"},{key:"contact2_name",label:"聯絡人②姓名",type:"text"},{key:"contact2_relationship",label:"聯絡人②關係",type:"text"},{key:"contact2_phone",label:"聯絡人②電話",type:"text"},{key:"contact2_confidential",label:"是否保密",type:"boolean"},{key:"contact2_available_time",label:"方便聯絡時間",type:"text"},{key:"referrer",label:"介紹人",type:"text"}]}},Y=Ut(),{success:U,error:m,confirm:de}=Lt(),{list:Me,updateOne:ve,removeOne:Te,convertToCase:Oe}=useLeads(),{getUsers:qe}=Ct(),{list:Pe}=Vt(),{refreshBadges:B}=St(),{get:Re}=fe(),O=b(""),$=b("all"),Z=b(!1),ue=b(null),g=b([]),W=b([]),Fe=b({pending:0,today:0,thisWeek:0,processingRate:0}),ce=b([]),ze=b([]),ee=b(!1),pe=b(!1),te=b(!1),oe=b(!1),se=b(!1),le=b(null),k=b(null),ae=b(null),E=b(null),w=b(null),S=b(!1),G=b(1),ye=b(5);ie(()=>Math.ceil(ke.value.length/ye.value));const H=b([]),h=K({}),he=[{value:"pending",label:"待處理",category:"leads",route:"/cases"},{value:"valid_customer",label:"有效客",category:"leads_management",route:"/cases/valid-customer"},{value:"invalid_customer",label:"無效客",category:"leads_management",route:"/cases/invalid-customer"},{value:"customer_service",label:"客服",category:"leads_management",route:"/cases/customer-service"},{value:"blacklist",label:"黑名單",category:"leads_management",route:"/cases/blacklist"},{value:"approved_disbursed",label:"核准撥款",category:"submissions",route:"/submissions/approved-disbursed"},{value:"approved_undisbursed",label:"核准未撥",category:"submissions",route:"/submissions/approved-pending"},{value:"conditional_approval",label:"附條件",category:"submissions",route:"/submissions/conditional"},{value:"rejected",label:"婉拒",category:"submissions",route:"/submissions/declined"},{value:"tracking",label:"追蹤中",category:"tracking",route:"/tracking/index"}],Be=Array.from({length:10},(l,t)=>`G${t+1}`),a=K({page_url:"",website_domain:"",channel:"wp_form",status:"pending",created_at:"",assigned_to:null,customer_name:"",email:null,line_id:"",loan_purpose:"",ip_address:null,notes:"",birth_date:"",id_number:"",education:"",region:"",registered_address:"",home_phone:"",address_same:!1,mailing_address:"",mobile_phone:"",residence_duration:"",residence_owner:"",telecom_provider:"",case_number:"",required_amount:null,company_email:"",company_name:"",company_phone:"",company_address:"",job_title:"",monthly_income:null,new_labor_insurance:!1,employment_duration:"",contact1_name:"",contact1_relationship:"",contact1_phone:"",contact1_available_time:"",contact1_confidential:!1,contact2_name:"",contact2_relationship:"",contact2_phone:"",contact2_confidential:!1,contact2_available_time:"",referrer:""}),j=K({loan_amount:null,loan_type:"",notes:""}),A=K({assigned_to:null}),I=K({display_name:""}),We=ie(()=>Ae),ke=ie(()=>{let l=g.value;if(O.value&&O.value.length>=2){const t=O.value.toLowerCase();l=l.filter(u=>u.email?.toLowerCase().includes(t)||u.line_id?.toLowerCase().includes(t)||u.payload?.頁面_URL?.toLowerCase().includes(t)||u.source?.toLowerCase().includes(t)||u.assignee?.name?.toLowerCase().includes(t))}return $.value&&$.value!=="all"&&($.value==="null"?l=l.filter(t=>!t.assigned_to):l=l.filter(t=>t.assigned_to===parseInt($.value))),l}),ne=ie(()=>H.value.filter(l=>l.is_visible)),M=async()=>{Z.value=!0,ue.value=null;try{if(_e().public.apiBaseUrl==="/mock-api"){const e=xe();g.value=e.leads.filter(n=>n.case_status==="pending"),Z.value=!1,await B();return}const{items:t,meta:u,success:d}=await Me({case_status:"pending",per_page:1e3});if(d){g.value=t||[];const e=g.value.length,n=new Date,q=g.value.filter(C=>new Date(C.created_at).toDateString()===n.toDateString()).length,X=g.value.filter(C=>{const P=new Date(C.created_at),J=new Date(n);return J.setDate(n.getDate()-n.getDay()),P>=J}).length;Fe.value={pending:e,today:q,thisWeek:X,processingRate:e>0?Math.round(X/e*100):0}}}catch(l){ue.value="載入進線數據失敗",console.error("Load leads error:",l)}finally{Z.value=!1}},Ge=async()=>{try{const{success:l,users:t}=await qe({per_page:250});l&&Array.isArray(t)&&(W.value=t)}catch(l){console.warn("Load users failed:",l)}},we=async()=>{const{success:l,items:t}=await Pe("case");l&&(H.value=t)},He=async()=>{try{const{data:l,error:t}=await Re("/websites/options");!t&&Array.isArray(l)?(ce.value=l,ze.value=l.map(u=>({value:u.domain,label:u.name,website:u}))):console.warn("Failed to load websites from management system:",t)}catch(l){console.warn("Load websites failed:",l)}},Xe=l=>{O.value=l,G.value=1},Je=l=>{G.value=l},Ke=l=>{ye.value=l,G.value=1};let be;gt([O,$],()=>{clearTimeout(be),be=setTimeout(()=>{G.value=1},300)});const Qe=l=>{k.value=l,pe.value=!0},Ue=()=>{pe.value=!1,k.value=null},Ye=async l=>{le.value=l.id;const t=l.payload?.頁面_URL||l.source||"",u=ge(t),d=l.payload||{};Object.assign(a,{page_url:t,website_domain:u.website?u.domain:t?"other":"",channel:l.channel||"wp_form",status:l.status||"pending",created_at:l.created_at?new Date(l.created_at).toISOString().slice(0,16):new Date().toISOString().slice(0,16),assigned_to:l.assigned_to||null,customer_name:l.customer_name||"",email:null,line_id:l.line_id||d.LINE_ID||"",loan_purpose:d.貸款需求||"",ip_address:l.ip_address||null,notes:l.notes||d.備註||"",birth_date:d.出生年月日||"",id_number:d.身份證字號||"",education:d.最高學歷||"",region:d.房屋區域||d.所在地區||"",registered_address:d.戶籍地址||"",home_phone:d.室內電話||"",address_same:d.通訊地址是否同戶籍地||!1,mailing_address:d.通訊地址||d.房屋地址||"",mobile_phone:d.通訊電話||l.phone||"",residence_duration:d.現居地住多久||"",residence_owner:d.居住地持有人||"",telecom_provider:d.電信業者||"",case_number:re(l),required_amount:d.資金需求||null,company_email:d.電子郵件||l.email||"",company_name:d.公司名稱||"",company_phone:d.公司電話||"",company_address:d.公司地址||"",job_title:d.職稱||"",monthly_income:d.月收入||null,new_labor_insurance:d.有無新轉勞保||!1,employment_duration:d.目前公司在職多久||"",contact1_name:d["聯絡人①姓名"]||"",contact1_relationship:d["聯絡人①關係"]||"",contact1_phone:d["聯絡人①電話"]||"",contact1_available_time:d.方便聯絡時間||"",contact1_confidential:d.是否保密||!1,contact2_name:d["聯絡人②姓名"]||"",contact2_relationship:d["聯絡人②關係"]||"",contact2_phone:d["聯絡人②電話"]||"",contact2_confidential:d["聯絡人②是否保密"]||!1,contact2_available_time:d["聯絡人②方便聯絡時間"]||"",referrer:d.介紹人||""}),await we(),dt(l),ee.value=!0},me=()=>{ee.value=!1,le.value=null},Ze=async()=>{if(le.value){S.value=!0;try{let l=a.page_url;if(a.website_domain&&a.website_domain!=="other"){const d=ce.value.find(e=>e.domain===a.website_domain);d&&(l=d.url)}const t={channel:a.channel,status:a.status,email:a.email,line_id:a.line_id,ip_address:a.ip_address,assigned_to:a.assigned_to,notes:a.notes,customer_name:a.customer_name,payload:{頁面_URL:l,LINE_ID:a.line_id,貸款需求:a.loan_purpose,備註:a.notes,出生年月日:a.birth_date,身份證字號:a.id_number,最高學歷:a.education,房屋區域:a.region,戶籍地址:a.registered_address,室內電話:a.home_phone,通訊地址是否同戶籍地:a.address_same,通訊地址:a.mailing_address,通訊電話:a.mobile_phone,現居地住多久:a.residence_duration,居住地持有人:a.residence_owner,電信業者:a.telecom_provider,資金需求:a.required_amount,電子郵件:a.company_email,公司名稱:a.company_name,公司電話:a.company_phone,公司地址:a.company_address,職稱:a.job_title,月收入:a.monthly_income,有無新轉勞保:a.new_labor_insurance,目前公司在職多久:a.employment_duration,"聯絡人①姓名":a.contact1_name,"聯絡人①關係":a.contact1_relationship,"聯絡人①電話":a.contact1_phone,方便聯絡時間:a.contact1_available_time,是否保密:a.contact1_confidential,"聯絡人②姓名":a.contact2_name,"聯絡人②關係":a.contact2_relationship,"聯絡人②電話":a.contact2_phone,"聯絡人②是否保密":a.contact2_confidential,"聯絡人②方便聯絡時間":a.contact2_available_time,介紹人:a.referrer,...h}},{error:u}=await ve(le.value,t);u?m(u?.message||"更新失敗"):(ee.value=!1,await M(),U("進線資料更新成功"))}catch(l){m("系統錯誤，請稍後再試"),console.error("Update lead error:",l)}finally{S.value=!1}}},et=async l=>{if(await de(`確定刪除編號 ${l.id} 的進線嗎？`))try{const{error:u}=await Te(l.id);u?m(u?.message||"刪除失敗"):(await M(),U(`編號 ${l.id} 的進線已刪除`))}catch(u){m("系統錯誤，請稍後再試"),console.error("Delete lead error:",u)}},tt=l=>{if(!l.customer_id){m("此進線尚未綁定客戶，請先建立/綁定客戶後再送件");return}ae.value=l,Object.assign(j,{loan_amount:null,loan_type:"",notes:""}),te.value=!0},Le=()=>{te.value=!1,ae.value=null},ot=async()=>{if(ae.value)try{const{error:l}=await Oe(ae.value.id,j);l?m(l?.message||"轉換失敗"):(te.value=!1,await M(),U("進線轉換案件成功"))}catch(l){m("系統錯誤，請稍後再試"),console.error("Convert lead error:",l)}},st=l=>{E.value=l,A.assigned_to=l.assigned_to||null,oe.value=!0},Ce=()=>{oe.value=!1,E.value=null,A.assigned_to=null},lt=async()=>{if(!E.value||!A.assigned_to){m("請選擇承辦業務");return}S.value=!0;try{const{error:l}=await ve(E.value.id,{assigned_to:A.assigned_to});if(l)m(l?.message||"指派失敗");else{oe.value=!1,await M();const t=W.value.find(u=>u.id===A.assigned_to);U(`已成功指派給 ${t?.name||"未知業務"}`)}}catch(l){m("系統錯誤，請稍後再試"),console.error("Assign lead error:",l)}},at=l=>{w.value=l,I.display_name=l.line_user_info?.display_name||"",se.value=!0},Ve=()=>{se.value=!1,w.value=null,I.display_name=""},nt=async()=>{if(!w.value||!I.display_name?.trim()){m("名稱不能為空");return}S.value=!0;try{const{$api:l}=ht(),{data:t,error:u}=await l.put(`/leads/${w.value.id}/line-name`,{editable_name:I.display_name.trim()});!u&&t?.success?(w.value.line_user_info&&(w.value.line_user_info.display_name=I.display_name.trim(),w.value.line_user_info.editable_name=I.display_name.trim()),se.value=!1,await M(),U(`LINE用戶名稱已更新：${t.old_name} → ${t.new_name}`)):m(t?.message||u?.message||"更新失敗")}catch(l){m("更新失敗，請稍後再試"),console.error("Save LINE name error:",l)}},Se=l=>{const t=he.find(u=>u.value===l);return t?t.route:"/"},rt=async(l,t)=>{try{_e().public.apiBaseUrl;{console.log("Using mock mode for updateLeadStatus",{itemId:l.id,newStatus:t});const P=xe().updateLeadCaseStatus(l.id,t);if(console.log("Mock update result:",P),P){const J=g.value.findIndex(R=>R.id===l.id);J!==-1&&g.value.splice(J,1);const $e=CASE_STATUS_OPTIONS.find(R=>R.value===t)?.label;if(U(`進線狀態已更新為：${$e}`),await B(),t!=="pending"){const R=Se(t);R&&setTimeout(async()=>{await de(`進線已移至「${$e}」區塊，是否前往查看？`,"前往查看","留在此頁")&&await je(R)},1500)}return}else{console.error("Item not found in mock store:",l.id),m("更新失敗：找不到對應的案件");return}}const{patch:d}=fe(),{data:e,error:n}=await d(`/leads/${l.id}/case-status`,{case_status:t});if(n){m("更新進線狀態失敗");return}const q=g.value.findIndex(C=>C.id===l.id);q!==-1&&g.value.splice(q,1);const X=CASE_STATUS_OPTIONS.find(C=>C.value===t)?.label;if(U(`進線狀態已更新為：${X}`),await B(),t!=="pending"){const C=Se(t);C&&setTimeout(async()=>{await de(`進線已移至「${X}」區塊，是否前往查看？`,"前往查看","留在此頁")&&await je(C)},1500)}}catch(u){m("更新狀態失敗，請稍後再試"),console.error("Update lead status error:",u)}},it=async(l,t)=>{try{const{patch:u}=fe(),{error:d}=await u(`/leads/${l.id}`,{payload:{...l.payload,頁面_URL:t}});if(d){m("更新網站失敗");return}l.payload.頁面_URL=t,U(`網站已更新為：${t}`)}catch(u){m("更新網站失敗，請稍後再試"),console.error("Update website error:",u)}},dt=l=>{const t=l?.payload||{};H.value.forEach(u=>{const d=u.key;t&&Object.prototype.hasOwnProperty.call(t,d)?h[d]=t[d]:u.default_value?h[d]=u.default_value:h[d]=u.type==="multiselect"?[]:u.type==="boolean"?!1:""})},ut=l=>{try{return new URL(l).hostname}catch{return l||""}},re=l=>{const t=new Date(l.created_at),u=t.getFullYear().toString().slice(-2),d=String(t.getMonth()+1).padStart(2,"0"),e=String(t.getDate()).padStart(2,"0"),n=String(l.id).padStart(3,"0");return`CASE${u}${d}${e}${n}`},ge=l=>{if(!l)return{name:"-",domain:"",website:null};const t=ut(l),u=ce.value.find(d=>{if(d.domain===t)return!0;const e=t.replace(/^www\./,""),n=d.domain.replace(/^www\./,"");return!!(e===n||l.includes(d.domain)||t.includes(d.domain)||d.domain.includes(t))});return u?{name:u.name,domain:u.domain,website:u}:{name:t||l,domain:t||l,website:null}},Ie=l=>new Date(l).toLocaleDateString("zh-TW",{year:"numeric",month:"2-digit",day:"2-digit"}),De=l=>new Date(l).toLocaleTimeString("zh-TW",{hour:"2-digit",minute:"2-digit"}),ct=(l,t)=>t.type==="multiselect"?Array.isArray(l)?l.join(", "):l||"-":t.type==="boolean"?l?"是":"否":l??"-";Ee(async()=>{await Promise.all([Ge(),M(),we(),He(),B()])}),_t(()=>{clearTimeout(be)}),xt({title:"網路進線管理"});const Ne=async()=>{if(_e().public.apiBaseUrl==="/mock-api"){const d=xe(),e={customer_name:`假客戶${Date.now()}`,email:`mock${Date.now()}@example.com`,phone:`09${String(Math.floor(Math.random()*1e8)).padStart(8,"0")}`,line_id:`mocklineid${Date.now()}`,channel:"wp_form",source:`http://mock-website-${Date.now()}.com`,case_status:"pending",assigned_to:null,payload:{頁面_URL:`http://mock-website-${Date.now()}.com`,需求金額:Math.floor(Math.random()*1e6)+1e5,房屋地址:`假地址${Math.floor(Math.random()*999)}號`}},n=d.addLead(e);n.case_status==="pending"&&g.value.push(n),await B(),U(`新增假進線 #${n.id} 成功！`);return}const t=g.value.length>0?Math.max(...g.value.map(d=>d.id))+1:1,u={id:t,customer_name:`假客戶${t}`,email:`mock${t}@example.com`,phone:`09${String(t).padStart(8,"0")}`,line_id:`mocklineid${t}`,channel:"wp_form",source:`http://mock-website-${t}.com`,case_status:"pending",created_at:new Date().toISOString(),updated_at:new Date().toISOString(),assigned_to:null,payload:{頁面_URL:`http://mock-website-${t}.com`,需求金額:Math.floor(Math.random()*1e6)+1e5,房屋地址:`假地址${t}號`}};g.value.push(u),U(`新增假進線 #${t} 成功！`)},pt=async(l,t)=>{try{const u=g.value.findIndex(d=>d.id===l);u!==-1&&(g.value[u].channel=t,U("來源管道更新成功"))}catch(u){console.error("更新來源管道失敗:",u),m("更新來源管道失敗")}},yt=async(l,t)=>{try{const u=g.value.findIndex(d=>d.id===l);u!==-1&&(g.value[u].payload||(g.value[u].payload={}),g.value[u].payload.貸款需求=t,U("諮詢項目更新成功"))}catch(u){console.error("更新諮詢項目失敗:",u),m("更新諮詢項目失敗")}};return Ee(async()=>{for(let l=0;l<3;l++)await Ne()}),(l,t)=>{const u=bt,d=ft("XMarkIcon");return i(),r("div",Et,[o("div",jt,[t[21]||(t[21]=o("div",null,[o("h1",{class:"text-3xl font-bold text-gray-900"},"附條件"),o("p",{class:"text-gray-600 mt-2"},"需要附加條件核准的案件")],-1)),o("button",{onClick:Ne,class:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"},[T(s(It),{class:"-ml-1 mr-2 h-5 w-5","aria-hidden":"true"}),t[20]||(t[20]=L(" 新增進線 ",-1))])]),T(kt,{title:"網路進線列表",columns:s(We),data:s(ke),loading:s(Z),error:s(ue),"search-query":s(O),"search-placeholder":"搜尋姓名/手機/Email/LINE/網站... (至少2個字符)","show-search-icon":!1,"current-page":s(G),"items-per-page":s(ye),"loading-text":"載入中...","empty-text":"沒有網路進線案件",onSearch:Xe,onRefresh:M,onRetry:M,onPageChange:Je,onPageSizeChange:Ke},{filters:v(()=>[s(Y).hasPermission&&s(Y).hasPermission("customer_management")?p((i(),r("select",{key:0,"onUpdate:modelValue":t[0]||(t[0]=e=>vt($)?$.value=e:null),class:"px-4 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},[t[22]||(t[22]=o("option",{value:"all"},"全部承辦",-1)),t[23]||(t[23]=o("option",{value:"null"},"未指派",-1)),(i(!0),r(x,null,f(s(W),e=>(i(),r("option",{key:e.id,value:e.id},c(e.name),9,At))),128))],512)),[[N,s($)]]):y("",!0)]),actions:v(()=>[...t[24]||(t[24]=[])]),"cell-case_status":v(({item:e})=>[o("select",{value:e.case_status||"pending",onChange:n=>rt(e,n.target.value),class:"w-full px-1 py-0.5 text-xs border border-gray-300 rounded bg-white text-gray-900 focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500"},[(i(),r(x,null,f(he,n=>o("option",{key:n.value,value:n.value},c(n.label),9,Tt)),64))],40,Mt)]),"cell-case_number":v(({item:e})=>[o("div",Ot,c(re(e)),1)]),"cell-website":v(({item:e})=>[o("select",{value:ge(e.payload?.頁面_URL||e.source).name,onChange:n=>it(e,n.target.value),class:"w-full px-1 py-0.5 text-xs border border-gray-300 rounded bg-white text-gray-900 focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500"},[(i(!0),r(x,null,f(s(Be),n=>(i(),r("option",{key:n,value:n},c(n),9,Pt))),128))],40,qt)]),"cell-channel":v(({item:e})=>[o("select",{value:e.channel,onChange:n=>pt(e.id,n.target.value),class:"w-full px-2 py-1 text-sm border border-gray-300 rounded bg-white text-gray-900 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},[...t[25]||(t[25]=[o("option",{value:"wp_form"},"網站表單",-1),o("option",{value:"lineoa"},"官方LINE",-1),o("option",{value:"email"},"email",-1),o("option",{value:"phone"},"專線",-1)])],40,Rt)]),"cell-datetime":v(({item:e})=>[o("div",null,[o("div",Ft,c(Ie(e.created_at)),1),o("div",zt,c(De(e.created_at)),1)])]),"cell-assignee":v(({item:e})=>[o("div",Bt,[o("span",Wt,c(e.assignee?.name||"未指派"),1),!e.assignee&&s(Y).hasPermission&&s(Y).hasPermission("customer_management")?(i(),r("button",{key:0,onClick:n=>st(e),class:"inline-flex items-center justify-center w-6 h-6 text-blue-600 hover:text-white hover:bg-blue-600 rounded transition-colors duration-200 relative group",title:"指派業務"},[T(u,{name:"heroicons:user-plus",class:"w-4 h-4"}),t[26]||(t[26]=o("span",{class:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-2 py-1 text-xs text-white bg-gray-800 rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap"}," 指派業務 ",-1))],8,Gt)):y("",!0)])]),"cell-contact_info":v(({item:e})=>[o("div",null,[o("div",Ht,c(e.email||"未提供"),1),o("div",Xt,c(e.phone||"未提供"),1)])]),"cell-line_info":v(({item:e})=>[e.line_user_info&&e.is_line_user_id?(i(),r("div",Jt,[e.line_user_info.picture_url?(i(),r("img",{key:0,src:e.line_user_info.picture_url,alt:e.line_user_info.display_name||"LINE用戶",class:"w-6 h-6 rounded-full object-cover",onError:t[1]||(t[1]=n=>n.target.style.display="none")},null,40,Kt)):(i(),r("div",Qt," L ")),o("div",Yt,[o("div",Zt,[o("span",eo,c(e.line_user_info.display_name||"未設定名稱"),1),o("button",{onClick:n=>at(e),class:"text-blue-500 hover:text-blue-700 text-xs",title:"編輯LINE名稱"}," ✏️ ",8,to)])])])):e.line_id&&!e.is_line_user_id?(i(),r("div",oo,[t[27]||(t[27]=o("div",{class:"w-6 h-6 rounded-full bg-gray-400 flex items-center justify-center text-white text-xs"}," @ ",-1)),o("span",so,c(e.line_id),1)])):(i(),r("div",lo," 未綁定 "))]),"cell-location":v(({item:e})=>[o("div",null,[o("div",ao,c(e.payload?.房屋區域||e.payload?.所在地區||"未提供"),1),o("div",no,c(e.payload?.房屋地址||""),1)])]),"cell-amount":v(({item:e})=>[o("span",ro,c(e.payload?.資金需求||"未填寫"),1)]),"cell-purpose":v(({item:e})=>[o("select",{value:e.payload?.貸款需求||"",onChange:n=>yt(e.id,n.target.value),class:"w-full px-2 py-1 text-sm border border-gray-300 rounded bg-white text-gray-900 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},[...t[28]||(t[28]=[o("option",{value:""},"請選擇",-1),o("option",{value:"房屋貸款"},"房屋貸款",-1),o("option",{value:"土地貸款"},"土地貸款",-1),o("option",{value:"企業貸款"},"企業貸款",-1),o("option",{value:"個人信貸"},"個人信貸",-1),o("option",{value:"汽車貸款"},"汽車貸款",-1),o("option",{value:"其他"},"其他",-1)])],40,io)]),"cell-custom_fields":v(({item:e})=>[s(ne).length>0?(i(),r("div",uo,[(i(!0),r(x,null,f(s(ne).slice(0,2),n=>(i(),r("div",{key:n.id,class:"text-xs"},[o("span",co,c(n.label)+":",1),o("span",po,c(ct(e.payload?.[n.key],n)),1)]))),128)),s(ne).length>2?(i(),r("div",yo," +"+c(s(ne).length-2)+" 個欄位 ",1)):y("",!0)])):(i(),r("span",bo,"無自定義欄位"))]),"cell-actions":v(({item:e})=>[o("div",mo,[o("button",{onClick:n=>Qe(e),class:"group relative inline-flex items-center justify-center p-2 text-blue-600 hover:text-white hover:bg-blue-600 rounded-lg transition-all duration-200",title:"查看詳情"},[T(s(Dt),{class:"w-4 h-4"}),t[29]||(t[29]=o("div",{class:"absolute bottom-full mb-2 hidden group-hover:block px-2 py-1 text-xs text-white bg-gray-900 rounded whitespace-nowrap z-10"}," 查看詳情 ",-1))],8,go),o("button",{onClick:n=>Ye(e),class:"group relative inline-flex items-center justify-center p-2 text-gray-600 hover:text-white hover:bg-gray-600 rounded-lg transition-all duration-200",title:"編輯"},[T(s(wt),{class:"w-4 h-4"}),t[30]||(t[30]=o("div",{class:"absolute bottom-full mb-2 hidden group-hover:block px-2 py-1 text-xs text-white bg-gray-900 rounded whitespace-nowrap z-10"}," 編輯 ",-1))],8,_o),e.customer_id?(i(),r("button",{key:0,onClick:n=>tt(e),class:"group relative inline-flex items-center justify-center p-2 text-purple-600 hover:text-white hover:bg-purple-600 rounded-lg transition-all duration-200",title:"轉送件"},[T(s(Nt),{class:"w-4 h-4"}),t[31]||(t[31]=o("div",{class:"absolute bottom-full mb-2 hidden group-hover:block px-2 py-1 text-xs text-white bg-gray-900 rounded whitespace-nowrap z-10"}," 轉送件 ",-1))],8,xo)):y("",!0),o("button",{onClick:n=>et(e),class:"group relative inline-flex items-center justify-center p-2 text-red-600 hover:text-white hover:bg-red-600 rounded-lg transition-all duration-200",title:"刪除"},[T(s($t),{class:"w-4 h-4"}),t[32]||(t[32]=o("div",{class:"absolute bottom-full mb-2 hidden group-hover:block px-2 py-1 text-xs text-white bg-gray-900 rounded whitespace-nowrap z-10"}," 刪除 ",-1))],8,fo)])]),_:1},8,["columns","data","loading","error","search-query","current-page","items-per-page"]),s(ee)?(i(),r("div",{key:0,class:"fixed inset-0 bg-black/50 z-50",onClick:D(me,["self"])},[o("div",vo,[o("div",ho,[t[33]||(t[33]=o("h3",{class:"text-xl font-semibold text-gray-900"},"編輯進線",-1)),o("button",{type:"button",onClick:me,class:"text-gray-400 hover:text-gray-600"},[T(d,{class:"w-6 h-6"})])]),o("div",ko,[o("form",{onSubmit:D(Ze,["prevent"]),class:"h-full flex"},[o("div",wo,[t[45]||(t[45]=o("h4",{class:"text-lg font-semibold text-gray-800 mb-4 sticky top-0 bg-blue-50 py-2"},"基本資訊",-1)),o("div",Uo,[o("div",null,[t[34]||(t[34]=o("label",{class:"block text-sm font-semibold text-gray-900 mb-1"},"進線狀態",-1)),p(o("select",{"onUpdate:modelValue":t[2]||(t[2]=e=>s(a).case_status=e),class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},[(i(!0),r(x,null,f(l.CASE_STATUS_OPTIONS,e=>(i(),r("option",{key:e.value,value:e.value},c(e.label),9,Lo))),128))],512),[[N,s(a).case_status]])]),o("div",null,[t[35]||(t[35]=o("label",{class:"block text-sm font-semibold text-gray-900 mb-1"},"時間",-1)),p(o("input",{"onUpdate:modelValue":t[3]||(t[3]=e=>s(a).created_at=e),type:"datetime-local",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",readonly:""},null,512),[[_,s(a).created_at]])]),o("div",null,[t[37]||(t[37]=o("label",{class:"block text-sm font-semibold text-gray-900 mb-1"},"承辦業務",-1)),p(o("select",{"onUpdate:modelValue":t[4]||(t[4]=e=>s(a).assigned_to=e),class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},[t[36]||(t[36]=o("option",{value:""},"未指派",-1)),(i(!0),r(x,null,f(s(W),e=>(i(),r("option",{key:e.id,value:e.id},c(e.name),9,Co))),128))],512),[[N,s(a).assigned_to]])]),o("div",null,[t[39]||(t[39]=o("label",{class:"block text-sm font-semibold text-gray-900 mb-1"},"來源管道",-1)),p(o("select",{"onUpdate:modelValue":t[5]||(t[5]=e=>s(a).channel=e),class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},[...t[38]||(t[38]=[o("option",{value:"wp_form"},"網站表單",-1),o("option",{value:"lineoa"},"官方LINE",-1),o("option",{value:"email"},"email",-1),o("option",{value:"phone"},"專線",-1)])],512),[[N,s(a).channel]])]),o("div",null,[t[40]||(t[40]=o("label",{class:"block text-sm font-semibold text-gray-900 mb-1"},"姓名",-1)),p(o("input",{"onUpdate:modelValue":t[6]||(t[6]=e=>s(a).customer_name=e),type:"text",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",readonly:""},null,512),[[_,s(a).customer_name]])]),o("div",null,[t[41]||(t[41]=o("label",{class:"block text-sm font-semibold text-gray-900 mb-1"},"LINE資訊",-1)),o("div",Vo,[p(o("input",{"onUpdate:modelValue":t[7]||(t[7]=e=>s(a).line_display_name=e),placeholder:"LINE顯示名稱",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",readonly:""},null,512),[[_,s(a).line_display_name]]),p(o("input",{"onUpdate:modelValue":t[8]||(t[8]=e=>s(a).line_id=e),placeholder:"LINE加好友ID",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",readonly:""},null,512),[[_,s(a).line_id]])])]),o("div",null,[t[42]||(t[42]=o("label",{class:"block text-sm font-semibold text-gray-900 mb-1"},"諮詢項目",-1)),p(o("input",{"onUpdate:modelValue":t[9]||(t[9]=e=>s(a).loan_purpose=e),class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",readonly:""},null,512),[[_,s(a).loan_purpose]])]),o("div",null,[t[43]||(t[43]=o("label",{class:"block text-sm font-semibold text-gray-900 mb-1"},"網站",-1)),p(o("select",{"onUpdate:modelValue":t[10]||(t[10]=e=>s(a).website=e),class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},[(i(),r(x,null,f(10,e=>o("option",{key:e,value:`G${e}`},"G"+c(e),9,So)),64))],512),[[N,s(a).website]])]),o("div",null,[t[44]||(t[44]=o("label",{class:"block text-sm font-semibold text-gray-900 mb-1"},"聯絡資訊",-1)),o("div",Io,[p(o("input",{"onUpdate:modelValue":t[11]||(t[11]=e=>s(a).email=e),type:"email",placeholder:"Email",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",readonly:""},null,512),[[_,s(a).email]]),p(o("input",{"onUpdate:modelValue":t[12]||(t[12]=e=>s(a).phone=e),type:"tel",placeholder:"手機號碼",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",readonly:""},null,512),[[_,s(a).phone]])])])])]),o("div",Do,[o("h4",No,c(V.personal.title),1),o("div",$o,[(i(!0),r(x,null,f(V.personal.fields,e=>(i(),r("div",{key:e.key},[o("label",Eo,[L(c(e.label)+" ",1),e.required?(i(),r("span",jo,"*")):y("",!0)]),e.type==="text"||e.type==="email"?p((i(),r("input",{key:0,"onUpdate:modelValue":n=>s(a)[e.key]=n,type:e.type,readonly:e.readonly,class:Q(["w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",{"bg-gray-100":e.readonly}])},null,10,Ao)),[[F,s(a)[e.key]]]):e.type==="number"?p((i(),r("input",{key:1,"onUpdate:modelValue":n=>s(a)[e.key]=n,type:"number",min:"0",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,8,Mo)),[[_,s(a)[e.key],void 0,{number:!0}]]):e.type==="date"?p((i(),r("input",{key:2,"onUpdate:modelValue":n=>s(a)[e.key]=n,type:"date",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,8,To)),[[_,s(a)[e.key]]]):e.type==="select"?p((i(),r("select",{key:3,"onUpdate:modelValue":n=>s(a)[e.key]=n,class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},[t[46]||(t[46]=o("option",{value:""},"請選擇",-1)),(i(!0),r(x,null,f(e.options,n=>(i(),r("option",{key:n,value:n},c(n),9,qo))),128))],8,Oo)),[[N,s(a)[e.key]]]):e.type==="boolean"?(i(),r("label",Po,[p(o("input",{type:"checkbox","onUpdate:modelValue":n=>s(a)[e.key]=n,class:"rounded"},null,8,Ro),[[z,s(a)[e.key]]]),t[47]||(t[47]=o("span",{class:"text-sm"},"是",-1))])):e.type==="custom"?(i(),r("div",Fo," 自定義欄位將顯示在下方 ")):y("",!0)]))),128))])]),o("div",zo,[o("h4",Bo,c(V.contact.title),1),o("div",Wo,[(i(!0),r(x,null,f(V.contact.fields,e=>(i(),r("div",{key:e.key},[o("label",Go,[L(c(e.label)+" ",1),e.required?(i(),r("span",Ho,"*")):y("",!0)]),e.type==="text"||e.type==="email"?p((i(),r("input",{key:0,"onUpdate:modelValue":n=>s(a)[e.key]=n,type:e.type,readonly:e.readonly,class:Q(["w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",{"bg-gray-100":e.readonly}])},null,10,Xo)),[[F,s(a)[e.key]]]):e.type==="number"?p((i(),r("input",{key:1,"onUpdate:modelValue":n=>s(a)[e.key]=n,type:"number",min:"0",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,8,Jo)),[[_,s(a)[e.key],void 0,{number:!0}]]):e.type==="date"?p((i(),r("input",{key:2,"onUpdate:modelValue":n=>s(a)[e.key]=n,type:"date",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,8,Ko)),[[_,s(a)[e.key]]]):e.type==="select"?p((i(),r("select",{key:3,"onUpdate:modelValue":n=>s(a)[e.key]=n,class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},[t[48]||(t[48]=o("option",{value:""},"請選擇",-1)),(i(!0),r(x,null,f(e.options,n=>(i(),r("option",{key:n,value:n},c(n),9,Yo))),128))],8,Qo)),[[N,s(a)[e.key]]]):e.type==="boolean"?(i(),r("label",Zo,[p(o("input",{type:"checkbox","onUpdate:modelValue":n=>s(a)[e.key]=n,class:"rounded"},null,8,es),[[z,s(a)[e.key]]]),t[49]||(t[49]=o("span",{class:"text-sm"},"是",-1))])):y("",!0)]))),128))])]),o("div",ts,[o("h4",os,c(V.company.title),1),o("div",ss,[(i(!0),r(x,null,f(V.company.fields,e=>(i(),r("div",{key:e.key},[o("label",ls,[L(c(e.label)+" ",1),e.required?(i(),r("span",as,"*")):y("",!0)]),e.type==="text"||e.type==="email"?p((i(),r("input",{key:0,"onUpdate:modelValue":n=>s(a)[e.key]=n,type:e.type,readonly:e.readonly,class:Q(["w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",{"bg-gray-100":e.readonly}])},null,10,ns)),[[F,s(a)[e.key]]]):e.type==="number"?p((i(),r("input",{key:1,"onUpdate:modelValue":n=>s(a)[e.key]=n,type:"number",min:"0",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,8,rs)),[[_,s(a)[e.key],void 0,{number:!0}]]):e.type==="boolean"?(i(),r("label",is,[p(o("input",{type:"checkbox","onUpdate:modelValue":n=>s(a)[e.key]=n,class:"rounded"},null,8,ds),[[z,s(a)[e.key]]]),t[50]||(t[50]=o("span",{class:"text-sm"},"是",-1))])):y("",!0)]))),128))])]),o("div",us,[o("h4",cs,c(V.emergency.title),1),o("div",ps,[(i(!0),r(x,null,f(V.emergency.fields,e=>(i(),r("div",{key:e.key},[o("label",ys,[L(c(e.label)+" ",1),e.required?(i(),r("span",bs,"*")):y("",!0)]),e.type==="text"?p((i(),r("input",{key:0,"onUpdate:modelValue":n=>s(a)[e.key]=n,type:e.type,readonly:e.readonly,class:Q(["w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",{"bg-gray-100":e.readonly}])},null,10,ms)),[[F,s(a)[e.key]]]):e.type==="boolean"?(i(),r("label",gs,[p(o("input",{type:"checkbox","onUpdate:modelValue":n=>s(a)[e.key]=n,class:"rounded"},null,8,_s),[[z,s(a)[e.key]]]),t[51]||(t[51]=o("span",{class:"text-sm"},"是",-1))])):y("",!0)]))),128))])]),o("div",xs,[o("h4",fs,c(V.other.title),1),o("div",vs,[(i(!0),r(x,null,f(V.other.fields.filter(e=>e.type!=="custom"),e=>(i(),r("div",{key:e.key},[o("label",hs,[L(c(e.label)+" ",1),e.required?(i(),r("span",ks,"*")):y("",!0)]),e.type==="text"?p((i(),r("input",{key:0,"onUpdate:modelValue":n=>s(a)[e.key]=n,type:e.type,readonly:e.readonly,class:Q(["w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",{"bg-gray-100":e.readonly}])},null,10,ws)),[[F,s(a)[e.key]]]):e.type==="number"?p((i(),r("input",{key:1,"onUpdate:modelValue":n=>s(a)[e.key]=n,type:"number",min:"0",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,8,Us)),[[_,s(a)[e.key],void 0,{number:!0}]]):y("",!0)]))),128)),s(H).length?(i(),r("div",Ls,[t[54]||(t[54]=o("h5",{class:"text-md font-medium text-gray-800 mb-3"},"自定義欄位",-1)),o("div",Cs,[(i(!0),r(x,null,f(s(H),e=>(i(),r("div",{key:e.id},[o("label",Vs,[L(c(e.label)+" ",1),e.is_required?(i(),r("span",Ss,"*")):y("",!0)]),["text","number","decimal","date"].includes(e.type)?p((i(),r("input",{key:0,type:e.type==="decimal"||e.type==="number"?"number":e.type==="date"?"date":"text",step:e.type==="decimal"?"any":void 0,class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:e.is_required,"onUpdate:modelValue":n=>s(h)[e.key]=n},null,8,Is)),[[F,s(h)[e.key]]]):e.type==="textarea"?p((i(),r("textarea",{key:1,class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:focus:border-blue-500",required:e.is_required,"onUpdate:modelValue":n=>s(h)[e.key]=n,rows:"2"},null,8,Ds)),[[_,s(h)[e.key]]]):e.type==="select"?p((i(),r("select",{key:2,class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:e.is_required,"onUpdate:modelValue":n=>s(h)[e.key]=n},[t[52]||(t[52]=o("option",{value:""},"請選擇",-1)),(i(!0),r(x,null,f(e.options||[],n=>(i(),r("option",{key:n,value:n},c(n),9,$s))),128))],8,Ns)),[[N,s(h)[e.key]]]):e.type==="multiselect"?(i(),r("div",Es,[o("div",js,[(i(!0),r(x,null,f(e.options||[],n=>(i(),r("label",{key:n,class:"inline-flex items-center text-sm"},[p(o("input",{type:"checkbox",value:n,"onUpdate:modelValue":q=>s(h)[e.key]=q,class:"mr-1"},null,8,As),[[z,s(h)[e.key]]]),o("span",null,c(n),1)]))),128))])])):e.type==="boolean"?(i(),r("label",Ms,[p(o("input",{type:"checkbox","onUpdate:modelValue":n=>s(h)[e.key]=n},null,8,Ts),[[z,s(h)[e.key]]]),t[53]||(t[53]=o("span",{class:"text-sm"},"是/否",-1))])):y("",!0)]))),128))])])):y("",!0),o("div",Os,[t[55]||(t[55]=o("label",{class:"block text-sm font-semibold text-gray-900 mb-1"},"備註",-1)),p(o("textarea",{"onUpdate:modelValue":t[13]||(t[13]=e=>s(a).notes=e),rows:"3",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,512),[[_,s(a).notes]])]),o("div",qs,[o("button",{type:"button",class:"px-4 py-2 border border-gray-300 rounded-lg",onClick:me},"取消"),o("button",{type:"submit",class:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",disabled:s(S)},c(s(S)?"儲存中...":"儲存"),9,Ps)])])])],32)])])])):y("",!0),s(pe)?(i(),r("div",{key:1,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 mt-0",onClick:D(Ue,["self"])},[o("div",Rs,[o("div",{class:"flex justify-between items-center mb-4"},[t[56]||(t[56]=o("h3",{class:"text-lg font-semibold text-gray-900"},"進線詳情",-1)),o("button",{onClick:Ue,class:"text-gray-400 hover:text-gray-600"}," ✕ ")]),s(k)?(i(),r("div",Fs,[o("div",zs,[o("div",null,[t[57]||(t[57]=o("label",{class:"block text-sm font-medium text-gray-700"},"網站",-1)),o("p",Bs,c(ge(s(k).payload?.頁面_URL||s(k).source).name),1)]),o("div",null,[t[58]||(t[58]=o("label",{class:"block text-sm font-medium text-gray-700"},"來源管道",-1)),o("p",Ws,c(s(k).channel||"wp_form"),1)]),o("div",null,[t[59]||(t[59]=o("label",{class:"block text-sm font-medium text-gray-700"},"時間",-1)),o("p",Gs,c(Ie(s(k).created_at))+" "+c(De(s(k).created_at)),1)]),o("div",null,[t[60]||(t[60]=o("label",{class:"block text-sm font-medium text-gray-700"},"承辦業務",-1)),o("p",Hs,c(s(k).assignee?.name||"未指派"),1)]),o("div",null,[t[61]||(t[61]=o("label",{class:"block text-sm font-medium text-gray-700"},"Email",-1)),o("p",Xs,c(s(k).email||"未提供"),1)]),o("div",null,[t[62]||(t[62]=o("label",{class:"block text-sm font-medium text-gray-700"},"LINE ID",-1)),o("p",Js,c(s(k).line_id||"未提供"),1)])]),s(k).notes?(i(),r("div",Ks,[t[63]||(t[63]=o("label",{class:"block text-sm font-medium text-gray-700"},"備註",-1)),o("p",Qs,c(s(k).notes),1)])):y("",!0)])):y("",!0)])])):y("",!0),s(te)?(i(),r("div",{key:2,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 mt-0",onClick:D(Le,["self"])},[o("div",Ys,[t[68]||(t[68]=o("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"送件（建立案件）",-1)),o("form",{onSubmit:D(ot,["prevent"]),class:"space-y-3"},[o("div",Zs,[o("div",null,[t[64]||(t[64]=o("label",{class:"block text-sm font-semibold text-gray-900 mb-1"},"貸款金額",-1)),p(o("input",{"onUpdate:modelValue":t[14]||(t[14]=e=>s(j).loan_amount=e),required:"",type:"number",min:"0",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,512),[[_,s(j).loan_amount,void 0,{number:!0}]])]),o("div",null,[t[65]||(t[65]=o("label",{class:"block text-sm font-semibold text-gray-900 mb-1"},"貸款類型",-1)),p(o("input",{"onUpdate:modelValue":t[15]||(t[15]=e=>s(j).loan_type=e),class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,512),[[_,s(j).loan_type]])]),o("div",el,[t[66]||(t[66]=o("label",{class:"block text-sm font-semibold text-gray-900 mb-1"},"備註",-1)),p(o("textarea",{"onUpdate:modelValue":t[16]||(t[16]=e=>s(j).notes=e),rows:"2",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,512),[[_,s(j).notes]])])]),o("div",{class:"flex justify-end space-x-3 pt-2"},[o("button",{type:"button",class:"px-4 py-2 border border-gray-300 rounded-lg",onClick:Le},"取消"),t[67]||(t[67]=o("button",{type:"submit",class:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700"},"送件",-1))])],32)])])):y("",!0),s(oe)?(i(),r("div",{key:3,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 mt-0",onClick:D(Ce,["self"])},[o("div",tl,[t[75]||(t[75]=o("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"指派承辦業務",-1)),o("form",{onSubmit:D(lt,["prevent"]),class:"space-y-4"},[s(E)?(i(),r("div",ol,[t[72]||(t[72]=o("div",{class:"text-sm text-gray-900 font-semibold mb-2"},"進線資訊：",-1)),o("div",sl,[o("div",ll,[t[69]||(t[69]=o("span",{class:"font-medium"},"進線編號：",-1)),L(c(re(s(E))),1)]),o("div",al,[t[70]||(t[70]=o("span",{class:"font-medium"},"Email：",-1)),L(c(s(E).email||"未提供"),1)]),o("div",nl,[t[71]||(t[71]=o("span",{class:"font-medium"},"LINE ID：",-1)),L(c(s(E).line_id||"未提供"),1)])])])):y("",!0),o("div",null,[t[74]||(t[74]=o("label",{class:"block text-sm font-semibold text-gray-900 mb-2"},[L("選擇承辦業務 "),o("span",{class:"text-red-500"},"*")],-1)),p(o("select",{"onUpdate:modelValue":t[17]||(t[17]=e=>s(A).assigned_to=e),required:"",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},[t[73]||(t[73]=o("option",{value:""},"請選擇業務人員",-1)),(i(!0),r(x,null,f(s(W).filter(e=>e.roles?.[0]?.name==="staff"),e=>(i(),r("option",{key:e.id,value:e.id},c(e.name||e.email)+" (業務) ",9,rl))),128))],512),[[N,s(A).assigned_to]])]),o("div",il,[o("button",{type:"button",class:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50",onClick:Ce}," 取消 "),o("button",{type:"submit",class:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",disabled:s(S)||!s(A).assigned_to},c(s(S)?"指派中...":"確認指派"),9,dl)])],32)])])):y("",!0),s(se)?(i(),r("div",{key:4,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 mt-0",onClick:D(Ve,["self"])},[o("div",ul,[t[78]||(t[78]=o("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"編輯LINE名稱",-1)),o("form",{onSubmit:D(nt,["prevent"]),class:"space-y-4"},[s(w)?(i(),r("div",cl,[t[76]||(t[76]=o("div",{class:"text-sm text-gray-900 font-semibold mb-2"},"LINE使用者資訊：",-1)),o("div",pl,[s(w).line_user_info?.picture_url?(i(),r("img",{key:0,src:s(w).line_user_info.picture_url,alt:s(w).line_user_info.display_name||"LINE用戶",class:"w-10 h-10 rounded-full object-cover",onError:t[18]||(t[18]=e=>e.target.style.display="none")},null,40,yl)):(i(),r("div",bl," L ")),o("div",null,[o("div",ml,c(s(w).line_user_info?.display_name||"未設定名稱"),1),o("div",gl,"進線編號："+c(re(s(w))),1)])])])):y("",!0),o("div",null,[t[77]||(t[77]=o("label",{class:"block text-sm font-semibold text-gray-900 mb-2"},[L("LINE名稱 "),o("span",{class:"text-red-500"},"*")],-1)),p(o("input",{"onUpdate:modelValue":t[19]||(t[19]=e=>s(I).display_name=e),required:"",maxlength:"100",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"請輸入LINE名稱"},null,512),[[_,s(I).display_name]])]),o("div",_l,[o("button",{type:"button",class:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50",onClick:Ve}," 取消 "),o("button",{type:"submit",class:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",disabled:s(S)||!s(I).display_name?.trim()},c(s(S)?"儲存中...":"儲存"),9,xl)])],32)])])):y("",!0)])}}},Tl=mt(fl,[["__scopeId","data-v-8a80b7a5"]]);export{Tl as default};
