import be from"./D3cojo9C.js";import ve from"./-Op9ZE8F.js";import fe from"./XQULDnv6.js";import he from"./BqPyo1yH.js";import ke from"./dEC6R0bn.js";import we from"./Vg4ySuqD.js";import De from"./C-5-XKM9.js";import Ve from"./BNIY59VZ.js";import Me from"./DgBX7xd1.js";import{h as Ce,u as Se,r as g,b as N,i as Te,c as v,a as t,e as l,k as r,t as n,d as s,F as I,q as O,A as B,o as p,j as y,s as P,f as Ue,x as U,E as W}from"#entry";import{u as $e}from"./Csg14XMH.js";import"./Dc4_b61V.js";import"./C1TBPVO2.js";import"./0es6LyBp.js";import"./BJ2ClxiI.js";import"./Cd8xZgT4.js";import"./mD2okE1y.js";import"./CI5qNQA5.js";import"./CHOj1P8S.js";import"./BlreP_uz.js";import"./DavVyERY.js";import"./UEvvKvg5.js";import"./Bm92f-5u.js";import"./CxIZtCgj.js";import"./nS2KoPbh.js";import"./Ca9-rUq1.js";import"./CGjWf7d3.js";import"./CC7AEF_M.js";import"./8RdW9T__.js";import"./DLM5oWup.js";import"./mGL09qS9.js";import"./Dqd9zge7.js";import"./BwtY8fMv.js";import"./CfdwNQdU.js";import"./Xhxc7jYu.js";import"./91ekCI0b.js";import"./wUKDeqpb.js";const je={class:"space-y-6"},Fe={class:"flex items-center justify-between"},Le={class:"flex gap-4"},Re={class:"grid grid-cols-1 md:grid-cols-4 gap-6"},ze={class:"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6"},Ee={class:"flex items-center justify-between"},Ne={class:"text-2xl font-bold text-gray-900 dark:text-white"},Ie={class:"p-3 bg-blue-100 dark:bg-blue-900 rounded-full"},Oe={class:"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6"},Be={class:"flex items-center justify-between"},Pe={class:"text-2xl font-bold text-red-600 dark:text-red-400"},Ye={class:"p-3 bg-red-100 dark:bg-red-900 rounded-full"},Ae={class:"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6"},We={class:"flex items-center justify-between"},qe={class:"text-2xl font-bold text-yellow-600 dark:text-yellow-400"},Ge={class:"p-3 bg-yellow-100 dark:bg-yellow-900 rounded-full"},He={class:"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6"},Je={class:"flex items-center justify-between"},Ke={class:"text-2xl font-bold text-green-600 dark:text-green-400"},Qe={class:"p-3 bg-green-100 dark:bg-green-900 rounded-full"},Xe={class:"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700"},Ze={class:"p-6 border-b border-gray-200 dark:border-gray-700"},et={class:"flex items-center justify-between"},tt={class:"flex items-center gap-4"},ot={class:"text-xl font-semibold text-gray-900 dark:text-white"},st={class:"flex gap-2"},at={class:"flex gap-2"},lt={class:"p-6"},rt={class:"grid grid-cols-7 gap-1 mb-4"},dt={class:"grid grid-cols-7 gap-1"},nt=["onClick"],it={class:"space-y-1"},ut=["onClick"],ct={class:"font-medium"},mt={class:"opacity-75"},gt={class:"p-6"},pt={class:"space-y-4"},yt={class:"flex gap-3 justify-end pt-4"},xt={key:0,class:"p-6"},_t={class:"flex items-center justify-between mb-4"},bt={class:"flex gap-2"},vt={class:"space-y-4"},ft={class:"grid grid-cols-2 gap-4"},ht={class:"text-gray-900 dark:text-white"},kt={class:"text-gray-900 dark:text-white"},wt={class:"grid grid-cols-2 gap-4"},Dt={class:"text-gray-900 dark:text-white"},Vt={class:"text-gray-900 dark:text-white"},Mt={class:"grid grid-cols-3 gap-4"},Ct={class:"text-gray-900 dark:text-white"},St={class:"text-gray-900 dark:text-white"},Tt={class:"text-gray-900 dark:text-white"},Ut={class:"grid grid-cols-2 gap-4"},$t={key:0},jt={class:"text-gray-900 dark:text-white whitespace-pre-wrap"},Ft={key:1},Lt={class:"text-gray-900 dark:text-white"},Rt={class:"flex gap-3 justify-end pt-6"},zt={class:"p-6"},Et={class:"space-y-4"},Nt={class:"flex gap-3 justify-end pt-4"},Vo={__name:"contact-calendar",setup(It){const f=$e(),{$api:h}=Ce();Se({title:"追蹤行事曆 - 金融管理系統"});const w=g(!1),D=g(!1),C=g(!1),L=g(!1),R=g(!1),z=g(!1),m=g(new Date),d=g(null),$=g([]),Y=g([]),T=g({today:0,overdue:0,needReminder:0,completed:0}),u=g({customer_id:null,scheduled_date:"",scheduled_time:"",contact_type:"phone",priority:"medium",notes:""}),k=g({new_date:"",new_time:"",notes:""}),q=["日","一","二","三","四","五","六"],G=[{label:"電話",value:"phone"},{label:"LINE",value:"line"},{label:"Email",value:"email"},{label:"會面",value:"meeting"},{label:"其他",value:"other"}],H=[{label:"高",value:"high"},{label:"中",value:"medium"},{label:"低",value:"low"}],J=N(()=>m.value.getFullYear()),K=N(()=>m.value.getMonth()+1),Q=N(()=>{const o=m.value.getFullYear(),e=m.value.getMonth(),i=new Date(o,e,1),x=new Date(o,e+1,0),_=new Date(i),c=new Date(x);_.setDate(_.getDate()-_.getDay()),c.setDate(c.getDate()+(6-c.getDay()));const M=[],b=new Date(_),F=new Date;for(;b<=c;)M.push({date:b.getDate(),fullDate:b.toISOString().split("T")[0],isCurrentMonth:b.getMonth()===e,isToday:b.toDateString()===F.toDateString()}),b.setDate(b.getDate()+1);return M}),X=()=>{m.value=new Date(m.value.getFullYear(),m.value.getMonth()-1,1),V()},Z=()=>{m.value=new Date(m.value.getFullYear(),m.value.getMonth()+1,1),V()},ee=()=>{m.value=new Date,V()},te=o=>{o.isCurrentMonth&&(u.value.scheduled_date=o.fullDate,w.value=!0)},oe=o=>$.value.filter(e=>e.scheduled_date===o),se=o=>{const e="block";switch(o.status){case"scheduled":return o.priority==="high"?`${e} bg-red-100 dark:bg-red-900/50 text-red-800 dark:text-red-200`:o.priority==="medium"?`${e} bg-blue-100 dark:bg-blue-900/50 text-blue-800 dark:text-blue-200`:`${e} bg-gray-100 dark:bg-gray-800 text-gray-800 dark:text-gray-200`;case"contacted":return`${e} bg-green-100 dark:bg-green-900/50 text-green-800 dark:text-green-200`;case"rescheduled":return`${e} bg-yellow-100 dark:bg-yellow-900/50 text-yellow-800 dark:text-yellow-200`;case"missed":return`${e} bg-red-100 dark:bg-red-900/50 text-red-800 dark:text-red-200 line-through`;case"completed":return`${e} bg-green-100 dark:bg-green-900/50 text-green-800 dark:text-green-200`;default:return`${e} bg-gray-100 dark:bg-gray-800 text-gray-800 dark:text-gray-200`}},ae=o=>{d.value=o,D.value=!0},V=async()=>{try{const o=m.value.getFullYear(),e=m.value.getMonth()+1,i=await h("/contact-schedules/calendar/data",{params:{year:o,month:e}});i.success&&($.value=[],Object.keys(i.data).forEach(x=>{i.data[x].forEach(_=>{$.value.push(_)})}))}catch(o){console.error("載入行事曆數據失敗:",o),f.add({title:"載入失敗",description:"無法載入行事曆數據，請重試",color:"red"})}},j=async()=>{try{const[o,e,i]=await Promise.all([h("/contact-schedules/today/list"),h("/contact-schedules/overdue/list"),h("/contact-schedules/reminders/list")]);T.value={today:o.success?o.data.length:0,overdue:e.success?e.data.length:0,needReminder:i.success?i.data.length:0,completed:$.value.filter(x=>x.status==="completed").length}}catch(o){console.error("載入統計數據失敗:",o)}},le=async()=>{try{z.value=!0;const o=await h("/customers",{params:{per_page:1e3}});o.success&&(Y.value=o.data.data||[])}catch(o){console.error("載入客戶列表失敗:",o),f.add({title:"載入失敗",description:"無法載入客戶列表",color:"red"})}finally{z.value=!1}},re=async()=>{try{L.value=!0,(await h("/contact-schedules",{method:"POST",body:u.value})).success&&(f.add({title:"建立成功",description:"聯絡計畫已建立",color:"green"}),w.value=!1,ie(),await V(),await j())}catch(o){console.error("建立聯絡計畫失敗:",o),f.add({title:"建立失敗",description:o.data?.message||"無法建立聯絡計畫",color:"red"})}finally{L.value=!1}},de=async()=>{try{(await h(`/contact-schedules/${d.value.id}/contacted`,{method:"POST",body:{notes:"已透過行事曆標記為聯絡完成"}})).success&&(f.add({title:"標記成功",description:"已標記為聯絡完成",color:"green"}),D.value=!1,await V(),await j())}catch(o){console.error("標記失敗:",o),f.add({title:"標記失敗",description:o.data?.message||"無法標記為已聯絡",color:"red"})}},ne=async()=>{try{R.value=!0,(await h(`/contact-schedules/${d.value.id}/reschedule`,{method:"POST",body:k.value})).success&&(f.add({title:"改約成功",description:"聯絡時間已改約",color:"green"}),C.value=!1,D.value=!1,await V(),await j())}catch(o){console.error("改約失敗:",o),f.add({title:"改約失敗",description:o.data?.message||"無法改約時間",color:"red"})}finally{R.value=!1}},ie=()=>{u.value={customer_id:null,scheduled_date:"",scheduled_time:"",contact_type:"phone",priority:"medium",notes:""}},ue=o=>({phone:"電話",line:"LINE",email:"Email",meeting:"會面",other:"其他"})[o]||o,ce=o=>({scheduled:"已排程",contacted:"已聯絡",rescheduled:"已改約",missed:"未聯絡",completed:"已完成"})[o]||o,me=o=>({scheduled:"blue",contacted:"green",rescheduled:"yellow",missed:"red",completed:"green"})[o]||"gray",ge=o=>({high:"高",medium:"中",low:"低"})[o]||o,pe=o=>({high:"red",medium:"yellow",low:"gray"})[o]||"gray",ye=o=>o?new Date(o).toLocaleDateString("zh-TW"):"",xe=o=>o?new Date(o).toLocaleString("zh-TW"):"";return Te(async()=>{await le(),await V(),await j()}),(o,e)=>{const i=be,x=ve,_=fe,c=he,M=ke,b=we,F=De,E=Ve,A=Me;return p(),v("div",je,[t("div",Fe,[e[18]||(e[18]=t("div",null,[t("h1",{class:"text-3xl font-bold text-gray-900 dark:text-white"},"追蹤行事曆"),t("p",{class:"text-gray-600 dark:text-gray-300 mt-2"},"管理客戶聯絡排程和追蹤提醒")],-1)),t("div",Le,[l(i,{icon:"i-heroicons-plus",onClick:e[0]||(e[0]=a=>w.value=!0),color:"primary"},{default:r(()=>[...e[17]||(e[17]=[y(" 新增聯絡計畫 ",-1)])]),_:1})])]),t("div",Re,[t("div",ze,[t("div",Ee,[t("div",null,[e[19]||(e[19]=t("p",{class:"text-sm text-gray-600 dark:text-gray-400"},"今日計畫",-1)),t("p",Ne,n(s(T).today),1)]),t("div",Ie,[l(x,{name:"i-heroicons-calendar-days",class:"w-6 h-6 text-blue-600 dark:text-blue-400"})])])]),t("div",Oe,[t("div",Be,[t("div",null,[e[20]||(e[20]=t("p",{class:"text-sm text-gray-600 dark:text-gray-400"},"逾期未聯絡",-1)),t("p",Pe,n(s(T).overdue),1)]),t("div",Ye,[l(x,{name:"i-heroicons-exclamation-triangle",class:"w-6 h-6 text-red-600 dark:text-red-400"})])])]),t("div",Ae,[t("div",We,[t("div",null,[e[21]||(e[21]=t("p",{class:"text-sm text-gray-600 dark:text-gray-400"},"需要提醒",-1)),t("p",qe,n(s(T).needReminder),1)]),t("div",Ge,[l(x,{name:"i-heroicons-bell",class:"w-6 h-6 text-yellow-600 dark:text-yellow-400"})])])]),t("div",He,[t("div",Je,[t("div",null,[e[22]||(e[22]=t("p",{class:"text-sm text-gray-600 dark:text-gray-400"},"本月完成",-1)),t("p",Ke,n(s(T).completed),1)]),t("div",Qe,[l(x,{name:"i-heroicons-check-circle",class:"w-6 h-6 text-green-600 dark:text-green-400"})])])])]),t("div",Xe,[t("div",Ze,[t("div",et,[t("div",tt,[t("h2",ot,n(s(J))+"年"+n(s(K))+"月 ",1),t("div",st,[l(i,{icon:"i-heroicons-chevron-left",variant:"ghost",size:"sm",onClick:X}),l(i,{icon:"i-heroicons-chevron-right",variant:"ghost",size:"sm",onClick:Z})])]),t("div",at,[l(i,{variant:"ghost",size:"sm",onClick:ee},{default:r(()=>[...e[23]||(e[23]=[y(" 今天 ",-1)])]),_:1})])])]),t("div",lt,[t("div",rt,[(p(),v(I,null,O(q,a=>t("div",{key:a,class:"p-2 text-center text-sm font-medium text-gray-500 dark:text-gray-400"},n(a),1)),64))]),t("div",dt,[(p(!0),v(I,null,O(s(Q),(a,_e)=>(p(),v("div",{key:_e,class:P(["min-h-[120px] p-2 border border-gray-100 dark:border-gray-700 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors cursor-pointer",{"bg-gray-50 dark:bg-gray-800":!a.isCurrentMonth,"bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-700":a.isToday,"text-gray-400 dark:text-gray-600":!a.isCurrentMonth}]),onClick:S=>te(a)},[t("div",{class:P(["text-sm font-medium mb-1",{"text-blue-600 dark:text-blue-400 font-bold":a.isToday,"text-gray-400 dark:text-gray-600":!a.isCurrentMonth,"text-gray-900 dark:text-white":a.isCurrentMonth&&!a.isToday}])},n(a.date),3),t("div",it,[(p(!0),v(I,null,O(oe(a.fullDate),S=>(p(),v("div",{key:S.id,class:P(["text-xs p-1 rounded truncate cursor-pointer",se(S)]),onClick:Ue(Ot=>ae(S),["stop"])},[t("div",ct,n(S.customer?.name||"未知客戶"),1),t("div",mt,n(S.scheduled_time||"全天"),1)],10,ut))),128))])],10,nt))),128))])])]),l(E,{modelValue:s(w),"onUpdate:modelValue":e[8]||(e[8]=a=>B(w)?w.value=a:null),ui:{width:"sm:max-w-lg"}},{default:r(()=>[t("div",gt,[e[26]||(e[26]=t("h3",{class:"text-lg font-semibold text-gray-900 dark:text-white mb-4"},"新增聯絡計畫",-1)),l(F,{state:s(u),onSubmit:re},{default:r(()=>[t("div",pt,[l(c,{label:"客戶",name:"customer_id"},{default:r(()=>[l(_,{modelValue:s(u).customer_id,"onUpdate:modelValue":e[1]||(e[1]=a=>s(u).customer_id=a),options:s(Y),"option-attribute":"name","value-attribute":"id",placeholder:"選擇客戶",searchable:"",loading:s(z)},null,8,["modelValue","options","loading"])]),_:1}),l(c,{label:"聯絡日期",name:"scheduled_date"},{default:r(()=>[l(M,{modelValue:s(u).scheduled_date,"onUpdate:modelValue":e[2]||(e[2]=a=>s(u).scheduled_date=a),type:"date",min:new Date().toISOString().split("T")[0]},null,8,["modelValue","min"])]),_:1}),l(c,{label:"聯絡時間",name:"scheduled_time"},{default:r(()=>[l(M,{modelValue:s(u).scheduled_time,"onUpdate:modelValue":e[3]||(e[3]=a=>s(u).scheduled_time=a),type:"time",placeholder:"選填"},null,8,["modelValue"])]),_:1}),l(c,{label:"聯絡方式",name:"contact_type"},{default:r(()=>[l(_,{modelValue:s(u).contact_type,"onUpdate:modelValue":e[4]||(e[4]=a=>s(u).contact_type=a),options:G,placeholder:"選擇聯絡方式"},null,8,["modelValue"])]),_:1}),l(c,{label:"優先級",name:"priority"},{default:r(()=>[l(_,{modelValue:s(u).priority,"onUpdate:modelValue":e[5]||(e[5]=a=>s(u).priority=a),options:H,placeholder:"選擇優先級"},null,8,["modelValue"])]),_:1}),l(c,{label:"備註",name:"notes"},{default:r(()=>[l(b,{modelValue:s(u).notes,"onUpdate:modelValue":e[6]||(e[6]=a=>s(u).notes=a),placeholder:"輸入備註...",rows:3},null,8,["modelValue"])]),_:1}),t("div",yt,[l(i,{variant:"ghost",onClick:e[7]||(e[7]=a=>w.value=!1)},{default:r(()=>[...e[24]||(e[24]=[y(" 取消 ",-1)])]),_:1}),l(i,{type:"submit",loading:s(L)},{default:r(()=>[...e[25]||(e[25]=[y(" 建立計畫 ",-1)])]),_:1},8,["loading"])])])]),_:1},8,["state"])])]),_:1},8,["modelValue"]),l(E,{modelValue:s(D),"onUpdate:modelValue":e[11]||(e[11]=a=>B(D)?D.value=a:null),ui:{width:"sm:max-w-2xl"}},{default:r(()=>[s(d)?(p(),v("div",xt,[t("div",_t,[e[29]||(e[29]=t("h3",{class:"text-lg font-semibold text-gray-900 dark:text-white"},"聯絡計畫詳情",-1)),t("div",bt,[s(d).status==="scheduled"?(p(),W(i,{key:0,size:"xs",color:"green",onClick:de},{default:r(()=>[...e[27]||(e[27]=[y(" 標記已聯絡 ",-1)])]),_:1})):U("",!0),s(d).status==="scheduled"?(p(),W(i,{key:1,size:"xs",color:"orange",onClick:e[9]||(e[9]=a=>C.value=!0)},{default:r(()=>[...e[28]||(e[28]=[y(" 改約時間 ",-1)])]),_:1})):U("",!0)])]),t("div",vt,[t("div",ft,[t("div",null,[e[30]||(e[30]=t("label",{class:"text-sm font-medium text-gray-500 dark:text-gray-400"},"客戶姓名",-1)),t("p",ht,n(s(d).customer?.name||"未知客戶"),1)]),t("div",null,[e[31]||(e[31]=t("label",{class:"text-sm font-medium text-gray-500 dark:text-gray-400"},"客戶等級",-1)),t("p",kt,n(s(d).customer?.level||"未設定"),1)])]),t("div",wt,[t("div",null,[e[32]||(e[32]=t("label",{class:"text-sm font-medium text-gray-500 dark:text-gray-400"},"Line 顯示名稱",-1)),t("p",Dt,n(s(d).customer?.line_display_name||"無"),1)]),t("div",null,[e[33]||(e[33]=t("label",{class:"text-sm font-medium text-gray-500 dark:text-gray-400"},"聯絡電話",-1)),t("p",Vt,n(s(d).customer?.phone||"無"),1)])]),t("div",Mt,[t("div",null,[e[34]||(e[34]=t("label",{class:"text-sm font-medium text-gray-500 dark:text-gray-400"},"預計日期",-1)),t("p",Ct,n(ye(s(d).scheduled_date)),1)]),t("div",null,[e[35]||(e[35]=t("label",{class:"text-sm font-medium text-gray-500 dark:text-gray-400"},"預計時間",-1)),t("p",St,n(s(d).scheduled_time||"全天"),1)]),t("div",null,[e[36]||(e[36]=t("label",{class:"text-sm font-medium text-gray-500 dark:text-gray-400"},"聯絡方式",-1)),t("p",Tt,n(ue(s(d).contact_type)),1)])]),t("div",Ut,[t("div",null,[e[37]||(e[37]=t("label",{class:"text-sm font-medium text-gray-500 dark:text-gray-400"},"狀態",-1)),l(A,{color:me(s(d).status)},{default:r(()=>[y(n(ce(s(d).status)),1)]),_:1},8,["color"])]),t("div",null,[e[38]||(e[38]=t("label",{class:"text-sm font-medium text-gray-500 dark:text-gray-400"},"優先級",-1)),l(A,{color:pe(s(d).priority)},{default:r(()=>[y(n(ge(s(d).priority)),1)]),_:1},8,["color"])])]),s(d).notes?(p(),v("div",$t,[e[39]||(e[39]=t("label",{class:"text-sm font-medium text-gray-500 dark:text-gray-400"},"備註",-1)),t("p",jt,n(s(d).notes),1)])):U("",!0),s(d).actual_contact_at?(p(),v("div",Ft,[e[40]||(e[40]=t("label",{class:"text-sm font-medium text-gray-500 dark:text-gray-400"},"實際聯絡時間",-1)),t("p",Lt,n(xe(s(d).actual_contact_at)),1)])):U("",!0)]),t("div",Rt,[l(i,{variant:"ghost",onClick:e[10]||(e[10]=a=>D.value=!1)},{default:r(()=>[...e[41]||(e[41]=[y(" 關閉 ",-1)])]),_:1})])])):U("",!0)]),_:1},8,["modelValue"]),l(E,{modelValue:s(C),"onUpdate:modelValue":e[16]||(e[16]=a=>B(C)?C.value=a:null),ui:{width:"sm:max-w-md"}},{default:r(()=>[t("div",zt,[e[44]||(e[44]=t("h3",{class:"text-lg font-semibold text-gray-900 dark:text-white mb-4"},"改約時間",-1)),l(F,{state:s(k),onSubmit:ne},{default:r(()=>[t("div",Et,[l(c,{label:"新日期",name:"new_date"},{default:r(()=>[l(M,{modelValue:s(k).new_date,"onUpdate:modelValue":e[12]||(e[12]=a=>s(k).new_date=a),type:"date",min:new Date().toISOString().split("T")[0]},null,8,["modelValue","min"])]),_:1}),l(c,{label:"新時間",name:"new_time"},{default:r(()=>[l(M,{modelValue:s(k).new_time,"onUpdate:modelValue":e[13]||(e[13]=a=>s(k).new_time=a),type:"time",placeholder:"選填"},null,8,["modelValue"])]),_:1}),l(c,{label:"改約原因",name:"notes"},{default:r(()=>[l(b,{modelValue:s(k).notes,"onUpdate:modelValue":e[14]||(e[14]=a=>s(k).notes=a),placeholder:"輸入改約原因...",rows:3},null,8,["modelValue"])]),_:1}),t("div",Nt,[l(i,{variant:"ghost",onClick:e[15]||(e[15]=a=>C.value=!1)},{default:r(()=>[...e[42]||(e[42]=[y(" 取消 ",-1)])]),_:1}),l(i,{type:"submit",loading:s(R)},{default:r(()=>[...e[43]||(e[43]=[y(" 確認改約 ",-1)])]),_:1},8,["loading"])])])]),_:1},8,["state"])])]),_:1},8,["modelValue"])])}}};export{Vo as default};
