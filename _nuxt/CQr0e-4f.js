import{r as b,H as S,i as T,c as a,a as e,x,d as o,F as w,q as h,f as q,t as i,g as n,v as m,I as D,j as C,L as V,A as L,o as d}from"#entry";import{u as O}from"./DzJdZt_Q.js";import"./DgLT0ASK.js";const I={class:"space-y-6"},K={class:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden"},$={class:"overflow-x-auto"},z={class:"w-full"},H={class:"bg-white divide-y divide-gray-200"},P={key:0},R={class:"px-6 py-3"},Y={class:"px-6 py-3"},G={class:"px-6 py-3"},J={class:"px-6 py-3"},Q={class:"px-6 py-3"},W={class:"px-6 py-3"},X={class:"px-6 py-3 space-x-2"},Z=["onClick"],ee=["onClick"],te={key:1},se={class:"bg-white rounded-lg p-6 w-full max-w-xl"},le={class:"text-lg font-semibold text-gray-900 mb-4"},oe={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},re=["disabled"],ie=["value"],ae={class:"inline-flex items-center mt-7"},de={class:"inline-flex items-center mt-7"},ne={key:0},ue={class:"flex justify-end space-x-3 pt-2"},pe=["disabled"],ge={__name:"custom-fields",setup(be){const{list:j,create:F,update:U,remove:M}=O(),_=[{value:"text",label:"文字"},{value:"textarea",label:"文字區塊"},{value:"number",label:"數字"},{value:"decimal",label:"小數"},{value:"date",label:"日期"},{value:"select",label:"單選"},{value:"multiselect",label:"多選"},{value:"boolean",label:"是/否"}],g=b([]),c=b(!1),p=b(!1),y=b(!1),u=b(""),l=S({id:null,entity_type:"case",key:"",label:"",type:"text",is_required:!1,is_visible:!0,sort_order:0,options:[]}),v=async()=>{c.value=!0;const{success:r,items:t}=await j("case");r&&(g.value=t),c.value=!1};T(v);const A=()=>{Object.assign(l,{id:null,entity_type:"case",key:"",label:"",type:"text",is_required:!1,is_visible:!0,sort_order:0,options:[]}),u.value="",p.value=!0},B=r=>{Object.assign(l,{id:r.id,entity_type:"case",key:r.key,label:r.label,type:r.type,is_required:!!r.is_required,is_visible:!!r.is_visible,sort_order:r.sort_order||0,options:r.options||[]}),u.value=Array.isArray(r.options)?r.options.join(","):"",p.value=!0},k=()=>{p.value=!1},E=async()=>{y.value=!0;try{const r={entity_type:"case",key:l.key,label:l.label,type:l.type,is_required:!!l.is_required,is_visible:!!l.is_visible,sort_order:Number(l.sort_order)||0,options:["select","multiselect"].includes(l.type)?u.value.split(",").map(s=>s.trim()).filter(Boolean):[]};let t;l.id?t=await U(l.id,r):t=await F(r),t.error||(p.value=!1,await v())}finally{y.value=!1}},N=async r=>{if(!confirm("確定刪除該欄位？"))return;const{error:t}=await M(r.id);t||await v()};return(r,t)=>(d(),a("div",I,[e("div",{class:"flex items-center justify-between"},[t[7]||(t[7]=e("div",null,[e("h1",{class:"text-3xl font-bold text-gray-900"},"自定義欄位（案件）"),e("p",{class:"text-gray-600 mt-2"},"管理 entity_type = case 的欄位（支援：文字、文字區塊、數字、小數、日期、單選、多選、是/否）")],-1)),e("button",{onClick:A,class:"px-3 py-2 bg-blue-600 text-white rounded"},"新增欄位")]),e("div",K,[t[11]||(t[11]=e("div",{class:"px-6 py-4 border-b border-gray-200 bg-gray-50 flex items-center justify-between"},[e("h3",{class:"text-lg font-medium text-gray-900"},"欄位清單")],-1)),e("div",$,[e("table",z,[t[10]||(t[10]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"排序"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"名稱"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"鍵值 Key"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"類型"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"必填"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"顯示"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"操作")])],-1)),e("tbody",H,[o(c)?(d(),a("tr",P,[...t[8]||(t[8]=[e("td",{colspan:"7",class:"px-6 py-6 text-center text-gray-500"},"載入中...",-1)])])):x("",!0),(d(!0),a(w,null,h(o(g),s=>(d(),a("tr",{key:s.id},[e("td",R,i(s.sort_order),1),e("td",Y,i(s.label),1),e("td",G,i(s.key),1),e("td",J,i(_.find(f=>f.value===s.type)?.label||s.type),1),e("td",Q,i(s.is_required?"是":"否"),1),e("td",W,i(s.is_visible?"是":"否"),1),e("td",X,[e("button",{class:"px-2 py-1 border rounded",onClick:f=>B(s)},"編輯",8,Z),e("button",{class:"px-2 py-1 border rounded text-red-600",onClick:f=>o(N)(s)},"刪除",8,ee)])]))),128)),!o(c)&&o(g).length===0?(d(),a("tr",te,[...t[9]||(t[9]=[e("td",{colspan:"7",class:"px-6 py-6 text-center text-gray-500"},"沒有資料",-1)])])):x("",!0)])])])]),o(p)?(d(),a("div",{key:0,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",onClick:q(k,["self"])},[e("div",se,[e("h3",le,i(o(l).id?"編輯欄位":"新增欄位"),1),e("form",{onSubmit:q(E,["prevent"]),class:"space-y-3"},[e("div",oe,[e("div",null,[t[12]||(t[12]=e("label",{class:"block text-sm mb-1"},"顯示名稱 (label)",-1)),n(e("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>o(l).label=s),required:"",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,512),[[m,o(l).label]])]),e("div",null,[t[13]||(t[13]=e("label",{class:"block text-sm mb-1"},"鍵值 Key",-1)),n(e("input",{"onUpdate:modelValue":t[1]||(t[1]=s=>o(l).key=s),disabled:!!o(l).id,required:"",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,8,re),[[m,o(l).key]])]),e("div",null,[t[14]||(t[14]=e("label",{class:"block text-sm mb-1"},"類型",-1)),n(e("select",{"onUpdate:modelValue":t[2]||(t[2]=s=>o(l).type=s),required:"",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},[(d(),a(w,null,h(_,s=>e("option",{key:s.value,value:s.value},i(s.label),9,ie)),64))],512),[[D,o(l).type]])]),e("div",null,[e("label",ae,[n(e("input",{type:"checkbox","onUpdate:modelValue":t[3]||(t[3]=s=>o(l).is_required=s),class:"mr-2"},null,512),[[V,o(l).is_required]]),t[15]||(t[15]=C(" 必填 ",-1))])]),e("div",null,[t[16]||(t[16]=e("label",{class:"block text-sm mb-1"},"排序",-1)),n(e("input",{"onUpdate:modelValue":t[4]||(t[4]=s=>o(l).sort_order=s),type:"number",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,512),[[m,o(l).sort_order,void 0,{number:!0}]])]),e("div",null,[e("label",de,[n(e("input",{type:"checkbox","onUpdate:modelValue":t[5]||(t[5]=s=>o(l).is_visible=s),class:"mr-2"},null,512),[[V,o(l).is_visible]]),t[17]||(t[17]=C(" 顯示 ",-1))])])]),["select","multiselect"].includes(o(l).type)?(d(),a("div",ne,[t[18]||(t[18]=e("label",{class:"block text-sm mb-1"},"選項 (以逗號分隔)",-1)),n(e("input",{"onUpdate:modelValue":t[6]||(t[6]=s=>L(u)?u.value=s:null),class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"例如：高,中,低"},null,512),[[m,o(u)]])])):x("",!0),e("div",ue,[e("button",{type:"button",class:"px-4 py-2 border rounded",onClick:k},"取消"),e("button",{type:"submit",class:"px-4 py-2 bg-blue-600 text-white rounded",disabled:o(y)},i(o(y)?"儲存中...":"儲存"),9,pe)])],32)])])):x("",!0)]))}};export{ge as default};
