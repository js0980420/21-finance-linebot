import{c as d,o as l,a as e,u as be,r as h,b as ne,i as ke,y as $e,x as A,e as k,j as le,d as a,E as F,R as M,t as m,F as p,q as _,s as P,g as ie,v as Ae,A as Pe,f as Ce,I as Re}from"#entry";import{u as Fe}from"./BtlpaPqX.js";import{a as Me}from"./DgLT0ASK.js";import{u as je}from"./CCH93LFy.js";import{r as Z}from"./G1mM6o1b.js";import{r as Ue,a as Ee,b as Ve}from"./ucBMxYjt.js";import{r as Se}from"./BC8p3SKJ.js";import{r as ce}from"./D4TV4JXr.js";import{r as De}from"./CKtbBPOe.js";import{r as Be}from"./Bi0YyG7H.js";import{r as Q}from"./DWNj0d99.js";import{r as He}from"./DW5NWq0j.js";import{r as Te}from"./UqRq4KLf.js";function ze($,b){return l(),d("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M3.75 21h16.5M4.5 3h15M5.25 3v18m13.5-18v18M9 6.75h1.5m-1.5 3h1.5m-1.5 3h1.5m3-6H15m-1.5 3H15m-1.5 3H15M9 21v-3.375c0-.621.504-1.125 1.125-1.125h3.75c.621 0 1.125.504 1.125 1.125V21"})])}function Le($,b){return l(),d("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M3.75 6A2.25 2.25 0 0 1 6 3.75h2.25A2.25 2.25 0 0 1 10.5 6v2.25a2.25 2.25 0 0 1-2.25 2.25H6a2.25 2.25 0 0 1-2.25-2.25V6ZM3.75 15.75A2.25 2.25 0 0 1 6 13.5h2.25a2.25 2.25 0 0 1 2.25 2.25V18a2.25 2.25 0 0 1-2.25 2.25H6A2.25 2.25 0 0 1 3.75 18v-2.25ZM13.5 6a2.25 2.25 0 0 1 2.25-2.25H18A2.25 2.25 0 0 1 20.25 6v2.25A2.25 2.25 0 0 1 18 10.5h-2.25a2.25 2.25 0 0 1-2.25-2.25V6ZM13.5 15.75a2.25 2.25 0 0 1 2.25-2.25H18a2.25 2.25 0 0 1 2.25 2.25V18A2.25 2.25 0 0 1 18 20.25h-2.25A2.25 2.25 0 0 1 13.5 18v-2.25Z"})])}const Oe=()=>{const{get:$,post:b,del:T}=Me();return{getPermissions:async()=>{try{const{data:g,error:v}=await $("/permissions");if(v)throw console.error("Error fetching permissions:",v),v;return g}catch(g){throw console.error("Failed to get permissions:",g),g}},getPermissionsByCategory:async g=>{const{data:v,error:c}=await $(`/permissions/category/${g}`);if(c)throw c;return v},getUserRoles:async g=>{const{data:v,error:c}=await $(`/users/${g}/roles`);if(c)throw c;return v},getRolePermissions:async g=>{try{const{data:v,error:c}=await $(`/roles/${g}/permissions`);if(c)throw console.error(`Error fetching permissions for role ${g}:`,c),c;return v}catch(v){throw console.error(`Failed to get role permissions for role ${g}:`,v),v}},assignPermissionToRole:async(g,v)=>{try{if(!g||!v)throw new Error("Role ID and permission name are required");const{data:c,error:y}=await b(`/roles/${g}/permissions`,{permission_name:v});if(y)throw console.error(`Error assigning permission ${v} to role ${g}:`,y),y;return c}catch(c){throw console.error(`Failed to assign permission ${v} to role ${g}:`,c),c}},removePermissionFromRole:async(g,v)=>{try{if(!g||!v)throw new Error("Role ID and permission name are required");const{data:c,error:y}=await T(`/roles/${g}/permissions/${v}`);if(y)throw console.error(`Error removing permission ${v} from role ${g}:`,y),y;return c}catch(c){throw console.error(`Failed to remove permission ${v} from role ${g}:`,c),c}}}},qe={class:"space-y-6"},Ze={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4"},Qe={class:"flex items-center space-x-3"},Ge={key:0,class:"text-center py-12"},Ie={key:1},Je={key:0,class:"space-y-6"},Ke={class:"bg-white rounded-lg shadow-sm p-6"},We={class:"flex items-center justify-between mb-6"},Xe={class:"text-sm text-gray-500"},Ye={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4"},Ne=["onClick"],es={class:"flex items-center space-x-3 mb-3"},ss={class:"font-semibold text-gray-900"},ts={class:"space-y-2"},os={class:"flex items-center justify-between"},rs={class:"text-xs font-medium text-gray-900"},as={class:"flex items-center justify-between"},ns={class:"text-xs font-medium text-gray-900"},ls={key:0,class:"absolute top-2 right-2"},is={key:0,class:"grid grid-cols-1 xl:grid-cols-3 gap-6"},cs={class:"xl:col-span-2 bg-white rounded-lg shadow-sm"},ds={class:"p-6"},us={class:"flex items-center justify-between mb-6"},ms={class:"flex items-center space-x-3"},vs={class:"text-xl font-semibold text-gray-900"},gs={class:"flex items-center space-x-2"},ys={class:"space-y-4 max-h-96 overflow-y-auto"},fs=["onClick"],xs={class:"flex items-center space-x-3"},hs={class:"font-medium text-gray-900 capitalize"},ps={class:"inline-flex px-2 py-1 text-xs bg-gray-100 text-gray-600 rounded-full"},_s={class:"flex items-center space-x-2"},ws={class:"text-xs text-gray-500"},bs=["checked","indeterminate","onClick"],ks={key:0,class:"border-t border-gray-200"},$s={class:"p-4 space-y-3"},As=["id","checked","onChange"],Ps={class:"flex-1 min-w-0"},Cs=["for"],Rs={class:"text-xs text-gray-500 mt-1"},Fs={class:"space-y-6"},Ms={class:"bg-white rounded-lg shadow-sm p-6"},js={class:"space-y-4"},Us={class:"flex items-center justify-between"},Es={class:"text-lg font-semibold text-gray-900"},Vs={class:"flex items-center justify-between"},Ss={class:"text-lg font-semibold text-gray-900"},Ds={class:"flex items-center justify-between"},Bs={class:"text-lg font-semibold text-primary-600"},Hs={class:"bg-white rounded-lg shadow-sm p-6"},Ts={class:"flex items-center justify-between mb-4"},zs={class:"space-y-3 max-h-64 overflow-y-auto"},Ls=["src","alt"],Os={class:"flex-1 min-w-0"},qs={class:"text-sm font-medium text-gray-900 truncate"},Zs={class:"text-xs text-gray-500 truncate"},Qs=["onClick"],Gs={key:0,class:"text-center py-8"},Is={key:1,class:"bg-white rounded-lg shadow-sm"},Js={class:"p-6"},Ks={class:"flex items-center justify-between mb-6"},Ws={class:"flex items-center space-x-3"},Xs={class:"overflow-x-auto"},Ys={class:"min-w-full"},Ns={class:"border-b border-gray-200"},et={class:"flex flex-col items-center space-y-1"},st={class:"text-xs"},tt={class:"bg-gray-50"},ot={colspan:"100%",class:"py-2 px-4 font-medium text-gray-900 text-sm capitalize"},rt={class:"py-3 px-4 sticky left-0 bg-white"},at={class:"text-sm font-medium text-gray-900"},nt={class:"text-xs text-gray-500"},lt=["checked","onChange"],it={key:2,class:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4"},ct={class:"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-96 overflow-hidden"},dt={class:"p-6"},ut={class:"flex items-center justify-between mb-4"},mt={class:"grid grid-cols-2 gap-4 overflow-y-auto max-h-80"},vt={class:"space-y-2"},gt=["src","alt"],yt={class:"flex-1 min-w-0"},ft={class:"text-sm font-medium text-gray-900 truncate"},xt=["onUpdate:modelValue","onChange"],ht=["value"],pt={class:"space-y-2"},_t={class:"flex items-center space-x-2"},wt={class:"text-sm font-medium text-gray-900"},bt={class:"text-xs bg-gray-200 text-gray-700 px-2 py-1 rounded-full"},kt={key:3,class:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4"},$t={class:"bg-white rounded-lg shadow-xl max-w-md w-full"},At={class:"p-6"},Pt={class:"flex items-center justify-between mb-4"},Ct={class:"space-y-3 max-h-64 overflow-y-auto"},Rt=["src","alt"],Ft={class:"flex-1 min-w-0"},Mt={class:"text-sm font-medium text-gray-900"},jt={class:"text-xs text-gray-500"},Ut=["onClick"],Et={key:0,class:"text-center py-8"},Jt={__name:"permissions",setup($){be({title:"權限管理 - 金融管理系統"});const{error:b}=Fe(),{getPermissions:T,getRolePermissions:z,assignPermissionToRole:E,removePermissionFromRole:V}=Oe(),{getUsers:G,getRoles:I,assignRole:J,removeUserFromRole:g}=je(),v=h(!0),c=h({}),y=h([]),C=h([]),n=h(null),i=h([]),x=h({}),j=h("roles"),L=h(!1),S=h(!1),w=h([]),R=h(""),O=h({}),q=async()=>{try{v.value=!0,console.log("Loading permissions management data...");const[o,s,t]=await Promise.allSettled([T(),I(),G()]);o.status==="fulfilled"?(c.value=o.value.permissions||{},console.log("Permissions loaded:",Object.keys(c.value).length,"categories")):(console.error("Failed to load permissions:",o.reason),c.value={}),s.status==="fulfilled"?(y.value=s.value||[],console.log("Roles loaded:",y.value.length,"roles")):(console.error("Failed to load roles:",s.reason),y.value=[]),t.status==="fulfilled"?(C.value=t.value.data||t.value||[],console.log("Users loaded:",C.value.length,"users")):(console.error("Failed to load users:",t.reason),C.value=[]),Object.keys(c.value).length>0?w.value=[Object.keys(c.value)[0]]:w.value=[],y.value.length>0&&await de(),console.log("Permissions management data loaded successfully")}catch(o){console.error("Critical error loading permission data:",o),await b("載入權限資料時發生錯誤，請重新整理頁面或聯繫系統管理員")}finally{v.value=!1}},de=async()=>{try{const o=y.value.map(async t=>{try{const r=await z(t.id);return{roleId:t.id,permissions:r.permissions||[]}}catch(r){return console.error(`Failed to load permissions for role ${t.id}:`,r),{roleId:t.id,permissions:[]}}});if((await Promise.all(o)).forEach(({roleId:t,permissions:r})=>{x.value[t]=r}),n.value){const t=x.value[n.value.id];i.value=Array.isArray(t)?t:[]}}catch(o){console.error("Failed to load role permissions:",o)}},ue=async o=>{n.value=o;const s=x.value[o.id];i.value=Array.isArray(s)?s:[],x.value[o.id]||await D()},D=async()=>{if(!(!n.value||!n.value.id))try{const s=(await z(n.value.id)).permissions||[];i.value=Array.isArray(s)?s:[],x.value[n.value.id]=i.value}catch(o){console.error("Failed to load role permissions:",o),i.value=[]}},K=async o=>{if(!n.value){console.warn("No role selected for permission toggle");return}try{const s=Array.isArray(i.value)?i.value:[];s.includes(o)?(console.log(`Removing permission ${o} from role ${n.value.id}`),await V(n.value.id,o),i.value=s.filter(r=>r!==o)):(console.log(`Adding permission ${o} to role ${n.value.id}`),await E(n.value.id,o),s.includes(o)||(i.value=[...s,o])),x.value[n.value.id]=[...i.value],console.log(`Permission ${o} toggled successfully for role ${n.value.display_name}`)}catch(s){console.error("Failed to toggle permission:",s),await b(`權限設定失敗: ${s.message||"請檢查網路連線或聯繫系統管理員"}`),await D()}},me=o=>{Array.isArray(w.value)||(w.value=[]);const s=w.value.indexOf(o);s>-1?w.value.splice(s,1):w.value.push(o)},ve=async o=>{if(!n.value||!c.value[o])return;const s=c.value[o],t=se(o);try{if(t)for(const r of s){const u=Array.isArray(i.value)?i.value:[];u.includes(r.name)&&(await V(n.value.id,r.name),i.value=u.filter(f=>f!==r.name))}else{const r=Array.isArray(i.value)?i.value:[];for(const u of s)r.includes(u.name)||(await E(n.value.id,u.name),r.push(u.name));i.value=r}x.value[n.value.id]=i.value}catch(r){console.error("Failed to toggle category permissions:",r),await D()}},ge=async()=>{if(!n.value)return;const o=te(),s=ae.value;try{if(s){const t=Array.isArray(i.value)?i.value:[];for(const r of t)await V(n.value.id,r);i.value=[]}else{const t=Array.isArray(i.value)?i.value:[];for(const r of o)t.includes(r)||(await E(n.value.id,r),t.push(r));i.value=t}x.value[n.value.id]=i.value}catch(t){console.error("Failed to toggle all permissions:",t),await D()}},ye=async(o,s)=>{s&&await re(o,s)},fe=async(o,s)=>{const t=y.value.find(f=>f.id===o);if(!t){console.warn("Role not found for matrix toggle:",o);return}const r=n.value,u=[...i.value];try{n.value=t;const f=x.value[o];i.value=Array.isArray(f)?f:[],await K(s),x.value[o]=[...i.value]}catch(f){console.error("Failed to toggle role permission in matrix view:",f)}finally{if(n.value=r,r){const f=x.value[r.id];i.value=Array.isArray(f)?f:u}else i.value=Array.isArray(u)?u:[]}},B=o=>({admin:Se,executive:ze,manager:Ue,staff:Z,sales:Z})[o]||Z,H=o=>({admin:"text-purple-600",executive:"text-purple-600",manager:"text-blue-600",staff:"text-green-600",sales:"text-green-600"})[o]||"text-gray-600",W=o=>({admin:"bg-purple-100",executive:"bg-purple-100",manager:"bg-blue-100",staff:"bg-green-100",sales:"bg-green-100"})[o]||"bg-gray-100",X=o=>({users:"用戶管理",customers:"客戶管理",reports:"報表管理",chat:"聊天功能",system:"系統設定",finance:"財務管理"})[o]||o,U=o=>C.value.filter(s=>s.roles&&s.roles.some(t=>t.id===o)),Y=o=>o?C.value.filter(s=>!s.roles||!s.roles.some(t=>t.id===o)):[],xe=o=>x.value[o]?.length||0,N=o=>c.value[o]?.length||0,ee=o=>{if(!c.value[o]||!n.value)return 0;const s=Array.isArray(i.value)?i.value:[];return c.value[o].filter(t=>s.includes(t.name)).length},se=o=>{if(!c.value[o]||!n.value)return!1;const s=Array.isArray(i.value)?i.value:[];return c.value[o].every(t=>s.includes(t.name))},he=o=>{if(!c.value[o]||!n.value)return!1;const s=ee(o),t=N(o);return s>0&&s<t},pe=(o,s)=>x.value[s]?.includes(o)||!1,te=()=>{const o=[];return Object.values(c.value).forEach(s=>{s.forEach(t=>o.push(t.name))}),o},oe=()=>te().length,re=async(o,s)=>{try{const t=y.value.find(r=>r.id===s);t&&(await J(o,t.name),await q(),S.value=!1)}catch(t){console.error("Failed to assign user to role:",t),await b(`分配用戶到角色失敗: ${t.message}`)}},_e=async(o,s)=>{try{await g(o,s),await q()}catch(t){console.error("Failed to remove user from role:",t),await b(`移除用戶角色失敗: ${t.message}`)}},ae=ne(()=>{if(!n.value)return!1;const o=oe();return(Array.isArray(i.value)?i.value:[]).length===o}),we=ne(()=>{if(!R.value)return c.value;const o={};return Object.entries(c.value).forEach(([s,t])=>{const r=t.filter(u=>u.display_name.toLowerCase().includes(R.value.toLowerCase())||u.description.toLowerCase().includes(R.value.toLowerCase()));r.length>0&&(o[s]=r)}),o});return ke(async()=>{await q()}),$e([i,c],()=>{}),(o,s)=>(l(),d("div",qe,[e("div",Ze,[s[7]||(s[7]=e("div",null,[e("h1",{class:"text-3xl font-bold text-gray-900"},"權限管理"),e("p",{class:"text-gray-600 mt-2"},"管理用戶權限和角色設定")],-1)),e("div",Qe,[e("button",{onClick:s[0]||(s[0]=t=>L.value=!0),class:"inline-flex items-center px-4 py-2 bg-primary-500 text-white rounded-lg hover:bg-primary-600 transition-colors duration-200"},[k(a(ce),{class:"w-4 h-4 mr-2"}),s[6]||(s[6]=le(" 快速分配 ",-1))]),e("button",{onClick:s[1]||(s[1]=t=>j.value=a(j)==="roles"?"matrix":"roles"),class:"inline-flex items-center px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors duration-200"},[(l(),F(M(a(j)==="roles"?a(De):a(Le)),{class:"w-4 h-4 mr-2"})),le(" "+m(a(j)==="roles"?"矩陣視圖":"角色視圖"),1)])])]),a(v)?(l(),d("div",Ge,[...s[8]||(s[8]=[e("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-500 mx-auto mb-4"},null,-1),e("p",{class:"text-gray-600"},"載入權限資料中...",-1)])])):(l(),d("div",Ie,[a(j)==="roles"?(l(),d("div",Je,[e("div",Ke,[e("div",We,[s[9]||(s[9]=e("h2",{class:"text-xl font-semibold text-gray-900"},"選擇管理角色",-1)),e("div",Xe," 共 "+m(a(y).length)+" 個角色 ",1)]),e("div",Ye,[(l(!0),d(p,null,_(a(y),t=>(l(),d("div",{key:t.id,onClick:r=>ue(t),class:P(["relative p-4 border-2 rounded-lg cursor-pointer transition-all duration-200 hover:shadow-md",{"border-primary-500 bg-primary-50":a(n)?.id===t.id,"border-gray-200 hover:border-gray-300":a(n)?.id!==t.id}])},[e("div",es,[e("div",{class:P(["p-2 rounded-lg",W(t.name)])},[(l(),F(M(B(t.name)),{class:P(["w-5 h-5",H(t.name)])},null,8,["class"]))],2),e("div",null,[e("h3",ss,m(t.display_name),1)])]),e("div",ts,[e("div",os,[s[10]||(s[10]=e("span",{class:"text-xs text-gray-500"},"用戶數",-1)),e("span",rs,m(U(t.id).length),1)]),e("div",as,[s[11]||(s[11]=e("span",{class:"text-xs text-gray-500"},"權限數",-1)),e("span",ns,m(xe(t.id)),1)])]),a(n)?.id===t.id?(l(),d("div",ls,[k(a(Be),{class:"w-5 h-5 text-primary-500"})])):A("",!0)],10,Ne))),128))])]),a(n)?(l(),d("div",is,[e("div",cs,[e("div",ds,[e("div",us,[e("div",ms,[e("div",{class:P(["p-2 rounded-lg",W(a(n).name)])},[(l(),F(M(B(a(n).name)),{class:P(["w-6 h-6",H(a(n).name)])},null,8,["class"]))],2),e("div",null,[e("h2",vs,m(a(n).display_name)+" 權限設定",1),s[12]||(s[12]=e("p",{class:"text-sm text-gray-500"},"管理此角色的系統權限",-1))])]),e("div",gs,[e("button",{onClick:ge,class:"text-sm text-primary-600 hover:text-primary-800"},m(a(ae)?"取消全選":"全選"),1)])]),e("div",ys,[(l(!0),d(p,null,_(a(c),(t,r)=>(l(),d("div",{key:r,class:"border border-gray-200 rounded-lg"},[e("div",{onClick:u=>me(r),class:"flex items-center justify-between p-4 cursor-pointer hover:bg-gray-50 transition-colors duration-200"},[e("div",xs,[(l(),F(M(Array.isArray(a(w))&&a(w).includes(r)?a(Ee):a(Ve)),{class:"w-4 h-4 text-gray-400"})),e("h3",hs,m(X(r)),1),e("span",ps,m(N(r)),1)]),e("div",_s,[e("div",ws,m(ee(r))+"/"+m(t.length)+" 已選 ",1),e("input",{type:"checkbox",checked:se(r),indeterminate:he(r),onClick:Ce(u=>ve(r),["stop"]),class:"w-4 h-4 text-primary-600 bg-gray-100 border-gray-300 rounded focus:ring-primary-500"},null,8,bs)])],8,fs),Array.isArray(a(w))&&a(w).includes(r)?(l(),d("div",ks,[e("div",$s,[(l(!0),d(p,null,_(t,u=>(l(),d("div",{key:u.id,class:"flex items-start space-x-3 p-3 rounded-lg hover:bg-gray-50 transition-colors duration-200"},[e("input",{id:`perm-${u.id}`,type:"checkbox",checked:Array.isArray(a(i))?a(i).includes(u.name):!1,onChange:f=>K(u.name),class:"w-4 h-4 mt-1 text-primary-600 bg-gray-100 border-gray-300 rounded focus:ring-primary-500"},null,40,As),e("div",Ps,[e("label",{for:`perm-${u.id}`,class:"block text-sm font-medium text-gray-900 cursor-pointer"},m(u.display_name),9,Cs),e("p",Rs,m(u.description),1)])]))),128))])])):A("",!0)]))),128))])])]),e("div",Fs,[e("div",Ms,[s[16]||(s[16]=e("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"角色統計",-1)),e("div",js,[e("div",Us,[s[13]||(s[13]=e("span",{class:"text-sm text-gray-600"},"用戶數量",-1)),e("span",Es,m(U(a(n).id).length),1)]),e("div",Vs,[s[14]||(s[14]=e("span",{class:"text-sm text-gray-600"},"權限數量",-1)),e("span",Ss,m(a(i).length),1)]),e("div",Ds,[s[15]||(s[15]=e("span",{class:"text-sm text-gray-600"},"完整度",-1)),e("span",Bs,m(Math.round(a(i).length/oe()*100))+"% ",1)])])]),e("div",Hs,[e("div",Ts,[s[18]||(s[18]=e("h3",{class:"text-lg font-semibold text-gray-900"},"此角色的用戶",-1)),e("button",{onClick:s[2]||(s[2]=t=>S.value=!0),class:"text-sm text-primary-600 hover:text-primary-800 flex items-center space-x-1"},[k(a(ce),{class:"w-4 h-4"}),s[17]||(s[17]=e("span",null,"分配用戶",-1))])]),e("div",zs,[(l(!0),d(p,null,_(U(a(n).id),t=>(l(),d("div",{key:t.id,class:"flex items-center space-x-3 p-3 bg-gray-50 rounded-lg"},[e("img",{src:t.avatar||`https://ui-avatars.com/api/?name=${encodeURIComponent(t.name)}&background=6366f1&color=fff`,alt:t.name,class:"w-8 h-8 rounded-full"},null,8,Ls),e("div",Os,[e("div",qs,m(t.name),1),e("div",Zs,m(t.email),1)]),e("button",{onClick:r=>_e(t.id,a(n).id),class:"text-red-600 hover:text-red-800"},[k(a(Q),{class:"w-4 h-4"})],8,Qs)]))),128)),U(a(n).id).length===0?(l(),d("div",Gs,[k(a(He),{class:"w-8 h-8 text-gray-400 mx-auto mb-2"}),s[19]||(s[19]=e("p",{class:"text-sm text-gray-500"},"此角色暫無用戶",-1))])):A("",!0)])])])])):A("",!0)])):(l(),d("div",Is,[e("div",Js,[e("div",Ks,[s[20]||(s[20]=e("h2",{class:"text-xl font-semibold text-gray-900"},"權限矩陣視圖",-1)),e("div",Ws,[ie(e("input",{"onUpdate:modelValue":s[3]||(s[3]=t=>Pe(R)?R.value=t:null),type:"text",placeholder:"搜尋權限...",class:"px-3 py-2 border border-gray-300 rounded-lg text-sm"},null,512),[[Ae,a(R)]])])]),e("div",Xs,[e("table",Ys,[e("thead",null,[e("tr",Ns,[s[21]||(s[21]=e("th",{class:"text-left py-3 px-4 font-medium text-gray-900 sticky left-0 bg-white z-10"}," 權限 ",-1)),(l(!0),d(p,null,_(a(y),t=>(l(),d("th",{key:t.id,class:"text-center py-3 px-2 font-medium text-gray-900 min-w-24"},[e("div",et,[(l(),F(M(B(t.name)),{class:P(["w-4 h-4",H(t.name)])},null,8,["class"])),e("span",st,m(t.display_name),1)])]))),128))])]),e("tbody",null,[(l(!0),d(p,null,_(a(we),(t,r)=>(l(),d(p,{key:r},[e("tr",tt,[e("td",ot,m(X(r)),1)]),(l(!0),d(p,null,_(t,u=>(l(),d("tr",{key:u.id,class:"border-b border-gray-100 hover:bg-gray-50"},[e("td",rt,[e("div",null,[e("div",at,m(u.display_name),1),e("div",nt,m(u.description),1)])]),(l(!0),d(p,null,_(a(y),f=>(l(),d("td",{key:f.id,class:"text-center py-3 px-2"},[e("input",{type:"checkbox",checked:pe(u.name,f.id),onChange:Vt=>fe(f.id,u.name),class:"w-4 h-4 text-primary-600 bg-gray-100 border-gray-300 rounded focus:ring-primary-500"},null,40,lt)]))),128))]))),128))],64))),128))])])])])]))])),a(L)?(l(),d("div",it,[e("div",ct,[e("div",dt,[e("div",ut,[s[22]||(s[22]=e("h3",{class:"text-lg font-medium text-gray-900"},"快速用戶角色分配",-1)),e("button",{onClick:s[4]||(s[4]=t=>L.value=!1),class:"text-gray-400 hover:text-gray-600"},[k(a(Q),{class:"w-5 h-5"})])]),e("div",mt,[e("div",null,[s[24]||(s[24]=e("h4",{class:"text-sm font-medium text-gray-900 mb-3"},"用戶",-1)),e("div",vt,[(l(!0),d(p,null,_(a(C),t=>(l(),d("div",{key:t.id,class:"flex items-center space-x-3 p-2 rounded hover:bg-gray-50"},[e("img",{src:t.avatar||`https://ui-avatars.com/api/?name=${encodeURIComponent(t.name)}&background=6366f1&color=fff`,alt:t.name,class:"w-6 h-6 rounded-full"},null,8,gt),e("div",yt,[e("div",ft,m(t.name),1)]),ie(e("select",{"onUpdate:modelValue":r=>a(O)[t.id]=r,onChange:r=>ye(t.id,a(O)[t.id]),class:"text-xs border border-gray-300 rounded"},[s[23]||(s[23]=e("option",{value:""},"選擇角色",-1)),(l(!0),d(p,null,_(a(y),r=>(l(),d("option",{key:r.id,value:r.id},m(r.display_name),9,ht))),128))],40,xt),[[Re,a(O)[t.id]]])]))),128))])]),e("div",null,[s[25]||(s[25]=e("h4",{class:"text-sm font-medium text-gray-900 mb-3"},"角色分佈",-1)),e("div",pt,[(l(!0),d(p,null,_(a(y),t=>(l(),d("div",{key:t.id,class:"flex items-center justify-between p-2 bg-gray-50 rounded"},[e("div",_t,[(l(),F(M(B(t.name)),{class:P(["w-4 h-4",H(t.name)])},null,8,["class"])),e("span",wt,m(t.display_name),1)]),e("span",bt,m(U(t.id).length),1)]))),128))])])])])])])):A("",!0),a(S)?(l(),d("div",kt,[e("div",$t,[e("div",At,[e("div",Pt,[s[26]||(s[26]=e("h3",{class:"text-lg font-medium text-gray-900"},"分配用戶到角色",-1)),e("button",{onClick:s[5]||(s[5]=t=>S.value=!1),class:"text-gray-400 hover:text-gray-600"},[k(a(Q),{class:"w-5 h-5"})])]),e("div",Ct,[(l(!0),d(p,null,_(Y(a(n)?.id),t=>(l(),d("div",{key:t.id,class:"flex items-center space-x-3 p-3 border border-gray-200 rounded-lg hover:bg-gray-50"},[e("img",{src:t.avatar||`https://ui-avatars.com/api/?name=${encodeURIComponent(t.name)}&background=6366f1&color=fff`,alt:t.name,class:"w-8 h-8 rounded-full"},null,8,Rt),e("div",Ft,[e("div",Mt,m(t.name),1),e("div",jt,m(t.email),1)]),e("button",{onClick:r=>re(t.id,a(n).id),class:"text-primary-600 hover:text-primary-800"},[k(a(Te),{class:"w-4 h-4"})],8,Ut)]))),128)),Y(a(n)?.id).length===0?(l(),d("div",Et,[...s[27]||(s[27]=[e("p",{class:"text-sm text-gray-500"},"所有用戶已分配此角色",-1)])])):A("",!0)])])])])):A("",!0)]))}};export{Jt as default};
